import{n as s,g as c,d as m,r as l,u as i}from"./index-9PYfvHl5.js";import{p as f}from"./DNiMR7Uc-BXvHAZ5J.js";var k=Object.defineProperty,h=(o,e,a)=>e in o?k(o,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[e]=a,d=(o,e,a)=>h(o,typeof e!="symbol"?e+"":e,a);const{FaceLandmarker:u,FilesetResolver:p}=f;class g{constructor(){d(this,"faceLandmarker"),d(this,"runningMode","IMAGE"),d(this,"modelLocation",s.CDN)}getModelAssetPath(e){switch(e){case s.CDN:return"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task";case s.SelfHosted:const{protocol:a,host:t}=window.location,r="models/mpvision/face_landmarker/face_landmarker/float16/1/face_landmarker.task",n=c.loadModelsFromRoot?`${a}//${t}/`:document.baseURI;return new URL(r,n).href}}getWasmPath(e){switch(e){case s.CDN:return"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm";case s.SelfHosted:const{protocol:a,host:t}=window.location,r="models/mpvision/tasks-vision@0.10.9/wasm",n=c.loadModelsFromRoot?`${a}//${t}/`:document.baseURI;return new URL(r,n).href}}async createFaceLandmarker(e){const a=this.getWasmPath(e||s.SelfHosted),t=await p.forVisionTasks(a),r=this.getModelAssetPath(e||s.SelfHosted);this.faceLandmarker=await u.createFromOptions(t,{baseOptions:{modelAssetPath:r,delegate:"GPU"},outputFaceBlendshapes:!0,runningMode:this.runningMode,numFaces:1})}async loadModels(e){var a;await this.createFaceLandmarker(e||this.modelLocation),(a=this.faceLandmarker)==null||a.detect(await m())}async detect(e){const a=l(e);if(this.faceLandmarker===void 0)return{faceBox:void 0,landmarks:[],videoFrame:a};const t=this.faceLandmarker.detect(a);if(t.faceLandmarks.length===0)return{faceBox:void 0,landmarks:[],videoFrame:a};const r=t.faceLandmarks[0];return{faceBox:i(r),landmarks:r,videoFrame:a}}async detectInWorker(e){if(this.faceLandmarker===void 0)return{faceBox:void 0,landmarks:[],videoFrame:e};const a=this.faceLandmarker.detect(e);if(a.faceLandmarks.length===0)return{faceBox:void 0,landmarks:[],videoFrame:e};const t=a.faceLandmarks[0];return{faceBox:i(t),landmarks:t,videoFrame:e}}}export{g as MPVisionFaceMeshDetector};

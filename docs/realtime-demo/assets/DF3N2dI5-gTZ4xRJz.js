import{j as g}from"./index-BUEQIYUR.js";var p=Object.defineProperty,d=(o,e,t)=>e in o?p(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,y=(o,e,t)=>d(o,typeof e!="symbol"?e+"":e,t);async function u(o,e){const t=await o.getCanvas();e.yCenter-=e.height*.15,e.width*=1.2,e.height*=1.3;let a=e.width*t.width,n=e.height*t.height,s=(e.xCenter-e.width/2)*t.width,r=(e.yCenter-e.height/2)*t.height;if(a==0||n==0)return;let i=document.createElement("canvas");const c=256,h=Math.max(c/a,c/n,1);i.width=a*h,i.height=n*h;let l=i.getContext("2d");return l?.drawImage(t,s,r,a,n,0,0,i.width,i.height),h>1&&console.log("[Beauty Analyzer] Enlarge face to 256x256 if needed."),i}class A{constructor(e){y(this,"config"),y(this,"state","ready"),y(this,"photo"),y(this,"result"),this.config=e,this.config.development=e.development||!0,console.log("[Beauty Analyzer] Created.")}async analyze(e){if(this.photo===void 0){console.log("[Beauty Analyzer] No photo to analyze.");return}const t=await this.photo;if(t===void 0){console.log("[Beauty Analyzer] No face image to analyze.");return}return await this.callApi({faceImage:t,apiKey:this.config.apiKey,facialSkinAge:e})}async callApi(e){const t={"Content-Type":"application/octet-stream",Accept:"application/json"},a=e.apiKey||this.config.apiKey;a&&(t["X-Api-Key"]=a),e.facialSkinAge!==void 0&&(t["X-Skin-Age"]=e.facialSkinAge.toString());const n=e.faceImage.toDataURL("image/jpeg"),s=atob(n.split(",")[1]),r=new ArrayBuffer(s.length),i=new Uint8Array(r);for(let l=0;l<s.length;l++)i[l]=s.charCodeAt(l);const c=new Blob([i],{type:"image/jpeg"}),h=this.config.development===!0?"https://aws-backend.panoptic.ai/beauty-dev/process":"https://aws-backend.panoptic.ai/beauty/process";return await(await fetch(h,{method:"POST",headers:t,body:c})).json()}processFrame(e,t,a,n,s){switch(n){case g.Idle:this.state="ready",this.photo=void 0;break;case g.CollectingData:if(this.state!=="ready"||(this.photo===void 0&&(this.photo=u(e,t),console.log("[Beauty Analyzer] Photo taken.")),a===void 0))break;this.state="busy",console.log("[Beauty Analyzer] Analyzing..."),this.analyze(a).then(r=>{this.result=r,this.state="done",console.log("[Beauty Analyzer] Done",this.result)});break;case g.AnalyzingData:if(this.state!=="ready"||s<4||a===void 0&&s>1)break;this.state="busy",console.log("[Beauty Analyzer] Analyzing..."),this.analyze(a).then(r=>{this.result=r,this.state="done",console.log("[Beauty Analyzer] Done",this.result)});break}}}export{A as RemoteBeautyAnalyzer};

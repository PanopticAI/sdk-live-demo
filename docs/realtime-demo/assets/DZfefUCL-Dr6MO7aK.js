import{u as r,U as d,k as m,b as l,c as i}from"./index-D-BKjTUD.js";import{p as f}from"./DNiMR7Uc-BXvHAZ5J.js";var k=Object.defineProperty,h=(o,e,a)=>e in o?k(o,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[e]=a,c=(o,e,a)=>h(o,typeof e!="symbol"?e+"":e,a);const{FaceLandmarker:u,FilesetResolver:p}=f;class F{constructor(){c(this,"faceLandmarker"),c(this,"runningMode","IMAGE"),c(this,"modelLocation",r.CDN)}getModelAssetPath(e){switch(e){case r.CDN:return"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task";case r.SelfHosted:const{protocol:a,host:t}=window.location,s="models/mpvision/face_landmarker/face_landmarker/float16/1/face_landmarker.task",n=d.loadModelsFromRoot?`${a}//${t}/`:document.baseURI;return new URL(s,n).href}}getWasmPath(e){switch(e){case r.CDN:return"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm";case r.SelfHosted:const{protocol:a,host:t}=window.location,s="models/mpvision/tasks-vision@0.10.9/wasm",n=d.loadModelsFromRoot?`${a}//${t}/`:document.baseURI;return new URL(s,n).href}}async createFaceLandmarker(e){const a=this.getWasmPath(e||r.SelfHosted),t=await p.forVisionTasks(a),s=this.getModelAssetPath(e||r.SelfHosted);this.faceLandmarker=await u.createFromOptions(t,{baseOptions:{modelAssetPath:s,delegate:"GPU"},outputFaceBlendshapes:!0,runningMode:this.runningMode,numFaces:1})}async loadModels(e){var a;await this.createFaceLandmarker(e||this.modelLocation),(a=this.faceLandmarker)==null||a.detect(await m())}async detect(e){const a=l(e);if(this.faceLandmarker===void 0)return{faceBox:void 0,landmarks:[],videoFrame:a};const t=this.faceLandmarker.detect(a);if(t.faceLandmarks.length===0)return{faceBox:void 0,landmarks:[],videoFrame:a};const s=t.faceLandmarks[0];return{faceBox:i(s),landmarks:s,videoFrame:a}}async detectInWorker(e){if(this.faceLandmarker===void 0)return{faceBox:void 0,landmarks:[],videoFrame:e};const a=this.faceLandmarker.detect(e);if(a.faceLandmarks.length===0)return{faceBox:void 0,landmarks:[],videoFrame:e};const t=a.faceLandmarks[0];return{faceBox:i(t),landmarks:t,videoFrame:e}}}export{F as MPVisionFaceMeshDetector};

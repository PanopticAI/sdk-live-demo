const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BZv7hKWF-CN-8B7cM.js","assets/CHLN02Hd-bYoJUYLc.js","assets/DUElpq7j-D6AVsVFW.js","assets/NLcWG4bS-eyrYbbK2.js","assets/PuLtFuKi-DwYa-1A5.js","assets/CdFMc3zZ-_GH66VcY.js","assets/DNiMR7Uc-BXvHAZ5J.js","assets/CVxazVkC-VC5h-GWa.js","assets/D3SGl8y2-B7wHqFd5.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const h of o)if(h.type==="childList")for(const c of h.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(o){const h={};return o.integrity&&(h.integrity=o.integrity),o.referrerPolicy&&(h.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?h.credentials="include":o.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function n(o){if(o.ep)return;o.ep=!0;const h=t(o);fetch(o.href,h)}})();const Ps="modulepreload",Fs=function(s){return"/realtime-demo/"+s},At={},Ce=function(e,t,n){let o=Promise.resolve();if(t&&t.length>0){let m=function(p){return Promise.all(p.map(x=>Promise.resolve(x).then(R=>({status:"fulfilled",value:R}),R=>({status:"rejected",reason:R}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),r=c?.nonce||c?.getAttribute("nonce");o=m(t.map(p=>{if(p=Fs(p),p in At)return;At[p]=!0;const x=p.endsWith(".css"),R=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${R}`))return;const w=document.createElement("link");if(w.rel=x?"stylesheet":Ps,x||(w.as="script"),w.crossOrigin="",w.href=p,r&&w.setAttribute("nonce",r),document.head.appendChild(w),x)return new Promise((y,v)=>{w.addEventListener("load",y),w.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${p}`)))})}))}function h(c){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=c,window.dispatchEvent(r),!r.defaultPrevented)throw c}return o.then(c=>{for(const r of c||[])r.status==="rejected"&&h(r.reason);return e().catch(h)})};var As=Object.defineProperty,Is=(s,e,t)=>e in s?As(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,d=(s,e,t)=>Is(s,typeof e!="symbol"?e+"":e,t),pi=(s=>(s[s.Male=0]="Male",s[s.Female=1]="Female",s))(pi||{}),Je=(s=>(s[s.Poor=0]="Poor",s[s.Good=1]="Good",s[s.Excellent=2]="Excellent",s))(Je||{}),ie=(s=>(s[s.Local=0]="Local",s[s.LocalV2=101]="LocalV2",s[s.RemoteDev=1]="RemoteDev",s[s.RemoteProd=2]="RemoteProd",s[s.AwsDev=3]="AwsDev",s[s.AwsProd=4]="AwsProd",s[s.RemoteProdEnterprise=5]="RemoteProdEnterprise",s[s.AwsFirebaseEnterpriseProd=5]="AwsFirebaseEnterpriseProd",s[s.AwsProdEnterprise=6]="AwsProdEnterprise",s[s.AwsEnterpriseProd=6]="AwsEnterpriseProd",s[s.AwsDevEnterprise=7]="AwsDevEnterprise",s[s.AwsEnterpriseDev=7]="AwsEnterpriseDev",s[s.FdaDev=8]="FdaDev",s[s.FdaProd=9]="FdaProd",s[s.Schema2Dev=10]="Schema2Dev",s[s.Schema2Prod=11]="Schema2Prod",s))(ie||{}),We=(s=>(s[s.default=0]="default",s[s.dummy=1]="dummy",s))(We||{}),N=(s=>(s[s.WaitingData=0]="WaitingData",s[s.CollectingData=1]="CollectingData",s[s.AnalyzingData=2]="AnalyzingData",s[s.Idle=3]="Idle",s))(N||{});async function Bs(s,e){return new Promise(t=>{setTimeout(()=>{t(e)},s*1e3)})}function q(...s){console.log("[VSE Plugin]",...s)}function _s(s){let e="";const t=(s.length-s.length*.8)/2;for(let n=0;n<s.length;n++)n>=t&&n<s.length-t?e+="#":e+=s[n];return e}let Qe;const Os=new Uint8Array(16);function Vs(){if(!Qe&&(Qe=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Qe))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Qe(Os)}const oe=[];for(let s=0;s<256;++s)oe.push((s+256).toString(16).slice(1));function $s(s,e=0){return oe[s[e+0]]+oe[s[e+1]]+oe[s[e+2]]+oe[s[e+3]]+"-"+oe[s[e+4]]+oe[s[e+5]]+"-"+oe[s[e+6]]+oe[s[e+7]]+"-"+oe[s[e+8]]+oe[s[e+9]]+"-"+oe[s[e+10]]+oe[s[e+11]]+oe[s[e+12]]+oe[s[e+13]]+oe[s[e+14]]+oe[s[e+15]]}const Ls=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),It={randomUUID:Ls};function Et(s,e,t){if(It.randomUUID&&!s)return It.randomUUID();s=s||{};const n=s.random||(s.rng||Vs)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,$s(n)}function Bt(s,e){return(e.getTime()-s.getTime())/1e3}function Us(s,e){if(s.length!=e.length)return!1;for(let t=0;t<s.length;t++)if(s[t].x!=e[t].x||s[t].y!=e[t].y)return!1;return!0}function vt(s,e){return Math.sqrt((e.x-s.x)*(e.x-s.x)+(e.y-s.y)*(e.y-s.y))}function Hs(s,e,t=20){let n="|";for(let o=0;o<t;o++)o/t>e?n+=" ":n+="█";return n+=`| ${e.toFixed(2)}`,`${s}: ${n}`}function de(...s){console.log("[Blink Detector]",...s)}let vi=class{constructor(s="",e=!1){d(this,"frameCount",0),d(this,"start",new Date),d(this,"name","noname"),d(this,"enableLog",!1),d(this,"lastLogTime",new Date),d(this,"logInterval",10),this.name=s,this.enableLog=e}get averageFps(){if(this.frameCount===0&&(this.start=new Date),!(this.elapsed<.5))return this.frameCount/this.elapsed}get elapsed(){return(new Date().getTime()-this.start.getTime())/1e3}tick(){this.frameCount=this.frameCount+1}reset(){this.frameCount=0,this.start=new Date,this.lastLogTime=new Date}log(){if(this.averageFps==null||(new Date().getTime()-this.lastLogTime.getTime())/1e3<this.logInterval)return;const s=this.averageFps.toFixed(2);this.enableLog&&(console.log(`[FPS ${this.name}] (${this.frameCount}/${this.elapsed})) ${s}fps`),this.lastLogTime=new Date)}};class st{constructor(e,t){d(this,"duration"),d(this,"name"),d(this,"observers",[]),d(this,"startTime",new Date),d(this,"fps"),d(this,"signals",[]),this.name=e,this.fps=new vi(e),this.duration=t}get size(){return this.fps.averageFps===void 0?10:this.fps.averageFps*this.duration}clear(){this.signals=[],this.fps.reset(),this.startTime=new Date}add(e){if(this.fps.tick(),this.observers.forEach(t=>{var n;return(n=t.willAdd)==null?void 0:n.call(t,e)}),this.signals.length<this.size)this.signals.push({timestamp:new Date,value:e});else{for(;this.signals.length>this.size;)this.signals.shift();this.signals.push({timestamp:new Date,value:e})}this.observers.forEach(t=>{var n;return(n=t.onAdded)==null?void 0:n.call(t,e)})}get max(){return this.signals.length===0?0:Math.max(...this.signals.map(e=>e.value))}get lastEntry(){if(this.signals.length!==0)return this.signals[this.signals.length-1]}get last(){if(this.signals.length!=0)return this.signals[this.signals.length-1].value}visualize(e=0,t=1,n=20){const o=this.lastEntry||{timestamp:new Date,value:0};let h="|";for(let c=0;c<n;c++){const r=e+c/n*(t-e);r>=0?r>o.value?h+=" ":h+="█":r<o.value?h+=" ":h+="█"}return h+=`| ${o.value.toFixed(2)}`,`${((o.timestamp.getTime()-this.startTime.getTime())/1e3).toFixed(2)}s ${this.name}: ${h}`}derivative(){const e=new st(`${this.name}'`,this.size),t=this;return this.observers.push({willAdd(n){t.last!==void 0&&e.add(n-t.last)}}),e}detectPeak(e,t){if(this.fps.averageFps===void 0)return!1;const n=Math.min(Math.floor(this.fps.averageFps*e),this.signals.length);if(n<2||this.signals.length<2)return!1;const o=this.signals[this.signals.length-1].value,h=this.signals.slice(this.signals.length-1-n,this.signals.length-2).map(r=>r.value),c=Ns(h);return o-c>c*t}}function Ns(s){return s.reduce((e,t)=>e+t,0)/s.length}const Ws=.2,zs=1/20,js=.5,Gs=2,qs=2;class Qs{constructor(e="No name"){d(this,"name"),d(this,"movement",0),d(this,"debug",!1),d(this,"config",{movementThreshold:Ws,startMovementDurationThreshold:zs,stopMovementDurationThreshold:js,freezedTheshold:Gs,movementDurationThreshold:qs,normalizeValue:.02}),d(this,"lastPosition"),d(this,"startMoveTime"),d(this,"startStayTime"),d(this,"lastZeroMovementTime"),d(this,"_isMoving",!1),d(this,"_lastStateChagneTime"),this.name=e}configure(e){e.stopMovementDurationThreshold!==void 0&&(de("Configure Movement Detector stopMovementDurationThreshold: ",e.stopMovementDurationThreshold),this.config.stopMovementDurationThreshold=e.stopMovementDurationThreshold),e.startMovementDurationThreshold!==void 0&&(de("Configure Movement Detector startMovementDurationThreshold: ",e.startMovementDurationThreshold),this.config.startMovementDurationThreshold=e.startMovementDurationThreshold),e.movementThreshold!==void 0&&(de("Configure Movement Detector movementThreshold: ",e.movementThreshold),this.config.movementThreshold=e.movementThreshold),e.freezedTheshold!==void 0&&(de("Configure Movement Detector freezedTheshold: ",e.freezedTheshold),this.config.freezedTheshold=e.freezedTheshold),e.unstableDurationThreshold!==void 0&&(de("Configure Movement Detector unstableDurationThreshold: ",e.unstableDurationThreshold),this.config.movementDurationThreshold=e.unstableDurationThreshold)}reset(){this.lastPosition=void 0,this.startMoveTime=void 0,this.startStayTime=void 0,this.lastZeroMovementTime=void 0,this._lastStateChagneTime=void 0,this._isMoving=!1}get movedLongEnough(){return this.startMoveTime===void 0?!1:Bt(this.startMoveTime,new Date)>this.config.startMovementDurationThreshold}get stayStillLongEnough(){return this.startStayTime===void 0?!1:Bt(this.startStayTime,new Date)>this.config.stopMovementDurationThreshold}update(e){if(this.lastPosition===void 0){this.lastPosition=e;return}this.movement=vt(e,this.lastPosition)/this.config.normalizeValue,this.lastPosition=e,this.movement>this.config.movementThreshold?(this.startStayTime=void 0,this.startMoveTime===void 0&&(this.startMoveTime=new Date),this.movedLongEnough&&(this.isMoving=!0)):(this.startMoveTime=void 0,this.startStayTime===void 0&&(this.startStayTime=new Date),this.stayStillLongEnough&&(this.isMoving=!1)),this.debugLog(Hs("Movement",this.movement)),this.movement===0?this.lastZeroMovementTime===void 0&&(this.lastZeroMovementTime=new Date):this.lastZeroMovementTime=void 0}get isDead(){return this.lastZeroMovementTime===void 0?!1:(new Date().getTime()-this.lastZeroMovementTime.getTime())/1e3>this.config.freezedTheshold}get unstable(){return this._lastStateChagneTime===void 0||!this.isMoving?!1:(new Date().getTime()-this._lastStateChagneTime.getTime())/1e3>this.config.movementDurationThreshold}get isMoving(){return this._isMoving}set isMoving(e){this._isMoving!==e&&(this._isMoving=e,this._lastStateChagneTime=new Date,this._isMoving?this.debugLog(`${this.name} is moving.`):this.debugLog(`${this.name} is not moving`))}debugLog(...e){this.debug&&de(...e)}}class wi{constructor(e,t){d(this,"landmarks",[]),d(this,"ltrb"),d(this,"name"),d(this,"fps"),d(this,"ears"),d(this,"movementDetector"),this.ltrb=e,this.name=t,this.fps=new vi(t),this.movementDetector=new Qs(t),this.ears=new st(`${t} EAR`,2)}reset(){this.movementDetector.reset(),this.fps.reset(),this.ears.clear()}update(e){Us(this.landmarks,e)||this.fps.tick(),this.fps.log(),this.landmarks=e,this.ears.add(this.aspectRatio),this.movementDetector.update(this.midPoint)}get maxEar(){return this.ears.max}get normalizedEar(){return this.aspectRatio/this.maxEar}get averageFps(){return this.fps.averageFps}get movement(){return this.movementDetector.movement}get isMoving(){return this.movementDetector.isMoving}get detectionLost(){return this.movementDetector.isDead}get unstable(){return this.movementDetector.unstable}get leftPoint(){return{x:this.landmarks[this.ltrb.left].x,y:this.landmarks[this.ltrb.left].y}}get rightPoint(){return{x:this.landmarks[this.ltrb.right].x,y:this.landmarks[this.ltrb.right].y}}get topPoint(){return{x:this.landmarks[this.ltrb.top].x,y:this.landmarks[this.ltrb.top].y}}get bottomPoint(){return{x:this.landmarks[this.ltrb.bottom].x,y:this.landmarks[this.ltrb.bottom].y}}get width(){return vt(this.leftPoint,this.rightPoint)}get height(){return vt(this.topPoint,this.bottomPoint)}get aspectRatio(){return this.height/this.width}get midPoint(){return{x:(this.leftPoint.x+this.rightPoint.x)/2,y:(this.leftPoint.y+this.rightPoint.y)/2}}}const Ye=[[263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]],Ke=[[33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]],Ys={left:Ye[0][0],top:Ye[11][1],right:Ye[15][1],bottom:Ye[4][0]},Ks={left:Ke[0][0],top:Ke[11][1],right:Ke[15][1],bottom:Ke[4][0]};class Xs extends wi{constructor(){super(Ys,"Left Eye")}}class Js extends wi{constructor(){super(Ks,"Right Eye")}}class Zs{constructor(){d(this,"fps",15),d(this,"blinkCount",5),d(this,"noEyes",!1),d(this,"unstable",!1)}configure(e){}reset(){}detect(e){return!0}}const en=.15,tn=10;class sn{constructor(){d(this,"leftEye",new Xs),d(this,"rightEye",new Js),d(this,"avgEars"),d(this,"dEars"),d(this,"debug",!1),d(this,"_blinkCount",0),d(this,"_isReset",!1),d(this,"config",{enableBlinkDetector:!0,minFps:tn,earDiffThreshold:en,enableMovementDetection:!0}),de("Blink detector created"),this.avgEars=new st("EAR",this.leftEye.ears.duration),this.dEars=this.avgEars.derivative()}configure(e){e.earDiffThreshold!==void 0&&(de("Configure Blink Detector earDiffThreshold: ",e.earDiffThreshold),this.config.earDiffThreshold=e.earDiffThreshold),e.minFps!==void 0&&(de("Configure Blink Detector minFps: ",e.minFps),this.config.minFps=e.minFps),e.enableMovementDetection&&(de("Configure Blink Detector enableMovementDetection: ",e.enableMovementDetection),this.config.enableMovementDetection=e.enableMovementDetection),this.leftEye.movementDetector.configure(e),this.rightEye.movementDetector.configure(e)}get noEyes(){return this.leftEye.detectionLost||this.rightEye.detectionLost}get unstable(){return this.leftEye.unstable||this.rightEye.unstable}get fps(){return((this.leftEye.averageFps||0)+(this.rightEye.averageFps||0))/2}reset(){this._isReset=!0,this._blinkCount=0,this.leftEye.reset(),this.rightEye.reset(),this.avgEars.clear(),this.dEars.clear()}get blinkCount(){return this.leftEye.averageFps!==void 0&&this.rightEye.averageFps!==void 0&&this.leftEye.averageFps<this.config.minFps&&this.rightEye.averageFps<this.config.minFps?(de(`FPS < ${this.config.minFps}, blink detection is unreliable. Always return blink count 1.`),1):this._blinkCount}detect(e){if(this._isReset||this.reset(),this.leftEye.update(e),this.rightEye.update(e),this.config.enableMovementDetection){if(this.unstable)return de("Error: unstable eyes"),!1;if(this.leftEye.isMoving||this.rightEye.isMoving)return!1;if(this.noEyes)return de("Error: no eyes"),!1}this.avgEars.add(1-(this.leftEye.normalizedEar+this.rightEye.normalizedEar)/2);const t=this.dEars.last||0,n=t>this.config.earDiffThreshold;if(this.debug&&de(this.dEars.visualize(-1,1,30)),n){this._blinkCount++;const o=((this.leftEye.averageFps||0)+(this.rightEye.averageFps||0))/2;de(`Blink Detected ${this._blinkCount}. EAR_DIFF=${t.toFixed(2)} FPS=${o.toFixed(1)}`)}return n}}function _t(s){switch(s){case We.default:return new sn;case We.dummy:return new Zs}}const yi=class bi{constructor(){d(this,"endpoint","https://aws-backend.panoptic.ai/s3/"),d(this,"s3ApiKey","TJ3CJ2ebRs0YK3HIwopu529q92qAZ1waBI5mWIq5")}async getDataFromS3(e,t){try{const n={type:"get-json",params:{bucket:e,objectKey:t}},o={"Content-Type":"application/json","X-Api-Key":this.s3ApiKey},h=await fetch(this.endpoint,{method:"POST",headers:o,body:JSON.stringify(n)});if(h.status!=200)throw new Error(h.statusText);return await h.json()}catch(n){throw console.error(`${bi.TAG}: Error fetching data from S3:`,n),n}}};d(yi,"TAG","AWS S3 Client");let nn=yi;var ko=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function an(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function Do(s){if(Object.prototype.hasOwnProperty.call(s,"__esModule"))return s;var e=s.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(n){var o=Object.getOwnPropertyDescriptor(s,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return s[n]}})}),t}var Ot={},je={},Vt;function on(){if(Vt)return je;Vt=1,je.byteLength=r,je.toByteArray=p,je.fromByteArray=w;for(var s=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,h=n.length;o<h;++o)s[o]=n[o],e[n.charCodeAt(o)]=o;e[45]=62,e[95]=63;function c(y){var v=y.length;if(v%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var u=y.indexOf("=");u===-1&&(u=v);var g=u===v?0:4-u%4;return[u,g]}function r(y){var v=c(y),u=v[0],g=v[1];return(u+g)*3/4-g}function m(y,v,u){return(v+u)*3/4-u}function p(y){var v,u=c(y),g=u[0],k=u[1],E=new t(m(y,g,k)),S=0,M=k>0?g-4:g,T;for(T=0;T<M;T+=4)v=e[y.charCodeAt(T)]<<18|e[y.charCodeAt(T+1)]<<12|e[y.charCodeAt(T+2)]<<6|e[y.charCodeAt(T+3)],E[S++]=v>>16&255,E[S++]=v>>8&255,E[S++]=v&255;return k===2&&(v=e[y.charCodeAt(T)]<<2|e[y.charCodeAt(T+1)]>>4,E[S++]=v&255),k===1&&(v=e[y.charCodeAt(T)]<<10|e[y.charCodeAt(T+1)]<<4|e[y.charCodeAt(T+2)]>>2,E[S++]=v>>8&255,E[S++]=v&255),E}function x(y){return s[y>>18&63]+s[y>>12&63]+s[y>>6&63]+s[y&63]}function R(y,v,u){for(var g,k=[],E=v;E<u;E+=3)g=(y[E]<<16&16711680)+(y[E+1]<<8&65280)+(y[E+2]&255),k.push(x(g));return k.join("")}function w(y){for(var v,u=y.length,g=u%3,k=[],E=16383,S=0,M=u-g;S<M;S+=E)k.push(R(y,S,S+E>M?M:S+E));return g===1?(v=y[u-1],k.push(s[v>>2]+s[v<<4&63]+"==")):g===2&&(v=(y[u-2]<<8)+y[u-1],k.push(s[v>>10]+s[v>>4&63]+s[v<<2&63]+"=")),k.join("")}return je}var rt={};var $t;function rn(){return $t||($t=1,rt.read=function(s,e,t,n,o){var h,c,r=o*8-n-1,m=(1<<r)-1,p=m>>1,x=-7,R=t?o-1:0,w=t?-1:1,y=s[e+R];for(R+=w,h=y&(1<<-x)-1,y>>=-x,x+=r;x>0;h=h*256+s[e+R],R+=w,x-=8);for(c=h&(1<<-x)-1,h>>=-x,x+=n;x>0;c=c*256+s[e+R],R+=w,x-=8);if(h===0)h=1-p;else{if(h===m)return c?NaN:(y?-1:1)*(1/0);c=c+Math.pow(2,n),h=h-p}return(y?-1:1)*c*Math.pow(2,h-n)},rt.write=function(s,e,t,n,o,h){var c,r,m,p=h*8-o-1,x=(1<<p)-1,R=x>>1,w=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,y=n?0:h-1,v=n?1:-1,u=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(r=isNaN(e)?1:0,c=x):(c=Math.floor(Math.log(e)/Math.LN2),e*(m=Math.pow(2,-c))<1&&(c--,m*=2),c+R>=1?e+=w/m:e+=w*Math.pow(2,1-R),e*m>=2&&(c++,m/=2),c+R>=x?(r=0,c=x):c+R>=1?(r=(e*m-1)*Math.pow(2,o),c=c+R):(r=e*Math.pow(2,R-1)*Math.pow(2,o),c=0));o>=8;s[t+y]=r&255,y+=v,r/=256,o-=8);for(c=c<<o|r,p+=o;p>0;s[t+y]=c&255,y+=v,c/=256,p-=8);s[t+y-v]|=u*128}),rt}var Lt;function ln(){return Lt||(Lt=1,(function(s){const e=on(),t=rn(),n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;s.Buffer=r,s.SlowBuffer=E,s.INSPECT_MAX_BYTES=50;const o=2147483647;s.kMaxLength=o,r.TYPED_ARRAY_SUPPORT=h(),!r.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function h(){try{const i=new Uint8Array(1),a={foo:function(){return 42}};return Object.setPrototypeOf(a,Uint8Array.prototype),Object.setPrototypeOf(i,a),i.foo()===42}catch{return!1}}Object.defineProperty(r.prototype,"parent",{enumerable:!0,get:function(){if(r.isBuffer(this))return this.buffer}}),Object.defineProperty(r.prototype,"offset",{enumerable:!0,get:function(){if(r.isBuffer(this))return this.byteOffset}});function c(i){if(i>o)throw new RangeError('The value "'+i+'" is invalid for option "size"');const a=new Uint8Array(i);return Object.setPrototypeOf(a,r.prototype),a}function r(i,a,l){if(typeof i=="number"){if(typeof a=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return R(i)}return m(i,a,l)}r.poolSize=8192;function m(i,a,l){if(typeof i=="string")return w(i,a);if(ArrayBuffer.isView(i))return v(i);if(i==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i);if(ce(i,ArrayBuffer)||i&&ce(i.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(ce(i,SharedArrayBuffer)||i&&ce(i.buffer,SharedArrayBuffer)))return u(i,a,l);if(typeof i=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const f=i.valueOf&&i.valueOf();if(f!=null&&f!==i)return r.from(f,a,l);const b=g(i);if(b)return b;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof i[Symbol.toPrimitive]=="function")return r.from(i[Symbol.toPrimitive]("string"),a,l);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i)}r.from=function(i,a,l){return m(i,a,l)},Object.setPrototypeOf(r.prototype,Uint8Array.prototype),Object.setPrototypeOf(r,Uint8Array);function p(i){if(typeof i!="number")throw new TypeError('"size" argument must be of type number');if(i<0)throw new RangeError('The value "'+i+'" is invalid for option "size"')}function x(i,a,l){return p(i),i<=0?c(i):a!==void 0?typeof l=="string"?c(i).fill(a,l):c(i).fill(a):c(i)}r.alloc=function(i,a,l){return x(i,a,l)};function R(i){return p(i),c(i<0?0:k(i)|0)}r.allocUnsafe=function(i){return R(i)},r.allocUnsafeSlow=function(i){return R(i)};function w(i,a){if((typeof a!="string"||a==="")&&(a="utf8"),!r.isEncoding(a))throw new TypeError("Unknown encoding: "+a);const l=S(i,a)|0;let f=c(l);const b=f.write(i,a);return b!==l&&(f=f.slice(0,b)),f}function y(i){const a=i.length<0?0:k(i.length)|0,l=c(a);for(let f=0;f<a;f+=1)l[f]=i[f]&255;return l}function v(i){if(ce(i,Uint8Array)){const a=new Uint8Array(i);return u(a.buffer,a.byteOffset,a.byteLength)}return y(i)}function u(i,a,l){if(a<0||i.byteLength<a)throw new RangeError('"offset" is outside of buffer bounds');if(i.byteLength<a+(l||0))throw new RangeError('"length" is outside of buffer bounds');let f;return a===void 0&&l===void 0?f=new Uint8Array(i):l===void 0?f=new Uint8Array(i,a):f=new Uint8Array(i,a,l),Object.setPrototypeOf(f,r.prototype),f}function g(i){if(r.isBuffer(i)){const a=k(i.length)|0,l=c(a);return l.length===0||i.copy(l,0,0,a),l}if(i.length!==void 0)return typeof i.length!="number"||ae(i.length)?c(0):y(i);if(i.type==="Buffer"&&Array.isArray(i.data))return y(i.data)}function k(i){if(i>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return i|0}function E(i){return+i!=i&&(i=0),r.alloc(+i)}r.isBuffer=function(i){return i!=null&&i._isBuffer===!0&&i!==r.prototype},r.compare=function(i,a){if(ce(i,Uint8Array)&&(i=r.from(i,i.offset,i.byteLength)),ce(a,Uint8Array)&&(a=r.from(a,a.offset,a.byteLength)),!r.isBuffer(i)||!r.isBuffer(a))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(i===a)return 0;let l=i.length,f=a.length;for(let b=0,D=Math.min(l,f);b<D;++b)if(i[b]!==a[b]){l=i[b],f=a[b];break}return l<f?-1:f<l?1:0},r.isEncoding=function(i){switch(String(i).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},r.concat=function(i,a){if(!Array.isArray(i))throw new TypeError('"list" argument must be an Array of Buffers');if(i.length===0)return r.alloc(0);let l;if(a===void 0)for(a=0,l=0;l<i.length;++l)a+=i[l].length;const f=r.allocUnsafe(a);let b=0;for(l=0;l<i.length;++l){let D=i[l];if(ce(D,Uint8Array))b+D.length>f.length?(r.isBuffer(D)||(D=r.from(D)),D.copy(f,b)):Uint8Array.prototype.set.call(f,D,b);else if(r.isBuffer(D))D.copy(f,b);else throw new TypeError('"list" argument must be an Array of Buffers');b+=D.length}return f};function S(i,a){if(r.isBuffer(i))return i.length;if(ArrayBuffer.isView(i)||ce(i,ArrayBuffer))return i.byteLength;if(typeof i!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof i);const l=i.length,f=arguments.length>2&&arguments[2]===!0;if(!f&&l===0)return 0;let b=!1;for(;;)switch(a){case"ascii":case"latin1":case"binary":return l;case"utf8":case"utf-8":return De(i).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return l*2;case"hex":return l>>>1;case"base64":return Le(i).length;default:if(b)return f?-1:De(i).length;a=(""+a).toLowerCase(),b=!0}}r.byteLength=S;function M(i,a,l){let f=!1;if((a===void 0||a<0)&&(a=0),a>this.length||((l===void 0||l>this.length)&&(l=this.length),l<=0)||(l>>>=0,a>>>=0,l<=a))return"";for(i||(i="utf8");;)switch(i){case"hex":return U(this,a,l);case"utf8":case"utf-8":return W(this,a,l);case"ascii":return ge(this,a,l);case"latin1":case"binary":return L(this,a,l);case"base64":return te(this,a,l);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,a,l);default:if(f)throw new TypeError("Unknown encoding: "+i);i=(i+"").toLowerCase(),f=!0}}r.prototype._isBuffer=!0;function T(i,a,l){const f=i[a];i[a]=i[l],i[l]=f}r.prototype.swap16=function(){const i=this.length;if(i%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let a=0;a<i;a+=2)T(this,a,a+1);return this},r.prototype.swap32=function(){const i=this.length;if(i%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let a=0;a<i;a+=4)T(this,a,a+3),T(this,a+1,a+2);return this},r.prototype.swap64=function(){const i=this.length;if(i%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let a=0;a<i;a+=8)T(this,a,a+7),T(this,a+1,a+6),T(this,a+2,a+5),T(this,a+3,a+4);return this},r.prototype.toString=function(){const i=this.length;return i===0?"":arguments.length===0?W(this,0,i):M.apply(this,arguments)},r.prototype.toLocaleString=r.prototype.toString,r.prototype.equals=function(i){if(!r.isBuffer(i))throw new TypeError("Argument must be a Buffer");return this===i?!0:r.compare(this,i)===0},r.prototype.inspect=function(){let i="";const a=s.INSPECT_MAX_BYTES;return i=this.toString("hex",0,a).replace(/(.{2})/g,"$1 ").trim(),this.length>a&&(i+=" ... "),"<Buffer "+i+">"},n&&(r.prototype[n]=r.prototype.inspect),r.prototype.compare=function(i,a,l,f,b){if(ce(i,Uint8Array)&&(i=r.from(i,i.offset,i.byteLength)),!r.isBuffer(i))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof i);if(a===void 0&&(a=0),l===void 0&&(l=i?i.length:0),f===void 0&&(f=0),b===void 0&&(b=this.length),a<0||l>i.length||f<0||b>this.length)throw new RangeError("out of range index");if(f>=b&&a>=l)return 0;if(f>=b)return-1;if(a>=l)return 1;if(a>>>=0,l>>>=0,f>>>=0,b>>>=0,this===i)return 0;let D=b-f,C=l-a;const V=Math.min(D,C),X=this.slice(f,b),z=i.slice(a,l);for(let G=0;G<V;++G)if(X[G]!==z[G]){D=X[G],C=z[G];break}return D<C?-1:C<D?1:0};function F(i,a,l,f,b){if(i.length===0)return-1;if(typeof l=="string"?(f=l,l=0):l>2147483647?l=2147483647:l<-2147483648&&(l=-2147483648),l=+l,ae(l)&&(l=b?0:i.length-1),l<0&&(l=i.length+l),l>=i.length){if(b)return-1;l=i.length-1}else if(l<0)if(b)l=0;else return-1;if(typeof a=="string"&&(a=r.from(a,f)),r.isBuffer(a))return a.length===0?-1:P(i,a,l,f,b);if(typeof a=="number")return a=a&255,typeof Uint8Array.prototype.indexOf=="function"?b?Uint8Array.prototype.indexOf.call(i,a,l):Uint8Array.prototype.lastIndexOf.call(i,a,l):P(i,[a],l,f,b);throw new TypeError("val must be string, number or Buffer")}function P(i,a,l,f,b){let D=1,C=i.length,V=a.length;if(f!==void 0&&(f=String(f).toLowerCase(),f==="ucs2"||f==="ucs-2"||f==="utf16le"||f==="utf-16le")){if(i.length<2||a.length<2)return-1;D=2,C/=2,V/=2,l/=2}function X(G,J){return D===1?G[J]:G.readUInt16BE(J*D)}let z;if(b){let G=-1;for(z=l;z<C;z++)if(X(i,z)===X(a,G===-1?0:z-G)){if(G===-1&&(G=z),z-G+1===V)return G*D}else G!==-1&&(z-=z-G),G=-1}else for(l+V>C&&(l=C-V),z=l;z>=0;z--){let G=!0;for(let J=0;J<V;J++)if(X(i,z+J)!==X(a,J)){G=!1;break}if(G)return z}return-1}r.prototype.includes=function(i,a,l){return this.indexOf(i,a,l)!==-1},r.prototype.indexOf=function(i,a,l){return F(this,i,a,l,!0)},r.prototype.lastIndexOf=function(i,a,l){return F(this,i,a,l,!1)};function $(i,a,l,f){l=Number(l)||0;const b=i.length-l;f?(f=Number(f),f>b&&(f=b)):f=b;const D=a.length;f>D/2&&(f=D/2);let C;for(C=0;C<f;++C){const V=parseInt(a.substr(C*2,2),16);if(ae(V))return C;i[l+C]=V}return C}function K(i,a,l,f){return Ee(De(a,i.length-l),i,l,f)}function ee(i,a,l,f){return Ee(Re(a),i,l,f)}function j(i,a,l,f){return Ee(Le(a),i,l,f)}function Q(i,a,l,f){return Ee(Pe(a,i.length-l),i,l,f)}r.prototype.write=function(i,a,l,f){if(a===void 0)f="utf8",l=this.length,a=0;else if(l===void 0&&typeof a=="string")f=a,l=this.length,a=0;else if(isFinite(a))a=a>>>0,isFinite(l)?(l=l>>>0,f===void 0&&(f="utf8")):(f=l,l=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const b=this.length-a;if((l===void 0||l>b)&&(l=b),i.length>0&&(l<0||a<0)||a>this.length)throw new RangeError("Attempt to write outside buffer bounds");f||(f="utf8");let D=!1;for(;;)switch(f){case"hex":return $(this,i,a,l);case"utf8":case"utf-8":return K(this,i,a,l);case"ascii":case"latin1":case"binary":return ee(this,i,a,l);case"base64":return j(this,i,a,l);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Q(this,i,a,l);default:if(D)throw new TypeError("Unknown encoding: "+f);f=(""+f).toLowerCase(),D=!0}},r.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function te(i,a,l){return a===0&&l===i.length?e.fromByteArray(i):e.fromByteArray(i.slice(a,l))}function W(i,a,l){l=Math.min(i.length,l);const f=[];let b=a;for(;b<l;){const D=i[b];let C=null,V=D>239?4:D>223?3:D>191?2:1;if(b+V<=l){let X,z,G,J;switch(V){case 1:D<128&&(C=D);break;case 2:X=i[b+1],(X&192)===128&&(J=(D&31)<<6|X&63,J>127&&(C=J));break;case 3:X=i[b+1],z=i[b+2],(X&192)===128&&(z&192)===128&&(J=(D&15)<<12|(X&63)<<6|z&63,J>2047&&(J<55296||J>57343)&&(C=J));break;case 4:X=i[b+1],z=i[b+2],G=i[b+3],(X&192)===128&&(z&192)===128&&(G&192)===128&&(J=(D&15)<<18|(X&63)<<12|(z&63)<<6|G&63,J>65535&&J<1114112&&(C=J))}}C===null?(C=65533,V=1):C>65535&&(C-=65536,f.push(C>>>10&1023|55296),C=56320|C&1023),f.push(C),b+=V}return ue(f)}const Y=4096;function ue(i){const a=i.length;if(a<=Y)return String.fromCharCode.apply(String,i);let l="",f=0;for(;f<a;)l+=String.fromCharCode.apply(String,i.slice(f,f+=Y));return l}function ge(i,a,l){let f="";l=Math.min(i.length,l);for(let b=a;b<l;++b)f+=String.fromCharCode(i[b]&127);return f}function L(i,a,l){let f="";l=Math.min(i.length,l);for(let b=a;b<l;++b)f+=String.fromCharCode(i[b]);return f}function U(i,a,l){const f=i.length;(!a||a<0)&&(a=0),(!l||l<0||l>f)&&(l=f);let b="";for(let D=a;D<l;++D)b+=xe[i[D]];return b}function O(i,a,l){const f=i.slice(a,l);let b="";for(let D=0;D<f.length-1;D+=2)b+=String.fromCharCode(f[D]+f[D+1]*256);return b}r.prototype.slice=function(i,a){const l=this.length;i=~~i,a=a===void 0?l:~~a,i<0?(i+=l,i<0&&(i=0)):i>l&&(i=l),a<0?(a+=l,a<0&&(a=0)):a>l&&(a=l),a<i&&(a=i);const f=this.subarray(i,a);return Object.setPrototypeOf(f,r.prototype),f};function I(i,a,l){if(i%1!==0||i<0)throw new RangeError("offset is not uint");if(i+a>l)throw new RangeError("Trying to access beyond buffer length")}r.prototype.readUintLE=r.prototype.readUIntLE=function(i,a,l){i=i>>>0,a=a>>>0,l||I(i,a,this.length);let f=this[i],b=1,D=0;for(;++D<a&&(b*=256);)f+=this[i+D]*b;return f},r.prototype.readUintBE=r.prototype.readUIntBE=function(i,a,l){i=i>>>0,a=a>>>0,l||I(i,a,this.length);let f=this[i+--a],b=1;for(;a>0&&(b*=256);)f+=this[i+--a]*b;return f},r.prototype.readUint8=r.prototype.readUInt8=function(i,a){return i=i>>>0,a||I(i,1,this.length),this[i]},r.prototype.readUint16LE=r.prototype.readUInt16LE=function(i,a){return i=i>>>0,a||I(i,2,this.length),this[i]|this[i+1]<<8},r.prototype.readUint16BE=r.prototype.readUInt16BE=function(i,a){return i=i>>>0,a||I(i,2,this.length),this[i]<<8|this[i+1]},r.prototype.readUint32LE=r.prototype.readUInt32LE=function(i,a){return i=i>>>0,a||I(i,4,this.length),(this[i]|this[i+1]<<8|this[i+2]<<16)+this[i+3]*16777216},r.prototype.readUint32BE=r.prototype.readUInt32BE=function(i,a){return i=i>>>0,a||I(i,4,this.length),this[i]*16777216+(this[i+1]<<16|this[i+2]<<8|this[i+3])},r.prototype.readBigUInt64LE=re(function(i){i=i>>>0,pe(i,"offset");const a=this[i],l=this[i+7];(a===void 0||l===void 0)&&ye(i,this.length-8);const f=a+this[++i]*2**8+this[++i]*2**16+this[++i]*2**24,b=this[++i]+this[++i]*2**8+this[++i]*2**16+l*2**24;return BigInt(f)+(BigInt(b)<<BigInt(32))}),r.prototype.readBigUInt64BE=re(function(i){i=i>>>0,pe(i,"offset");const a=this[i],l=this[i+7];(a===void 0||l===void 0)&&ye(i,this.length-8);const f=a*2**24+this[++i]*2**16+this[++i]*2**8+this[++i],b=this[++i]*2**24+this[++i]*2**16+this[++i]*2**8+l;return(BigInt(f)<<BigInt(32))+BigInt(b)}),r.prototype.readIntLE=function(i,a,l){i=i>>>0,a=a>>>0,l||I(i,a,this.length);let f=this[i],b=1,D=0;for(;++D<a&&(b*=256);)f+=this[i+D]*b;return b*=128,f>=b&&(f-=Math.pow(2,8*a)),f},r.prototype.readIntBE=function(i,a,l){i=i>>>0,a=a>>>0,l||I(i,a,this.length);let f=a,b=1,D=this[i+--f];for(;f>0&&(b*=256);)D+=this[i+--f]*b;return b*=128,D>=b&&(D-=Math.pow(2,8*a)),D},r.prototype.readInt8=function(i,a){return i=i>>>0,a||I(i,1,this.length),this[i]&128?(255-this[i]+1)*-1:this[i]},r.prototype.readInt16LE=function(i,a){i=i>>>0,a||I(i,2,this.length);const l=this[i]|this[i+1]<<8;return l&32768?l|4294901760:l},r.prototype.readInt16BE=function(i,a){i=i>>>0,a||I(i,2,this.length);const l=this[i+1]|this[i]<<8;return l&32768?l|4294901760:l},r.prototype.readInt32LE=function(i,a){return i=i>>>0,a||I(i,4,this.length),this[i]|this[i+1]<<8|this[i+2]<<16|this[i+3]<<24},r.prototype.readInt32BE=function(i,a){return i=i>>>0,a||I(i,4,this.length),this[i]<<24|this[i+1]<<16|this[i+2]<<8|this[i+3]},r.prototype.readBigInt64LE=re(function(i){i=i>>>0,pe(i,"offset");const a=this[i],l=this[i+7];(a===void 0||l===void 0)&&ye(i,this.length-8);const f=this[i+4]+this[i+5]*2**8+this[i+6]*2**16+(l<<24);return(BigInt(f)<<BigInt(32))+BigInt(a+this[++i]*2**8+this[++i]*2**16+this[++i]*2**24)}),r.prototype.readBigInt64BE=re(function(i){i=i>>>0,pe(i,"offset");const a=this[i],l=this[i+7];(a===void 0||l===void 0)&&ye(i,this.length-8);const f=(a<<24)+this[++i]*2**16+this[++i]*2**8+this[++i];return(BigInt(f)<<BigInt(32))+BigInt(this[++i]*2**24+this[++i]*2**16+this[++i]*2**8+l)}),r.prototype.readFloatLE=function(i,a){return i=i>>>0,a||I(i,4,this.length),t.read(this,i,!0,23,4)},r.prototype.readFloatBE=function(i,a){return i=i>>>0,a||I(i,4,this.length),t.read(this,i,!1,23,4)},r.prototype.readDoubleLE=function(i,a){return i=i>>>0,a||I(i,8,this.length),t.read(this,i,!0,52,8)},r.prototype.readDoubleBE=function(i,a){return i=i>>>0,a||I(i,8,this.length),t.read(this,i,!1,52,8)};function B(i,a,l,f,b,D){if(!r.isBuffer(i))throw new TypeError('"buffer" argument must be a Buffer instance');if(a>b||a<D)throw new RangeError('"value" argument is out of bounds');if(l+f>i.length)throw new RangeError("Index out of range")}r.prototype.writeUintLE=r.prototype.writeUIntLE=function(i,a,l,f){if(i=+i,a=a>>>0,l=l>>>0,!f){const C=Math.pow(2,8*l)-1;B(this,i,a,l,C,0)}let b=1,D=0;for(this[a]=i&255;++D<l&&(b*=256);)this[a+D]=i/b&255;return a+l},r.prototype.writeUintBE=r.prototype.writeUIntBE=function(i,a,l,f){if(i=+i,a=a>>>0,l=l>>>0,!f){const C=Math.pow(2,8*l)-1;B(this,i,a,l,C,0)}let b=l-1,D=1;for(this[a+b]=i&255;--b>=0&&(D*=256);)this[a+b]=i/D&255;return a+l},r.prototype.writeUint8=r.prototype.writeUInt8=function(i,a,l){return i=+i,a=a>>>0,l||B(this,i,a,1,255,0),this[a]=i&255,a+1},r.prototype.writeUint16LE=r.prototype.writeUInt16LE=function(i,a,l){return i=+i,a=a>>>0,l||B(this,i,a,2,65535,0),this[a]=i&255,this[a+1]=i>>>8,a+2},r.prototype.writeUint16BE=r.prototype.writeUInt16BE=function(i,a,l){return i=+i,a=a>>>0,l||B(this,i,a,2,65535,0),this[a]=i>>>8,this[a+1]=i&255,a+2},r.prototype.writeUint32LE=r.prototype.writeUInt32LE=function(i,a,l){return i=+i,a=a>>>0,l||B(this,i,a,4,4294967295,0),this[a+3]=i>>>24,this[a+2]=i>>>16,this[a+1]=i>>>8,this[a]=i&255,a+4},r.prototype.writeUint32BE=r.prototype.writeUInt32BE=function(i,a,l){return i=+i,a=a>>>0,l||B(this,i,a,4,4294967295,0),this[a]=i>>>24,this[a+1]=i>>>16,this[a+2]=i>>>8,this[a+3]=i&255,a+4};function le(i,a,l,f,b){_e(a,f,b,i,l,7);let D=Number(a&BigInt(4294967295));i[l++]=D,D=D>>8,i[l++]=D,D=D>>8,i[l++]=D,D=D>>8,i[l++]=D;let C=Number(a>>BigInt(32)&BigInt(4294967295));return i[l++]=C,C=C>>8,i[l++]=C,C=C>>8,i[l++]=C,C=C>>8,i[l++]=C,l}function H(i,a,l,f,b){_e(a,f,b,i,l,7);let D=Number(a&BigInt(4294967295));i[l+7]=D,D=D>>8,i[l+6]=D,D=D>>8,i[l+5]=D,D=D>>8,i[l+4]=D;let C=Number(a>>BigInt(32)&BigInt(4294967295));return i[l+3]=C,C=C>>8,i[l+2]=C,C=C>>8,i[l+1]=C,C=C>>8,i[l]=C,l+8}r.prototype.writeBigUInt64LE=re(function(i,a=0){return le(this,i,a,BigInt(0),BigInt("0xffffffffffffffff"))}),r.prototype.writeBigUInt64BE=re(function(i,a=0){return H(this,i,a,BigInt(0),BigInt("0xffffffffffffffff"))}),r.prototype.writeIntLE=function(i,a,l,f){if(i=+i,a=a>>>0,!f){const V=Math.pow(2,8*l-1);B(this,i,a,l,V-1,-V)}let b=0,D=1,C=0;for(this[a]=i&255;++b<l&&(D*=256);)i<0&&C===0&&this[a+b-1]!==0&&(C=1),this[a+b]=(i/D>>0)-C&255;return a+l},r.prototype.writeIntBE=function(i,a,l,f){if(i=+i,a=a>>>0,!f){const V=Math.pow(2,8*l-1);B(this,i,a,l,V-1,-V)}let b=l-1,D=1,C=0;for(this[a+b]=i&255;--b>=0&&(D*=256);)i<0&&C===0&&this[a+b+1]!==0&&(C=1),this[a+b]=(i/D>>0)-C&255;return a+l},r.prototype.writeInt8=function(i,a,l){return i=+i,a=a>>>0,l||B(this,i,a,1,127,-128),i<0&&(i=255+i+1),this[a]=i&255,a+1},r.prototype.writeInt16LE=function(i,a,l){return i=+i,a=a>>>0,l||B(this,i,a,2,32767,-32768),this[a]=i&255,this[a+1]=i>>>8,a+2},r.prototype.writeInt16BE=function(i,a,l){return i=+i,a=a>>>0,l||B(this,i,a,2,32767,-32768),this[a]=i>>>8,this[a+1]=i&255,a+2},r.prototype.writeInt32LE=function(i,a,l){return i=+i,a=a>>>0,l||B(this,i,a,4,2147483647,-2147483648),this[a]=i&255,this[a+1]=i>>>8,this[a+2]=i>>>16,this[a+3]=i>>>24,a+4},r.prototype.writeInt32BE=function(i,a,l){return i=+i,a=a>>>0,l||B(this,i,a,4,2147483647,-2147483648),i<0&&(i=4294967295+i+1),this[a]=i>>>24,this[a+1]=i>>>16,this[a+2]=i>>>8,this[a+3]=i&255,a+4},r.prototype.writeBigInt64LE=re(function(i,a=0){return le(this,i,a,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),r.prototype.writeBigInt64BE=re(function(i,a=0){return H(this,i,a,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function he(i,a,l,f,b,D){if(l+f>i.length)throw new RangeError("Index out of range");if(l<0)throw new RangeError("Index out of range")}function se(i,a,l,f,b){return a=+a,l=l>>>0,b||he(i,a,l,4),t.write(i,a,l,f,23,4),l+4}r.prototype.writeFloatLE=function(i,a,l){return se(this,i,a,!0,l)},r.prototype.writeFloatBE=function(i,a,l){return se(this,i,a,!1,l)};function we(i,a,l,f,b){return a=+a,l=l>>>0,b||he(i,a,l,8),t.write(i,a,l,f,52,8),l+8}r.prototype.writeDoubleLE=function(i,a,l){return we(this,i,a,!0,l)},r.prototype.writeDoubleBE=function(i,a,l){return we(this,i,a,!1,l)},r.prototype.copy=function(i,a,l,f){if(!r.isBuffer(i))throw new TypeError("argument should be a Buffer");if(l||(l=0),!f&&f!==0&&(f=this.length),a>=i.length&&(a=i.length),a||(a=0),f>0&&f<l&&(f=l),f===l||i.length===0||this.length===0)return 0;if(a<0)throw new RangeError("targetStart out of bounds");if(l<0||l>=this.length)throw new RangeError("Index out of range");if(f<0)throw new RangeError("sourceEnd out of bounds");f>this.length&&(f=this.length),i.length-a<f-l&&(f=i.length-a+l);const b=f-l;return this===i&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(a,l,f):Uint8Array.prototype.set.call(i,this.subarray(l,f),a),b},r.prototype.fill=function(i,a,l,f){if(typeof i=="string"){if(typeof a=="string"?(f=a,a=0,l=this.length):typeof l=="string"&&(f=l,l=this.length),f!==void 0&&typeof f!="string")throw new TypeError("encoding must be a string");if(typeof f=="string"&&!r.isEncoding(f))throw new TypeError("Unknown encoding: "+f);if(i.length===1){const D=i.charCodeAt(0);(f==="utf8"&&D<128||f==="latin1")&&(i=D)}}else typeof i=="number"?i=i&255:typeof i=="boolean"&&(i=Number(i));if(a<0||this.length<a||this.length<l)throw new RangeError("Out of range index");if(l<=a)return this;a=a>>>0,l=l===void 0?this.length:l>>>0,i||(i=0);let b;if(typeof i=="number")for(b=a;b<l;++b)this[b]=i;else{const D=r.isBuffer(i)?i:r.from(i,f),C=D.length;if(C===0)throw new TypeError('The value "'+i+'" is invalid for argument "value"');for(b=0;b<l-a;++b)this[b+a]=D[b%C]}return this};const fe={};function Te(i,a,l){fe[i]=class extends l{constructor(){super(),Object.defineProperty(this,"message",{value:a.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${i}]`,this.stack,delete this.name}get code(){return i}set code(f){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:f,writable:!0})}toString(){return`${this.name} [${i}]: ${this.message}`}}}Te("ERR_BUFFER_OUT_OF_BOUNDS",function(i){return i?`${i} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Te("ERR_INVALID_ARG_TYPE",function(i,a){return`The "${i}" argument must be of type number. Received type ${typeof a}`},TypeError),Te("ERR_OUT_OF_RANGE",function(i,a,l){let f=`The value of "${i}" is out of range.`,b=l;return Number.isInteger(l)&&Math.abs(l)>2**32?b=Be(String(l)):typeof l=="bigint"&&(b=String(l),(l>BigInt(2)**BigInt(32)||l<-(BigInt(2)**BigInt(32)))&&(b=Be(b)),b+="n"),f+=` It must be ${a}. Received ${b}`,f},RangeError);function Be(i){let a="",l=i.length;const f=i[0]==="-"?1:0;for(;l>=f+4;l-=3)a=`_${i.slice(l-3,l)}${a}`;return`${i.slice(0,l)}${a}`}function $e(i,a,l){pe(a,"offset"),(i[a]===void 0||i[a+l]===void 0)&&ye(a,i.length-(l+1))}function _e(i,a,l,f,b,D){if(i>l||i<a){const C=typeof a=="bigint"?"n":"";let V;throw a===0||a===BigInt(0)?V=`>= 0${C} and < 2${C} ** ${(D+1)*8}${C}`:V=`>= -(2${C} ** ${(D+1)*8-1}${C}) and < 2 ** ${(D+1)*8-1}${C}`,new fe.ERR_OUT_OF_RANGE("value",V,i)}$e(f,b,D)}function pe(i,a){if(typeof i!="number")throw new fe.ERR_INVALID_ARG_TYPE(a,"number",i)}function ye(i,a,l){throw Math.floor(i)!==i?(pe(i,l),new fe.ERR_OUT_OF_RANGE("offset","an integer",i)):a<0?new fe.ERR_BUFFER_OUT_OF_BOUNDS:new fe.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${a}`,i)}const be=/[^+/0-9A-Za-z-_]/g;function ze(i){if(i=i.split("=")[0],i=i.trim().replace(be,""),i.length<2)return"";for(;i.length%4!==0;)i=i+"=";return i}function De(i,a){a=a||1/0;let l;const f=i.length;let b=null;const D=[];for(let C=0;C<f;++C){if(l=i.charCodeAt(C),l>55295&&l<57344){if(!b){if(l>56319){(a-=3)>-1&&D.push(239,191,189);continue}else if(C+1===f){(a-=3)>-1&&D.push(239,191,189);continue}b=l;continue}if(l<56320){(a-=3)>-1&&D.push(239,191,189),b=l;continue}l=(b-55296<<10|l-56320)+65536}else b&&(a-=3)>-1&&D.push(239,191,189);if(b=null,l<128){if((a-=1)<0)break;D.push(l)}else if(l<2048){if((a-=2)<0)break;D.push(l>>6|192,l&63|128)}else if(l<65536){if((a-=3)<0)break;D.push(l>>12|224,l>>6&63|128,l&63|128)}else if(l<1114112){if((a-=4)<0)break;D.push(l>>18|240,l>>12&63|128,l>>6&63|128,l&63|128)}else throw new Error("Invalid code point")}return D}function Re(i){const a=[];for(let l=0;l<i.length;++l)a.push(i.charCodeAt(l)&255);return a}function Pe(i,a){let l,f,b;const D=[];for(let C=0;C<i.length&&!((a-=2)<0);++C)l=i.charCodeAt(C),f=l>>8,b=l%256,D.push(b),D.push(f);return D}function Le(i){return e.toByteArray(ze(i))}function Ee(i,a,l,f){let b;for(b=0;b<f&&!(b+l>=a.length||b>=i.length);++b)a[b+l]=i[b];return b}function ce(i,a){return i instanceof a||i!=null&&i.constructor!=null&&i.constructor.name!=null&&i.constructor.name===a.name}function ae(i){return i!==i}const xe=(function(){const i="0123456789abcdef",a=new Array(256);for(let l=0;l<16;++l){const f=l*16;for(let b=0;b<16;++b)a[f+b]=i[l]+i[b]}return a})();function re(i){return typeof BigInt>"u"?_:i}function _(){throw new Error("BigInt not supported")}})(Ot)),Ot}var lt=ln();const xi=class Ze{constructor(){d(this,"key",null),d(this,"awsS3Service",new nn)}async encrypt(e){const t=JSON.stringify(e),n=await this.getKey(),o=window.crypto.getRandomValues(new Uint8Array(Ze.GCM_IV_LENGTH)),h=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:o},n,new TextEncoder().encode(t)),c=new Uint8Array([...o,...new Uint8Array(h)]);return lt.Buffer.from(c).toString("base64")}async decrypt(e){try{const t=await this.getKey(),n=new Uint8Array(lt.Buffer.from(e,"base64")),o=n.slice(0,Ze.GCM_IV_LENGTH),h=n.slice(Ze.GCM_IV_LENGTH),c=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:o},t,h);return new TextDecoder().decode(c)}catch(t){return console.error("Decryption error:",t),null}}async getKey(){if(!this.key)try{const e=await this.awsS3Service.getDataFromS3("fda-app-secure-store","aesKey.json"),t=lt.Buffer.from(e.key,"base64");this.key=await window.crypto.subtle.importKey("raw",t,{name:"AES-GCM"},!1,["encrypt","decrypt"])}catch(e){throw new Error(`Key retrieval failed: ${e}`)}return this.key}};d(xi,"GCM_IV_LENGTH",12);let wt=xi;const hn=15,cn={development:!0,serverHost:"http://localhost:5000",endPoints:{getHealth:"/api/v2/get_health",sendHealthReport:void 0},coldStartDuration:0,schemaVersion:"1.4",encrypted:!1},dn={development:!0,serverHost:"http://localhost:5000",endPoints:{getHealth:"/vitals-v2/get-health",sendHealthReport:void 0},coldStartDuration:0,schemaVersion:"2.1",encrypted:!0},un={development:!0,serverHost:"https://backend.panoptic.ai",endPoints:{getHealth:"/v2/dev/get-health",sendHealthReport:"/email/dev"},coldStartDuration:25,schemaVersion:"1.2",encrypted:!1},gn={development:!1,serverHost:"https://backend.panoptic.ai",endPoints:{getHealth:"/v2/get-health",sendHealthReport:"/email"},coldStartDuration:25,schemaVersion:"1.2",encrypted:!1},fn={development:!0,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/v2/dev/get-health",sendHealthReport:"/email/dev"},coldStartDuration:25,schemaVersion:"1.4",encrypted:!1},Si={development:!1,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/v2/get-health",sendHealthReport:"/email"},coldStartDuration:25,schemaVersion:"1.4",encrypted:!1},mn={development:!1,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/v2/get-health-company",sendHealthReport:"/email"},coldStartDuration:25,schemaVersion:"1.2",encrypted:!1},pn={development:!0,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/v2/dev/get-health-company",sendHealthReport:"/email/dev"},coldStartDuration:25,schemaVersion:"1.5",encrypted:!1},vn={development:!1,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/v2/get-health-company",sendHealthReport:"/email"},coldStartDuration:25,schemaVersion:"1.5",encrypted:!1},wn={development:!0,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/vitals-v2-dev/get-health",sendHealthReport:void 0},coldStartDuration:25,schemaVersion:"2.2",encrypted:!0},yn={development:!1,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/vitals-v2/get-health",sendHealthReport:void 0},coldStartDuration:25,schemaVersion:"2.2",encrypted:!0};class Ut{constructor(e){d(this,"windowDuration",hn),d(this,"deviceId",Et()),d(this,"config",Si),d(this,"apiKey"),d(this,"aesCryptor"),d(this,"httpCall",(...t)=>fetch(...t)),this.config=e}setServerUrl(e){this.config.serverHost=e}getUrl(){return this.config.serverHost+this.config.endPoints.getHealth}get httpHeaders(){const e={"Content-Type":"application/json"};return this.apiKey&&(e["X-Api-Key"]=this.apiKey),e}async wakeUpServer(){const e=this.getUrl();this.aesCryptor=new wt;let t={isAlive:!0};this.config.encrypted&&(t={data:await this.aesCryptor.encrypt(t)}),await this.httpCall(e,{method:"POST",headers:this.httpHeaders,body:JSON.stringify(t)})}async callAPI(e,t){this.aesCryptor=new wt;let n=t;this.config.encrypted&&(n={data:await this.aesCryptor.encrypt(t)});const o=await this.httpCall(e,{method:"POST",headers:this.httpHeaders,body:JSON.stringify(n)});if(o.status!=200){const c=await o.text();throw new Error(`Error: ${o.status} ${c}`)}let h=await o.json();if(this.config.encrypted){const c=await this.aesCryptor.decrypt(h.data);c&&(h=JSON.parse(c))}return h}getUrlSES(){return this.config.serverHost+this.config.endPoints.sendHealthReport}async sendHealthReport(e,t,n,o){const h=this.getUrlSES(),c={type:"attachment",params:{Recipients:e,EmailContent:n.emailContent,EmailSubject:n.emailSubject,FileName:n.fileName,Attachments:t,Source:o}},r=await this.httpCall(h,{method:"POST",headers:this.httpHeaders,body:JSON.stringify(c)});if(r.status!=200)throw new Error(r.statusText);return r.json()}}var et={exports:{}},bn=et.exports,Ht;function xn(){return Ht||(Ht=1,(function(s,e){(function(t,n){var o="1.0.39",h="",c="?",r="function",m="undefined",p="object",x="string",R="major",w="model",y="name",v="type",u="vendor",g="version",k="architecture",E="console",S="mobile",M="tablet",T="smarttv",F="wearable",P="embedded",$=500,K="Amazon",ee="Apple",j="ASUS",Q="BlackBerry",te="Browser",W="Chrome",Y="Edge",ue="Firefox",ge="Google",L="Huawei",U="LG",O="Microsoft",I="Motorola",B="Opera",le="Samsung",H="Sharp",he="Sony",se="Xiaomi",we="Zebra",fe="Facebook",Te="Chromium OS",Be="Mac OS",$e=" Browser",_e=function(_,i){var a={};for(var l in _)i[l]&&i[l].length%2===0?a[l]=i[l].concat(_[l]):a[l]=_[l];return a},pe=function(_){for(var i={},a=0;a<_.length;a++)i[_[a].toUpperCase()]=_[a];return i},ye=function(_,i){return typeof _===x?be(i).indexOf(be(_))!==-1:!1},be=function(_){return _.toLowerCase()},ze=function(_){return typeof _===x?_.replace(/[^\d\.]/g,h).split(".")[0]:n},De=function(_,i){if(typeof _===x)return _=_.replace(/^\s\s*/,h),typeof i===m?_:_.substring(0,$)},Re=function(_,i){for(var a=0,l,f,b,D,C,V;a<i.length&&!C;){var X=i[a],z=i[a+1];for(l=f=0;l<X.length&&!C&&X[l];)if(C=X[l++].exec(_),C)for(b=0;b<z.length;b++)V=C[++f],D=z[b],typeof D===p&&D.length>0?D.length===2?typeof D[1]==r?this[D[0]]=D[1].call(this,V):this[D[0]]=D[1]:D.length===3?typeof D[1]===r&&!(D[1].exec&&D[1].test)?this[D[0]]=V?D[1].call(this,V,D[2]):n:this[D[0]]=V?V.replace(D[1],D[2]):n:D.length===4&&(this[D[0]]=V?D[3].call(this,V.replace(D[1],D[2])):n):this[D]=V||n;a+=2}},Pe=function(_,i){for(var a in i)if(typeof i[a]===p&&i[a].length>0){for(var l=0;l<i[a].length;l++)if(ye(i[a][l],_))return a===c?n:a}else if(ye(i[a],_))return a===c?n:a;return i.hasOwnProperty("*")?i["*"]:_},Le={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},Ee={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},ce={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[y,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[y,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[y,g],[/opios[\/ ]+([\w\.]+)/i],[g,[y,B+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[g,[y,B+" GX"]],[/\bopr\/([\w\.]+)/i],[g,[y,B]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[g,[y,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[y,g],[/quark(?:pc)?\/([-\w\.]+)/i],[g,[y,"Quark"]],[/\bddg\/([\w\.]+)/i],[g,[y,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[y,"UC"+te]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[g,[y,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[y,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[y,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[g,[y,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[g,[y,"Smart Lenovo "+te]],[/(avast|avg)\/([\w\.]+)/i],[[y,/(.+)/,"$1 Secure "+te],g],[/\bfocus\/([\w\.]+)/i],[g,[y,ue+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[y,B+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[y,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[y,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[y,B+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[y,"MIUI "+te]],[/fxios\/([-\w\.]+)/i],[g,[y,ue]],[/\bqihu|(qi?ho?o?|360)browser/i],[[y,"360"+$e]],[/\b(qq)\/([\w\.]+)/i],[[y,/(.+)/,"$1Browser"],g],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[y,/(.+)/,"$1"+$e],g],[/samsungbrowser\/([\w\.]+)/i],[g,[y,le+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[y,/_/g," "],g],[/metasr[\/ ]?([\d\.]+)/i],[g,[y,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[y,"Sogou Mobile"],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[y,g],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[y],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[y,fe],g],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[y,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[y,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[g,[y,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[y,W+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[y,W+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[y,"Android "+te]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[y,g],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[g,[y,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[g,y],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[y,[g,Pe,Le]],[/(webkit|khtml)\/([\w\.]+)/i],[y,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[y,"Netscape"],g],[/(wolvic)\/([\w\.]+)/i],[y,g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[y,ue+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[y,[g,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[y,[g,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[k,"amd64"]],[/(ia32(?=;))/i],[[k,be]],[/((?:i[346]|x)86)[;\)]/i],[[k,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[k,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[k,"armhf"]],[/windows (ce|mobile); ppc;/i],[[k,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[k,/ower/,h,be]],[/(sun4\w)[;\)]/i],[[k,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[k,be]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[w,[u,le],[v,M]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[w,[u,le],[v,S]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[w,[u,ee],[v,S]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[w,[u,ee],[v,M]],[/(macintosh);/i],[w,[u,ee]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[w,[u,H],[v,S]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[w,[u,L],[v,M]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[w,[u,L],[v,S]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[w,/_/g," "],[u,se],[v,S]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[w,/_/g," "],[u,se],[v,M]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[w,[u,"OPPO"],[v,S]],[/\b(opd2\d{3}a?) bui/i],[w,[u,"OPPO"],[v,M]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[w,[u,"Vivo"],[v,S]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[w,[u,"Realme"],[v,S]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[w,[u,I],[v,S]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[w,[u,I],[v,M]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[w,[u,U],[v,M]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[w,[u,U],[v,S]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[w,[u,"Lenovo"],[v,M]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[w,/_/g," "],[u,"Nokia"],[v,S]],[/(pixel c)\b/i],[w,[u,ge],[v,M]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[w,[u,ge],[v,S]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[w,[u,he],[v,S]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[w,"Xperia Tablet"],[u,he],[v,M]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[w,[u,"OnePlus"],[v,S]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[w,[u,K],[v,M]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[w,/(.+)/g,"Fire Phone $1"],[u,K],[v,S]],[/(playbook);[-\w\),; ]+(rim)/i],[w,u,[v,M]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[w,[u,Q],[v,S]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[w,[u,j],[v,M]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[w,[u,j],[v,S]],[/(nexus 9)/i],[w,[u,"HTC"],[v,M]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[u,[w,/_/g," "],[v,S]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[w,[u,"TCL"],[v,M]],[/(itel) ((\w+))/i],[[u,be],w,[v,Pe,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[w,[u,"Acer"],[v,M]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[w,[u,"Meizu"],[v,S]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[w,[u,"Ulefone"],[v,S]],[/droid.+; (a(?:015|06[35]|142p?))/i],[w,[u,"Nothing"],[v,S]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[u,w,[v,S]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[u,w,[v,M]],[/(surface duo)/i],[w,[u,O],[v,M]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[w,[u,"Fairphone"],[v,S]],[/(u304aa)/i],[w,[u,"AT&T"],[v,S]],[/\bsie-(\w*)/i],[w,[u,"Siemens"],[v,S]],[/\b(rct\w+) b/i],[w,[u,"RCA"],[v,M]],[/\b(venue[\d ]{2,7}) b/i],[w,[u,"Dell"],[v,M]],[/\b(q(?:mv|ta)\w+) b/i],[w,[u,"Verizon"],[v,M]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[w,[u,"Barnes & Noble"],[v,M]],[/\b(tm\d{3}\w+) b/i],[w,[u,"NuVision"],[v,M]],[/\b(k88) b/i],[w,[u,"ZTE"],[v,M]],[/\b(nx\d{3}j) b/i],[w,[u,"ZTE"],[v,S]],[/\b(gen\d{3}) b.+49h/i],[w,[u,"Swiss"],[v,S]],[/\b(zur\d{3}) b/i],[w,[u,"Swiss"],[v,M]],[/\b((zeki)?tb.*\b) b/i],[w,[u,"Zeki"],[v,M]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[u,"Dragon Touch"],w,[v,M]],[/\b(ns-?\w{0,9}) b/i],[w,[u,"Insignia"],[v,M]],[/\b((nxa|next)-?\w{0,9}) b/i],[w,[u,"NextBook"],[v,M]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[u,"Voice"],w,[v,S]],[/\b(lvtel\-)?(v1[12]) b/i],[[u,"LvTel"],w,[v,S]],[/\b(ph-1) /i],[w,[u,"Essential"],[v,S]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[w,[u,"Envizen"],[v,M]],[/\b(trio[-\w\. ]+) b/i],[w,[u,"MachSpeed"],[v,M]],[/\btu_(1491) b/i],[w,[u,"Rotor"],[v,M]],[/(shield[\w ]+) b/i],[w,[u,"Nvidia"],[v,M]],[/(sprint) (\w+)/i],[u,w,[v,S]],[/(kin\.[onetw]{3})/i],[[w,/\./g," "],[u,O],[v,S]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[w,[u,we],[v,M]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[w,[u,we],[v,S]],[/smart-tv.+(samsung)/i],[u,[v,T]],[/hbbtv.+maple;(\d+)/i],[[w,/^/,"SmartTV"],[u,le],[v,T]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[u,U],[v,T]],[/(apple) ?tv/i],[u,[w,ee+" TV"],[v,T]],[/crkey/i],[[w,W+"cast"],[u,ge],[v,T]],[/droid.+aft(\w+)( bui|\))/i],[w,[u,K],[v,T]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[w,[u,H],[v,T]],[/(bravia[\w ]+)( bui|\))/i],[w,[u,he],[v,T]],[/(mitv-\w{5}) bui/i],[w,[u,se],[v,T]],[/Hbbtv.*(technisat) (.*);/i],[u,w,[v,T]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[u,De],[w,De],[v,T]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[v,T]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[u,w,[v,E]],[/droid.+; (shield) bui/i],[w,[u,"Nvidia"],[v,E]],[/(playstation [345portablevi]+)/i],[w,[u,he],[v,E]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[w,[u,O],[v,E]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[w,[u,le],[v,F]],[/((pebble))app/i],[u,w,[v,F]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[w,[u,ee],[v,F]],[/droid.+; (glass) \d/i],[w,[u,ge],[v,F]],[/droid.+; (wt63?0{2,3})\)/i],[w,[u,we],[v,F]],[/(quest( \d| pro)?)/i],[w,[u,fe],[v,F]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[u,[v,P]],[/(aeobc)\b/i],[w,[u,K],[v,P]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[w,[v,S]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[w,[v,M]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[v,M]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[v,S]],[/(android[-\w\. ]{0,9});.+buil/i],[w,[u,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[y,Y+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[y,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[y,g],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,y]],os:[[/microsoft (windows) (vista|xp)/i],[y,g],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[y,[g,Pe,Ee]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[g,Pe,Ee],[y,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[y,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[y,Be],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[g,y],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[y,g],[/\(bb(10);/i],[g,[y,Q]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[g,[y,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[y,ue+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[y,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[g,[y,"watchOS"]],[/crkey\/([\d\.]+)/i],[g,[y,W+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[y,Te],g],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[y,g],[/(sunos) ?([\w\.\d]*)/i],[[y,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[y,g]]},ae=function(_,i){if(typeof _===p&&(i=_,_=n),!(this instanceof ae))return new ae(_,i).getResult();var a=typeof t!==m&&t.navigator?t.navigator:n,l=_||(a&&a.userAgent?a.userAgent:h),f=a&&a.userAgentData?a.userAgentData:n,b=i?_e(ce,i):ce,D=a&&a.userAgent==l;return this.getBrowser=function(){var C={};return C[y]=n,C[g]=n,Re.call(C,l,b.browser),C[R]=ze(C[g]),D&&a&&a.brave&&typeof a.brave.isBrave==r&&(C[y]="Brave"),C},this.getCPU=function(){var C={};return C[k]=n,Re.call(C,l,b.cpu),C},this.getDevice=function(){var C={};return C[u]=n,C[w]=n,C[v]=n,Re.call(C,l,b.device),D&&!C[v]&&f&&f.mobile&&(C[v]=S),D&&C[w]=="Macintosh"&&a&&typeof a.standalone!==m&&a.maxTouchPoints&&a.maxTouchPoints>2&&(C[w]="iPad",C[v]=M),C},this.getEngine=function(){var C={};return C[y]=n,C[g]=n,Re.call(C,l,b.engine),C},this.getOS=function(){var C={};return C[y]=n,C[g]=n,Re.call(C,l,b.os),D&&!C[y]&&f&&f.platform&&f.platform!="Unknown"&&(C[y]=f.platform.replace(/chrome os/i,Te).replace(/macos/i,Be)),C},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return l},this.setUA=function(C){return l=typeof C===x&&C.length>$?De(C,$):C,this},this.setUA(l),this};ae.VERSION=o,ae.BROWSER=pe([y,g,R]),ae.CPU=pe([k]),ae.DEVICE=pe([w,u,v,E,S,T,M,F,P]),ae.ENGINE=ae.OS=pe([y,g]),s.exports&&(e=s.exports=ae),e.UAParser=ae;var xe=typeof t!==m&&(t.jQuery||t.Zepto);if(xe&&!xe.ua){var re=new ae;xe.ua=re.getResult(),xe.ua.get=function(){return re.getUA()},xe.ua.set=function(_){re.setUA(_);var i=re.getResult();for(var a in i)xe.ua[a]=i[a]}}})(typeof window=="object"?window:bn)})(et,et.exports)),et.exports}var Sn=xn();const yt=(s,e)=>e.some(t=>s instanceof t);let Nt,Wt;function kn(){return Nt||(Nt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Dn(){return Wt||(Wt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const bt=new WeakMap,ht=new WeakMap,nt=new WeakMap;function Rn(s){const e=new Promise((t,n)=>{const o=()=>{s.removeEventListener("success",h),s.removeEventListener("error",c)},h=()=>{t(Ve(s.result)),o()},c=()=>{n(s.error),o()};s.addEventListener("success",h),s.addEventListener("error",c)});return nt.set(e,s),e}function En(s){if(bt.has(s))return;const e=new Promise((t,n)=>{const o=()=>{s.removeEventListener("complete",h),s.removeEventListener("error",c),s.removeEventListener("abort",c)},h=()=>{t(),o()},c=()=>{n(s.error||new DOMException("AbortError","AbortError")),o()};s.addEventListener("complete",h),s.addEventListener("error",c),s.addEventListener("abort",c)});bt.set(s,e)}let xt={get(s,e,t){if(s instanceof IDBTransaction){if(e==="done")return bt.get(s);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ve(s[e])},set(s,e,t){return s[e]=t,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function ki(s){xt=s(xt)}function Cn(s){return Dn().includes(s)?function(...e){return s.apply(St(this),e),Ve(this.request)}:function(...e){return Ve(s.apply(St(this),e))}}function Mn(s){return typeof s=="function"?Cn(s):(s instanceof IDBTransaction&&En(s),yt(s,kn())?new Proxy(s,xt):s)}function Ve(s){if(s instanceof IDBRequest)return Rn(s);if(ht.has(s))return ht.get(s);const e=Mn(s);return e!==s&&(ht.set(s,e),nt.set(e,s)),e}const St=s=>nt.get(s);function Tn(s,e,{blocked:t,upgrade:n,blocking:o,terminated:h}={}){const c=indexedDB.open(s,e),r=Ve(c);return n&&c.addEventListener("upgradeneeded",m=>{n(Ve(c.result),m.oldVersion,m.newVersion,Ve(c.transaction),m)}),t&&c.addEventListener("blocked",m=>t(m.oldVersion,m.newVersion,m)),r.then(m=>{h&&m.addEventListener("close",()=>h()),o&&m.addEventListener("versionchange",p=>o(p.oldVersion,p.newVersion,p))}).catch(()=>{}),r}const Pn=["get","getKey","getAll","getAllKeys","count"],Fn=["put","add","delete","clear"],ct=new Map;function zt(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(ct.get(e))return ct.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,o=Fn.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(o||Pn.includes(t)))return;const h=async function(c,...r){const m=this.transaction(c,o?"readwrite":"readonly");let p=m.store;return n&&(p=p.index(r.shift())),(await Promise.all([p[t](...r),o&&m.done]))[0]};return ct.set(e,h),h}ki(s=>({...s,get:(e,t,n)=>zt(e,t)||s.get(e,t,n),has:(e,t)=>!!zt(e,t)||s.has(e,t)}));const An=["continue","continuePrimaryKey","advance"],jt={},kt=new WeakMap,Di=new WeakMap,In={get(s,e){if(!An.includes(e))return s[e];let t=jt[e];return t||(t=jt[e]=function(...n){kt.set(this,Di.get(this)[e](...n))}),t}};async function*Bn(...s){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...s)),!e)return;e=e;const t=new Proxy(e,In);for(Di.set(t,e),nt.set(t,St(e));e;)yield t,e=await(kt.get(t)||e.continue()),kt.delete(t)}function Gt(s,e){return e===Symbol.asyncIterator&&yt(s,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&yt(s,[IDBIndex,IDBObjectStore])}ki(s=>({...s,get(e,t,n){return Gt(e,t)?Bn:s.get(e,t,n)},has(e,t){return Gt(e,t)||s.has(e,t)}}));async function _n(s){const e=JSON.parse(s);if(!e)return;if(e.userInfo)return e;if(!e.data)return;const t=await new wt().decrypt(e.data);if(!t)return;const n=JSON.parse(t);if(!(!n||!n.userInfo))return n}async function On(s,e){const t=e?.body;if(typeof t!="string")return!1;const n=await _n(t);return n?(console.log("[Request Saver] Saving request",n),(await Tn("ai.panoptic.request")).transaction("requests","readwrite").objectStore("requests").put({id:1,url:s,request:e}),!0):!1}function Vn(s=fetch){return async(e,t)=>{try{await On(e,t)}catch(n){console.error("[Request Saver] ",n)}return s(e,t)}}function Ri(s){let e=0,t=0,n=0,o=0;for(let m=0;m<s.height;m++)for(let p=0;p<s.width;p++){let x=p*m*4,R=s.data[x],w=s.data[x+1],y=s.data[x+2];(R!==0||w!==0||y!==0)&&(e+=R,t+=w,n+=y,o++)}if(o===0)return;const h=e/o,c=t/o,r=n/o;if(!(isNaN(h)||isNaN(c)||isNaN(r)))return[h,c,r]}function $n(s,e){if(s===void 0)return;const{data:t,width:n,height:o}=s,h=[],c=[];for(let r=0;r<e;r++)for(let m=0;m<e;m++){const p=Math.floor(m*n/e),x=Math.min(Math.floor((m+1)*n/e),n),R=Math.floor(r*o/e),w=Math.min(Math.floor((r+1)*o/e),o);c.push({startX:p,endX:x,startY:R,endY:w})}for(const r of c){const{startX:m,endX:p,startY:x,endY:R}=r,w=p-m,y=R-x,v=w*y;if(v===0){const T=(x*n+m)*4;h.push([t[T],t[T+1],t[T+2]]);continue}let u=0,g=0,k=0;for(let T=x;T<R;T++){const F=(T*n+m)*4,P=(T*n+p)*4;for(let $=F;$<P;$+=4)u+=t[$],g+=t[$+1],k+=t[$+2]}const E=u/v,S=g/v,M=k/v;h.push([E,S,M])}return h}function Ln(s,e){if(s===void 0)return;const{data:t,width:n,height:o}=s,h=[],c=[];for(let r=0;r<e;r++)for(let m=0;m<e;m++){const p=Math.floor(m*n/e),x=Math.min(Math.floor((m+1)*n/e),n),R=Math.floor(r*o/e),w=Math.min(Math.floor((r+1)*o/e),o);c.push({startX:p,endX:x,startY:R,endY:w})}for(const r of c){const{startX:m,endX:p,startY:x,endY:R}=r,w=p-m,y=R-x,v=w*y;if(v===0){const T=(x*n+m)*4,F=t[T],P=t[T+1],$=t[T+2],[K,ee,j]=qt(F,P,$);h.push([K,ee,j]);continue}let u=0,g=0,k=0;for(let T=x;T<R;T++)for(let F=m;F<p;F++){const P=(T*n+F)*4,$=t[P],K=t[P+1],ee=t[P+2],[j,Q,te]=qt($,K,ee);u+=j,g+=Q,k+=te}const E=u/v,S=g/v,M=k/v;h.push([E,S,M])}return h}function qt(s,e,t){const n=.299*s+.587*e+.114*t,o=-.14713*s-.28886*e+.436*t,h=.615*s-.51499*e-.10001*t;return[n,o,h]}async function Qt(s){return Promise.all(s.map(Un))}async function Un(s){const e={};for(const t in s.pixels)e[t]={type:s.pixels[t].type,pixels:await s.pixels[t].pixels};return{...s,pixels:e}}const Hn=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,Yt=s=>{if(typeof s!="string")throw new TypeError("Invalid argument expected string");const e=s.match(Hn);if(!e)throw new Error(`Invalid argument not valid semver ('${s}' received)`);return e.shift(),e},Kt=s=>s==="*"||s==="x"||s==="X",Xt=s=>{const e=parseInt(s,10);return isNaN(e)?s:e},Nn=(s,e)=>typeof s!=typeof e?[String(s),String(e)]:[s,e],Wn=(s,e)=>{if(Kt(s)||Kt(e))return 0;const[t,n]=Nn(Xt(s),Xt(e));return t>n?1:t<n?-1:0},Jt=(s,e)=>{for(let t=0;t<Math.max(s.length,e.length);t++){const n=Wn(s[t]||"0",e[t]||"0");if(n!==0)return n}return 0},Ne=(s,e)=>{const t=Yt(s),n=Yt(e),o=t.pop(),h=n.pop(),c=Jt(t,n);return c!==0?c:o&&h?Jt(o.split("."),h.split(".")):o||h?o?-1:1:0},Ei=15,Dt=new Map([[ie.Local,cn],[ie.LocalV2,dn],[ie.RemoteDev,un],[ie.RemoteProd,gn],[ie.AwsDev,fn],[ie.AwsProd,Si],[ie.RemoteProdEnterprise,mn],[ie.AwsDevEnterprise,pn],[ie.AwsProdEnterprise,vn],[ie.Schema2Dev,wn],[ie.Schema2Prod,yn]]);class Zt{constructor(e){d(this,"wakeUpRequestTime"),d(this,"serverAwaken",!1),d(this,"scanId"),d(this,"client"),d(this,"cfg",{serverId:ie.RemoteProd,dataWindowDuration:Ei}),this.client=new Ut(Dt.get(ie.AwsProd)),e.dataWindowDuration&&(q("Configure dataWindowDuration: "+e.dataWindowDuration),this.client.windowDuration=e.dataWindowDuration),e.serverId!==void 0&&(q("Configure serverId: "+e.serverId),this.client=new Ut(Dt.get(e.serverId)),this.client.apiKey=this.cfg.apiKey),e.serverUrl&&(q("Configure serverUrl: "+e.serverUrl),this.client.setServerUrl(e.serverUrl)),e.apiKey&&(q("Configure apiKey: "+_s(e.apiKey)),this.cfg.apiKey=e.apiKey,this.client.apiKey=this.cfg.apiKey),e.httpCall&&(q("Configure httpCall"),this.client.httpCall=e.httpCall),e.enableSavingRequest&&(q("Configure enableSavingRequest"),this.client.httpCall=Vn(this.client.httpCall)),e.landmarksSampleRate!==void 0&&(q("Configure landmarksSampleRate: "+e.landmarksSampleRate),this.cfg.landmarksSampleRate=e.landmarksSampleRate)}get readyTime(){return this.client.config.coldStartDuration-this.client.windowDuration}get _isReady(){return this.wakeUpRequestTime===void 0?!1:this.serverAwaken?!0:(new Date().getTime()-this.wakeUpRequestTime)/1e3>this.readyTime}userInfo(e){const t={},n=e;return Object.keys(n).forEach(o=>{n[o]!==void 0&&(t[o]=n[o])}),t}async _wakeUpServer(){let e=new Date().getTime();return this.serverAwaken=!1,this.wakeUpRequestTime=new Date().getTime(),q("Wake up server now..."),new Promise((t,n)=>{this.client.wakeUpServer().then(()=>{this.serverAwaken=!0,t()}).catch(o=>{this.serverAwaken=!1,n(o)}).finally(()=>{let o=new Date().getTime()-e;q("Wake up time: ",o)})})}async wakeUpServer(){return this.wakeUpRequestTime!==void 0?this._waitUntilReady():this._wakeUpServer()}isReadySync(){return this._isReady}async isReady(){if(this._isReady)return!0;let e=Bs(.5,"timeout");return Promise.race([e,this.waitUntilReady()]).then(t=>t!=="timeout")}async _waitUntilReady(){return new Promise(e=>{let t=setInterval(()=>{this._isReady&&(clearInterval(t),e())},200)})}async waitUntilReady(){return this.wakeUpRequestTime==null&&this.wakeUpServer(),this._waitUntilReady()}begin(){return this.scanId=Et(),this._wakeUpServer().catch(e=>console.log(e)),Promise.resolve()}async analyze(e,t,n){var o;const h=(o=e[0].pixels.face)==null?void 0:o.type;if(Ne(this.client.config.schemaVersion,"2")>0)var c=await this.getHealthV2(e,t,n);else if(h=="rgb1x1")c=await this.getHealthRgb1x1(await Qt(e),t);else throw new Error("Unsupported pixel Size");return this.parseHealthFromJson(c)}async getHealthRgb1x1(e,t){const n=this.client.getUrl(),o=e.filter(x=>{var R;return(R=x.pixels.face)==null?void 0:R.pixels}).map(x=>{var R;return(R=x.pixels.face)==null?void 0:R.pixels[0][0]}),h=e.filter(x=>{var R;return(R=x.pixels.face)==null?void 0:R.pixels}).map(x=>{var R;return(R=x.pixels.face)==null?void 0:R.pixels[0][1]}),c=e.filter(x=>{var R;return(R=x.pixels.face)==null?void 0:R.pixels}).map(x=>{var R;return(R=x.pixels.face)==null?void 0:R.pixels[0][2]}),r=e.map(x=>x.timestamp),m=e.filter(x=>{var R;return(R=x.pixels.chest)==null?void 0:R.pixels}).map(x=>{var R;return(R=x.pixels.chest)==null?void 0:R.pixels[0][0]}),p={r:o,g:h,b:c,timestamp:r,userInfo:this.userInfo(t),deviceId:this.client.deviceId,windowDuration:this.client.windowDuration,deviceType:"web"};return m!==void 0&&m.length>0?m.length>=h.length?(p.respPixels=m,p.version="1.3"):console.warn("[HttpEndpointsClient] Too few respiratory pixels. Falling back to schema 1.2."):console.warn("[HttpEndpointsClient] No respiratory pixels. Falling back to schema 1.2."),this.scanId!==void 0&&(p.scanId=this.scanId),await this.client.callAPI(n,p)}async getHealthV2(e,t,n){var o;const h=this.client.getUrl(),c=this.prepareDataV2(await Qt(e)),r=this.prepareDeviceInfo(),m={...c,pixelsFormat:(o=e[0].pixels.face)==null?void 0:o.type,userInfo:this.userInfo(t),deviceInfo:r,measurementMode:"Resting",faceDetectorOption:"mp-face-mesh",metadata:{requestTime:Date.now(),dev:this.client.config.development},videoFrameInfo:n};return this.scanId!==void 0&&(m.deviceInfo.scanId=this.scanId),await this.client.callAPI(h,m)}prepareDataV2(e){const t=[],n=[],o=[];let h="2.1";if(e.map(c=>{var r,m,p,x,R,w,y,v,u,g;const k=(r=c.pixels.face)==null?void 0:r.pixels;if(k){const M={values:k,timestamp:c.timestamp};(m=c.pixels.chin)!=null&&m.pixels&&(h="2.2",M.chin=(p=c.pixels.chin)==null?void 0:p.pixels),(x=c.pixels.leftCheek)!=null&&x.pixels&&(h="2.2",M.leftCheek=(R=c.pixels.leftCheek)==null?void 0:R.pixels),(w=c.pixels.rightCheek)!=null&&w.pixels&&(h="2.2",M.rightCheek=(y=c.pixels.rightCheek)==null?void 0:y.pixels),(v=c.pixels.glabella)!=null&&v.pixels&&(h="2.2",M.glabella=(u=c.pixels.glabella)==null?void 0:u.pixels),t.push(M)}const E=(g=c.pixels.chest)==null?void 0:g.pixels;E&&(E[0].length===1?n.push(this.mean(E)[0]):(h="2.3",E.length==1?n.push(E[0]):n.push(E)));const S=this.getLandmarksV2(c.landmarks);if(S){const M=c.facebox,T={bbox:[M.xCenter-M.width/2,M.yCenter-M.height/2,M.xCenter+M.width/2,M.yCenter+M.height/2],landmarks:S,timestamp:c.timestamp};o.push(T)}}),o.length>1&&this.cfg.landmarksSampleRate!==void 0){const c=this.cfg.landmarksSampleRate,r=o[o.length-1].timestamp-o[0].timestamp;if(o.length/r>c){const m=1/c,p=[];let x=o[0].timestamp;p.push(o[0]);for(let R=1;R<o.length;R++)o[R].timestamp-x>=m&&(p.push(o[R]),x=o[R].timestamp);o.length=0,o.push(...p)}}return{version:h,pixels:t,respPixels:n,facialMarkers:o.length==0?null:o}}getLandmarksV2(e){if(!e||e.length==0)return null;const t={};return[4,10,11,14,34,136,152,168,205,264,365,425].map(n=>{t[n]=[e[n].x,e[n].y],e[n].z!==void 0&&t[n].push(e[n].z)}),t}prepareDeviceInfo(){const{device:e}=Sn.UAParser(navigator.userAgent);return{deviceId:this.client.deviceId,deviceBrand:e!=null&&e.vendor?e.vendor:"unknown",deviceModel:e!=null&&e.model?e.model:"unknown",deviceType:"web"}}mean(e){if(e.length===0)return[0,0,0];const t=e[0].length;return e.reduce((n,o)=>{for(let h=0;h<t;h++)n[h]+=o[h];return n},Array(t).fill(0)).map(n=>n/e.length)}end(){throw new Error("Method not implemented.")}reset(){this.serverAwaken=!1,this.wakeUpRequestTime=void 0,this.scanId=void 0}parseHealthFromJson(e){return q(e),Ne(this.client.config.schemaVersion,"2")>0?this.parseHealthV2(e):this.parseHealthV1(e)}parseHealthV1(e){let t=e.vital_signs,n=e.health_risks,o=e.holistic_health,h={datetime:new Date};if(o&&(h.holisticHealth={},o.general_wellness!==void 0&&(h.holisticHealth.generalWellness=o.general_wellness),o.bmi!==void 0&&(h.holisticHealth.bmi=o.bmi),o.hhe_version!==void 0&&(h.holisticHealth.version=o.hhe_version),o.absi!==void 0&&(h.holisticHealth.absi=o.absi),o.cardiac_workload!==void 0&&(h.holisticHealth.cardiacWorkload=o.cardiac_workload),o.pulse_respiratory_quotient!==void 0&&(h.holisticHealth.pulseRespiratoryQuotient=o.pulse_respiratory_quotient),o.waist_to_height_ratio!==void 0&&(h.holisticHealth.waistToHeightRatio=o.waist_to_height_ratio)),t["0_server"].scan_parameters!==void 0){let c=t["0_server"].scan_parameters,r={conditions:c.conditions!==void 0?c.conditions:void 0,invalidPixelPercentage:c.invalid_pixel_percentage!==void 0?c.invalid_pixel_percentage:void 0,signalDuration:c.signal_duration!==void 0?c.signal_duration:void 0,signalQuality:c.signal_quality!==void 0?c.signal_quality:void 0,snr:c.snr!==void 0?c.snr:void 0};h.scanParameters=r}return t&&(h.vitalSigns={heartRate:t.heart_rate,spo2:t.spo2,ibi:t.hrv_ibi},t.respiratory_rate!==void 0&&(h.vitalSigns.respiratoryRate=t.respiratory_rate),t.stress!==void 0&&(h.vitalSigns.stress=t.stress),t.stress_score!==void 0&&(h.vitalSigns.stressScore=t.stress_score),t.hrv_sdnn!==void 0&&(h.vitalSigns.hrvSdnn=t.hrv_sdnn),t.hrv_rmssd!==void 0&&(h.vitalSigns.hrvRmssd=t.hrv_rmssd),t.temperature!==void 0&&(h.vitalSigns.temperature=t.temperature),t.blood_pressure!==void 0&&(h.vitalSigns.bloodPressure=t.blood_pressure),t.blood_pressure_systolic!==void 0&&(h.vitalSigns.bloodPressureSystolic=t.blood_pressure_systolic),t.blood_pressure_diastolic!==void 0&&(h.vitalSigns.bloodPressureDiastolic=t.blood_pressure_diastolic),t.facial_skin_age!==void 0&&(h.vitalSigns.facialSkinAge=t.facial_skin_age),t.blood_alcohol!==void 0&&(h.vitalSigns.bloodAlcohol=t.blood_alcohol),t.blood_sugar!==void 0&&(h.vitalSigns.bloodSugar=t.blood_sugar),t["0_server"].version!==void 0&&(h.vitalSigns.version=t["0_server"].version)),n.cvd_risk_general!==void 0&&(h.risks==null&&(h.risks={}),h.risks.cardiovascularRisks={generalRisk:n.cvd_risk_general,coronaryHeartDisease:n.cvd_risk_CHD,congestiveHeartFailure:n.cvd_risk_CHF,intermittentClaudication:n.cvd_risk_IC,stroke:n.cvd_risk_Stroke}),n.covid_risk!==void 0&&(h.risks==null&&(h.risks={}),h.risks.covidRisk={covidRisk:n.covid_risk}),n.diabetesRisk!==void 0&&(h.risks==null&&(h.risks={}),h.risks.diabetesRisk=n.diabetesRisk),n.hypertensionRisk!==void 0&&(h.risks==null&&(h.risks={}),h.risks.hypertensionRisk=n.hypertensionRisk),n.cholesterolRisk!==void 0&&(h.risks==null&&(h.risks={}),h.risks.cholesterolRisk=n.cholesterolRisk),n.hre_version!==void 0&&h.risks&&(h.risks.version=n.hre_version),h}parseHealthV2(e){let t=e.vitalSigns,n=e.healthRisks,o=e.wellness,h=e.signalAnalysis,c=e.serverInfo,r={datetime:new Date};if(o&&(r.holisticHealth={},o.generalWellness!==void 0&&(r.holisticHealth.generalWellness=o.generalWellness),o.bmi!==void 0&&(r.holisticHealth.bmi=o.bmi),o.absi!==void 0&&(r.holisticHealth.absi=o.absi),o.absiz!==void 0&&(r.holisticHealth.absiz=o.absiz),o.cardiacWorkload!==void 0&&(r.holisticHealth.cardiacWorkload=o.cardiacWorkload),o.pulseRespiratoryQuotient!==void 0&&(r.holisticHealth.pulseRespiratoryQuotient=o.pulseRespiratoryQuotient),o.waistToHeightRatio!==void 0&&(r.holisticHealth.waistToHeightRatio=o.waistToHeightRatio),o.cardiovascularSystemWellness!==void 0&&(r.holisticHealth.cardiovascularSystemWellness=o.cardiovascularSystemWellness),o.mentalWellness!==void 0&&(r.holisticHealth.mentalWellness=o.mentalWellness),o.physicalWellness!==void 0&&(r.holisticHealth.physicalWellness=o.physicalWellness),o.respiratorySystemWellness!==void 0&&(r.holisticHealth.respiratorySystemWellness=o.respiratorySystemWellness)),t&&(r.vitalSigns={},t.heartRate!==void 0&&(r.vitalSigns.heartRate=t.heartRate),t.spo2!==void 0&&(r.vitalSigns.spo2=t.spo2),t.hrvIbi!==void 0&&(r.vitalSigns.ibi=t.hrvIbi),t.respiratoryRate!==void 0&&(r.vitalSigns.respiratoryRate=t.respiratoryRate),t.stress!==void 0&&(r.vitalSigns.stress=t.stress),t.stressScore!==void 0&&(r.vitalSigns.stressScore=t.stressScore),t.hrvSdnn!==void 0&&(r.vitalSigns.hrvSdnn=t.hrvSdnn),t.hrvRmssd!==void 0&&(r.vitalSigns.hrvRmssd=t.hrvRmssd),t.bloodPressure!==void 0&&(r.vitalSigns.bloodPressure=t.bloodPressure),t.bloodPressureSystolic!==void 0&&(r.vitalSigns.bloodPressureSystolic=t.bloodPressureSystolic),t.bloodPressureDiastolic!==void 0&&(r.vitalSigns.bloodPressureDiastolic=t.bloodPressureDiastolic),t.facialSkinAge!==void 0&&(r.vitalSigns.facialSkinAge=t.facialSkinAge)),n&&(r.risks={},n.cvdRiskGeneral!==void 0&&(r.risks.cardiovascularRisks={generalRisk:n.cvdRiskGeneral,coronaryHeartDisease:n.cvdRiskCHD,congestiveHeartFailure:n.cvdRiskCHF,intermittentClaudication:n.cvdRiskIC,stroke:n.cvdRiskStroke}),n.covidRisk!==void 0&&(r.risks.covidRisk={covidRisk:n.covidRisk}),n.diabetesRisk!==void 0&&(r.risks.diabetesRisk=n.diabetesRisk),n.hypertensionRisk!==void 0&&(r.risks.hypertensionRisk=n.hypertensionRisk),n.cholesterolRisk!==void 0&&(r.risks.cholesterolRisk=n.cholesterolRisk)),h){if(r.scanParameters={},h.signalConditions!==void 0){const m=h.signalConditions;r.scanParameters.signalConditions={noSpeedJitter:m.noSpeedJitter,goodAverageSpeed:m.goodAverageSpeed,fixedHeadPosition:m.fixedHeadPosition,noHeadTurning:m.noHeadTurning,adequateBrightness:m.adequateBrightness,evenLightingOnFace:m.evenLightingOnFace,goodSnr:m.goodSnr,signalSteadiness:m.signalSteadiness,goodSignalPercentage:m.goodSignalPercentage,hrSteadiness:m.hrSteadiness,hrSignalQuality:m.hrSignalQuality,rrSignalQuality:m.rrSignalQuality,bpSignalQuality:m.bpSignalQuality}}h.signalDuration!==void 0&&(r.scanParameters.signalDuration=h.signalDuration),h.signalQuality!==void 0&&(r.scanParameters.signalQuality=h.signalQuality),h.snr!==void 0&&(r.scanParameters.snr=h.snr),h.warning!==void 0&&(r.scanParameters.warning=h.warning)}return c&&(r.serverInfo={userPlan:c.userPlan,userId:c.userId},c.datetime!==void 0&&(r.serverInfo.datetime=c.datetime),c.datetimeStr!==void 0&&(r.serverInfo.datetimeStr=c.datetimeStr),c.elapse!==void 0&&(r.serverInfo.elapse=c.elapse),c.version!==void 0&&(r.serverInfo.version=c.version),c.errorCode!==void 0&&(r.serverInfo.errorCode=c.datetime)),r}}class zn{constructor(e,t,n,o,h=navigator.hardwareConcurrency*2,c){d(this,"workerManagers",[]),d(this,"createWorker"),d(this,"workerName"),d(this,"timeout"),d(this,"workerCount"),d(this,"onCreated"),d(this,"workerFunction"),d(this,"isEnabled",!0),this.onCreated=c,this.createWorker=e,this.workerName=n,this.timeout=o,this.workerCount=h,this.workerFunction=t,this.onCreated=c,this.isEnabled&&this.newWorker()}async newWorker(){const e=this.createWorker(),t=new jn(e,this.workerName,this.timeout);return this.onCreated&&await this.onCreated(t),this.workerManagers.push(t),t}async callWorker(e,t){if(!this.isEnabled&&this.workerFunction)return this.workerFunction(e);const n=this.workerManagers.find(o=>!o.isBusy);return n?n.callWorker(e,t):this.workerManagers.length<this.workerCount?(await this.newWorker()).callWorker(e,t):Promise.reject(new Error(`${this.workerName}: All ${this.workerCount} workers are busy`))}get hasAvailableWorker(){return this.workerManagers.some(e=>!e.isBusy)||this.workerManagers.length<this.workerCount}terminateAll(){this.workerManagers.forEach(e=>e.terminate()),this.workerManagers=[]}}class jn{constructor(e,t,n){d(this,"timeout"),d(this,"worker"),d(this,"workerName"),d(this,"pendingPromises",{}),this.timeout=n||1e3,this.worker=e,this.workerName=t||"Worker",this.worker.onmessage=o=>{const{result:h,hash:c,error:r}=o.data,m=this.pendingPromises[c];m&&(clearTimeout(m.timer),r?m.reject(new Error(`Worker ${this.workerName} Error: ${r}`)):m.resolve(h),delete this.pendingPromises[c])},this.worker.onerror=o=>{for(const h in this.pendingPromises)clearTimeout(this.pendingPromises[h].timer),this.pendingPromises[h].reject(new Error(`Worker ${this.workerName} Error: ${o.message}`)),delete this.pendingPromises[h];console.error(`Worker ${t} error: ${o.message}`)}}get isBusy(){return Object.keys(this.pendingPromises).length>2}callWorker(e,t){const n=crypto.randomUUID();return new Promise((o,h)=>{const c=setTimeout(()=>{if(this.pendingPromises[n]){const p=Object.keys(this.pendingPromises).length;this.pendingPromises[n].reject(new Error(`Worker ${this.workerName} Timeout. ${p>1?`${p} pending promises.`:""}`))}delete this.pendingPromises[n]},this.timeout);this.pendingPromises[n]&&(clearTimeout(this.pendingPromises[n].timer),this.pendingPromises[n].reject(new Error(`Worker ${this.workerName} Duplicate hash: ${n}`)),delete this.pendingPromises[n]),this.pendingPromises[n]={resolve:o,reject:h,timer:c};const r=performance.now();this.worker.postMessage({inputData:e,hash:n},t);const m=performance.now()-r;m>5&&console.warn(`Worker ${this.workerName} postMessage took ${m} ms, which may cause frame drops.`)})}terminate(){this.worker.terminate();for(const e in this.pendingPromises)clearTimeout(this.pendingPromises[e].timer),this.pendingPromises[e].reject(new Error(`Worker ${this.workerName} terminated.`)),delete this.pendingPromises[e]}}const dt={};function me(s,e,t,n,o,h){return dt[t]||(dt[t]=new zn(s,e,t,n,o,h)),dt[t]}function at(s){return Ri(s)}self.onmessage=s=>{const{inputData:e,hash:t}=s.data,n=at(e);self.postMessage({result:n,hash:t})};class ut{constructor(){d(this,"dataType","ggg1x1"),d(this,"workerFactory",()=>new Worker(new URL("/realtime-demo/assets/B5lsALhE-ppZ36LXi.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,at,"Ggg1x1WorkerPool"))}async extract(e){const t=await e;if(!t)return;const n=await this.workerPool.callWorker(t);if(!(!n||n[1]===void 0))return[[n[1]]]}}function Ci(s){const e=Ri(s);if(!e)return null;const[t,n,o]=e,h=.299*t+.587*n+.114*o,c=-.14713*t-.28886*n+.436*o,r=.615*t-.51499*n-.10001*o;return[h,c,r]}self.onmessage=s=>{const{inputData:e,hash:t}=s.data,n=Ci(e);self.postMessage({result:n,hash:t})};class Gn{constructor(){d(this,"dataType","yyy1x1"),d(this,"workerFactory",()=>new Worker(new URL("/realtime-demo/assets/CXHLiYOT-BPLMuNyk.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Ci,"Yuv1x1WorkerPool"))}async extract(e){const t=await e;if(!t)return;const n=await this.workerPool.callWorker(t);if(n)return[[n[0]]]}}class gt{constructor(){d(this,"dataType","rgb1x1"),d(this,"workerFactory",()=>new Worker(new URL("/realtime-demo/assets/B5lsALhE-ppZ36LXi.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,at,"Rgb1x1WorkerPool"))}async extract(e){const t=await e;if(!t)return;const n=await this.workerPool.callWorker(t);if(n)return[n]}}function Ct(s){const{imageData:e,size:t}=s;return $n(e,t)}self.onmessage=s=>{const{inputData:e,hash:t}=s.data,n=Ct(e);self.postMessage({result:n,hash:t})};class qn{constructor(){d(this,"dataType","rgb8x8"),d(this,"workerFactory",()=>new Worker(new URL("/realtime-demo/assets/BJ8tLFkU-CydYnlpG.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Ct,"Rgb8x8WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:8})}}class Qn{constructor(){d(this,"dataType","rgb32x32"),d(this,"workerFactory",()=>new Worker(new URL("/realtime-demo/assets/BJ8tLFkU-CydYnlpG.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Ct,"Rgb32x32WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:32})}}function Ge(s){const{imageData:e,size:t}=s;return Ln(e,t)}self.onmessage=s=>{const{inputData:e,hash:t}=s.data,n=Ge(e);self.postMessage({result:n,hash:t})};class Yn{constructor(){d(this,"dataType","yuv8x8"),d(this,"workerFactory",()=>new Worker(new URL("/realtime-demo/assets/BQisuE9N-gDDR2tiQ.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Ge,"Yuv8x8WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:8})}}class Kn{constructor(){d(this,"dataType","yuv32x32"),d(this,"workerFactory",()=>new Worker(new URL("/realtime-demo/assets/BQisuE9N-gDDR2tiQ.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Ge,"Yuv32x32WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:32})}}class Xn{constructor(){d(this,"dataType","yuv64x64"),d(this,"workerFactory",()=>new Worker(new URL("/realtime-demo/assets/BQisuE9N-gDDR2tiQ.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Ge,"Yuv64x64WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:64})}}class Jn{constructor(){d(this,"dataType","yuv1x1"),d(this,"workerFactory",()=>new Worker(new URL("/realtime-demo/assets/BQisuE9N-gDDR2tiQ.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Ge,"Yuv1x1WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:1})}}class Zn{constructor(){d(this,"dataType","meanRgb1x1"),d(this,"workerFactory",()=>new Worker(new URL("/realtime-demo/assets/B5lsALhE-ppZ36LXi.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,at,"ChestMeanRgb1x1WorkerPool"))}async extract(e){const t=await e;if(!t)return;const n=await this.workerPool.callWorker(t);if(n)return[n]}}function ft(s,e="rgb1x1"){if(s==="face")switch(e){case"rgb1x1":return new gt;case"rgb8x8":return new qn;case"rgb32x32":return new Qn;case"yuv1x1":return new Jn;case"yuv8x8":return new Yn;case"yuv32x32":return new Kn;case"yuv64x64":return new Xn;case"ggg1x1":return new ut;default:return new gt}else if(s==="chest")switch(e){case"ggg1x1":return new ut;case"yyy1x1":return new Gn;case"meanRgb1x1":return new Zn;default:return new ut}else return new gt}function mt(s){const e=s?.pixelDataType??"rgb1x1",t=s?.chestPixelDataType??"ggg1x1";return(s?.enabledROIs??["face","chest"]).reduce((n,o)=>(o==="face"?n.face=ft(o,e):o==="chest"?n.chest=ft(o,t):n[o]=ft(o,e),n),{})}const Rt="2.1.0-b2";class ea{constructor(){d(this,"threshold",1),d(this,"lastOKTime",0),d(this,"lastPixels"),d(this,"detected",!1)}reset(){this.lastOKTime=0,this.lastPixels=void 0,this.detected=!1}diff(e,t){let n=0;for(let o=0;o<e.length;o++){const h=e[o],c=t[o];for(let r=0;r<h.length;r++)n+=c[r]-h[r]}return n}detect(e,t){if(e){if(this.lastPixels!==void 0){if(this.diff(e,this.lastPixels)!==0)this.lastOKTime=t;else if(t-this.lastOKTime>this.threshold)return this.detected=!0,!0}return this.lastPixels=e,!1}}}const ei=25,ti=5,ii=1/6,si=1;class ta{constructor(){d(this,"instanceId"),d(this,"stage",N.Idle),d(this,"startTime",new Date),d(this,"health"),d(this,"firstDataTime"),d(this,"frameData",[]),d(this,"lastSendTime"),d(this,"sendingData",!1),d(this,"error"),d(this,"cfg",{serverId:ie.RemoteProd,dataCollectionDuration:ei,dataSendingRate:ii,dataSendingDuration:ti,dataWindowDuration:Ei,faceLostTimeout:si}),d(this,"blinkDetector",_t(We.dummy)),d(this,"healthAnalyzer"),d(this,"pixelsExtractors"),d(this,"duplicatedPixelDetector",new ea),window.__vital_sign_engine_plugin__=this,this.instanceId=Et(),q(`VitalSignEngine Plugin InstanceId: ${this.instanceId}`),q(`VitalSignEngine Plugin (TSVitalSignCamera-${Rt})`),this.healthAnalyzer=new Zt({serverId:ie.AwsProd}),this.pixelsExtractors=mt(),this.configure({serverId:ie.AwsEnterpriseProd})}configure(e){q("Configuring. Instance Id = ",this.instanceId),this.healthAnalyzer=new Zt(e),e.pixelDataType&&(q("Configure pixelDataType: "+e.pixelDataType),this.cfg.pixelDataType=e.pixelDataType,this.pixelsExtractors=mt(e)),e.chestPixelDataType&&(q("Configure chestPixelDataType: "+e.chestPixelDataType),this.cfg.chestPixelDataType=e.chestPixelDataType,this.pixelsExtractors=mt(e)),e.dataCollectionDuration&&(q("Configure dataCollectionDuration: "+e.dataCollectionDuration),this.cfg.dataCollectionDuration=e.dataCollectionDuration),e.dataSendingDuration&&(q("Configure dataSendingDuration: "+e.dataSendingDuration),this.cfg.dataSendingDuration=e.dataSendingDuration),e.dataSendingRate&&(q("Configure dataSendingRate: "+e.dataSendingRate),this.cfg.dataSendingRate=e.dataSendingRate),e.blinkDetectorType!==void 0&&(q("Configure blink detecor type"),this.blinkDetector=_t(e.blinkDetectorType),e.blinkDetectorConfig!==void 0&&this.blinkDetector.configure(e.blinkDetectorConfig)),e.blinkDetectorConfig!==void 0&&(q("Configure blink detector"),this.blinkDetector.configure(e.blinkDetectorConfig)),e.faceLostTimeout!==void 0&&(q("Configure faceLostTimeout"),this.cfg.faceLostTimeout=e.faceLostTimeout)}get stageTime(){switch(this.stage){case N.WaitingData:return-1;case N.CollectingData:return this.cfg.dataCollectionDuration||ei;case N.AnalyzingData:return this.cfg.dataSendingDuration||ti;case N.Idle:return-1}}get elapsedTime(){return(new Date().getTime()-this.startTime.getTime())/1e3}get remainingTime(){return Math.max(this.stageTime-this.elapsedTime,0)}get nextStage(){return this.elapsedTime<=this.stageTime?!1:this.stage!==N.AnalyzingData?!0:!this.sendingData}frameDataTimestamp(e){return this.firstDataTime===void 0?0:(e-this.firstDataTime)/1e3}get healthResult(){return{stage:this.stage,remainingTime:this.remainingTime,totalTime:this.stageTime===-1?void 0:this.stageTime,health:this.health,error:this.error}}async isReady(){return this.healthAnalyzer.isReady()}async waitUntilReady(){return this.healthAnalyzer.waitUntilReady()}reset(){this.blinkDetector.reset(),this.frameData=[],this.firstDataTime=void 0,this.lastSendTime=void 0,this.sendingData=!1,this.healthAnalyzer.reset(),this.duplicatedPixelDetector.reset()}async start(){if(this.stage!==N.Idle)return Promise.reject(new Error("already started"));this.health=void 0,this.error=void 0,this.reset(),this.healthAnalyzer.begin(),this.setStage(N.WaitingData)}get stageName(){switch(this.stage){case N.Idle:return"Idle";case N.AnalyzingData:return"Analyzing";case N.CollectingData:return"Collecting";case N.WaitingData:return"Waiting"}}setStage(e){this.stage=e,this.startTime=new Date,q(this.stageName)}async stop(){this.stage!==N.Idle&&(this.setStage(N.Idle),this.reset(),this.healthAnalyzer.reset())}toIdleStage(){this.setStage(N.Idle),this.reset(),this.healthAnalyzer.reset()}faceLostError(){q("Error: face lost"),this.toIdleStage(),this.error=new Error("face lost")}duplicatedRGBError(){q("Error: duplicated RGB values"),this.toIdleStage(),this.error=new Error("duplicated rgb")}faceLost(e){if(this.frameData.length==0)return!1;const t=this.frameData[this.frameData.length-1],n=this.cfg.faceLostTimeout===void 0?si:this.cfg.faceLostTimeout;return!(this.frameDataTimestamp(e)-t.timestamp<n)}getHealth(e){var t,n;const o=e.videoFrameInfo.timestamp;if(this.stage===N.Idle)return(t=e.images)!=null&&t.face&&e.faceBox&&this.extractPixels(e.images),this.healthResult;if(this.stage==N.WaitingData)return this.faceLost(o)||this.blinkDetector.noEyes||this.blinkDetector.unstable?(this.faceLostError(),this.healthResult):(this.blinkDetector.detect(e.landmarks),this.healthAnalyzer.isReadySync()?(this.setStage(N.CollectingData),this.healthResult):(q("Waiting server to awake..."),this.healthResult));if(this.stage==N.CollectingData)return this.faceLost(o)||this.blinkDetector.noEyes||this.blinkDetector.unstable?(this.faceLostError(),this.healthResult):(this.blinkDetector.detect(e.landmarks),(n=e.images)!=null&&n.face&&e.faceBox&&(this.addData(e.images,e.faceBox,e.landmarks,o),this.duplicatedPixelDetector.detected)?(this.duplicatedRGBError(),this.healthResult):(this.nextStage&&this.setStage(N.AnalyzingData),this.healthResult));if(this.stage==N.AnalyzingData){if(this.blinkDetector.blinkCount==0)return q("Error: no blink"),this.toIdleStage(),this.error=new Error("no blink"),this.healthResult;let h=this.cfg.dataSendingRate||ii;return e.images&&e.faceBox&&this.addData(e.images,e.faceBox,e.landmarks,o),this.sendData(1/h,e.userInfo,e.videoFrameInfo),this.nextStage&&this.toIdleStage(),this.healthResult}else return this.nextStage&&this.setStage(N.Idle),this.healthResult}addData(e,t,n,o){if(e.face===void 0)return;this.firstDataTime===void 0&&(this.firstDataTime=o);let h={pixels:this.extractPixels(e),timestamp:this.frameDataTimestamp(o),facebox:t,landmarks:n};this.frameData.push(h)}extractPixels(e){var t;let n={};for(const o in this.pixelsExtractors){const h=o,c=this.pixelsExtractors[h];if(!c)continue;const r=e[h];if(!r)continue;const m=(t=this.pixelsExtractors[h])==null?void 0:t.extract(r.imageData);m&&(n[h]={type:c.dataType,pixels:m})}return n}handleError(e){q(`Error: ${e}`),this.toIdleStage(),this.error=e}sendData(e,t,n){if(this.sendingData||this.elapsedTime>=this.stageTime)return;if(this.lastSendTime===void 0){this.lastSendTime=new Date,this._sendData(t,n).catch(c=>this.handleError(c));return}let o=new Date,h=this.lastSendTime;(o.getTime()-h.getTime())/1e3<e||this._sendData(t,n).catch(c=>this.handleError(c))}async _sendData(e,t){if(this.sendingData=!0,this.frameData.length===0)throw this.sendingData=!1,new Error("no pixel data");const n=this.frameData,o=await this.healthAnalyzer.analyze(n,e,t);this.stage===N.AnalyzingData&&(this.health=o),this.lastSendTime=new Date,this.sendingData=!1}async sendHealthReport(e,t,n,o){return this.healthAnalyzer.client.sendHealthReport(e,t,n,o)}}function ia(){return new ta}var ne=(s=>(s[s.MediaPipe=0]="MediaPipe",s[s.OpenCV=1]="OpenCV",s[s.Dummy=2]="Dummy",s[s.TFMediaPipe=3]="TFMediaPipe",s[s.FaceApi=4]="FaceApi",s[s.MPFaceMesh=5]="MPFaceMesh",s[s.MPFaceDetector=6]="MPFaceDetector",s[s.MPFaceMeshThreaded=7]="MPFaceMeshThreaded",s))(ne||{}),sa=(s=>(s.SelfHosted="self-hosted",s.CDN="cdn",s))(sa||{}),ke=(s=>(s[s.cif352x288=0]="cif352x288",s[s.sd480x360=1]="sd480x360",s[s.hd1280x720=2]="hd1280x720",s[s.hd1920x1080=3]="hd1920x1080",s))(ke||{});function na(s){switch(s){case 0:return{width:352,height:288};case 1:return{width:480,height:360};case 2:return{width:1280,height:720};case 3:return{width:1920,height:1080}}}class aa{constructor(e){d(this,"video"),d(this,"canvas"),this.video=e,this.canvas=document.createElement("canvas")}start(){if(!this.video.srcObject)throw new Error("Video element has no srcObject");return Promise.resolve()}stop(){return Promise.resolve()}captureFrame(e,t){const n=this.cropFrame(this.video,e),o=Promise.resolve(n.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,n.width,n.height));return{timestamp:t??performance.now(),width:n.width,height:n.height,getImageData:()=>o,getCanvas:()=>Promise.resolve(n)}}cropFrame(e,t){const n=this.canvas;return n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(e,t.x,t.y,t.width,t.height,0,0,n.width,n.height),n.getContext("2d").canvas}}var ni={exports:{}},ai;function oa(){return ai||(ai=1,(function(s){s.exports=(function(e){var t={};function n(o){if(t[o])return t[o].exports;var h=t[o]={i:o,l:!1,exports:{}};return e[o].call(h.exports,h,h.exports,n),h.l=!0,h.exports}return n.m=e,n.c=t,n.d=function(o,h,c){n.o(o,h)||Object.defineProperty(o,h,{configurable:!1,enumerable:!0,get:c})},n.n=function(o){var h=o&&o.__esModule?(function(){return o.default}):(function(){return o});return n.d(h,"a",h),h},n.o=function(o,h){return Object.prototype.hasOwnProperty.call(o,h)},n.p="",n(n.s=1)})([(function(e,t,n){var o={MOBILE:"mobile",TABLET:"tablet",SMART_TV:"smarttv",CONSOLE:"console",WEARABLE:"wearable",BROWSER:void 0},h={CHROME:"Chrome",FIREFOX:"Firefox",OPERA:"Opera",YANDEX:"Yandex",SAFARI:"Safari",INTERNET_EXPLORER:"Internet Explorer",EDGE:"Edge",CHROMIUM:"Chromium",IE:"IE",MOBILE_SAFARI:"Mobile Safari",EDGE_CHROMIUM:"Edge Chromium"},c={IOS:"iOS",ANDROID:"Android",WINDOWS_PHONE:"Windows Phone",WINDOWS:"Windows",MAC_OS:"Mac OS"},r={isMobile:!1,isTablet:!1,isBrowser:!1,isSmartTV:!1,isConsole:!1,isWearable:!1};e.exports={BROWSER_TYPES:h,DEVICE_TYPES:o,OS_TYPES:c,defaultData:r}}),(function(e,t,n){var o=n(2),h=n(0),c=h.BROWSER_TYPES,r=h.OS_TYPES,m=h.DEVICE_TYPES,p=n(4),x=p.checkType,R=p.broPayload,w=p.mobilePayload,y=p.wearPayload,v=p.consolePayload,u=p.stvPayload,g=p.getNavigatorInstance,k=p.isIOS13Check,E=new o,S=E.getBrowser(),M=E.getDevice(),T=E.getEngine(),F=E.getOS(),P=E.getUA(),$=c.CHROME,K=c.CHROMIUM,ee=c.IE,j=c.INTERNET_EXPLORER,Q=c.OPERA,te=c.FIREFOX,W=c.SAFARI,Y=c.EDGE,ue=c.YANDEX,ge=c.MOBILE_SAFARI,L=m.MOBILE,U=m.TABLET,O=m.SMART_TV,I=m.BROWSER,B=m.WEARABLE,le=m.CONSOLE,H=r.ANDROID,he=r.WINDOWS_PHONE,se=r.IOS,we=r.WINDOWS,fe=r.MAC_OS,Te=function(){return M.type===L},Be=function(){return M.type===U},$e=function(){switch(M.type){case L:case U:return!0;default:return!1}},_e=function(){return F.name===r.WINDOWS&&F.version==="10"?typeof P=="string"&&P.indexOf("Edg/")!==-1:!1},pe=function(){return M.type===O},ye=function(){return M.type===I},be=function(){return M.type===B},ze=function(){return M.type===le},De=function(){return F.name===H},Re=function(){return F.name===we},Pe=function(){return F.name===fe},Le=function(){return F.name===he},Ee=function(){return F.name===se},ce=function(){return S.name===$},ae=function(){return S.name===te},xe=function(){return S.name===K},re=function(){return S.name===Y},_=function(){return S.name===ue},i=function(){return S.name===W||S.name===ge},a=function(){return S.name===ge},l=function(){return S.name===Q},f=function(){return S.name===j||S.name===ee},b=function(){var Se=g(),qe=Se&&Se.userAgent.toLowerCase();return typeof qe=="string"?/electron/.test(qe):!1},D=function(){var Se=g();return Se&&(/iPad|iPhone|iPod/.test(Se.platform)||Se.platform==="MacIntel"&&Se.maxTouchPoints>1)&&!window.MSStream},C=function(){return k("iPad")},V=function(){return k("iPhone")},X=function(){return k("iPod")},z=function(){return S.major},G=function(){return S.version},J=function(){return F.version?F.version:"none"},_i=function(){return F.name?F.name:"none"},Oi=function(){return S.name},Vi=function(){return M.vendor?M.vendor:"none"},$i=function(){return M.model?M.model:"none"},Li=function(){return T.name},Ui=function(){return T.version},Hi=function(){return P},Ni=function(){return M.type},Wi=pe(),zi=ze(),ji=be(),Gi=a()||C(),qi=xe(),Qi=$e()||C(),Yi=Te(),Ki=Be()||C(),Xi=ye(),Ji=De(),Zi=Le(),es=Ee()||C(),ts=ce(),is=ae(),ss=i(),ns=l(),as=f(),os=J(),rs=_i(),ls=z(),hs=G(),cs=Oi(),ds=Vi(),us=$i(),gs=Li(),fs=Ui(),ms=Hi(),ps=re()||_e(),vs=_(),ws=Ni(),ys=D(),bs=C(),xs=V(),Ss=X(),ks=b(),Ds=_e(),Rs=re(),Es=Re(),Cs=Pe(),Oe=x(M.type);function Ms(){var Se=Oe.isBrowser,qe=Oe.isMobile,Ts=Oe.isTablet,Tt=Oe.isSmartTV,Pt=Oe.isConsole,Ft=Oe.isWearable;if(Se)return R(Se,S,T,F,P);if(Tt)return u(Tt,T,F,P);if(Pt)return v(Pt,T,F,P);if(qe||Ts)return w(Oe,M,F,P);if(Ft)return y(Ft,T,F,P)}e.exports={deviceDetect:Ms,isSmartTV:Wi,isConsole:zi,isWearable:ji,isMobileSafari:Gi,isChromium:qi,isMobile:Qi,isMobileOnly:Yi,isTablet:Ki,isBrowser:Xi,isAndroid:Ji,isWinPhone:Zi,isIOS:es,isChrome:ts,isFirefox:is,isSafari:ss,isOpera:ns,isIE:as,osVersion:os,osName:rs,fullBrowserVersion:ls,browserVersion:hs,browserName:cs,mobileVendor:ds,mobileModel:us,engineName:gs,engineVersion:fs,getUA:ms,isEdge:ps,isYandex:vs,deviceType:ws,isIOS13:ys,isIPad13:bs,isIPhone13:xs,isIPod13:Ss,isElectron:ks,isEdgeChromium:Ds,isLegacyEdge:Rs,isWindows:Es,isMacOs:Cs}}),(function(e,t,n){var o;(function(h,c){var r="0.7.18",m="",p="?",x="function",R="undefined",w="object",y="string",v="major",u="model",g="name",k="type",E="vendor",S="version",M="architecture",T="console",F="mobile",P="tablet",$="smarttv",K="wearable",ee="embedded",j={extend:function(L,U){var O={};for(var I in L)U[I]&&U[I].length%2===0?O[I]=U[I].concat(L[I]):O[I]=L[I];return O},has:function(L,U){return typeof L=="string"?U.toLowerCase().indexOf(L.toLowerCase())!==-1:!1},lowerize:function(L){return L.toLowerCase()},major:function(L){return typeof L===y?L.replace(/[^\d\.]/g,"").split(".")[0]:c},trim:function(L){return L.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},Q={rgx:function(L,U){for(var O=0,I,B,le,H,he,se;O<U.length&&!he;){var we=U[O],fe=U[O+1];for(I=B=0;I<we.length&&!he;)if(he=we[I++].exec(L),he)for(le=0;le<fe.length;le++)se=he[++B],H=fe[le],typeof H===w&&H.length>0?H.length==2?typeof H[1]==x?this[H[0]]=H[1].call(this,se):this[H[0]]=H[1]:H.length==3?typeof H[1]===x&&!(H[1].exec&&H[1].test)?this[H[0]]=se?H[1].call(this,se,H[2]):c:this[H[0]]=se?se.replace(H[1],H[2]):c:H.length==4&&(this[H[0]]=se?H[3].call(this,se.replace(H[1],H[2])):c):this[H]=se||c;O+=2}},str:function(L,U){for(var O in U)if(typeof U[O]===w&&U[O].length>0){for(var I=0;I<U[O].length;I++)if(j.has(U[O][I],L))return O===p?c:O}else if(j.has(U[O],L))return O===p?c:O;return L}},te={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},W={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[g,S],[/(opios)[\/\s]+([\w\.]+)/i],[[g,"Opera Mini"],S],[/\s(opr)\/([\w\.]+)/i],[[g,"Opera"],S],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark)\/([\w\.-]+)/i],[g,S],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[g,"IE"],S],[/(edge|edgios|edgea)\/((\d+)?[\w\.]+)/i],[[g,"Edge"],S],[/(yabrowser)\/([\w\.]+)/i],[[g,"Yandex"],S],[/(puffin)\/([\w\.]+)/i],[[g,"Puffin"],S],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[g,"UCBrowser"],S],[/(comodo_dragon)\/([\w\.]+)/i],[[g,/_/g," "],S],[/(micromessenger)\/([\w\.]+)/i],[[g,"WeChat"],S],[/(qqbrowserlite)\/([\w\.]+)/i],[g,S],[/(QQ)\/([\d\.]+)/i],[g,S],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[g,S],[/(BIDUBrowser)[\/\s]?([\w\.]+)/i],[g,S],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[g,S],[/(MetaSr)[\/\s]?([\w\.]+)/i],[g],[/(LBBROWSER)/i],[g],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[S,[g,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[S,[g,"Facebook"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[S,[g,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[g,/(.+)/,"$1 WebView"],S],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[g,/(.+(?:g|us))(.+)/,"$1 $2"],S],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[S,[g,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[g,S],[/(dolfin)\/([\w\.]+)/i],[[g,"Dolphin"],S],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[g,"Chrome"],S],[/(coast)\/([\w\.]+)/i],[[g,"Opera Coast"],S],[/fxios\/([\w\.-]+)/i],[S,[g,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[S,[g,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[S,g],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[g,"GSA"],S],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[g,[S,Q.str,te.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[g,S],[/(navigator|netscape)\/([\w\.-]+)/i],[[g,"Netscape"],S],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[g,S]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[M,"amd64"]],[/(ia32(?=;))/i],[[M,j.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[M,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[M,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[M,/ower/,"",j.lowerize]],[/(sun4\w)[;\)]/i],[[M,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[M,j.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[u,E,[k,P]],[/applecoremedia\/[\w\.]+ \((ipad)/],[u,[E,"Apple"],[k,P]],[/(apple\s{0,1}tv)/i],[[u,"Apple TV"],[E,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[E,u,[k,P]],[/(kf[A-z]+)\sbuild\/.+silk\//i],[u,[E,"Amazon"],[k,P]],[/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i],[[u,Q.str,te.device.amazon.model],[E,"Amazon"],[k,F]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[u,E,[k,F]],[/\((ip[honed|\s\w*]+);/i],[u,[E,"Apple"],[k,F]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[E,u,[k,F]],[/\(bb10;\s(\w+)/i],[u,[E,"BlackBerry"],[k,F]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[u,[E,"Asus"],[k,P]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[E,"Sony"],[u,"Xperia Tablet"],[k,P]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[u,[E,"Sony"],[k,F]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[E,u,[k,T]],[/android.+;\s(shield)\sbuild/i],[u,[E,"Nvidia"],[k,T]],[/(playstation\s[34portablevi]+)/i],[u,[E,"Sony"],[k,T]],[/(sprint\s(\w+))/i],[[E,Q.str,te.device.sprint.vendor],[u,Q.str,te.device.sprint.model],[k,F]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[E,u,[k,P]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[E,[u,/_/g," "],[k,F]],[/(nexus\s9)/i],[u,[E,"HTC"],[k,P]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[u,[E,"Huawei"],[k,F]],[/(microsoft);\s(lumia[\s\w]+)/i],[E,u,[k,F]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[u,[E,"Microsoft"],[k,T]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[E,"Microsoft"],[k,F]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[u,[E,"Motorola"],[k,F]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[u,[E,"Motorola"],[k,P]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[E,j.trim],[u,j.trim],[k,$]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[E,"Samsung"],[k,$]],[/\(dtv[\);].+(aquos)/i],[u,[E,"Sharp"],[k,$]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[E,"Samsung"],u,[k,P]],[/smart-tv.+(samsung)/i],[E,[k,$],u],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[E,"Samsung"],u,[k,F]],[/sie-(\w*)/i],[u,[E,"Siemens"],[k,F]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[E,"Nokia"],u,[k,F]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[u,[E,"Acer"],[k,P]],[/android.+([vl]k\-?\d{3})\s+build/i],[u,[E,"LG"],[k,P]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[E,"LG"],u,[k,P]],[/(lg) netcast\.tv/i],[E,u,[k,$]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[u,[E,"LG"],[k,F]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[u,[E,"Lenovo"],[k,P]],[/linux;.+((jolla));/i],[E,u,[k,F]],[/((pebble))app\/[\d\.]+\s/i],[E,u,[k,K]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[E,u,[k,F]],[/crkey/i],[[u,"Chromecast"],[E,"Google"]],[/android.+;\s(glass)\s\d/i],[u,[E,"Google"],[k,K]],[/android.+;\s(pixel c)\s/i],[u,[E,"Google"],[k,P]],[/android.+;\s(pixel xl|pixel)\s/i],[u,[E,"Google"],[k,F]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[u,/_/g," "],[E,"Xiaomi"],[k,F]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[u,/_/g," "],[E,"Xiaomi"],[k,P]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[u,[E,"Meizu"],[k,P]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})\s+build/i],[u,[E,"OnePlus"],[k,F]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[u,[E,"RCA"],[k,P]],[/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i],[u,[E,"Dell"],[k,P]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[u,[E,"Verizon"],[k,P]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[E,"Barnes & Noble"],u,[k,P]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[u,[E,"NuVision"],[k,P]],[/android.+;\s(k88)\sbuild/i],[u,[E,"ZTE"],[k,P]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[u,[E,"Swiss"],[k,F]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[u,[E,"Swiss"],[k,P]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[u,[E,"Zeki"],[k,P]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[E,"Dragon Touch"],u,[k,P]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[u,[E,"Insignia"],[k,P]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[u,[E,"NextBook"],[k,P]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[E,"Voice"],u,[k,F]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[E,"LvTel"],u,[k,F]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[u,[E,"Envizen"],[k,P]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[E,u,[k,P]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[u,[E,"MachSpeed"],[k,P]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[E,u,[k,P]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[u,[E,"Rotor"],[k,P]],[/android.+(KS(.+))\s+build/i],[u,[E,"Amazon"],[k,P]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[E,u,[k,P]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[k,j.lowerize],E,u],[/(android[\w\.\s\-]{0,9});.+build/i],[u,[E,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[S,[g,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[g,S],[/rv\:([\w\.]{1,9}).+(gecko)/i],[S,g]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[g,S],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[g,[S,Q.str,te.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[g,"Windows"],[S,Q.str,te.os.windows.version]],[/\((bb)(10);/i],[[g,"BlackBerry"],S],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]*)/i,/linux;.+(sailfish);/i],[g,S],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[g,"Symbian"],S],[/\((series40);/i],[g],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[g,"Firefox OS"],S],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[g,S],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[g,"Chromium OS"],S],[/(sunos)\s?([\w\.\d]*)/i],[[g,"Solaris"],S],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[g,S],[/(haiku)\s(\w+)/i],[g,S],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[S,/_/g,"."],[g,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[g,"Mac OS"],[S,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]*)/i],[g,S]]},Y=function(L,U){if(typeof L=="object"&&(U=L,L=c),!(this instanceof Y))return new Y(L,U).getResult();var O=L||(h&&h.navigator&&h.navigator.userAgent?h.navigator.userAgent:m),I=U?j.extend(W,U):W;return this.getBrowser=function(){var B={name:c,version:c};return Q.rgx.call(B,O,I.browser),B.major=j.major(B.version),B},this.getCPU=function(){var B={architecture:c};return Q.rgx.call(B,O,I.cpu),B},this.getDevice=function(){var B={vendor:c,model:c,type:c};return Q.rgx.call(B,O,I.device),B},this.getEngine=function(){var B={name:c,version:c};return Q.rgx.call(B,O,I.engine),B},this.getOS=function(){var B={name:c,version:c};return Q.rgx.call(B,O,I.os),B},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return O},this.setUA=function(B){return O=B,this},this};Y.VERSION=r,Y.BROWSER={NAME:g,MAJOR:v,VERSION:S},Y.CPU={ARCHITECTURE:M},Y.DEVICE={MODEL:u,VENDOR:E,TYPE:k,CONSOLE:T,MOBILE:F,SMARTTV:$,TABLET:P,WEARABLE:K,EMBEDDED:ee},Y.ENGINE={NAME:g,VERSION:S},Y.OS={NAME:g,VERSION:S},typeof t!==R?(typeof e!==R&&e.exports&&(t=e.exports=Y),t.UAParser=Y):n(3)?(o=(function(){return Y}).call(t,n,t,e),o!==c&&(e.exports=o)):h&&(h.UAParser=Y);var ue=h&&(h.jQuery||h.Zepto);if(typeof ue!==R){var ge=new Y;ue.ua=ge.getResult(),ue.ua.get=function(){return ge.getUA()},ue.ua.set=function(L){ge.setUA(L);var U=ge.getResult();for(var O in U)ue.ua[O]=U[O]}}})(typeof window=="object"?window:this)}),(function(e,t){(function(n){e.exports=n}).call(t,{})}),(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(g){for(var k=1;k<arguments.length;k++){var E=arguments[k];for(var S in E)Object.prototype.hasOwnProperty.call(E,S)&&(g[S]=E[S])}return g},h=n(0),c=h.DEVICE_TYPES,r=h.defaultData,m=function(g){switch(g){case c.MOBILE:return{isMobile:!0};case c.TABLET:return{isTablet:!0};case c.SMART_TV:return{isSmartTV:!0};case c.CONSOLE:return{isConsole:!0};case c.WEARABLE:return{isWearable:!0};case c.BROWSER:return{isBrowser:!0};default:return r}},p=function(g,k,E,S,M){return{isBrowser:g,browserMajorVersion:k.major,browserFullVersion:k.version,browserName:k.name,engineName:E.name||!1,engineVersion:E.version,osName:S.name,osVersion:S.version,userAgent:M}},x=function(g,k,E,S){return o({},g,{vendor:k.vendor,model:k.model,os:E.name,osVersion:E.version,ua:S})},R=function(g,k,E,S){return{isSmartTV:g,engineName:k.name,engineVersion:k.version,osName:E.name,osVersion:E.version,userAgent:S}},w=function(g,k,E,S){return{isConsole:g,engineName:k.name,engineVersion:k.version,osName:E.name,osVersion:E.version,userAgent:S}},y=function(g,k,E,S){return{isWearable:g,engineName:k.name,engineVersion:k.version,osName:E.name,osVersion:E.version,userAgent:S}},v=t.getNavigatorInstance=function(){return typeof window<"u"&&(window.navigator||navigator)?window.navigator||navigator:!1},u=t.isIOS13Check=function(g){var k=v();return k&&k.platform&&(k.platform.indexOf(g)!==-1||k.platform==="MacIntel"&&k.maxTouchPoints>1&&!window.MSStream)};e.exports={checkType:m,broPayload:p,mobilePayload:x,stvPayload:R,consolePayload:w,wearPayload:y,getNavigatorInstance:v,isIOS13Check:u}})])})(ni)),ni.exports}var Z=oa();const ra=an(Z);function la(s){return new aa(s)}class ha{constructor(e,t){d(this,"video"),d(this,"onFrame"),d(this,"croppingRegion"),d(this,"width",1920),d(this,"height",1080),d(this,"_deviceId"),d(this,"callback"),d(this,"callbackFrameRate",30),d(this,"animationId"),d(this,"handleIOS17Bug",!0),d(this,"handleIOS17ObjectFitBug",!0),d(this,"preferredCamera"),d(this,"objectFit","cover"),d(this,"lastFrameTime"),d(this,"videoFrameCapturer"),this.video=e,this.onFrame=t.onFrame,t.width&&(this.width=t.width),t.height&&(this.height=t.height),t.croppingRegion&&(this.croppingRegion=t.croppingRegion),t.deviceId&&(this._deviceId=t.deviceId),t.callbackFrameRate&&(this.callbackFrameRate=t.callbackFrameRate),t.handleIOS17Bug!==void 0&&(this.handleIOS17Bug=t.handleIOS17Bug),t.preferredCamera!==void 0&&(this.preferredCamera=t.preferredCamera),this.handleIOS17Bug&&this.preferredCamera==null&&(this.preferredCamera="Front Camera"),t.handleIOS17ObjectFitBug!==void 0&&(this.handleIOS17ObjectFitBug=t.handleIOS17ObjectFitBug),getComputedStyle(this.video).objectFit!=="cover"&&(console.warn("[Camera] Forcing the object-fit to 'cover'."),this.video.style.setProperty("object-fit",this.objectFit,"important")),this.callback=n=>{if(this.animationId=requestAnimationFrame(this.callback),this.callbackFrameRate>0&&this.lastFrameTime!==void 0&&n-this.lastFrameTime<1e3/(this.callbackFrameRate*1.1)||(this.lastFrameTime=n,!this.video.srcObject||!this.videoFrameCapturer||!this.video.videoWidth||!this.video.videoHeight||!this.onFrame))return;const o=this.croppingRegion??{x:0,y:0,width:this.video.videoWidth,height:this.video.videoHeight},h=this.videoFrameCapturer.captureFrame(o,n);this.onFrame(h)}}set deviceId(e){this._deviceId!==e&&(this._deviceId=e,console.log(`[Camera] setting device id: ${this._deviceId}`),this.initInputDevice())}async initInputDevice(){var e={ideal:"user"};(this.deviceId||this.preferredCamera)&&(e=void 0);const t=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:this.width},height:{ideal:this.height},frameRate:{ideal:60},deviceId:this.deviceId,facingMode:e}});if(this.video.srcObject=t,console.log("[Camera] Assigned video source."),t.getVideoTracks().length>0&&t.getVideoTracks()[0].getSettings().deviceId){const[n]=t.getVideoTracks(),o=n.getSettings();if(console.log("[Camera] Device settings: ",o),this._deviceId=o.deviceId,o.frameRate!==void 0){const h=o.frameRate;this.callbackFrameRate=Math.min(h,this.callbackFrameRate??h),console.log(`[Camera] Callback frame rate set to ${this.callbackFrameRate} fps`)}}}get deviceId(){return this._deviceId}async start(){if(this.handleIOS17Bug&&(console.log("[Camera] Handling iOS 17 bug..."),this.video.style.opacity="0"),this.handleIOS17ObjectFitBug){console.log("[Camera] Handling iOS 17.2 object-fit bug...");const t=getComputedStyle(this.video).objectFit;t&&t!==""&&(this.video.style.objectFit="none")}const e=!this.deviceId||this.deviceId==="";await this.initInputDevice(),this.preferredCamera&&e&&await this.selectPreferredCamera(),this.handleIOS17Bug&&setTimeout(()=>{console.log("[Camera] iOS 17 bug handled"),this.video.style.opacity="1"},1500),this.handleIOS17ObjectFitBug&&setTimeout(()=>{console.log("[Camera] iOS 17.2 object-fit bug handled"),this.video.style.objectFit=this.objectFit},500),this.video.onplaying=async()=>{this.videoFrameCapturer=la(this.video),await this.videoFrameCapturer.start(),this.callback(performance.now())}}async selectPreferredCamera(e=10){const t=async()=>{console.log("[Camera] Enumerating devices...");let h=await navigator.mediaDevices.enumerateDevices();return console.log(`[Camera] ${h.length} devices found`),h=h.filter(c=>c.kind==="videoinput"),console.log(`[Camera] ${h.length} camera devices found`),this.preferredCamera&&(h=h.filter(c=>c.label===this.preferredCamera),console.log(`[Camera] ${h.length} preferred devices found`)),h.length>0?(this.deviceId=h[0].deviceId,!0):!1};let n=0,o=!1;do{try{console.log(`[Camera] Trying to set preferred camera "${this.preferredCamera}"...`);const h=new Promise(c=>setTimeout(c,e*1e3)).then(()=>!1);o=await Promise.race([t(),h])}catch(h){o=!1,console.log(h)}if(o){console.log(`[Camera] Successfully selected preferred camera "${this.preferredCamera}"`);break}console.log(`[Camera] No camera found. Retry after ${500/1e3} second.`),await new Promise(h=>setTimeout(h,500)),n+=500}while(!o&&n<e*1e3)}async stop(){return this.videoFrameCapturer&&(await this.videoFrameCapturer.stop(),this.videoFrameCapturer=void 0),this.video&&this.video.srcObject&&(this.video.srcObject.getVideoTracks().forEach(e=>{e.enabled=!1,e.stop()}),this.video.srcObject=null),this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=void 0),this.waitUntilStopped().then(()=>{})}async waitUntilStopped(e){return new Promise(t=>{let n=0,o=100;const h=setInterval(()=>{n+=o;try{this.video.srcObject.getVideoTracks(),e&&n>=e&&(clearInterval(h),t(!1))}catch{clearInterval(h),t(!0)}},o)})}}class oi{constructor(e){d(this,"name","noname"),d(this,"frameCount",0),d(this,"start"),d(this,"resetInterval",10),d(this,"frameTimes",[]),d(this,"lastFrameTime",0),this.name=e}reset(){this.frameCount=0,this.start=new Date}tick(){const e=Date.now();if((this.start===void 0||this.elapsed>this.resetInterval)&&(this.log(!1),this.reset()),this.lastFrameTime>0){const t=(e-this.lastFrameTime)/1e3;this.frameTimes.push(t),this.frameTimes.length>60&&this.frameTimes.shift()}this.lastFrameTime=e,this.frameCount=this.frameCount+1}get elapsed(){return this.start===void 0?0:(new Date().getTime()-this.start.getTime())/1e3}get average(){return this.frameTimes.length===0?0:1/(this.frameTimes.reduce((e,t)=>e+t)/this.frameTimes.length)}get current(){return this.average.toFixed(2)}log(e=!1){e&&console.log(`[FPS ${this.name}] ${this.current}fps`)}}function ca(s){let e=document.createElement("canvas");return e.width=s.videoWidth,e.height=s.videoHeight,e.getContext("2d").drawImage(s,0,0),e}function da(s){if(s instanceof HTMLCanvasElement)return s;let e=document.createElement("canvas");return e.width=s.width,e.height=s.width,e.getContext("2d").drawImage(s,0,0),e}function ri(s){let e;return s.image instanceof HTMLVideoElement?e=ca(s.image):s.image instanceof HTMLImageElement?e=da(s.image):e=s.image,e}async function Ro(){const s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAEYklEQVR4Xu3UAQkAAAwCwdm/9HI83BLIOdw5AgQIRAQWySkmAQIEzmB5AgIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw";return new Promise(e=>{const t=document.createElement("img");t.src=s,t.onload=()=>e(t)})}async function Eo(){const s=new ImageData(1,1);return s.data[0]=255,s.data[1]=255,s.data[2]=255,s.data[3]=255,s}async function ua(s){return new Promise(e=>setTimeout(e,s))}function Co(s){let e=1,t=1,n=0,o=0;return s.forEach(h=>{e=Math.min(h.x,e),t=Math.min(h.y,t),n=Math.max(h.x,n),o=Math.max(h.y,o)}),{xCenter:e+(n-e)/2,yCenter:t+(o-t)/2,width:n-e,height:o-t}}const tt=class Fe{constructor(e){d(this,"createDetector"),d(this,"maxFps",30),this.createDetector=e}async getFaceDetector(){return Fe.faceDetector==null&&(Fe.faceDetector=this.createDetector()),Fe.faceDetector}get lastSendTime(){return Fe.lastSendTime}set lastSendTime(e){Fe.lastSendTime=e}get modelState(){return Fe.modelState}set modelState(e){Fe.modelState=e}async loadModels(e){if(this.modelState!=="loaded"){if(this.modelState===void 0){this.modelState="loading";try{await(await this.getFaceDetector()).loadModels(e)}catch(t){throw this.modelState=void 0,t}console.log("[FaceDetectorProxy] model loaded."),this.modelState="loaded";return}do await ua(500);while(this.modelState!=="loading")}}timeout(e){return new Promise((t,n)=>setTimeout(n,e))}async detect(e){if(this.modelState!=="loaded"){console.log("[FaceDetectorProxy] model not ready");const h=ri(e);return{faceBox:void 0,landmarks:[],videoFrame:h}}const t=1e3/this.maxFps,n=new Date;if(this.lastSendTime===void 0||n.getTime()-this.lastSendTime.getTime()>t)return this.lastSendTime=n,Promise.race([this.timeout(1e3),(await this.getFaceDetector()).detect(e)]);const o=ri(e);return{faceBox:void 0,landmarks:[],videoFrame:o}}};d(tt,"faceDetector"),d(tt,"modelState"),d(tt,"lastSendTime");let Ue=tt;const ga=(()=>{const s={loadModelsFromRoot:!1};return typeof window<"u"?(window.__vital_sign_camera_global_options__===void 0&&(window.__vital_sign_camera_global_options__=s),window.__vital_sign_camera_global_options__):typeof self<"u"?(self.__vital_sign_camera_global_options__===void 0&&(self.__vital_sign_camera_global_options__=s),self.__vital_sign_camera_global_options__):s})();function fa(s){return s.startsWith("http")||s.startsWith("/")||!ga.loadModelsFromRoot?s:`/${s}`}async function ot(){return new Promise((s,e)=>{if(typeof FaceMeshUMD<"u"){s(FaceMeshUMD);return}const t=fa("assets/facemesh.umd.cjs");if(document.querySelector(`script[src="${t}"]`)){s(FaceMeshUMD);return}const n=document.createElement("script");n.src=t,document.head.appendChild(n),n.addEventListener("load",()=>{console.log("[VitalSignCamera] Imported FaceMeshUMD"),s(FaceMeshUMD)}),n.addEventListener("error",o=>{console.error("[VitalSignCamera] Failed to import FaceMeshUMD",o),e(o)})})}async function li(s){switch(console.log(`[VitalSignCamera] Creating face detector of type ${s}...`),s){case ne.MediaPipe:const{MediaPipeFaceDetector:e}=await Ce(async()=>{const{MediaPipeFaceDetector:p}=await import("./DAbq7ixO-DtyXssMn.js");return{MediaPipeFaceDetector:p}},[]);return new Ue(()=>new e);case ne.OpenCV:const{OpenCVFaceDetector:t}=await Ce(async()=>{const{OpenCVFaceDetector:p}=await import("./BZv7hKWF-CN-8B7cM.js");return{OpenCVFaceDetector:p}},__vite__mapDeps([0,1]));return new Ue(()=>new t);case ne.Dummy:const{DummyFaceDetector:n}=await Ce(async()=>{const{DummyFaceDetector:p}=await import("./BeXrq9WE-BUKHKF5a.js");return{DummyFaceDetector:p}},[]);return new n;case ne.TFMediaPipe:const{TFMediaPipeFaceDetector:o}=await Ce(async()=>{const{TFMediaPipeFaceDetector:p}=await import("./DUElpq7j-D6AVsVFW.js");return{TFMediaPipeFaceDetector:p}},__vite__mapDeps([2,1]));return new Ue(()=>new o);case ne.FaceApi:const{FaceApiFaceDetector:h}=await Ce(async()=>{const{FaceApiFaceDetector:p}=await import("./NLcWG4bS-eyrYbbK2.js");return{FaceApiFaceDetector:p}},__vite__mapDeps([3,4]));return new h;case ne.MPFaceMesh:const{MPVisionFaceMeshDetector:c}=await Ce(async()=>{const{MPVisionFaceMeshDetector:p}=await import("./CdFMc3zZ-_GH66VcY.js");return{MPVisionFaceMeshDetector:p}},__vite__mapDeps([5,6]));return new Ue(()=>new c);case ne.MPFaceDetector:const{MPVisionFaceDetector:r}=await Ce(async()=>{const{MPVisionFaceDetector:p}=await import("./CVxazVkC-VC5h-GWa.js");return{MPVisionFaceDetector:p}},__vite__mapDeps([7,6]));return new Ue(()=>new r);case ne.MPFaceMeshThreaded:const{MPVisionFaceMeshDetectorThread:m}=await ot();return new Ue(()=>new m)}}function ma(s){var e;const t=(e=s.srcObject)==null?void 0:e.getVideoTracks()[0];if(t.getCapabilities!==void 0){const n=t.getCapabilities().facingMode;return n&&n[0]}else return t.getSettings().facingMode}function pa(s){const e=ma(s);return e&&e==="environment"?"none":"scaleX(-1)"}function Mi(s){const{image:e,facebox:t}=s;let n=t.width*e.width,o=t.height*e.height,h=(t.xCenter-t.width/2)*e.width,c=(t.yCenter-t.height/2)*e.height;o=o*.7;const r=new OffscreenCanvas(e.width,e.height),m=r.getContext("2d");m?.putImageData(e,0,0);const p=new OffscreenCanvas(n,o),x=p.getContext("2d");x.drawImage(r,h,c,n,o,0,0,n,o);let R=x.getImageData(0,0,p.width,p.height).data,w=0,y=0;for(let v=0;v<R.length;v+=4)w+=Math.max(R[v],R[v+1],R[v+2]),y++;return w/y}self.onmessage=s=>{const{inputData:e,hash:t}=s.data,n=Mi(e);self.postMessage({result:n,hash:t})};const va=90,wa=[.3,.9],ya=[.4,.6],ba=[.3,.7],hi=.1,xa=30,Sa=Z.isMobile&&!Z.isTablet,ka=10,ci=Sa||Z.isAndroid?ka:15;function He(s){return Array.isArray(s)?s:[s.min,s.max]}class Da{constructor(e,t){d(this,"MOVEMENT_ARRAY",[]),d(this,"_conditions"),d(this,"vitalSignEngine"),d(this,"workerFactory",()=>new Worker(new URL("/realtime-demo/assets/DaF7aLs5-BKM5EhUa.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Mi,"CheckBrightness")),d(this,"minimumFrameRate",ci),d(this,"minimumBrightness",va),d(this,"validXRange",ya),d(this,"validYRange",ba),d(this,"validDistanceRange",wa),this.vitalSignEngine=e,t?.boundaryRangeX!==void 0&&(this.validXRange=He(t.boundaryRangeX)),t?.boundaryRangeY!==void 0&&(this.validYRange=He(t.boundaryRangeY)),t?.distanceRange!==void 0&&(this.validDistanceRange=He(t.distanceRange))}configure(e){e?.minimumFrameRate!==void 0&&(this.minimumFrameRate=e.minimumFrameRate),e?.validDistanceRange!==void 0&&(this.validDistanceRange=He(e.validDistanceRange)),e?.validXRange!==void 0&&(this.validXRange=He(e.validXRange)),e?.validYRange!==void 0&&(this.validYRange=He(e.validYRange))}get conditions(){return this._conditions}resetMovementArray(){this.MOVEMENT_ARRAY=[]}reset(){this.resetMovementArray(),this._conditions=void 0}async getBrightness(e,t){var n;const o=(n=e.getContext("2d",{willReadFrequently:!0}))==null?void 0:n.getImageData(0,0,e.width,e.height);return o?await this.workerPool.callWorker({image:o,facebox:t}):0}checkDistance(e){let t=this.validDistanceRange;return e.height>t[1]?Ae.TooClose:e.height<t[0]?Ae.TooFar:Ae.OK}checkFacePosition(e){if(e===void 0)return ve.Unknown;let t=this.validXRange,n=this.validYRange,o=ve.Centered;return e.yCenter<n[0]&&(o=ve.TooHigh),e.yCenter>n[1]&&(o=ve.TooLow),e.xCenter<t[0]&&(o=ve.TooRight),e.xCenter>t[1]&&(o=ve.TooLeft),o}async checkCondition(e,t,n){let o=!0;if(e!==void 0){let x=t?await this.getBrightness(e,t):0;o=this.minimumBrightness<=x}const h=t?this.checkDistance(t):Ae.TooFar,c=this.checkFacePosition(t);let r=!1;if(this.MOVEMENT_ARRAY.length>=xa){this.MOVEMENT_ARRAY.shift();let x=0,R=0,w=1,y=1;for(let g=0;g<this.MOVEMENT_ARRAY.length;g++)x=this.MOVEMENT_ARRAY[g][0]>x?this.MOVEMENT_ARRAY[g][0]:x,R=this.MOVEMENT_ARRAY[g][1]>R?this.MOVEMENT_ARRAY[g][1]:R,w=this.MOVEMENT_ARRAY[g][0]<w?this.MOVEMENT_ARRAY[g][0]:w,y=this.MOVEMENT_ARRAY[g][1]<y?this.MOVEMENT_ARRAY[g][1]:y;const v=x.valueOf()-w.valueOf(),u=R.valueOf()-y.valueOf();r=v<=hi&&u<=hi}t&&this.MOVEMENT_ARRAY.push([t.xCenter,t.yCenter]);let m=await this.vitalSignEngine.isReady();const p=n>=this.minimumFrameRate;return{lighting:o,distance:h===Ae.OK,centered:c===ve.Centered,movement:r,serverReady:m,frameRate:p,distanceCondition:h,facePositionCondition:c,fps:n}}async processFrame(e,t,n,o,h){h==="measuring"&&(o=Math.max(ci,o)),this._conditions=await this.checkCondition(n?e:void 0,t,o)}}function Ra(s,e,t){const n=new Da(s,t||void 0);return n.configure(e),n}async function Ea(){try{let s=await navigator.mediaDevices.enumerateDevices();return s=s.filter(e=>e.kind==="videoinput"),s.map((e,t)=>({label:e.label,id:e.deviceId,deviceIndex:t}))}catch{return[]}}function Ca(s,e){if(s.length!=e.length)return!1;for(let t=0;t<s.length;t++)if(s[t].id!==e[t].id||s[t].label!==e[t].label)return!1;return!0}class Ma{constructor(e,t){d(this,"camera"),d(this,"devices",[]),d(this,"timer"),d(this,"selectedDevice"),d(this,"onChanged"),this.camera=e,this.onChanged=t}start(){this.timer===void 0&&(this.timer=setInterval(async()=>{const e=await Ea();(!Ca(e,this.devices)||this.camera.device!==this.selectedDevice)&&(this.devices=e,this.selectedDevice=this.camera.device,this.onChanged&&this.onChanged(this.devices))},1e3))}}async function Ta(s){const{DefaultAgeEstimator:e}=await Ce(async()=>{const{DefaultAgeEstimator:t}=await import("./D3SGl8y2-B7wHqFd5.js");return{DefaultAgeEstimator:t}},__vite__mapDeps([8,4]));return new Promise(t=>{const n=new e(s,()=>{t(n)})})}class Pa{constructor(e,t={}){d(this,"canvas"),d(this,"ctx"),d(this,"config"),d(this,"ecgPhase",0),d(this,"tracePoints",[]),d(this,"tracePosition",0),d(this,"ecgAnimationStopped",!1),this.config={width:t.width||600,height:t.height||200,maxPoints:t.maxPoints||300,lineColor:t.lineColor||"#00ff00",backgroundColor:t.backgroundColor||"#000000",gridColor:t.gridColor||"#333333",visualizationType:t.visualizationType||"PPG",debug:t.debug||!1,...t},this.canvas=document.createElement("canvas"),this.canvas.width=this.config.width,this.canvas.height=this.config.height,this.canvas.style.border="1px solid #333",this.canvas.style.backgroundColor=this.config.backgroundColor,this.canvas.style.display="block",this.canvas.style.width=`${this.config.width}px`,this.canvas.style.height=`${this.config.height}px`,e.appendChild(this.canvas),this.log("Canvas created and appended");const n=this.canvas.getContext("2d");if(!n)throw new Error("Could not get 2D context from canvas");this.ctx=n,this.clear()}log(e,...t){this.config.debug&&console.log(`[Signal Visualizer] ${e}`,...t)}updateSignal(e,t,n){var o;if(this.log("updateSignal:",{hasData:!!e,valuesLength:((o=e?.values)==null?void 0:o.length)||0,sampleRate:e?.sampleRate,visualizationType:this.config.visualizationType,heartRate:t?.heartRate}),this.ctx.clearRect(0,0,this.config.width,this.config.height),this.ctx.fillStyle=this.config.backgroundColor,this.ctx.fillRect(0,0,this.config.width,this.config.height),this.config.visualizationType==="ECG"){if(n===N.Idle){this.stopECGAnimation(),this.drawNoSignal();return}this.ecgAnimationStopped=!1,this.drawECGSignal(t)}else{if(!e||e.values.length===0){this.drawNoSignal();return}this.drawGrid(),this.drawSignalArray(e.values,e.sampleRate),this.drawInfo(e)}}clear(){this.ctx.save(),this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over",this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.clearRect(0,0,this.config.width,this.config.height),this.ctx.fillStyle=this.config.backgroundColor,this.ctx.fillRect(0,0,this.config.width,this.config.height),this.ctx.restore()}stopECGAnimation(){this.ecgAnimationStopped=!0,this.tracePoints=[],this.tracePosition=0,this.ecgPhase=0,this.log("ECG animation stopped")}drawNoSignal(){this.ctx.fillStyle="#666666",this.ctx.font="16px monospace",this.ctx.textAlign="center",this.ctx.fillText("No Signal Data",this.config.width/2,this.config.height/2)}drawGrid(){this.ctx.save(),this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over",this.ctx.strokeStyle=this.config.gridColor,this.ctx.lineWidth=1,this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0;const e=this.config.width/10;for(let n=0;n<=this.config.width;n+=e)this.ctx.beginPath(),this.ctx.moveTo(n,0),this.ctx.lineTo(n,this.config.height),this.ctx.stroke();const t=this.config.height/5;for(let n=0;n<=this.config.height;n+=t)this.ctx.beginPath(),this.ctx.moveTo(0,n),this.ctx.lineTo(this.config.width,n),this.ctx.stroke();this.ctx.restore()}drawECGSignal(e){if(this.ecgAnimationStopped){this.drawNoSignal();return}this.drawGrid();const t=e?.heartRate||72,n=60/t*1e3,o=60/t*30,h=n/o;this.ecgPhase=(this.ecgPhase+h)%n;const c=this.ecgPhase/n,r=(this.generateECGWaveform(c,t)+1)*(this.config.height*.3)+this.config.height*.2;for(this.tracePoints.push({x:this.tracePosition,y:r}),this.tracePosition+=2;this.tracePoints.length>0&&this.tracePoints[0].x<-10;)this.tracePoints.shift();this.tracePosition>this.config.width+10&&(this.tracePosition=0,this.tracePoints=[]),this.drawMovingTrace(),this.drawECGInfo(t)}drawMovingTrace(){if(!(this.tracePoints.length<2)){this.ctx.shadowColor="#ff4444",this.ctx.shadowBlur=8,this.ctx.strokeStyle="#ff6b6b",this.ctx.lineWidth=4,this.ctx.beginPath(),this.ctx.moveTo(this.tracePoints[0].x,this.tracePoints[0].y);for(let e=1;e<this.tracePoints.length;e++)this.ctx.lineTo(this.tracePoints[e].x,this.tracePoints[e].y);this.ctx.stroke(),this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0}}generateECGWaveform(e,t){const n=(Math.random()-.5)*.05,o=Math.max(.08,Math.min(.2,.15*(72/t))),h=.8+(Math.random()-.5)*.3;if(e>=0&&e<=o){const c=e/o;return c<.15?c*(5+Math.random())*h*.7:c<.3?h*(.9+Math.random()*.2):c<.5?(1-(c-.3)/.2)*h*(.8+Math.random()*.4):Math.max(0,1-(c-.5)/.5)*h*(.2+Math.random()*.3)}else return n}drawSignalArray(e,t){const n=Math.min(e.length,this.config.maxPoints);if(n<2)return;const o=Math.min(...e),h=Math.max(...e)-o||1;this.ctx.save(),this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over",this.ctx.strokeStyle=this.config.lineColor,this.ctx.lineWidth=2,this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0,this.ctx.beginPath();const c=this.config.width/(n-1);for(let r=0;r<n;r++){const m=r*c,p=(e[r]-o)/h,x=this.config.height-p*(this.config.height*.8)-this.config.height*.1;r===0?this.ctx.moveTo(m,x):this.ctx.lineTo(m,x)}this.ctx.stroke(),this.ctx.restore()}drawECGInfo(e){this.ctx.fillStyle="#ffffff",this.ctx.font="12px monospace",this.ctx.textAlign="left",["ECG Animation",`Rate: ${e} BPM`,"Visual Demo Only"].forEach((t,n)=>{this.ctx.fillText(t,10,20+n*15)})}drawInfo(e){const{values:t,sampleRate:n}=e;this.ctx.fillStyle="#ffffff",this.ctx.font="12px monospace",this.ctx.textAlign="left",[`Samples: ${t.length}`,`Sample Rate: ${n.toFixed(1)} Hz`,`Duration: ${(t.length/n).toFixed(1)}s`].forEach((o,h)=>{this.ctx.fillText(o,10,20+h*15)})}destroy(){this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}}class Fa{constructor(e){d(this,"config",{earlyEstimation:!1,minDuration:10,minConfidence:.6,debug:!1}),d(this,"estimation_",null),d(this,"signalBuffer",[]),d(this,"timestamps",[]),d(this,"maxBufferSize",300),d(this,"minSamplesForEstimation",30),d(this,"currentPulseRate",0),d(this,"onPulseRateUpdate"),d(this,"heartRateHistory",[]),d(this,"maxHistorySize",10),d(this,"defaultFps",30),d(this,"earlyGuessThreshold",15),d(this,"earlyResultSampleThreshold",90),d(this,"earlyResultMaxHeartRate",150),d(this,"earlyResultMinHeartRate",50),d(this,"stableResultMaxHeartRate",130),d(this,"stableResultMinHeartRate",60),d(this,"minConfidenceForDisplay",1e-4),d(this,"effectiveMinConfidence",.3),d(this,"earlyResultMinHistoryLength",2),d(this,"muchEarlierTriggerThreshold",10),d(this,"minSignalLengthForDetrending",3),d(this,"detrendingWindowSize",50),d(this,"detrendingAmplification",10),d(this,"lowPassWindowSize",5),d(this,"maxAutocorrelationLags",150),d(this,"minAutocorrelationLength",10),d(this,"minBpmForPeakFinding",50),d(this,"maxBpmForPeakFinding",150),d(this,"minLagForPeakFinding",5),d(this,"minSignalLengthForMetrics",10),d(this,"expectedPpgAmplitude",20),d(this,"snrNormalizationFactor",5),d(this,"consistencyScoreFactor",2),d(this,"minSignalLengthForTrendStability",5),d(this,"confidenceWeights",{amplitude:.3,snr:.4,consistency:.2,stability:.1}),d(this,"signalQualityWeights",{amplitude:.4,consistency:.4,stability:.2}),d(this,"earlyGuessMinHeartRate",50),d(this,"earlyGuessMaxHeartRate",150),d(this,"earlyGuessMinLag",5),d(this,"earlyGuessConfidenceBoost",.3),d(this,"earlyGuessMinConfidence",.001),d(this,"stabilityCheckMinHistoryLength",5),d(this,"stabilityThresholdBpm",10),d(this,"defaultTimeIntervalMs",33),e&&this.configure(e)}log(e,...t){this.config.debug&&console.log(`[Realtime Estimater] ${e}`,...t)}get estimation(){return this.estimation_}get signalData(){return this.signalBuffer.length===0?null:{values:[...this.signalBuffer],timestamps:[...this.timestamps],sampleRate:this.timestamps.length>1?1e3/((this.timestamps[this.timestamps.length-1]-this.timestamps[0])/(this.timestamps.length-1)):this.defaultFps}}configure(e){e&&(this.config={...this.config,...e})}processFrame(e,t,n,o){if(this.log(`processFrame called, stage=${t}, hasROI=${!!(o!=null&&o.face)}`),t===N.Idle){this.log(`Skipping - idle stage (${t})`);return}if(!o||!o.face){this.log("Skipping - no ROI data");return}this.log(`Processing frame with ROI in stage ${t}`),this.processFrameAsync(e,o.face)}async processFrameAsync(e,t){const n=await this.extractRealPPGSignal(e,t);n!==null?(this.signalBuffer.push(n),this.timestamps.push(Date.now()),this.log(`Added to buffer - intensity: ${n.toFixed(2)}, buffer size: ${this.signalBuffer.length}`),this.signalBuffer.length>this.maxBufferSize&&(this.signalBuffer.shift(),this.timestamps.shift()),this.signalBuffer.length>=this.minSamplesForEstimation?(this.log(`Processing signal - ${this.signalBuffer.length} samples`),this.processSignal()):this.signalBuffer.length>=this.earlyGuessThreshold&&!this.estimation_?(this.log(`Attempting early guess - ${this.signalBuffer.length} samples`),this.processSignal()):this.log(`Not enough samples yet (${this.signalBuffer.length}/${this.minSamplesForEstimation})`)):this.log("Failed to extract intensity")}async extractRealPPGSignal(e,t){try{this.log("Extracting PPG signal from ROI");const n=await t.imageData;if(!n)return this.log("No imageData available"),null;const o=n.data;this.log(`ImageData length: ${o.length}`);let h=0,c=0;for(let m=0;m<o.length;m+=4)h+=o[m+1],c++;const r=c>0?h/c:null;return this.log(`Extracted intensity: ${r}`),r}catch(n){return console.warn("Failed to extract PPG signal:",n),null}}processSignal(){var e;if(this.signalBuffer.length<this.minSamplesForEstimation){this.log(`Not enough samples (${this.signalBuffer.length}/${this.minSamplesForEstimation})`);return}try{const t=this.bandpassFilter(this.signalBuffer),n=this.calculateAutocorrelation(t);this.log(`Raw signal range: [${Math.min(...this.signalBuffer).toFixed(2)}-${Math.max(...this.signalBuffer).toFixed(2)}]`),this.log(`Filtered signal range: [${Math.min(...t).toFixed(2)}-${Math.max(...t).toFixed(2)}]`),this.log(`Autocorr range: [${Math.min(...n).toFixed(4)}-${Math.max(...n).toFixed(4)}]`);const o=this.findDominantPeak(n);if(this.log(`signalLength=${this.signalBuffer.length}, filteredLength=${t.length}, autocorrLength=${n.length}, peakIndex=${o}`),o>0){const h=1e3/this.getAverageTimeInterval(),c=h/o,r=c*60;this.log(`sampleRate=${h.toFixed(1)}, peakIndex=${o}, frequency=${c.toFixed(2)}, heartRate=${r.toFixed(1)}`);const m=this.signalBuffer.length<this.earlyResultSampleThreshold,p=m?this.earlyResultMaxHeartRate:this.stableResultMaxHeartRate,x=m?this.earlyResultMinHeartRate:this.stableResultMinHeartRate;if(r>=x&&r<=p){const R=Math.round(r),w=this.calculateSignalMetrics(t),y=w.confidence,v=y>(this.config.minConfidence||.3)&&this.signalBuffer.length>=this.minSamplesForEstimation&&this.checkHeartRateStability();this.log(`confidence=${(y*100).toFixed(1)}%, snr=${w.snr.toFixed(2)}, signalQuality=${w.signalQuality.toFixed(1)}, isStable=${v}, signalLength=${this.signalBuffer.length}`);const u=this.minConfidenceForDisplay,g=this.signalBuffer.length<this.earlyResultSampleThreshold,k=g?this.minConfidenceForDisplay:this.config.minConfidence||this.effectiveMinConfidence;if(y>=u){const E=g?this.heartRateHistory.length>=this.earlyResultMinHistoryLength:this.checkHeartRateStability(),S=y>k&&E;(!this.estimation_||this.estimation_.heartRate!==R||g)&&(this.estimation_={heartRate:R,confidence:y,isStable:S,snr:w.snr,signalQuality:w.signalQuality},this.heartRateHistory.push(R),this.heartRateHistory.length>this.maxHistorySize&&this.heartRateHistory.shift(),this.currentPulseRate=R,(e=this.onPulseRateUpdate)==null||e.call(this,this.currentPulseRate),this.log(`Updated estimation - HR: ${R} BPM, Confidence: ${(y*100).toFixed(1)}%, Early: ${g}`))}else this.signalBuffer.length>=this.muchEarlierTriggerThreshold?this.provideEarlyGuess(t,n):this.log(`Confidence too low (${(y*100).toFixed(1)}%) for display`)}}}catch(t){console.warn("Failed to process PPG signal:",t)}}bandpassFilter(e){const t=[];if(e.length<this.minSignalLengthForDetrending)return t;const n=this.detrendingWindowSize;for(let c=0;c<e.length;c++){const r=Math.max(0,c-n),m=Math.min(e.length,c+n+1),p=e.slice(r,m),x=p.reduce((w,y)=>w+y,0)/p.length,R=(e[c]-x)*this.detrendingAmplification;t.push(R)}const o=[],h=this.lowPassWindowSize;for(let c=0;c<t.length;c++){const r=Math.max(0,c-h),m=Math.min(t.length,c+h+1),p=t.slice(r,m);o.push(p.reduce((x,R)=>x+R,0)/p.length)}return o}calculateAutocorrelation(e){const t=[],n=e.length,o=e.reduce((c,r)=>c+r,0)/n,h=e.reduce((c,r)=>c+Math.pow(r-o,2),0)/n;for(let c=0;c<Math.min(n-1,this.maxAutocorrelationLags);c++){let r=0,m=0;for(let x=0;x<n-c;x++)r+=(e[x]-o)*(e[x+c]-o),m++;const p=m>0?r/(m*h+1e-10):0;t.push(p)}return t}findDominantPeak(e){if(e.length<this.minAutocorrelationLength)return this.log(`Autocorr too short (${e.length})`),0;const t=1e3/this.getAverageTimeInterval(),n=Math.floor(t/(this.maxBpmForPeakFinding/60)),o=Math.floor(t/(this.minBpmForPeakFinding/60));this.log(`sampleRate=${t.toFixed(1)}, minPeriod=${n}, maxPeriod=${o}, autocorrRange=[${n+1}-${Math.min(o,e.length-1)}]`);const h=n+1,c=Math.min(o,e.length-1),r=e.slice(h,c+1);this.log(`Autocorr values [${h}-${c}]:`,r.map((x,R)=>`${h+R}:${x.toFixed(4)}`).join(", "));let m=0,p=0;for(let x=Math.max(this.minLagForPeakFinding,n);x<Math.min(o,e.length);x++)e[x]>m&&(m=e[x],p=x);return p>0?(this.log(`Found best peak at index ${p}, value=${m.toFixed(4)}`),p):(this.log("No acceptable peaks found"),0)}calculateSignalMetrics(e){if(e.length<this.minSignalLengthForMetrics)return{confidence:0,snr:0,signalQuality:0};const t=Math.max(...e)-Math.min(...e),n=e.reduce((y,v)=>y+v,0)/e.length,o=e.reduce((y,v)=>y+Math.pow(v-n,2),0)/e.length,h=Math.sqrt(o),c=Math.min(t/this.expectedPpgAmplitude,1),r=t/(h+.001),m=Math.min(r/this.snrNormalizationFactor,1),p=Math.max(0,1-h/(t+.001)*this.consistencyScoreFactor);let x=0;if(e.length>this.minSignalLengthForTrendStability){const y=e.slice(0,Math.floor(e.length/2)),v=e.slice(Math.floor(e.length/2)),u=Math.max(...y)-Math.min(...y),g=Math.max(...v)-Math.min(...v),k=(u+g)/2;x=1-Math.abs(u-g)/(k+.001)}const R=c*this.confidenceWeights.amplitude+m*this.confidenceWeights.snr+p*this.confidenceWeights.consistency+x*this.confidenceWeights.stability,w=c*this.signalQualityWeights.amplitude+p*this.signalQualityWeights.consistency+x*this.signalQualityWeights.stability;return{confidence:Math.max(0,Math.min(1,R)),snr:Math.max(0,r),signalQuality:Math.max(0,Math.min(100,w*100))}}provideEarlyGuess(e,t){var n;const o=1e3/this.getAverageTimeInterval(),h=Math.floor(o/(this.earlyGuessMaxHeartRate/60)),c=Math.floor(o/(this.earlyGuessMinHeartRate/60));let r=0,m=0;for(let p=Math.max(this.earlyGuessMinLag,h);p<Math.min(c,t.length);p++)t[p]>r&&(r=t[p],m=p);if(m>0){const p=o/m,x=Math.round(p*60);if(x>=this.earlyGuessMinHeartRate&&x<=this.earlyGuessMaxHeartRate){const R=this.calculateSignalMetrics(e),w=Math.max(R.confidence*this.earlyGuessConfidenceBoost,this.earlyGuessMinConfidence);(!this.estimation_||!0)&&(this.estimation_={heartRate:x,confidence:w,isStable:!1,snr:R.snr,signalQuality:R.signalQuality},this.currentPulseRate=x,(n=this.onPulseRateUpdate)==null||n.call(this,this.currentPulseRate),this.log(`Early guess - HR: ${x} BPM, Confidence: ${(w*100).toFixed(1)}% (BEST GUESS)`))}}}checkHeartRateStability(){if(this.heartRateHistory.length<this.stabilityCheckMinHistoryLength)return!1;const e=this.heartRateHistory.reduce((n,o)=>n+o,0)/this.heartRateHistory.length,t=this.heartRateHistory.reduce((n,o)=>n+Math.pow(o-e,2),0)/this.heartRateHistory.length;return Math.sqrt(t)<this.stabilityThresholdBpm}updateWithServerResult(e,t,n){var o;this.log(`Updating estimation with server result: ${e} BPM, SNR: ${t}, Signal Quality: ${n}`),this.estimation_={heartRate:Math.round(e),confidence:1,isStable:!0,snr:t,signalQuality:n},this.currentPulseRate=Math.round(e),(o=this.onPulseRateUpdate)==null||o.call(this,this.currentPulseRate)}reset(){this.estimation_=null,this.signalBuffer=[],this.timestamps=[],this.currentPulseRate=0,this.heartRateHistory=[]}getAverageTimeInterval(){if(this.timestamps.length<2)return this.defaultTimeIntervalMs;let e=0;for(let t=1;t<this.timestamps.length;t++)e+=this.timestamps[t]-this.timestamps[t-1];return e/(this.timestamps.length-1)}}async function Aa(s){return new Fa(s)}function Ia(s){let e=document.createElement("div"),t=document.createElement("div");return e.appendChild(t),s.after(e),e.style.pointerEvents="none",e}function Ba(s,e,t){const n=e.clientWidth/e.clientHeight,o=t.videoWidth/t.videoHeight;let h,c;o>n?(h=e.clientHeight,c=h*o):(c=e.clientWidth,h=c/o);const r=(h-e.clientHeight)/2,m=(c-e.clientWidth)/2;return{left:(s.xCenter-s.width/2)*c-m,top:(s.yCenter-s.height/2)*h-r,width:s.width*c,height:s.height*h}}class di{constructor(e,t){d(this,"boundingBox"),d(this,"video"),d(this,"color"),this.video=e,this.color=t?.color||"red",this.enabled=!0}set enabled(e){var t;e&&!this.boundingBox&&(this.boundingBox=Ia(this.video)),!e&&this.boundingBox&&((t=this.boundingBox.parentElement)==null||t.removeChild(this.boundingBox),this.boundingBox=void 0)}updateOptions(e){e.color&&e.color!==this.color&&(this.color=e.color)}update(e){if(!this.boundingBox)return;this.boundingBox.style.position="fixed";const{x:t,y:n,width:o,height:h}=this.video.getBoundingClientRect();this.boundingBox.style.left=`${t}px`,this.boundingBox.style.top=`${n}px`,this.boundingBox.style.width=`${o}px`,this.boundingBox.style.height=`${h}px`,this.boundingBox.style.transform=`${this.video.style.transform}`,this.boundingBox.style.overflow="clip";const c=this.boundingBox.children[0];if(e===void 0){c.style.setProperty("display","none");return}const r=Ba(e,this.video,this.video);c.style.display="block",c.style.position="relative",c.style.left=`${r.left}px`,c.style.top=`${r.top}px`,c.style.width=`${r.width}px`,c.style.height=`${r.height}px`,c.style.borderStyle="solid",c.style.borderColor=this.color||"red"}}const _a=".up-down-mask-animation{mask:linear-gradient(to bottom,transparent,black,transparent);-webkit-mask-size:100% 10%;mask-size:100% 10%;-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;animation:moveMaskUpDown var(--face-mesh-animation-duration, 2s) linear infinite}@keyframes moveMaskUpDown{0%{-webkit-mask-position:0% 0;mask-position:0% 0}50%{-webkit-mask-position:0% 100%;mask-position:0% 100%}to{-webkit-mask-position:0% 0;mask-position:0% 0}}.left-right-mask-animation{mask:linear-gradient(to right,transparent,black,transparent);-webkit-mask-size:10% 100%;mask-size:10% 100%;-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;animation:moveMaskLeftRight var(--face-mesh-animation-duration, 2s) linear infinite}@keyframes moveMaskLeftRight{0%{-webkit-mask-position:0% 0;mask-position:0% 0}50%{-webkit-mask-position:100% 0;mask-position:100% 0}to{-webkit-mask-position:0% 0;mask-position:0% 0}}.four-way-mask-animation{mask:linear-gradient(to bottom,transparent,black,transparent),linear-gradient(to right,transparent,black,transparent);-webkit-mask-size:100% 10%,10% 100%;mask-size:100% 10%,10% 100%;-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-composite:source-over;mask-composite:add;animation:moveMaskFourWay var(--face-mesh-animation-duration, 2s) linear infinite}@keyframes moveMaskFourWay{0%{-webkit-mask-position:0% 0,0% 0;mask-position:0% 0,0% 0}25%{-webkit-mask-position:0% 100%,0% 0;mask-position:0% 100%,0% 0}50%{-webkit-mask-position:0% 0%,0% 0;mask-position:0% 0%,0% 0}75%{-webkit-mask-position:0% 0%,100% 0;mask-position:0% 0%,100% 0}to{-webkit-mask-position:0% 0,0% 0;mask-position:0% 0,0% 0}}";async function Oa(){const{FACEMESH_FACE_OVAL:s}=await ot();return s}async function Va(s,e,t,n){if(e===void 0||t===void 0)return;s.save();const o=s.canvas.width,h=s.canvas.height,c=n?.lineWidth||await $a(e,o);for(var r=0;r<t.length;r++){const m=t[r];s.beginPath();const p=e[m[0]],x=e[m[1]];s.moveTo(p.x*o,p.y*h),s.lineTo(x.x*o,x.y*h),s.lineWidth=c,s.strokeStyle=n?.color||"lightgreen",s.stroke()}s.restore()}async function $a(s,e){const t=await La(s)*.01*e;return console.log("lineWidth = ",t),t}async function La(s){const e=(await Oa()).map(([t])=>s[t].x);return Math.abs(Math.max(...e)-Math.min(...e))}class ui{constructor(e,t){d(this,"faceMesh"),d(this,"canvas"),d(this,"video"),d(this,"color","lightgreen"),d(this,"lineWidth"),d(this,"animateStyle"),d(this,"animationSpeed"),d(this,"animationDelay"),d(this,"animationDirection"),this.video=e,this.color=t?.color||this.color,this.lineWidth=t?.lineWidth||this.lineWidth,this.animationSpeed=t?.animationSpeed,this.animationDelay=t?.animationDelay,this.animationDirection=t?.animationDirection,this.enabled=!0,this.animateStyle=document.createElement("style"),this.animateStyle.innerHTML=_a,this.animate=t?.animate!==void 0?t.animate:!0}destroy(){console.log("[VitalSignCamera] Trying to destroy face mesh..."),this.faceMesh&&this.faceMesh.parentElement&&(this.faceMesh.parentElement.removeChild(this.faceMesh),console.log("[VitalSignCamera] Face mesh removed."),this.faceMesh=void 0,this.canvas=void 0),this.animateStyle.parentElement&&(this.animateStyle.parentElement.removeChild(this.animateStyle),console.log("[VitalSignCamera] Face mesh animation CSS removed."))}get animationClass(){return this.animationDirection==="vertical"?"up-down-mask-animation":this.animationDirection==="horizontal"?"left-right-mask-animation":this.animationDirection=="both"?"four-way-mask-animation":"up-down-mask-animation"}set enabled(e){var t;e&&!this.faceMesh&&(this.faceMesh=document.createElement("div"),this.canvas=document.createElement("canvas"),this.canvas.style.setProperty("--face-mesh-animation-duration",`${this.animationSpeed??8}s`),this.canvas.style.setProperty("--face-mesh-animation-delay",`${this.animationDelay??-1.5}s`),console.log("Applying animation class",this.animationDirection,this.animationSpeed),this.canvas.className=`face-mesh-canvas ${this.animationClass}`,this.faceMesh.appendChild(this.canvas),this.faceMesh.style.width="0px",this.faceMesh.style.height="0px",this.faceMesh.style.pointerEvents="none",this.faceMesh.style.overflow="clip",this.video.after(this.faceMesh),console.log("[VitalSignCamera] Face mesh inserted.")),!e&&this.faceMesh&&((t=this.faceMesh.parentElement)==null||t.removeChild(this.faceMesh),this.faceMesh=void 0,this.canvas=void 0)}set animate(e){var t;e&&!this.animate&&(document.body.append(this.animateStyle),console.log("[VitalSignCamera] Face mesh CSS inserted.")),!e&&this.animate&&((t=this.animateStyle.parentElement)==null||t.removeChild(this.animateStyle))}get animate(){return this.animateStyle.parentElement!==null}get enabled(){return this.faceMesh!==void 0}updateOptions(e){e.color!==void 0&&e.color!==this.color&&(this.color=e.color),e.lineWidth!==void 0&&e.lineWidth!==this.lineWidth&&(this.lineWidth=e.lineWidth),e.animate!==void 0&&e.animate!==this.animate&&(this.animate=e.animate),e.animationSpeed!==void 0&&e.animationSpeed!==this.animationSpeed&&(this.animationSpeed=e.animationSpeed,this.canvas&&this.canvas.style.setProperty("--face-mesh-animation-duration",`${this.animationSpeed}s`)),e.animationDelay!==void 0&&e.animationDelay!==this.animationDelay&&(this.animationDelay=e.animationDelay,this.canvas&&this.canvas.style.setProperty("--face-mesh-animation-delay",`${this.animationDelay}s`)),e.animationDirection!==void 0&&e.animationDirection!==this.animationDirection&&(this.animationDirection=e.animationDirection,this.canvas&&(this.canvas.className=`face-mesh-canvas ${this.animationClass}`))}update(e){if(!this.faceMesh||!this.canvas)return;this.faceMesh.style.position="fixed";const{x:t,y:n,width:o,height:h}=this.video.getBoundingClientRect();this.faceMesh.style.left=`${t}px`,this.faceMesh.style.top=`${n}px`,this.faceMesh.style.width=`${o}px`,this.faceMesh.style.height=`${h}px`,this.faceMesh.style.transform=`${this.video.style.transform}`,this.faceMesh.style.overflow="clip",this.redraw(e);const c=this.computeStyle(this.faceMesh);this.canvas.style.left=c.left,this.canvas.style.top=c.top,this.canvas.style.width=c.width,this.canvas.style.height=c.height,this.canvas.style.aspectRatio=c.aspectRatio,this.canvas.style.position="relative"}async redraw(e){const{FACEMESH_TESSELATION:t}=await ot();if(!this.faceMesh||!this.canvas){console.warn("Undefined canvas or face mesh");return}this.canvas.width=this.video.videoWidth,this.canvas.height=this.video.videoHeight;const n=this.canvas.getContext("2d");if(n===null){console.warn("Null Context");return}if(n.save(),n.clearRect(0,0,this.canvas.width,this.canvas.height),e!==void 0&&e.length>0){const o=await this.computeLineWidth(e);n.lineTo(this.canvas.width,this.canvas.height),Va(n,e,t,{color:this.color,lineWidth:o})}n.restore()}computeStyle(e){let t=0;const n=this.video.videoHeight,o=this.video.videoWidth;t=o&&n?o/n:0;const h={width:"",height:"",left:"0%",top:"0%",aspectRatio:`${t}`},c=e.clientWidth/e.clientHeight;return c<t?(h.left=`${(c-t)/c/2*100}%`,h.height="100%"):(h.top=`${(1/c-1/t)*c/2*100}%`,h.width="100%"),h}async computeLineWidth(e){const t=this.video.videoWidth,n=this.lineWidth===void 0?"1%":this.lineWidth,o=await Ua(e);var h;return typeof n=="string"?h=parseFloat(n)*.01*o*t:h=n,h}}async function Ua(s){const{FACEMESH_FACE_OVAL:e}=await ot(),t=e.map(([n])=>s[n].x);return Math.abs(Math.max(...t)-Math.min(...t))}async function Ha(s){const{RemoteBeautyAnalyzer:e}=await Ce(async()=>{const{RemoteBeautyAnalyzer:t}=await import("./DF3N2dI5-poHua5zw.js");return{RemoteBeautyAnalyzer:t}},[]);return new e(s)}function Mt(s){var e;const{videoFrame:t,rect:n}=s,{x:o,y:h,w:c,h:r}=n,m=new OffscreenCanvas(t.width,t.height);(e=m.getContext("2d"))==null||e.putImageData(t,0,0);let p=new OffscreenCanvas(c,r).getContext("2d");return p.drawImage(m,o,h,c,r,0,0,c,r),p.getImageData(0,0,c,r)}self.onmessage=s=>{const{inputData:e,hash:t}=s.data,n=Mt(e);self.postMessage({result:n,hash:t},[n.data.buffer])};class Na{constructor(e,t,n){if(d(this,"type","chest"),d(this,"boundingBox"),d(this,"imageData"),d(this,"workerFactory",()=>new Worker(new URL("/realtime-demo/assets/BVv6I5U7-eMazRsx3.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Mt,"ChestROIExtractorWorker")),this.boundingBox=this.chestRect({width:e.width,height:e.height},t,n),this.boundingBox===void 0){this.imageData=Promise.resolve(void 0);return}this.imageData=e.getImageData().then(o=>{if(!(!o||!this.boundingBox))return this.workerPool.callWorker({videoFrame:o,rect:this.boundingBox})})}chestRect(e,t,n){if(!t||!n)return;let o=t.width*e.width,h=t.height*e.height,c=(n.xCenter-t.width/2)*e.width,r=(t.yCenter-t.height/2)*e.height;if(r=r+h,r+h>e.height&&(h=e.height-r),!(o<=0||h<=0)&&!(h<.1*n.height*e.height))return{x:c,y:r,w:o,h}}}class Wa{constructor(e,t,n,o="rgb1x1",h=ie.AwsEnterpriseProd){if(d(this,"type","face"),d(this,"boundingBox"),d(this,"imageData"),d(this,"workerFactory",()=>new Worker(new URL("/realtime-demo/assets/BVv6I5U7-eMazRsx3.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Mt,"FaceROIExtractorWorker")),this.boundingBox=this.faceRect({width:e.width,height:e.height},t,n,o,h),this.boundingBox===void 0){this.imageData=Promise.resolve(void 0);return}this.imageData=e.getImageData().then(c=>{if(!(!c||!this.boundingBox))return this.workerPool.callWorker({videoFrame:c,rect:this.boundingBox})})}faceRect(e,t,n,o,h){var c;if(!t||!n)return;let r=1,m=t.width*e.width*r,p=t.height*e.height*r,x=(n.xCenter-t.width/2*r)*e.width,R=(n.yCenter-t.height/2*r)*e.height;if(m==0||p==0)return;let w=(c=Dt.get(h))==null?void 0:c.schemaVersion;return(o=="rgb1x1"||o=="yuv1x1"&&w&&Ne(w,"2.0")<0)&&(p=p*.7),{x,y:R,w:m,h:p}}}function gi(s){const e=s.map(n=>n.x),t=s.map(n=>n.y);return{min:{x:Math.min(...e),y:Math.min(...t)},max:{x:Math.max(...e),y:Math.max(...t)}}}function za(s){const e=s.reduce((t,n)=>({x:t.x+n.x,y:t.y+n.y}),{x:0,y:0});return{x:e.x/s.length,y:e.y/s.length}}function ja(s,e,t){const n=[s[0].x,s[0].y,s[1].x,s[1].y],o=[e[0].x,e[0].y,e[1].x,e[1].y],[h,c,r,m]=n,p=Math.sqrt(Math.pow(Math.abs(h-r),2)+Math.pow(Math.abs(c-m),2)),[x,R,w,y]=o,v=x-w,u=R-y,g=[1,0],k=[r-h,m-c],E=g[0]*k[0]+g[1]*k[1],S=Math.sqrt(g[0]*g[0]+g[1]*g[1]),M=Math.sqrt(k[0]*k[0]+k[1]*k[1]),T=Math.acos(E/(S*M)),F=Math.abs(Math.cos(T)*p/2),P=Math.abs(Math.sin(T)*p/2),$={x:t.x-v/2,y:t.y-u/2*.8},K={x:t.x-F/2,y:t.y-P/2},ee={x:t.x+F/2,y:t.y+P/2},j={x:$.x+F/2,y:$.y+P/2},Q={x:$.x-F/2,y:$.y-P/2};return[K,ee,j,Q]}function Ga(s,e){const t=gi(e),n=t.min.x,o=t.min.y,h=t.max.x,c=t.max.y,r=[(h-n)*.25,(c-o)*.25];let m,p,x,R;switch(s){case"forehead":m=e[151].x,p=e[151].y,x=r[0]*2,R=r[1]*.5;break;case"glabella":m=e[8].x,p=e[8].y,x=r[0]*.6,R=r[1]*.6;break;case"rightCheek":m=e[425].x,p=e[425].y-r[1]*.2,x=r[0]*.8,R=r[1]*.6;break;case"leftCheek":m=e[205].x,p=e[205].y-r[1]*.2,x=r[0]*.8,R=r[1]*.6;break;case"chin":m=e[200].x,p=e[200].y,x=r[0]*.8,R=r[1]*.4;break;case"neck":const g=[e[205],e[425]],k=[e[168],e[4]],E=e[152],S=ja(g,k,E),M=gi(S),T=za(S);m=T.x,p=T.y,x=M.max.x-M.min.x,R=M.max.y-M.min.y,p+=R,R*=2;break;case"rightLowerCheek":m=e[425].x,p=e[425].y,x=r[0],R=r[1]/2,p+=R/2;break;case"rightUpperCheek":m=e[425].x,p=e[425].y,x=r[0],R=r[1]/2,p-=R/2;break;case"leftLowerCheek":m=e[205].x,p=e[205].y,x=r[0],R=r[1]/2,p+=R/2;break;case"leftUpperCheek":m=e[205].x,p=e[205].y,x=r[0],R=r[1]/2,p-=R/2;break;default:throw new Error(`Unsupported ROI part: ${s}`)}const w=m-x/2,y=p-R/2,v=w+x,u=y+R;return[{x:w,y},{x:v,y},{x:v,y:u},{x:w,y:u}]}function Ti(s,e){if(e.length===0)return{x:0,y:0,w:0,h:0};if(e.length===1){const c=e[0];return{x:Math.floor(c.x)*s.width,y:Math.floor(c.y)*s.height,w:1,h:1}}let t=e[0].x,n=e[0].y,o=e[0].x,h=e[0].y;for(let c=1;c<e.length;c++){const r=e[c];r.x<t&&(t=r.x),r.y<n&&(n=r.y),r.x>o&&(o=r.x),r.y>h&&(h=r.y)}return{x:t*s.width,y:n*s.height,w:(o-t)*s.width,h:(h-n)*s.height}}function Pi(s){var e;const{videoFrame:t,normalizedPoints:n}=s,{x:o,y:h,w:c,h:r}=Ti(t,n),m=new OffscreenCanvas(t.width,t.height);(e=m.getContext("2d"))==null||e.putImageData(t,0,0);let p=new OffscreenCanvas(c,r).getContext("2d");p.beginPath();for(let x=0;x<n.length;x++){const R=n[x],w=(R.x-o/t.width)*(t.width/c)*c,y=(R.y-h/t.height)*(t.height/r)*r;x===0?p.moveTo(w,y):p.lineTo(w,y)}return p.closePath(),p.clip(),p.drawImage(m,o,h,c,r,0,0,c,r),p.getImageData(0,0,c,r)}self.onmessage=s=>{const{inputData:e,hash:t}=s.data,n=Pi(e);self.postMessage({result:n,hash:t},[n.data.buffer])};class qa{constructor(e,t,n){d(this,"type"),d(this,"boundingBox"),d(this,"imageData"),d(this,"workerFactory",()=>new Worker(new URL("/realtime-demo/assets/CDhEsE-f-CpFHRKS_.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Pi,"PolygonROIExtractorWorker",1e3,48)),this.type=t,this.boundingBox=Ti(e,n),this.imageData=e.getImageData().then(o=>{if(!(!o||!this.boundingBox))return this.workerPool.callWorker({videoFrame:o,normalizedPoints:n})})}}class Qa{constructor(e,t){d(this,"canvas"),d(this,"config"),d(this,"faceDetectionSamplingInterval"),d(this,"debug",!1),d(this,"sampledFaceDetection"),d(this,"firstFaceDetection"),this.canvas=document.createElement("canvas"),this.config=t,this.faceDetectionSamplingInterval=e,console.log("[VitalSignCamera] DefaultFaceROIExtractor initialized")}reset(){this.sampledFaceDetection=void 0,this.firstFaceDetection=void 0}processFrame(e,t,n){n==="idle"&&(this.sampledFaceDetection=void 0,this.firstFaceDetection=void 0);const o=new Date().getTime();return(!this.sampledFaceDetection||!this.faceDetectionSamplingInterval||o-this.sampledFaceDetection.timestamp>this.faceDetectionSamplingInterval)&&(this.sampledFaceDetection={timestamp:new Date().getTime(),...t}),this.firstFaceDetection===void 0&&(this.firstFaceDetection=t),{images:(this.config.enabledROIs??["face","chest"]).reduce((h,c)=>{var r,m,p,x,R,w;if(c==="face")h.face=new Wa(e,(r=this.firstFaceDetection)==null?void 0:r.faceBox,(m=this.sampledFaceDetection)==null?void 0:m.faceBox,this.config.pixelDataType,this.config.serverId);else if(c==="chest")h.chest=new Na(e,(p=this.firstFaceDetection)==null?void 0:p.faceBox,(x=this.sampledFaceDetection)==null?void 0:x.faceBox);else{if(!((R=this.sampledFaceDetection)!=null&&R.landmarks)||this.sampledFaceDetection.landmarks.length===0)return h;const y=Ga(c,(w=this.sampledFaceDetection)==null?void 0:w.landmarks),v=new qa(e,c,y);h[c]=v}return this.debug&&h[c]&&this.debugRoi(h[c]),h},{})}}cropFrame(e,t){const n=this.canvas;return n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(e,t.x,t.y,t.width,t.height,0,0,n.width,n.height),n.getContext("2d").canvas}async debugRoi(e){var t;const n=await e.imageData;if(n===void 0){console.log("[VitalSignCamera] debugRoi: imageData is undefined");return}const o=document.createElement("canvas");o.width=n.width,o.height=n.height,(t=o.getContext("2d"))==null||t.putImageData(n,0,0);const h=o.toDataURL(),c=`debug-${e.type}`,r=document.getElementById(c);if(r)r.setAttribute("src",h);else{const m=document.createElement("img");m.id=c,m.setAttribute("src",h),document.body.appendChild(m)}}}function fi(s,e){var t;return console.log(`[VitalSignCamera] createFaceROIExtractor for ${(t=e.enabledROIs)==null?void 0:t.join(", ")} ROIs`),new Qa(s,e)}const Fi=Z.isMobile&&!Z.isTablet,Ya=Fi?ke.sd480x360:Z.isTablet?ke.hd1280x720:ke.hd1920x1080,mi={engineConfig:{serverId:ie.Schema2Prod,dataCollectionDuration:25,dataSendingDuration:5,enabledROIs:["face","chest"],pixelDataType:"rgb1x1",chestPixelDataType:"ggg1x1",landmarksSampleRate:10},conditionCheckerConfig:{minimumFrameRate:Fi||Z.isAndroid?10:15},presetFormat:Ya,maxFaceDetectionFps:5},Ka={engineConfig:{serverId:ie.Schema2Prod,dataCollectionDuration:18,dataSendingDuration:10,enabledROIs:["face","chest","leftCheek","rightCheek","chin","glabella"],pixelDataType:"rgb8x8",chestPixelDataType:"meanRgb1x1",landmarksSampleRate:10},conditionCheckerConfig:{minimumFrameRate:25},presetFormat:Z.isMobile?ke.hd1280x720:ke.hd1920x1080,maxFaceDetectionFps:15};function Ai(s){switch(s){case Me.relaxed:return mi;case Me.strict:return Ka;default:return mi}}class Xa{constructor(e){d(this,"lastFramerateOKTime",new Date),d(this,"requiredStableDuration",1e4),d(this,"waitingResponse",!1),this.camera=e}reset(){this.lastFramerateOKTime=new Date}process(e,t){var n;if(this.camera.precisionMode===void 0)return;const o=(n=Ai(this.camera.precisionMode).conditionCheckerConfig)==null?void 0:n.minimumFrameRate;if(!(o===void 0||(e>=o&&(this.lastFramerateOKTime=new Date),!this.lastFramerateOKTime)||this.waitingResponse)&&new Date().getTime()-this.lastFramerateOKTime.getTime()>=this.requiredStableDuration&&this.camera.precisionMode!==Me.relaxed&&t==="idle")if(this.camera.onPrecisionModeWillUpdate){this.waitingResponse=!0,this.camera.onPrecisionModeWillUpdate({currentMode:this.camera.precisionMode,newMode:Me.relaxed,reason:"lowFrameRate",response:h=>{this.waitingResponse=!1,h==="proceed"?this.updatePrecisionModeToRelaxed("response"):h==="wait"?this.reset():this.waitingResponse=!1}});return}else console.log("No onPrecisionModeWillUpdate handler, proceeding to update precision mode."),this.updatePrecisionModeToRelaxed()}updatePrecisionModeToRelaxed(e="lowFrameRate"){this.camera.precisionMode=Me.relaxed,this.camera.onPrecisionModeUpdated&&this.camera.onPrecisionModeUpdated({previousMode:Me.strict,currentMode:Me.relaxed,reason:e}),console.log(`[VitalSignCamera] Precision mode switched to relaxed after stable frame rate for ${this.requiredStableDuration} ms`)}}class Ja{constructor(){d(this,"config"),d(this,"currentStage"),d(this,"currentStageStartTime"),d(this,"grabbedFrames",[]),this.config={grabbingPoints:void 0}}configure(e){this.config=e}reset(){this.currentStage=void 0,this.currentStageStartTime=void 0,this.grabbedFrames=[]}processFrame(e,t,n){if(!this.config.grabbingPoints||this.config.grabbingPoints.length===0||(this.currentStage!==t&&(this.currentStage=t,this.currentStageStartTime=Date.now()),!this.currentStageStartTime))return;const o=Date.now()-this.currentStageStartTime,h=this.config.grabbingPoints||[];for(const c of h)c.stage===t&&(this.grabbedFrames.some(r=>r.stage===c.stage&&r.offset===c.offset)||o<c.offset||(console.log(`[Frame Grabber] Grabbing frame at stage ${N[c.stage]} with offset ${c.offset} ms`),this.grabbedFrames.push({canvas:e.getCanvas(),stage:c.stage,offset:c.offset})))}}function Za(){return new Ja}const Xe=Z.isMobile&&!Z.isTablet;class eo{constructor(e){d(this,"id",`${Math.floor(Math.random()*1e4)}`),d(this,"deviceCaps",ra),d(this,"version",Rt),d(this,"_isActive"),d(this,"_userInfo"),d(this,"_config"),d(this,"faceDetectorType"),d(this,"_presetFormat"),d(this,"checkBrightness",!0),d(this,"_device"),d(this,"preferredCamera"),d(this,"maxFps"),d(this,"maxFaceDetectionFps"),d(this,"_precisionMode"),d(this,"disableAgeEstimation"),d(this,"enableBeautyAnalysis"),d(this,"_visualizationOptions"),d(this,"customConditionRange"),d(this,"faceDetectionRegion"),d(this,"faceDetectionModelLocation"),d(this,"_realtimeEstimationConfig"),d(this,"vsStatus","idle"),d(this,"_faceDetectionResult"),d(this,"faceDetectionTimer"),d(this,"faceDetectionFunction"),d(this,"camera",null),d(this,"cameraStartTime"),d(this,"videoFrameInfo",null),d(this,"videoFrame"),d(this,"healthResult"),d(this,"video",null),d(this,"transform","none"),d(this,"_videoSettings"),d(this,"cameraFps",new oi("camera")),d(this,"faceDetectionFps",new oi("face detection")),d(this,"activateAfterBound",!1),d(this,"boundingBox"),d(this,"faceMesh"),d(this,"faceDetectionSamplingInterval"),d(this,"vitalSignEngine"),d(this,"faceDetector"),d(this,"roiExtractor"),d(this,"ageEstimator"),d(this,"beautyAnalyzer"),d(this,"realtimeEstimator"),d(this,"conditionChecker"),d(this,"frameGrabber"),d(this,"precisionModeChecker",new Xa(this)),d(this,"cameraDevices"),d(this,"onVideoFrameProcessed"),d(this,"onTransformUpdated"),d(this,"onVideoSettingsUpdated"),d(this,"onCameraDevicesUpdated"),d(this,"onInitialized"),d(this,"onPrecisionModeUpdated"),d(this,"onPrecisionModeWillUpdate"),d(this,"onError");var t;window.__vital_sign_camera_impl__=this,console.log(`[VitalSignCamera] Welcome to VitalSignCamera ${Rt}`),console.log("[VitalSignCamera] Initializing with props...",e);let n=new Date;this._isActive=!1,this.activateAfterBound=e.isActive,this._config=e.config||{},this._device=e.device,this.preferredCamera=e.preferredCamera,this._userInfo=e.userInfo,this._visualizationOptions=e.visualizationOptions,this.faceDetectionRegion=e.faceDetectionRegion,this.faceDetectionSamplingInterval=e.faceDetectionSamplingInterval,this._realtimeEstimationConfig=e.realtimeEstimationConfig,Z.isMobile?Xe?this._presetFormat=ke.sd480x360:this._presetFormat=ke.hd1280x720:this._presetFormat=ke.hd1920x1080,e.customConditionRange!==void 0&&(this.customConditionRange=e.customConditionRange),e.checkBrightness!==void 0?this.checkBrightness=e.checkBrightness:(Z.isAndroid&&(console.log("[VitalSignCamera] Android detected. Turn off brightness check."),this.checkBrightness=!1),e.faceDetectorType===ne.Dummy&&(console.log("[VitalSignCamera] Dummy face detector being used. Turn off brightness check."),this.checkBrightness=!1)),e.faceDetectorType!==void 0?(console.log(`[VitalSignCamera] Setting face detector type ${e.faceDetectorType}...`),this.faceDetectorType=e.faceDetectorType):(console.log("[VitalSignCamera] Auto setting face detector type..."),Z.isAndroid?(console.log("[VitalSignCamera] Android detected"),console.log("[VitalSignCamera] Setting new MediaPipe face detector"),this.faceDetectorType=ne.MPFaceMesh):Z.isIOS&&Ne(Z.browserVersion,"18.0")<0?(console.log("[VitalSignCamera] Setting new MediaPipe facemesh detector"),this.faceDetectorType=ne.MPFaceMesh):(console.log("[VitalSignCamera] Setting new MediaPipe facemesh threaded detector"),this.faceDetectorType=ne.MPFaceMeshThreaded)),e.presetFormat!==void 0&&(this._presetFormat=e.presetFormat),e.maxFps!==void 0?(console.log(`[VitalSignCamera] Setting max camera fps to ${e.maxFps}`),this.maxFps=e.maxFps):(this.maxFps=Xe?30:60,console.log(`[VitalSignCamera] Auto setting max camera fps to ${this.maxFps}`)),e.maxFaceDetectionFps!==void 0?(console.log(`[VitalSignCamera] Setting max face detection fps to ${e.maxFaceDetectionFps}`),this.maxFaceDetectionFps=e.maxFaceDetectionFps):Xe||Z.isAndroid?(this.maxFaceDetectionFps=2,console.log(`[VitalSignCamera] Mobile phone or Android detected, auto setting max face detection fps to ${this.maxFaceDetectionFps}`)):(this.maxFaceDetectionFps=5,console.log(`[VitalSignCamera] Auto setting max face detection fps to ${this.maxFaceDetectionFps}`)),((t=e.config)==null?void 0:t.blinkDetectorType)===We.default&&(console.log("[VitalSignCamera] Blink detector enabled, forcing face detection fps to 15"),this.maxFaceDetectionFps=Math.max(15,this.maxFaceDetectionFps)),e.disableAgeEstimation!==void 0?(console.log(`[VitalSignCamera] Setting age estimation: ${!e.disableAgeEstimation}`),this.disableAgeEstimation=e.disableAgeEstimation):(console.log("[VitalSignCamera] Auto setting age estimation..."),Xe?(console.log("[VitalSignCamera] is phone -> ageEstimation = false"),this.disableAgeEstimation=!0):(console.log("[VitalSignCamera] Not phone -> ageEstimation = true"),this.disableAgeEstimation=!1)),e.enableBeautyAnalysis!==void 0?(console.log(`[VitalSignCamera] Setting beauty analysis: ${e.enableBeautyAnalysis}`),this.enableBeautyAnalysis=e.enableBeautyAnalysis,this.enableBeautyAnalysis&&this.disableAgeEstimation&&(console.log("[VitalSignCamera] Beauty analysis ON -> Forcing ageEstimation = true"),this.disableAgeEstimation=!1)):this.enableBeautyAnalysis=!1,e.frameGrabberConfig!==void 0&&(this.frameGrabber=Za(),this.frameGrabber.configure(e.frameGrabberConfig));const o=this.disableAgeEstimation,h=this.enableBeautyAnalysis;this.onVideoFrameProcessed=e.onVideoFrameProcessed,this.onVideoSettingsUpdated=e.onVideoSettingsUpdated,this.onCameraDevicesUpdated=e.onCameraDevicesUpdated,this.onInitialized=e.onInitialized,this.onPrecisionModeUpdated=e.onPrecisionModeUpdated,this.onPrecisionModeWillUpdate=e.onPrecisionModeWillUpdate,this.onError=e.onError,this.vitalSignEngine=ia(),this.roiExtractor=fi(this.faceDetectionSamplingInterval,this.config),this.sdkCredentials=e.sdkCredentials,this.conditionChecker=Ra(this.vitalSignEngine,e.conditionCheckerConfig,this.customConditionRange),e.precisionMode!==void 0&&(this.precisionMode=e.precisionMode),this.cameraDevices=new Ma(this,c=>{this.onCameraDevicesUpdated&&this.onCameraDevicesUpdated({devices:c,selected:this.device})}),this.cameraDevices.start(),(async()=>{var c;try{o||(this.ageEstimator=await Ta(e.faceApiModelPath),this.ageEstimator.configure(e.ageEstimationConfig)),h&&(this.beautyAnalyzer=await Ha({apiKey:(c=e.config)==null?void 0:c.apiKey})),this._realtimeEstimationConfig&&(this.realtimeEstimator=await Aa(this._realtimeEstimationConfig)),this.faceDetector=await this.createFaceDetector(e.faceDetectionModelLocation),this.onInitialized&&this.onInitialized();const r=(new Date().getTime()-n.getTime())/1e3;console.log(`[VitalSignCamera] initialized. Loading time ${r}s.`)}catch(r){console.error(r),console.log("[VitalSignCamera] initialization failed."),this.onError&&this.onError(r),this.camera&&this.cameraStartTime&&this.stopCamera()}})()}async createFaceDetector(e){try{console.log("[VitalSignCamera] Model loading location: ",e);let t=await li(this.faceDetectorType);return await t.loadModels(e),t}catch(t){if(this.faceDetectorType==ne.MPFaceMeshThreaded)return console.warn("[VitalSignCamera] Failed to initialize MediaPipe FaceMesh threaded detector. Falling back to non-threaded version."),this.faceDetectorType=ne.MPFaceMesh,await this.createFaceDetector(e);throw t}}bind(e){this.video=e,this.video.setAttribute("autoplay","true"),this.video.setAttribute("playsinline",""),this.config&&(this.vitalSignEngine.configure(this.config),this.vitalSignEngine.isReady()),this.faceDetectorType===ne.TFMediaPipe&&this.vitalSignEngine.configure({blinkDetectorType:We.default}),this.isActive=this.activateAfterBound}set device(e){const t=this.isActive;this._device&&this._device.length>0&&this._device!==e&&this.stopCamera(),this._device=e,e?t&&this.startCamera():this.stopCamera()}get device(){return this._device}set isActive(e){e?this.startCamera():this.stopCamera()}get isActive(){return this._isActive}set presetFormat(e){if(this._presetFormat===e)return;const t=this.isActive;this.stopCamera(),this._presetFormat=e,t&&this.startCamera()}get presetFormat(){return this._presetFormat}set config(e){this._config={...this._config},Object.keys(e).forEach(t=>{const n=t;e[n]!==void 0&&(this._config[n]=e[n])}),this.config&&(this.vitalSignEngine.configure(this.config),this.roiExtractor=fi(this.faceDetectionSamplingInterval,this.config))}get config(){let e={...this._config};const t=new URLSearchParams(location.search).get("PANOPTIC_API_KEY");return t&&(e.apiKey=t),e}set userInfo(e){this._userInfo={...this._userInfo},Object.keys(e).forEach(t=>{const n=t;e[n]!==void 0&&(this._userInfo[n]=e[n])})}get userInfo(){let e={...this._userInfo};const t=new URLSearchParams(location.search).get("PANOPTIC_USER_ID");return t&&(e.userId=t),e}get sdkCredentials(){if(!(!this.config.apiKey&&!this.userInfo.userId))return{apiKey:this.config.apiKey,userId:this.userInfo.userId}}set sdkCredentials(e){e!=null&&e.apiKey&&(this.config={apiKey:e?.apiKey}),e!=null&&e.userId&&(this.userInfo={userId:e?.userId})}get precisionMode(){return this._precisionMode}set precisionMode(e){if(!e)return;this._precisionMode!==e&&(this.onPrecisionModeUpdated&&this.onPrecisionModeUpdated({previousMode:this._precisionMode,currentMode:e,reason:"manual"}),this.precisionModeChecker.reset()),this._precisionMode=e;const t=Ai(e);this.config=t.engineConfig,this.vitalSignEngine.configure(this.config),t.conditionCheckerConfig&&this.conditionChecker.configure(t.conditionCheckerConfig),t.presetFormat&&(this.presetFormat=t.presetFormat),t.maxFaceDetectionFps!==void 0&&(this.maxFaceDetectionFps=t.maxFaceDetectionFps,this.faceDetectionFunction&&this.startFaceDetection())}set faceDetectionResult(e){var t,n,o,h;this._faceDetectionResult=e,(t=this.faceDetectionResult)!=null&&t.videoFrame.width&&(n=this.faceDetectionResult)!=null&&n.videoFrame.height&&(this.videoFrameInfo={timestamp:performance.now(),width:(o=this.faceDetectionResult)==null?void 0:o.videoFrame.width,height:(h=this.faceDetectionResult)==null?void 0:h.videoFrame.height})}get faceDetectionResult(){return this._faceDetectionResult}get videoSettings(){return this._videoSettings}set videoSettings(e){if(this._videoSettings=e,e&&this.video){if(!this.onVideoSettingsUpdated)return;this.onVideoSettingsUpdated({video:this.video,settings:e})}}get visualizationOptions(){return this._visualizationOptions}set visualizationOptions(e){var t,n;if(this._visualizationOptions=e,!this.isActive)return;const o=e?.boundingBox&&e.boundingBox.enabled!==!1;o&&!this.boundingBox&&this.video&&(this.boundingBox=new di(this.video,(t=this._visualizationOptions)==null?void 0:t.boundingBox)),!o&&this.boundingBox&&(this.boundingBox.enabled=!1,this.boundingBox=void 0),this.boundingBox&&e!=null&&e.boundingBox&&this.boundingBox.updateOptions(e?.boundingBox);const h=e?.faceMesh&&e.faceMesh.enabled!==!1;h&&!this.faceMesh&&this.video&&(this.faceMesh=new ui(this.video,(n=this._visualizationOptions)==null?void 0:n.faceMesh)),!h&&this.faceMesh&&(this.faceMesh.destroy(),this.faceMesh=void 0),this.faceMesh&&e!=null&&e.faceMesh&&this.faceMesh.updateOptions(e?.faceMesh)}get faceMeshElement(){var e;return(e=this.faceMesh)==null?void 0:e.faceMesh}get boundingBoxElement(){var e;return(e=this.boundingBox)==null?void 0:e.boundingBox}get grabbedFrames(){var e;return(e=this.frameGrabber)==null?void 0:e.grabbedFrames}get realtimeEstimationConfig(){return this._realtimeEstimationConfig}set realtimeEstimationConfig(e){this._realtimeEstimationConfig=e,this.realtimeEstimator&&this.realtimeEstimator.configure(e)}get faceDetectionRegionAbs(){if(!this.faceDetectionRegion||!this.videoSettings)return;const{x:e,y:t,width:n,height:o}=this.faceDetectionRegion,h=this.videoSettings.width,c=this.videoSettings.height;return{x:typeof e=="string"?parseFloat(e)/100*h:e,y:typeof t=="string"?parseFloat(t)/100*c:t,width:typeof n=="string"?parseFloat(n)/100*h:n,height:typeof o=="string"?parseFloat(o)/100*c:o}}get processedFrame(){var e,t,n,o,h,c,r,m,p;if(this.videoFrameInfo===null||!this.videoFrame)return;const x=this.healthResult;return x!=null&&x.health&&(x.health.beautyAnalysis=(e=this.beautyAnalyzer)==null?void 0:e.result,x.health.vitalSigns={...x.health.vitalSigns,facialSkinAge:((n=(t=this.beautyAnalyzer)==null?void 0:t.result)==null?void 0:n.skinAge)||((h=(o=this.ageEstimator)==null?void 0:o.estimation)==null?void 0:h.age)}),{videoFrameInfo:this.videoFrameInfo,videoFrame:this.videoFrame,facebox:(c=this.faceDetectionResult)==null?void 0:c.faceBox,healthResult:x,scanConditions:this.conditionChecker.conditions,landmarks:(r=this.faceDetectionResult)==null?void 0:r.landmarks,realtimeEstimation:((m=this.realtimeEstimator)==null?void 0:m.estimation)||null,signalData:((p=this.realtimeEstimator)==null?void 0:p.signalData)||null}}updateVideoSettings(e){if(!e||!e.srcObject)return this.videoSettings=void 0,"not-ready";const t=e.srcObject.id,n=e.srcObject.getVideoTracks()[0].getSettings(),{width:o,height:h,frameRate:c}=n;return o===void 0||h===void 0?"undefined":(console.log(`[VitalSignCamera] Video Settings in ${Z.browserName}: ${o}x${h} @ ${c} fps`),this.transform=pa(e),e.style.transform=this.transform,this.onTransformUpdated&&this.onTransformUpdated(this.transform),this.videoSettings={videoId:t,width:e.videoWidth||o,height:e.videoHeight||h,transformX:this.transform},"ok")}startCamera(){var e,t;this._isActive||(this._isActive=!0,this.processVideoFrame(),(e=this.visualizationOptions)!=null&&e.boundingBox&&this.visualizationOptions.boundingBox.enabled!==!1&&!this.boundingBox&&this.video&&(this.boundingBox=new di(this.video,this.visualizationOptions.boundingBox)),(t=this.visualizationOptions)!=null&&t.faceMesh&&this.visualizationOptions.faceMesh.enabled!==!1&&!this.faceMesh&&this.video&&(this.faceMesh=new ui(this.video,this.visualizationOptions.faceMesh)))}async stopCamera(){var e,t;this._isActive&&(this._isActive=!1,this.vitalSignEngine.stop(),(e=this.boundingBox)==null||e.update(void 0),(t=this.faceMesh)==null||t.update(void 0),this.faceDetectionResult=void 0,this.videoFrame=void 0,this.boundingBox&&(this.boundingBox.enabled=!1,this.boundingBox=void 0),this.faceMesh&&(this.faceMesh.destroy(),this.faceMesh=void 0),this.video&&this.stopVideo(),this.conditionChecker.reset(),this.camera&&(await this.camera.stop(),this.cameraStartTime=void 0))}async waitCameraToStop(e){return this.camera?await this.camera.waitUntilStopped(e):!0}async stopVideo(){const e=this.video;e.srcObject&&e.srcObject.getVideoTracks().forEach(t=>t.stop()),this.vitalSignEngine.stop(),clearInterval(this.faceDetectionTimer),this.faceDetectionTimer=void 0,this.faceDetectionFunction=void 0,console.log("[VitalSignCamera] stop Camera")}startScanning(){var e,t;console.log("[VitalSignCamera] start scanning..."),this.vsStatus="measuring",(e=this.frameGrabber)==null||e.reset(),(t=this.realtimeEstimator)==null||t.reset(),this.vitalSignEngine.start()}stopScanning(){console.log("[VitalSignCamera] stop scanning..."),this.vitalSignEngine.stop()}convertFaceBox(e){if(e===void 0)return;if(!this.videoSettings||!this.faceDetectionRegionAbs)return e;const t=(e.xCenter*this.faceDetectionRegionAbs.width+this.faceDetectionRegionAbs.x)/this.videoSettings.width,n=(e.yCenter*this.faceDetectionRegionAbs.height+this.faceDetectionRegionAbs.y)/this.videoSettings.height,o=e.width*this.faceDetectionRegionAbs.width/this.videoSettings.width,h=e.height*this.faceDetectionRegionAbs.height/this.videoSettings.height;return{xCenter:t,yCenter:n,width:o,height:h}}convertLandmarks(e){if(e===void 0)return;if(this.videoSettings===void 0||!this.faceDetectionRegionAbs)return e;const t=this.videoSettings,n=this.faceDetectionRegionAbs;return e.map(o=>{const h=(o.x*n.width+n.x)/t.width,c=(o.y*n.height+n.y)/t.height,r=o.z;return{x:h,y:c,z:r}})}startFaceDetection(){this.faceDetectionFunction!==void 0&&(this.faceDetectionTimer&&(clearInterval(this.faceDetectionTimer),this.faceDetectionTimer=void 0),this.faceDetectionTimer=setInterval(this.faceDetectionFunction,1e3/this.maxFaceDetectionFps))}async processVideoFrame(){const e=this.video,{width:t,height:n}=na(this.presetFormat||ke.hd1920x1080);this.precisionModeChecker.reset();const o=new ha(e,{width:t,height:n,deviceId:this.device,preferredCamera:this.preferredCamera,callbackFrameRate:this.maxFps,handleIOS17Bug:Z.isIOS&&Ne(Z.browserVersion,"17")>=0,handleIOS17ObjectFitBug:Z.isIOS&&Ne(Z.browserVersion,"17.2")>=0,onFrame:p=>{var x,R,w,y,v,u,g,k,E,S,M,T,F,P,$,K;if(o.croppingRegion=this.faceDetectionRegionAbs,this.cameraStartTime===void 0)return;const ee=new Date().getTime()-this.cameraStartTime.getTime();if((((x=this.videoSettings)==null?void 0:x.width)!=e.videoWidth||((R=this.videoSettings)==null?void 0:R.height)!=e.videoHeight)&&this.updateVideoSettings(e)!=="ok"&&ee>5e3){console.error("[VitalSignCamera] Could not get camera settings."),o.stop(),this.onError&&this.onError(new Error("undefined camera dimension"));return}if(this.cameraFps.tick(),this.faceDetectionResult==null)return;this.conditionChecker.processFrame(this.faceDetectionResult.videoFrame,(w=this.faceDetectionResult)==null?void 0:w.faceBox,this.vsStatus==="idle"?this.checkBrightness:!1,this.cameraFps.average,this.vsStatus),this.precisionModeChecker.process(this.cameraFps.average,this.vsStatus);const{images:j}=this.roiExtractor.processFrame(p,this.faceDetectionResult,this.vsStatus);this.videoFrame=p;const Q=this.faceDetectionResult.faceBox,te={faceBox:Q,landmarks:this.faceDetectionResult.landmarks,videoFrameInfo:p,images:j,userInfo:this.userInfo},W=this.vitalSignEngine.getHealth(te);if(this.healthResult=W,this.vsStatus==="measuring"&&(W.stage===N.Idle&&(this.vsStatus="idle",this.vitalSignEngine.stop(),W.error&&this.onError&&this.onError(W.error)),(v=(y=W.health)==null?void 0:y.vitalSigns)!=null&&v.heartRate&&((k=this.realtimeEstimator)==null||k.updateWithServerResult(W.health.vitalSigns.heartRate,(u=W.health.scanParameters)==null?void 0:u.snr,(g=W.health.scanParameters)==null?void 0:g.signalQuality)),(E=this.ageEstimator)==null||E.processFrame(p,W.stage,W.remainingTime),(S=this.realtimeEstimator)==null||S.processFrame(p,W.stage,W.remainingTime,j),(F=this.beautyAnalyzer)==null||F.processFrame(p,Q,(T=(M=this.ageEstimator)==null?void 0:M.estimation)==null?void 0:T.age,W.stage,W.remainingTime),(P=this.frameGrabber)==null||P.processFrame(p,W.stage,W.remainingTime)),this.boundingBox){const Y=this.convertFaceBox(($=this.faceDetectionResult)==null?void 0:$.faceBox);this.boundingBox.update(Y)}if(this.faceMesh){const Y=this.convertLandmarks((K=this.faceDetectionResult)==null?void 0:K.landmarks);this.faceMesh.update(Y)}this.processedFrame&&this.onVideoFrameProcessed&&this.onVideoFrameProcessed(this.processedFrame)}});try{o.croppingRegion=this.faceDetectionRegionAbs,await o.start(),this.updateVideoSettings(e),this._device=o.deviceId,this.cameraStartTime=new Date}catch(p){console.error("[VitalSignCamera] Could not start camera: ",p),this.onError&&this.onError(p);return}let h=!1;const c=3;let r=0;const m=document.createElement("canvas");this.faceDetectionFunction=async()=>{if(this.faceDetector===void 0||!this.faceDetectionTimer||this.cameraFps.frameCount==0||h||!e.srcObject||this.videoSettings===void 0)return;const p=this.videoSettings;h=!0;const x=this.faceDetectionRegionAbs||{x:0,y:0,width:p.width,height:p.height},R=x.width/x.height;if(m.width=R>1?320:320*R,m.height=m.width/R,this.faceDetectorType!==ne.Dummy){let w=m.getContext("2d",{willReadFrequently:!0});w?.drawImage(e,x.x,x.y,x.width,x.height,0,0,m.width,m.height)}try{this.faceDetector.detect({image:m}).then(w=>{this.faceDetectionFps.tick(),this.faceDetectionResult={...w,faceDetectionRegion:x}})}catch(w){r++,console.error(`Face detector crashed: ${w}`),console.log(`Face detector crash count: ${r}`),r>c&&(console.log(`Face detector crashed ${r} times, falling back to dummy detector.`),this.faceDetectorType=ne.Dummy,this.faceDetector=await li(this.faceDetectorType))}h=!1},this.startFaceDetection(),this.camera=o}}function to(s){return new eo(s)}var Ae=(s=>(s.OK="ok",s.TooFar="tooFar",s.TooClose="tooClose",s))(Ae||{}),ve=(s=>(s.Centered="centered",s.TooHigh="tooHigh",s.TooLow="tooLow",s.TooLeft="tooLeft",s.TooRight="tooRight",s.Unknown="unknown",s))(ve||{}),Me=(s=>(s.relaxed="relaxed",s.strict="strict",s))(Me||{});function io(s){return typeof s=="boolean"?s?"Yes":"No":typeof s=="string"?s:typeof s=="number"?s.toFixed(1):s===void 0?"undefined":s===null?"null":"unknown type"}function so(s){switch(s){case Je.Poor:return"Poor";case Je.Good:return"Good";case Je.Excellent:return"Excellent";case void 0:return"undefined";case null:return"null";default:return"Unknown"}}function A(s,e){return e===null?`<!-- ${s} is null -->`:e===void 0?`<!-- ${s} is undefined -->`:`<!-- ${s}: ${typeof e} --><li>${s}: ${io(e)}</li>`}function no(s,e){const t=e.healthResult?.health;if(t)if(t){const n=t.scanParameters?.conditions?.[0]!==void 0?t.scanParameters?.conditions?.[0]:t.scanParameters?.signalConditions?.hrSteadiness,o=t.scanParameters?.conditions?.[1]!==void 0?t.scanParameters?.conditions?.[1]:t.scanParameters?.signalConditions?.goodSnr,h=t.scanParameters?.conditions?.[2]!==void 0?t.scanParameters?.conditions?.[2]:t.scanParameters?.signalConditions?.noSpeedJitter,c=t.scanParameters?.conditions?.[3]!==void 0?t.scanParameters?.conditions?.[3]:t.scanParameters?.signalConditions?.goodAverageSpeed,r=t.scanParameters?.conditions?.[4]!==void 0?t.scanParameters?.conditions?.[4]:t.scanParameters?.signalConditions?.signalSteadiness;s.innerHTML=`
    <hr/>
    <fieldset>
      <legend>Vital Signs</legend>
      <ul>
      ${A("Heart Rate",t.vitalSigns?.heartRate)}
      ${A("SPO2",t.vitalSigns?.spo2)}
      ${A("Respiratory Rate",t.vitalSigns?.respiratoryRate)}
      ${A("HRV SDNN",t.vitalSigns?.hrvSdnn)}
      ${A("HRV RMSSD",t.vitalSigns?.hrvRmssd)}
      ${A("Temperature",t.vitalSigns?.temperature)}
      ${A("Blood Pressure",t.vitalSigns?.bloodPressure)}
      ${A("Blood Pressure Systolic",t.vitalSigns?.bloodPressureSystolic)}
      ${A("Blood Pressure Diastolic",t.vitalSigns?.bloodPressureDiastolic)}
      ${A("Blood Alcohol",t.vitalSigns?.bloodAlcohol)}
      ${A("Blood Sugar",t.vitalSigns?.bloodSugar)}
      ${A("Facial Skin Age",t.vitalSigns?.facialSkinAge)}
      </ul>
    </fieldset>
    <fieldset>
      <legend>Cardiovascular Risk</legend>
      <ul>
      ${A("General Risk",t.risks?.cardiovascularRisks?.generalRisk)}
      ${A("Coronary Heart Disease",t.risks?.cardiovascularRisks?.coronaryHeartDisease)}
      ${A("Congestive Heart Failure",t.risks?.cardiovascularRisks?.congestiveHeartFailure)}
      ${A("Intermittent Claudication",t.risks?.cardiovascularRisks?.intermittentClaudication)}
      ${A("Stroke",t.risks?.cardiovascularRisks?.stroke)}
      </ul>
    </fieldset>
    <fieldset>
      <legend>Holistic Health</legend>
      <ul>
      ${A("General Wellness",t.holisticHealth?.generalWellness)}
      ${A("BMI",t.holisticHealth?.bmi)}
      ${A("ABSI",t.holisticHealth?.absi)}
      ${A("ABSIZ",t.holisticHealth?.absiz)}
      ${A("Cardiac Workload",t.holisticHealth?.cardiacWorkload)}
      ${A("Pulse Respiratory Quotient",t.holisticHealth?.pulseRespiratoryQuotient)}
      ${A("Waist To Height Ratio",t.holisticHealth?.waistToHeightRatio)}
      ${A("Cardiovascular System Wellness",t.holisticHealth?.cardiovascularSystemWellness)}
      ${A("Mental Wellness",t.holisticHealth?.mentalWellness)}
      ${A("Physical Wellness",t.holisticHealth?.physicalWellness)}
      ${A("Respiratory System Wellness",t.holisticHealth?.respiratorySystemWellness)}
      </ul>
    </fieldset>

    <fieldset>
      <legend>Health Risks</legend>
      <ul>
      ${A("Covid Risk",t.risks?.covidRisk?.covidRisk)}
      ${A("Diabetes Risk",t.risks?.diabetesRisk)}
      ${A("Hypertension Risk",t.risks?.hypertensionRisk)}
      </ul>
    </fieldset>

    <fieldset>
      <legend>Scan Parameters</legend>
      <ul>
      ${A("Signal Quality",t.scanParameters?.signalQuality)}
      ${A("Warning",t.scanParameters?.warning)}
      ${A("HR Steadiness",n)}
      ${A("Good SNR",o)}
      ${A("No Speed Jitter",h)}
      ${A("Good Average Speed",c)}
      ${A("Signal Steadiness",r)}
      ${A("Fixed Head Position",t.scanParameters?.signalConditions?.fixedHeadPosition)}
      ${A("No Head turning",t.scanParameters?.signalConditions?.noHeadTurning)}
      ${A("Adequate Brightness",t.scanParameters?.signalConditions?.adequateBrightness)}
      ${A("Even Lighting On Face",t.scanParameters?.signalConditions?.evenLightingOnFace)}
      ${A("Good Signal Percentage",so(t.scanParameters?.signalConditions?.goodSignalPercentage))}
      ${A("HR Signal Quality",t.scanParameters?.signalConditions?.hrSignalQuality)}
      ${A("RR Signal Quality",t.scanParameters?.signalConditions?.rrSignalQuality)}
      ${A("BP Signal Quality",t.scanParameters?.signalConditions?.bpSignalQuality)}
      ${A("Invalid Pixel Percentage",t.scanParameters?.invalidPixelPercentage)}
      ${A("Signal Duration",t.scanParameters?.signalDuration)}
      ${A("SNR",t.scanParameters?.snr)}
      </ul>
    </fieldset>
    `}else Ii(s)}function Ii(s){s.innerHTML=""}function ao(s){return s===!1?"Improve lighting":null}function oo(s,e){if(s===!1)switch(e){case ve.TooLeft:return"Move right";case ve.TooRight:return"Move left";case ve.TooHigh:return"Move down";case ve.TooLow:return"Move up";case ve.Unknown:return"Center face";default:return"Center face"}return null}function ro(s){return s===!1?"Hold still":null}function lo(s,e){if(s===!1)switch(e){case Ae.TooFar:return"Move closer";case Ae.TooClose:return"Move back";default:return"Adjust distance"}return null}function ho(s){return s===!1?"Low frame rate":null}function co(s){return s===!1?"Server not ready":null}function uo(s){return!(s===void 0||!s.lighting||!s.centered||!s.movement||!s.distance||!s.frameRate||!s.serverReady)}function go(s,e){const t=[],n=ao(e.scanConditions?.lighting);n&&t.push(n);const o=oo(e.scanConditions?.centered,e.scanConditions?.facePositionCondition);o&&t.push(o);const h=ro(e.scanConditions?.movement);h&&t.push(h);const c=lo(e.scanConditions?.distance,e.scanConditions?.distanceCondition);c&&t.push(c);const r=ho(e.scanConditions?.frameRate);r&&t.push(r);const m=co(e.scanConditions?.serverReady);if(m&&t.push(m),t.length===0)s.innerHTML='<div style="color: var(--success); text-align: center;"><i class="fas fa-check-circle"></i> Ready to Scan</div>';else{const p=t.join(" & ");s.innerHTML=`
      <ul style="list-style: none; padding: 0; margin: 0; width: 100%; display: flex; justify-content: center;">
        <li style="color: var(--warning); margin-bottom: 4px; display: flex; align-items: center; gap: 8px; text-align: center;">
            <i class="fas fa-exclamation-triangle"></i> ${p}
        </li>
      </ul>
    `}}var pt;function Bi(s,e){pt=e,pt?(s.innerHTML=`${pt}`,s.style.display="inline-block"):(s.innerHTML="",s.style.display="none")}function fo(s){Bi(s,void 0)}function mo(s,e,t){s.innerHTML=e.map(n=>{const o=t.device===n.id?"selected":"";return`<option value="${n.id}" ${o}>${n.label}</option>`}).join(`
`)}async function po(s,e){const t=document.getElementById("cameraBtn"),n=document.getElementById("cameraDropdown");t?.addEventListener("click",o=>{o.stopPropagation();const h=n.style.display==="block";n.style.display=h?"none":"block"}),document.addEventListener("click",o=>{!t?.contains(o.target)&&!n?.contains(o.target)&&(n.style.display="none")}),e.onCameraDevicesUpdated=o=>{mo(s,o.devices,e),o.devices.length>1&&s.removeAttribute("disabled")},s.addEventListener("change",()=>{e.device=s.value,n.style.display="none"})}function vo(s,e){e.healthResult?.stage!==N.Idle?s.setAttribute("hidden",""):s.removeAttribute("hidden")}let Ie=!1,it=!1;function wo(s,e,t,n,o,h,c,r){s.addEventListener("click",()=>{if(Ie)e.stopScanning(),s.innerHTML='<i class="fas fa-play"></i> Start Scan',s.removeAttribute("disabled"),s.classList.remove("scanning"),document.body.classList.remove("scanning-active"),Ie=!1,it=!1,o("Scan cancelled");else{c(t),r(n),it=!1;const m=document.querySelector("#pulseValue"),p=document.querySelector("#qualityValue"),x=document.querySelector("#snrValue"),R=document.querySelector("#confidenceValue"),w=document.querySelector("#qualityScore");m.textContent="--",p.textContent="--",x.textContent="--",R.textContent="--",w.textContent="--",h(),s.innerHTML='<i class="fas fa-spinner fa-spin"></i> Scanning...',s.classList.add("scanning"),document.body.classList.add("scanning-active"),Ie=!0,e.startScanning()}})}function yo(s,e){if(!Ie)return;let t="";switch(e.healthResult?.stage){case N.CollectingData:t=`Scanning... ${(e.healthResult?.remainingTime||0).toFixed(0)}s`;break;case N.AnalyzingData:t=`Analyzing... ${(e.healthResult?.remainingTime||0).toFixed(0)}s`;break;default:return}t&&(s.innerHTML=`<i class="fas fa-spinner fa-spin"></i> ${t}`)}function bo(s,e){it||(it=!0,s.innerHTML='<i class="fas fa-play"></i> Start Scan',s.classList.remove("scanning"),document.body.classList.remove("scanning-active"),Ie=!1,e("Vital signs scan completed successfully!"))}const xo={apiKey:"3AQMwZWvDf566xPwuMfvd5FLjPEw3j6G3Q3SPpAC",userId:"07a51b41-e1a4-4570-94a7-04ef371cc4f3"},So={age:30,gender:pi.Male,weight:60,height:170};window.onload=()=>{const s=document.querySelector("#startScanBtn"),e=document.querySelector("#scanConditions"),t=document.querySelector("#report"),n=document.querySelector("video"),o=document.querySelector("#error"),h=document.querySelector("#cameraPicker"),c=document.querySelector("#pulseValue"),r=document.querySelector("#qualityValue"),m=document.querySelector("#snrValue"),p=document.querySelector("#confidenceValue"),x=document.querySelector("#heartbeatContainer"),R=document.querySelector("#heartbeatIcon"),w=document.querySelector("#signalVisualizerContainer"),y=document.querySelector("#settingsBtn"),v=to({precisionMode:Me.relaxed,isActive:!0,sdkCredentials:xo,userInfo:So,visualizationOptions:{boundingBox:{enabled:!0}},realtimeEstimationConfig:{earlyEstimation:!0,minDuration:5,minConfidence:.3}});v.onError=M=>Bi(o,M),v.bind(n),po(h,v);let u=null,g="PPG";function k(M,T=!0){if(M&&M>0&&T){x.classList.add("active");const F=60/M;R.style.animationDuration=`${F}s`}else x.classList.remove("active")}function E(M=g){g=M,u&&(u.destroy(),u=null),u=new Pa(w,{width:300,height:100,maxPoints:200,lineColor:"#00ff00",backgroundColor:"transparent",visualizationType:M})}v.onVideoFrameProcessed=M=>{go(e,M),vo(h,M),no(t,M),yo(s,M);const T=document.querySelector(".history-section"),F=document.querySelector(".scanner-actions");if(Ie?(F.style.display="block",T.style.display="none"):uo(M.scanConditions)?(s.removeAttribute("disabled"),F.style.display="block",T.style.display="none"):(s.setAttribute("disabled","true"),F.style.display="none",T.style.display="block"),M.realtimeEstimation){const P=M.realtimeEstimation;if(P.heartRate?(c.textContent=Math.round(P.heartRate).toString(),k(P.heartRate,Ie)):k(0,Ie),P.signalQuality!==void 0&&P.signalQuality!==null){const $=Math.round(P.signalQuality/100*5),K="★".repeat($),ee="☆".repeat(5-$);r.textContent=K+ee;const j=document.querySelector("#qualityScore");j.textContent=`${Math.round(P.signalQuality)}%`}P.snr!==void 0&&P.snr!==null&&(m.textContent=P.snr.toFixed(1)),p.textContent=Math.round(P.confidence*100).toString()}if(u&&M.signalData){const P={...M.signalData,values:M.signalData.values.slice(-200),timestamps:M.signalData.timestamps.slice(-200)};u.updateSignal(P,M.realtimeEstimation||null,M.healthResult?.stage)}M.healthResult&&M.healthResult.health&&bo(s,S)},wo(s,v,t,o,S,E,Ii,fo),y.addEventListener("click",()=>{g=g==="PPG"?"ECG":"PPG",E(g),S(`Visualization type changed to ${g}`)});function S(M){const T=document.createElement("div");T.className="toast",T.textContent=M,document.body.appendChild(T),setTimeout(()=>{T.classList.add("show")},10),setTimeout(()=>{T.classList.remove("show"),setTimeout(()=>{document.body.removeChild(T)},300)},3e3)}};export{ot as a,ko as b,Do as c,Eo as d,da as f,ga as g,Ro as h,N as j,sa as n,ri as r,an as s,Co as u};

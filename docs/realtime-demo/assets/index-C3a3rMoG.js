const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CSUGaeuC-CDcDjEYn.js","assets/lSj6MPh9-B2EW-9QE.js","assets/Dw9s1-BC-Dec3WeYE.js","assets/sogQrOT1-qb_Yr_j8.js","assets/CfKMpZsR-qM3DS0Za.js","assets/CAb34dWC-C3AksZ3j.js","assets/DNiMR7Uc-D-lY-CVV.js","assets/DAnk5QpJ-Bf6lb9Xb.js","assets/DDvcQKT4-BQDg0Lp3.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const h of o)if(h.type==="childList")for(const c of h.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(o){const h={};return o.integrity&&(h.integrity=o.integrity),o.referrerPolicy&&(h.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?h.credentials="include":o.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function n(o){if(o.ep)return;o.ep=!0;const h=t(o);fetch(o.href,h)}})();const As="modulepreload",Fs=function(s){return"/sdk-live-demo/realtime-demo/"+s},ti={},Ie=function(e,t,n){let o=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),r=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));o=Promise.allSettled(t.map(m=>{if(m=Fs(m),m in ti)return;ti[m]=!0;const y=m.endsWith(".css"),k=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${k}`))return;const D=document.createElement("link");if(D.rel=y?"stylesheet":As,y||(D.as="script"),D.crossOrigin="",D.href=m,r&&D.setAttribute("nonce",r),document.head.appendChild(D),y)return new Promise((v,w)=>{D.addEventListener("load",v),D.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${m}`)))})}))}function h(c){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=c,window.dispatchEvent(r),!r.defaultPrevented)throw c}return o.then(c=>{for(const r of c||[])r.status==="rejected"&&h(r.reason);return e().catch(h)})};var Is=Object.defineProperty,_s=(s,e,t)=>e in s?Is(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,d=(s,e,t)=>_s(s,typeof e!="symbol"?e+"":e,t),Li=(s=>(s[s.Male=0]="Male",s[s.Female=1]="Female",s))(Li||{}),pt=(s=>(s[s.Poor=0]="Poor",s[s.Good=1]="Good",s[s.Excellent=2]="Excellent",s))(pt||{}),ne=(s=>(s[s.Local=0]="Local",s[s.LocalV2=101]="LocalV2",s[s.RemoteDev=1]="RemoteDev",s[s.RemoteProd=2]="RemoteProd",s[s.AwsDev=3]="AwsDev",s[s.AwsProd=4]="AwsProd",s[s.RemoteProdEnterprise=5]="RemoteProdEnterprise",s[s.AwsFirebaseEnterpriseProd=5]="AwsFirebaseEnterpriseProd",s[s.AwsProdEnterprise=6]="AwsProdEnterprise",s[s.AwsEnterpriseProd=6]="AwsEnterpriseProd",s[s.AwsDevEnterprise=7]="AwsDevEnterprise",s[s.AwsEnterpriseDev=7]="AwsEnterpriseDev",s[s.FdaDev=8]="FdaDev",s[s.FdaProd=9]="FdaProd",s[s.Schema2Dev=10]="Schema2Dev",s[s.Schema2Prod=11]="Schema2Prod",s))(ne||{}),We=(s=>(s[s.default=0]="default",s[s.dummy=1]="dummy",s))(We||{}),j=(s=>(s[s.WaitingData=0]="WaitingData",s[s.CollectingData=1]="CollectingData",s[s.AnalyzingData=2]="AnalyzingData",s[s.Idle=3]="Idle",s))(j||{});async function Bs(s,e){return new Promise(t=>{setTimeout(()=>{t(e)},s*1e3)})}function Q(...s){console.log("[VSE Plugin]",...s)}function Os(s){let e="";const t=(s.length-s.length*.8)/2;for(let n=0;n<s.length;n++)n>=t&&n<s.length-t?e+="#":e+=s[n];return e}let dt;const $s=new Uint8Array(16);function Vs(){if(!dt&&(dt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!dt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return dt($s)}const ge=[];for(let s=0;s<256;++s)ge.push((s+256).toString(16).slice(1));function Ls(s,e=0){return ge[s[e+0]]+ge[s[e+1]]+ge[s[e+2]]+ge[s[e+3]]+"-"+ge[s[e+4]]+ge[s[e+5]]+"-"+ge[s[e+6]]+ge[s[e+7]]+"-"+ge[s[e+8]]+ge[s[e+9]]+"-"+ge[s[e+10]]+ge[s[e+11]]+ge[s[e+12]]+ge[s[e+13]]+ge[s[e+14]]+ge[s[e+15]]}const Us=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ii={randomUUID:Us};function Qt(s,e,t){if(ii.randomUUID&&!s)return ii.randomUUID();s=s||{};const n=s.random||(s.rng||Vs)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Ls(n)}function si(s,e){return(e.getTime()-s.getTime())/1e3}function Hs(s,e){if(s.length!=e.length)return!1;for(let t=0;t<s.length;t++)if(s[t].x!=e[t].x||s[t].y!=e[t].y)return!1;return!0}function Ut(s,e){return Math.sqrt((e.x-s.x)*(e.x-s.x)+(e.y-s.y)*(e.y-s.y))}function Ns(s,e,t=20){let n="|";for(let o=0;o<t;o++)o/t>e?n+=" ":n+="█";return n+=`| ${e.toFixed(2)}`,`${s}: ${n}`}function me(...s){console.log("[Blink Detector]",...s)}let Ui=class{constructor(s="",e=!1){d(this,"frameCount",0),d(this,"start",new Date),d(this,"name","noname"),d(this,"enableLog",!1),d(this,"lastLogTime",new Date),d(this,"logInterval",10),this.name=s,this.enableLog=e}get averageFps(){if(this.frameCount===0&&(this.start=new Date),!(this.elapsed<.5))return this.frameCount/this.elapsed}get elapsed(){return(new Date().getTime()-this.start.getTime())/1e3}tick(){this.frameCount=this.frameCount+1}reset(){this.frameCount=0,this.start=new Date,this.lastLogTime=new Date}log(){if(this.averageFps==null||(new Date().getTime()-this.lastLogTime.getTime())/1e3<this.logInterval)return;const s=this.averageFps.toFixed(2);this.enableLog&&(console.log(`[FPS ${this.name}] (${this.frameCount}/${this.elapsed})) ${s}fps`),this.lastLogTime=new Date)}};class xt{constructor(e,t){d(this,"duration"),d(this,"name"),d(this,"observers",[]),d(this,"startTime",new Date),d(this,"fps"),d(this,"signals",[]),this.name=e,this.fps=new Ui(e),this.duration=t}get size(){return this.fps.averageFps===void 0?10:this.fps.averageFps*this.duration}clear(){this.signals=[],this.fps.reset(),this.startTime=new Date}add(e){if(this.fps.tick(),this.observers.forEach(t=>{var n;return(n=t.willAdd)==null?void 0:n.call(t,e)}),this.signals.length<this.size)this.signals.push({timestamp:new Date,value:e});else{for(;this.signals.length>this.size;)this.signals.shift();this.signals.push({timestamp:new Date,value:e})}this.observers.forEach(t=>{var n;return(n=t.onAdded)==null?void 0:n.call(t,e)})}get max(){return this.signals.length===0?0:Math.max(...this.signals.map(e=>e.value))}get lastEntry(){if(this.signals.length!==0)return this.signals[this.signals.length-1]}get last(){if(this.signals.length!=0)return this.signals[this.signals.length-1].value}visualize(e=0,t=1,n=20){const o=this.lastEntry||{timestamp:new Date,value:0};let h="|";for(let c=0;c<n;c++){const r=e+c/n*(t-e);r>=0?r>o.value?h+=" ":h+="█":r<o.value?h+=" ":h+="█"}return h+=`| ${o.value.toFixed(2)}`,`${((o.timestamp.getTime()-this.startTime.getTime())/1e3).toFixed(2)}s ${this.name}: ${h}`}derivative(){const e=new xt(`${this.name}'`,this.size),t=this;return this.observers.push({willAdd(n){t.last!==void 0&&e.add(n-t.last)}}),e}detectPeak(e,t){if(this.fps.averageFps===void 0)return!1;const n=Math.min(Math.floor(this.fps.averageFps*e),this.signals.length);if(n<2||this.signals.length<2)return!1;const o=this.signals[this.signals.length-1].value,h=this.signals.slice(this.signals.length-1-n,this.signals.length-2).map(r=>r.value),c=zs(h);return o-c>c*t}}function zs(s){return s.reduce((e,t)=>e+t,0)/s.length}const Ws=.2,js=1/20,qs=.5,Gs=2,Ys=2;class Qs{constructor(e="No name"){d(this,"name"),d(this,"movement",0),d(this,"debug",!1),d(this,"config",{movementThreshold:Ws,startMovementDurationThreshold:js,stopMovementDurationThreshold:qs,freezedTheshold:Gs,movementDurationThreshold:Ys,normalizeValue:.02}),d(this,"lastPosition"),d(this,"startMoveTime"),d(this,"startStayTime"),d(this,"lastZeroMovementTime"),d(this,"_isMoving",!1),d(this,"_lastStateChagneTime"),this.name=e}configure(e){e.stopMovementDurationThreshold!==void 0&&(me("Configure Movement Detector stopMovementDurationThreshold: ",e.stopMovementDurationThreshold),this.config.stopMovementDurationThreshold=e.stopMovementDurationThreshold),e.startMovementDurationThreshold!==void 0&&(me("Configure Movement Detector startMovementDurationThreshold: ",e.startMovementDurationThreshold),this.config.startMovementDurationThreshold=e.startMovementDurationThreshold),e.movementThreshold!==void 0&&(me("Configure Movement Detector movementThreshold: ",e.movementThreshold),this.config.movementThreshold=e.movementThreshold),e.freezedTheshold!==void 0&&(me("Configure Movement Detector freezedTheshold: ",e.freezedTheshold),this.config.freezedTheshold=e.freezedTheshold),e.unstableDurationThreshold!==void 0&&(me("Configure Movement Detector unstableDurationThreshold: ",e.unstableDurationThreshold),this.config.movementDurationThreshold=e.unstableDurationThreshold)}reset(){this.lastPosition=void 0,this.startMoveTime=void 0,this.startStayTime=void 0,this.lastZeroMovementTime=void 0,this._lastStateChagneTime=void 0,this._isMoving=!1}get movedLongEnough(){return this.startMoveTime===void 0?!1:si(this.startMoveTime,new Date)>this.config.startMovementDurationThreshold}get stayStillLongEnough(){return this.startStayTime===void 0?!1:si(this.startStayTime,new Date)>this.config.stopMovementDurationThreshold}update(e){if(this.lastPosition===void 0){this.lastPosition=e;return}this.movement=Ut(e,this.lastPosition)/this.config.normalizeValue,this.lastPosition=e,this.movement>this.config.movementThreshold?(this.startStayTime=void 0,this.startMoveTime===void 0&&(this.startMoveTime=new Date),this.movedLongEnough&&(this.isMoving=!0)):(this.startMoveTime=void 0,this.startStayTime===void 0&&(this.startStayTime=new Date),this.stayStillLongEnough&&(this.isMoving=!1)),this.debugLog(Ns("Movement",this.movement)),this.movement===0?this.lastZeroMovementTime===void 0&&(this.lastZeroMovementTime=new Date):this.lastZeroMovementTime=void 0}get isDead(){return this.lastZeroMovementTime===void 0?!1:(new Date().getTime()-this.lastZeroMovementTime.getTime())/1e3>this.config.freezedTheshold}get unstable(){return this._lastStateChagneTime===void 0||!this.isMoving?!1:(new Date().getTime()-this._lastStateChagneTime.getTime())/1e3>this.config.movementDurationThreshold}get isMoving(){return this._isMoving}set isMoving(e){this._isMoving!==e&&(this._isMoving=e,this._lastStateChagneTime=new Date,this._isMoving?this.debugLog(`${this.name} is moving.`):this.debugLog(`${this.name} is not moving`))}debugLog(...e){this.debug&&me(...e)}}class Hi{constructor(e,t){d(this,"landmarks",[]),d(this,"ltrb"),d(this,"name"),d(this,"fps"),d(this,"ears"),d(this,"movementDetector"),this.ltrb=e,this.name=t,this.fps=new Ui(t),this.movementDetector=new Qs(t),this.ears=new xt(`${t} EAR`,2)}reset(){this.movementDetector.reset(),this.fps.reset(),this.ears.clear()}update(e){Hs(this.landmarks,e)||this.fps.tick(),this.fps.log(),this.landmarks=e,this.ears.add(this.aspectRatio),this.movementDetector.update(this.midPoint)}get maxEar(){return this.ears.max}get normalizedEar(){return this.aspectRatio/this.maxEar}get averageFps(){return this.fps.averageFps}get movement(){return this.movementDetector.movement}get isMoving(){return this.movementDetector.isMoving}get detectionLost(){return this.movementDetector.isDead}get unstable(){return this.movementDetector.unstable}get leftPoint(){return{x:this.landmarks[this.ltrb.left].x,y:this.landmarks[this.ltrb.left].y}}get rightPoint(){return{x:this.landmarks[this.ltrb.right].x,y:this.landmarks[this.ltrb.right].y}}get topPoint(){return{x:this.landmarks[this.ltrb.top].x,y:this.landmarks[this.ltrb.top].y}}get bottomPoint(){return{x:this.landmarks[this.ltrb.bottom].x,y:this.landmarks[this.ltrb.bottom].y}}get width(){return Ut(this.leftPoint,this.rightPoint)}get height(){return Ut(this.topPoint,this.bottomPoint)}get aspectRatio(){return this.height/this.width}get midPoint(){return{x:(this.leftPoint.x+this.rightPoint.x)/2,y:(this.leftPoint.y+this.rightPoint.y)/2}}}const ut=[[263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]],gt=[[33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]],Ks={left:ut[0][0],top:ut[11][1],right:ut[15][1],bottom:ut[4][0]},Xs={left:gt[0][0],top:gt[11][1],right:gt[15][1],bottom:gt[4][0]};class Js extends Hi{constructor(){super(Ks,"Left Eye")}}class Zs extends Hi{constructor(){super(Xs,"Right Eye")}}class en{constructor(){d(this,"fps",15),d(this,"blinkCount",5),d(this,"noEyes",!1),d(this,"unstable",!1)}configure(e){}reset(){}detect(e){return!0}}const tn=.15,sn=10;class nn{constructor(){d(this,"leftEye",new Js),d(this,"rightEye",new Zs),d(this,"avgEars"),d(this,"dEars"),d(this,"debug",!1),d(this,"_blinkCount",0),d(this,"_isReset",!1),d(this,"config",{enableBlinkDetector:!0,minFps:sn,earDiffThreshold:tn,enableMovementDetection:!0}),me("Blink detector created"),this.avgEars=new xt("EAR",this.leftEye.ears.duration),this.dEars=this.avgEars.derivative()}configure(e){e.earDiffThreshold!==void 0&&(me("Configure Blink Detector earDiffThreshold: ",e.earDiffThreshold),this.config.earDiffThreshold=e.earDiffThreshold),e.minFps!==void 0&&(me("Configure Blink Detector minFps: ",e.minFps),this.config.minFps=e.minFps),e.enableMovementDetection&&(me("Configure Blink Detector enableMovementDetection: ",e.enableMovementDetection),this.config.enableMovementDetection=e.enableMovementDetection),this.leftEye.movementDetector.configure(e),this.rightEye.movementDetector.configure(e)}get noEyes(){return this.leftEye.detectionLost||this.rightEye.detectionLost}get unstable(){return this.leftEye.unstable||this.rightEye.unstable}get fps(){return((this.leftEye.averageFps||0)+(this.rightEye.averageFps||0))/2}reset(){this._isReset=!0,this._blinkCount=0,this.leftEye.reset(),this.rightEye.reset(),this.avgEars.clear(),this.dEars.clear()}get blinkCount(){return this.leftEye.averageFps!==void 0&&this.rightEye.averageFps!==void 0&&this.leftEye.averageFps<this.config.minFps&&this.rightEye.averageFps<this.config.minFps?(me(`FPS < ${this.config.minFps}, blink detection is unreliable. Always return blink count 1.`),1):this._blinkCount}detect(e){if(this._isReset||this.reset(),this.leftEye.update(e),this.rightEye.update(e),this.config.enableMovementDetection){if(this.unstable)return me("Error: unstable eyes"),!1;if(this.leftEye.isMoving||this.rightEye.isMoving)return!1;if(this.noEyes)return me("Error: no eyes"),!1}this.avgEars.add(1-(this.leftEye.normalizedEar+this.rightEye.normalizedEar)/2);const t=this.dEars.last||0,n=t>this.config.earDiffThreshold;if(this.debug&&me(this.dEars.visualize(-1,1,30)),n){this._blinkCount++;const o=((this.leftEye.averageFps||0)+(this.rightEye.averageFps||0))/2;me(`Blink Detected ${this._blinkCount}. EAR_DIFF=${t.toFixed(2)} FPS=${o.toFixed(1)}`)}return n}}function ni(s){switch(s){case We.default:return new nn;case We.dummy:return new en}}const Ni=class zi{constructor(){d(this,"endpoint","https://aws-backend.panoptic.ai/s3/"),d(this,"s3ApiKey","TJ3CJ2ebRs0YK3HIwopu529q92qAZ1waBI5mWIq5")}async getDataFromS3(e,t){try{const n={type:"get-json",params:{bucket:e,objectKey:t}},o={"Content-Type":"application/json","X-Api-Key":this.s3ApiKey},h=await fetch(this.endpoint,{method:"POST",headers:o,body:JSON.stringify(n)});if(h.status!=200)throw new Error(h.statusText);return await h.json()}catch(n){throw console.error(`${zi.TAG}: Error fetching data from S3:`,n),n}}};d(Ni,"TAG","AWS S3 Client");let an=Ni;var bo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function on(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function xo(s){if(Object.prototype.hasOwnProperty.call(s,"__esModule"))return s;var e=s.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(n){var o=Object.getOwnPropertyDescriptor(s,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return s[n]}})}),t}var ai={},je={},oi;function rn(){if(oi)return je;oi=1,je.byteLength=r,je.toByteArray=y,je.fromByteArray=v;for(var s=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,h=n.length;o<h;++o)s[o]=n[o],e[n.charCodeAt(o)]=o;e[45]=62,e[95]=63;function c(w){var p=w.length;if(p%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var u=w.indexOf("=");u===-1&&(u=p);var g=u===p?0:4-u%4;return[u,g]}function r(w){var p=c(w),u=p[0],g=p[1];return(u+g)*3/4-g}function m(w,p,u){return(p+u)*3/4-u}function y(w){var p,u=c(w),g=u[0],b=u[1],E=new t(m(w,g,b)),S=0,T=b>0?g-4:g,M;for(M=0;M<T;M+=4)p=e[w.charCodeAt(M)]<<18|e[w.charCodeAt(M+1)]<<12|e[w.charCodeAt(M+2)]<<6|e[w.charCodeAt(M+3)],E[S++]=p>>16&255,E[S++]=p>>8&255,E[S++]=p&255;return b===2&&(p=e[w.charCodeAt(M)]<<2|e[w.charCodeAt(M+1)]>>4,E[S++]=p&255),b===1&&(p=e[w.charCodeAt(M)]<<10|e[w.charCodeAt(M+1)]<<4|e[w.charCodeAt(M+2)]>>2,E[S++]=p>>8&255,E[S++]=p&255),E}function k(w){return s[w>>18&63]+s[w>>12&63]+s[w>>6&63]+s[w&63]}function D(w,p,u){for(var g,b=[],E=p;E<u;E+=3)g=(w[E]<<16&16711680)+(w[E+1]<<8&65280)+(w[E+2]&255),b.push(k(g));return b.join("")}function v(w){for(var p,u=w.length,g=u%3,b=[],E=16383,S=0,T=u-g;S<T;S+=E)b.push(D(w,S,S+E>T?T:S+E));return g===1?(p=w[u-1],b.push(s[p>>2]+s[p<<4&63]+"==")):g===2&&(p=(w[u-2]<<8)+w[u-1],b.push(s[p>>10]+s[p>>4&63]+s[p<<2&63]+"=")),b.join("")}return je}var Pt={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var ri;function ln(){return ri||(ri=1,Pt.read=function(s,e,t,n,o){var h,c,r=o*8-n-1,m=(1<<r)-1,y=m>>1,k=-7,D=t?o-1:0,v=t?-1:1,w=s[e+D];for(D+=v,h=w&(1<<-k)-1,w>>=-k,k+=r;k>0;h=h*256+s[e+D],D+=v,k-=8);for(c=h&(1<<-k)-1,h>>=-k,k+=n;k>0;c=c*256+s[e+D],D+=v,k-=8);if(h===0)h=1-y;else{if(h===m)return c?NaN:(w?-1:1)*(1/0);c=c+Math.pow(2,n),h=h-y}return(w?-1:1)*c*Math.pow(2,h-n)},Pt.write=function(s,e,t,n,o,h){var c,r,m,y=h*8-o-1,k=(1<<y)-1,D=k>>1,v=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,w=n?0:h-1,p=n?1:-1,u=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(r=isNaN(e)?1:0,c=k):(c=Math.floor(Math.log(e)/Math.LN2),e*(m=Math.pow(2,-c))<1&&(c--,m*=2),c+D>=1?e+=v/m:e+=v*Math.pow(2,1-D),e*m>=2&&(c++,m/=2),c+D>=k?(r=0,c=k):c+D>=1?(r=(e*m-1)*Math.pow(2,o),c=c+D):(r=e*Math.pow(2,D-1)*Math.pow(2,o),c=0));o>=8;s[t+w]=r&255,w+=p,r/=256,o-=8);for(c=c<<o|r,y+=o;y>0;s[t+w]=c&255,w+=p,c/=256,y-=8);s[t+w-p]|=u*128}),Pt}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var li;function hn(){return li||(li=1,function(s){const e=rn(),t=ln(),n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;s.Buffer=r,s.SlowBuffer=E,s.INSPECT_MAX_BYTES=50;const o=2147483647;s.kMaxLength=o,r.TYPED_ARRAY_SUPPORT=h(),!r.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function h(){try{const i=new Uint8Array(1),a={foo:function(){return 42}};return Object.setPrototypeOf(a,Uint8Array.prototype),Object.setPrototypeOf(i,a),i.foo()===42}catch{return!1}}Object.defineProperty(r.prototype,"parent",{enumerable:!0,get:function(){if(r.isBuffer(this))return this.buffer}}),Object.defineProperty(r.prototype,"offset",{enumerable:!0,get:function(){if(r.isBuffer(this))return this.byteOffset}});function c(i){if(i>o)throw new RangeError('The value "'+i+'" is invalid for option "size"');const a=new Uint8Array(i);return Object.setPrototypeOf(a,r.prototype),a}function r(i,a,l){if(typeof i=="number"){if(typeof a=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return D(i)}return m(i,a,l)}r.poolSize=8192;function m(i,a,l){if(typeof i=="string")return v(i,a);if(ArrayBuffer.isView(i))return p(i);if(i==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i);if(le(i,ArrayBuffer)||i&&le(i.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(le(i,SharedArrayBuffer)||i&&le(i.buffer,SharedArrayBuffer)))return u(i,a,l);if(typeof i=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const f=i.valueOf&&i.valueOf();if(f!=null&&f!==i)return r.from(f,a,l);const x=g(i);if(x)return x;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof i[Symbol.toPrimitive]=="function")return r.from(i[Symbol.toPrimitive]("string"),a,l);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i)}r.from=function(i,a,l){return m(i,a,l)},Object.setPrototypeOf(r.prototype,Uint8Array.prototype),Object.setPrototypeOf(r,Uint8Array);function y(i){if(typeof i!="number")throw new TypeError('"size" argument must be of type number');if(i<0)throw new RangeError('The value "'+i+'" is invalid for option "size"')}function k(i,a,l){return y(i),i<=0?c(i):a!==void 0?typeof l=="string"?c(i).fill(a,l):c(i).fill(a):c(i)}r.alloc=function(i,a,l){return k(i,a,l)};function D(i){return y(i),c(i<0?0:b(i)|0)}r.allocUnsafe=function(i){return D(i)},r.allocUnsafeSlow=function(i){return D(i)};function v(i,a){if((typeof a!="string"||a==="")&&(a="utf8"),!r.isEncoding(a))throw new TypeError("Unknown encoding: "+a);const l=S(i,a)|0;let f=c(l);const x=f.write(i,a);return x!==l&&(f=f.slice(0,x)),f}function w(i){const a=i.length<0?0:b(i.length)|0,l=c(a);for(let f=0;f<a;f+=1)l[f]=i[f]&255;return l}function p(i){if(le(i,Uint8Array)){const a=new Uint8Array(i);return u(a.buffer,a.byteOffset,a.byteLength)}return w(i)}function u(i,a,l){if(a<0||i.byteLength<a)throw new RangeError('"offset" is outside of buffer bounds');if(i.byteLength<a+(l||0))throw new RangeError('"length" is outside of buffer bounds');let f;return a===void 0&&l===void 0?f=new Uint8Array(i):l===void 0?f=new Uint8Array(i,a):f=new Uint8Array(i,a,l),Object.setPrototypeOf(f,r.prototype),f}function g(i){if(r.isBuffer(i)){const a=b(i.length)|0,l=c(a);return l.length===0||i.copy(l,0,0,a),l}if(i.length!==void 0)return typeof i.length!="number"||se(i.length)?c(0):w(i);if(i.type==="Buffer"&&Array.isArray(i.data))return w(i.data)}function b(i){if(i>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return i|0}function E(i){return+i!=i&&(i=0),r.alloc(+i)}r.isBuffer=function(i){return i!=null&&i._isBuffer===!0&&i!==r.prototype},r.compare=function(i,a){if(le(i,Uint8Array)&&(i=r.from(i,i.offset,i.byteLength)),le(a,Uint8Array)&&(a=r.from(a,a.offset,a.byteLength)),!r.isBuffer(i)||!r.isBuffer(a))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(i===a)return 0;let l=i.length,f=a.length;for(let x=0,R=Math.min(l,f);x<R;++x)if(i[x]!==a[x]){l=i[x],f=a[x];break}return l<f?-1:f<l?1:0},r.isEncoding=function(i){switch(String(i).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},r.concat=function(i,a){if(!Array.isArray(i))throw new TypeError('"list" argument must be an Array of Buffers');if(i.length===0)return r.alloc(0);let l;if(a===void 0)for(a=0,l=0;l<i.length;++l)a+=i[l].length;const f=r.allocUnsafe(a);let x=0;for(l=0;l<i.length;++l){let R=i[l];if(le(R,Uint8Array))x+R.length>f.length?(r.isBuffer(R)||(R=r.from(R)),R.copy(f,x)):Uint8Array.prototype.set.call(f,R,x);else if(r.isBuffer(R))R.copy(f,x);else throw new TypeError('"list" argument must be an Array of Buffers');x+=R.length}return f};function S(i,a){if(r.isBuffer(i))return i.length;if(ArrayBuffer.isView(i)||le(i,ArrayBuffer))return i.byteLength;if(typeof i!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof i);const l=i.length,f=arguments.length>2&&arguments[2]===!0;if(!f&&l===0)return 0;let x=!1;for(;;)switch(a){case"ascii":case"latin1":case"binary":return l;case"utf8":case"utf-8":return ke(i).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return l*2;case"hex":return l>>>1;case"base64":return Fe(i).length;default:if(x)return f?-1:ke(i).length;a=(""+a).toLowerCase(),x=!0}}r.byteLength=S;function T(i,a,l){let f=!1;if((a===void 0||a<0)&&(a=0),a>this.length||((l===void 0||l>this.length)&&(l=this.length),l<=0)||(l>>>=0,a>>>=0,l<=a))return"";for(i||(i="utf8");;)switch(i){case"hex":return L(this,a,l);case"utf8":case"utf-8":return N(this,a,l);case"ascii":return de(this,a,l);case"latin1":case"binary":return V(this,a,l);case"base64":return Z(this,a,l);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,a,l);default:if(f)throw new TypeError("Unknown encoding: "+i);i=(i+"").toLowerCase(),f=!0}}r.prototype._isBuffer=!0;function M(i,a,l){const f=i[a];i[a]=i[l],i[l]=f}r.prototype.swap16=function(){const i=this.length;if(i%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let a=0;a<i;a+=2)M(this,a,a+1);return this},r.prototype.swap32=function(){const i=this.length;if(i%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let a=0;a<i;a+=4)M(this,a,a+3),M(this,a+1,a+2);return this},r.prototype.swap64=function(){const i=this.length;if(i%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let a=0;a<i;a+=8)M(this,a,a+7),M(this,a+1,a+6),M(this,a+2,a+5),M(this,a+3,a+4);return this},r.prototype.toString=function(){const i=this.length;return i===0?"":arguments.length===0?N(this,0,i):T.apply(this,arguments)},r.prototype.toLocaleString=r.prototype.toString,r.prototype.equals=function(i){if(!r.isBuffer(i))throw new TypeError("Argument must be a Buffer");return this===i?!0:r.compare(this,i)===0},r.prototype.inspect=function(){let i="";const a=s.INSPECT_MAX_BYTES;return i=this.toString("hex",0,a).replace(/(.{2})/g,"$1 ").trim(),this.length>a&&(i+=" ... "),"<Buffer "+i+">"},n&&(r.prototype[n]=r.prototype.inspect),r.prototype.compare=function(i,a,l,f,x){if(le(i,Uint8Array)&&(i=r.from(i,i.offset,i.byteLength)),!r.isBuffer(i))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof i);if(a===void 0&&(a=0),l===void 0&&(l=i?i.length:0),f===void 0&&(f=0),x===void 0&&(x=this.length),a<0||l>i.length||f<0||x>this.length)throw new RangeError("out of range index");if(f>=x&&a>=l)return 0;if(f>=x)return-1;if(a>=l)return 1;if(a>>>=0,l>>>=0,f>>>=0,x>>>=0,this===i)return 0;let R=x-f,C=l-a;const $=Math.min(R,C),K=this.slice(f,x),z=i.slice(a,l);for(let W=0;W<$;++W)if(K[W]!==z[W]){R=K[W],C=z[W];break}return R<C?-1:C<R?1:0};function P(i,a,l,f,x){if(i.length===0)return-1;if(typeof l=="string"?(f=l,l=0):l>2147483647?l=2147483647:l<-2147483648&&(l=-2147483648),l=+l,se(l)&&(l=x?0:i.length-1),l<0&&(l=i.length+l),l>=i.length){if(x)return-1;l=i.length-1}else if(l<0)if(x)l=0;else return-1;if(typeof a=="string"&&(a=r.from(a,f)),r.isBuffer(a))return a.length===0?-1:A(i,a,l,f,x);if(typeof a=="number")return a=a&255,typeof Uint8Array.prototype.indexOf=="function"?x?Uint8Array.prototype.indexOf.call(i,a,l):Uint8Array.prototype.lastIndexOf.call(i,a,l):A(i,[a],l,f,x);throw new TypeError("val must be string, number or Buffer")}function A(i,a,l,f,x){let R=1,C=i.length,$=a.length;if(f!==void 0&&(f=String(f).toLowerCase(),f==="ucs2"||f==="ucs-2"||f==="utf16le"||f==="utf-16le")){if(i.length<2||a.length<2)return-1;R=2,C/=2,$/=2,l/=2}function K(W,X){return R===1?W[X]:W.readUInt16BE(X*R)}let z;if(x){let W=-1;for(z=l;z<C;z++)if(K(i,z)===K(a,W===-1?0:z-W)){if(W===-1&&(W=z),z-W+1===$)return W*R}else W!==-1&&(z-=z-W),W=-1}else for(l+$>C&&(l=C-$),z=l;z>=0;z--){let W=!0;for(let X=0;X<$;X++)if(K(i,z+X)!==K(a,X)){W=!1;break}if(W)return z}return-1}r.prototype.includes=function(i,a,l){return this.indexOf(i,a,l)!==-1},r.prototype.indexOf=function(i,a,l){return P(this,i,a,l,!0)},r.prototype.lastIndexOf=function(i,a,l){return P(this,i,a,l,!1)};function H(i,a,l,f){l=Number(l)||0;const x=i.length-l;f?(f=Number(f),f>x&&(f=x)):f=x;const R=a.length;f>R/2&&(f=R/2);let C;for(C=0;C<f;++C){const $=parseInt(a.substr(C*2,2),16);if(se($))return C;i[l+C]=$}return C}function J(i,a,l,f){return De(ke(a,i.length-l),i,l,f)}function ee(i,a,l,f){return De(Se(a),i,l,f)}function q(i,a,l,f){return De(Fe(a),i,l,f)}function G(i,a,l,f){return De(Re(a,i.length-l),i,l,f)}r.prototype.write=function(i,a,l,f){if(a===void 0)f="utf8",l=this.length,a=0;else if(l===void 0&&typeof a=="string")f=a,l=this.length,a=0;else if(isFinite(a))a=a>>>0,isFinite(l)?(l=l>>>0,f===void 0&&(f="utf8")):(f=l,l=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const x=this.length-a;if((l===void 0||l>x)&&(l=x),i.length>0&&(l<0||a<0)||a>this.length)throw new RangeError("Attempt to write outside buffer bounds");f||(f="utf8");let R=!1;for(;;)switch(f){case"hex":return H(this,i,a,l);case"utf8":case"utf-8":return J(this,i,a,l);case"ascii":case"latin1":case"binary":return ee(this,i,a,l);case"base64":return q(this,i,a,l);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return G(this,i,a,l);default:if(R)throw new TypeError("Unknown encoding: "+f);f=(""+f).toLowerCase(),R=!0}},r.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Z(i,a,l){return a===0&&l===i.length?e.fromByteArray(i):e.fromByteArray(i.slice(a,l))}function N(i,a,l){l=Math.min(i.length,l);const f=[];let x=a;for(;x<l;){const R=i[x];let C=null,$=R>239?4:R>223?3:R>191?2:1;if(x+$<=l){let K,z,W,X;switch($){case 1:R<128&&(C=R);break;case 2:K=i[x+1],(K&192)===128&&(X=(R&31)<<6|K&63,X>127&&(C=X));break;case 3:K=i[x+1],z=i[x+2],(K&192)===128&&(z&192)===128&&(X=(R&15)<<12|(K&63)<<6|z&63,X>2047&&(X<55296||X>57343)&&(C=X));break;case 4:K=i[x+1],z=i[x+2],W=i[x+3],(K&192)===128&&(z&192)===128&&(W&192)===128&&(X=(R&15)<<18|(K&63)<<12|(z&63)<<6|W&63,X>65535&&X<1114112&&(C=X))}}C===null?(C=65533,$=1):C>65535&&(C-=65536,f.push(C>>>10&1023|55296),C=56320|C&1023),f.push(C),x+=$}return ce(f)}const Y=4096;function ce(i){const a=i.length;if(a<=Y)return String.fromCharCode.apply(String,i);let l="",f=0;for(;f<a;)l+=String.fromCharCode.apply(String,i.slice(f,f+=Y));return l}function de(i,a,l){let f="";l=Math.min(i.length,l);for(let x=a;x<l;++x)f+=String.fromCharCode(i[x]&127);return f}function V(i,a,l){let f="";l=Math.min(i.length,l);for(let x=a;x<l;++x)f+=String.fromCharCode(i[x]);return f}function L(i,a,l){const f=i.length;(!a||a<0)&&(a=0),(!l||l<0||l>f)&&(l=f);let x="";for(let R=a;R<l;++R)x+=be[i[R]];return x}function O(i,a,l){const f=i.slice(a,l);let x="";for(let R=0;R<f.length-1;R+=2)x+=String.fromCharCode(f[R]+f[R+1]*256);return x}r.prototype.slice=function(i,a){const l=this.length;i=~~i,a=a===void 0?l:~~a,i<0?(i+=l,i<0&&(i=0)):i>l&&(i=l),a<0?(a+=l,a<0&&(a=0)):a>l&&(a=l),a<i&&(a=i);const f=this.subarray(i,a);return Object.setPrototypeOf(f,r.prototype),f};function I(i,a,l){if(i%1!==0||i<0)throw new RangeError("offset is not uint");if(i+a>l)throw new RangeError("Trying to access beyond buffer length")}r.prototype.readUintLE=r.prototype.readUIntLE=function(i,a,l){i=i>>>0,a=a>>>0,l||I(i,a,this.length);let f=this[i],x=1,R=0;for(;++R<a&&(x*=256);)f+=this[i+R]*x;return f},r.prototype.readUintBE=r.prototype.readUIntBE=function(i,a,l){i=i>>>0,a=a>>>0,l||I(i,a,this.length);let f=this[i+--a],x=1;for(;a>0&&(x*=256);)f+=this[i+--a]*x;return f},r.prototype.readUint8=r.prototype.readUInt8=function(i,a){return i=i>>>0,a||I(i,1,this.length),this[i]},r.prototype.readUint16LE=r.prototype.readUInt16LE=function(i,a){return i=i>>>0,a||I(i,2,this.length),this[i]|this[i+1]<<8},r.prototype.readUint16BE=r.prototype.readUInt16BE=function(i,a){return i=i>>>0,a||I(i,2,this.length),this[i]<<8|this[i+1]},r.prototype.readUint32LE=r.prototype.readUInt32LE=function(i,a){return i=i>>>0,a||I(i,4,this.length),(this[i]|this[i+1]<<8|this[i+2]<<16)+this[i+3]*16777216},r.prototype.readUint32BE=r.prototype.readUInt32BE=function(i,a){return i=i>>>0,a||I(i,4,this.length),this[i]*16777216+(this[i+1]<<16|this[i+2]<<8|this[i+3])},r.prototype.readBigUInt64LE=ae(function(i){i=i>>>0,fe(i,"offset");const a=this[i],l=this[i+7];(a===void 0||l===void 0)&&we(i,this.length-8);const f=a+this[++i]*2**8+this[++i]*2**16+this[++i]*2**24,x=this[++i]+this[++i]*2**8+this[++i]*2**16+l*2**24;return BigInt(f)+(BigInt(x)<<BigInt(32))}),r.prototype.readBigUInt64BE=ae(function(i){i=i>>>0,fe(i,"offset");const a=this[i],l=this[i+7];(a===void 0||l===void 0)&&we(i,this.length-8);const f=a*2**24+this[++i]*2**16+this[++i]*2**8+this[++i],x=this[++i]*2**24+this[++i]*2**16+this[++i]*2**8+l;return(BigInt(f)<<BigInt(32))+BigInt(x)}),r.prototype.readIntLE=function(i,a,l){i=i>>>0,a=a>>>0,l||I(i,a,this.length);let f=this[i],x=1,R=0;for(;++R<a&&(x*=256);)f+=this[i+R]*x;return x*=128,f>=x&&(f-=Math.pow(2,8*a)),f},r.prototype.readIntBE=function(i,a,l){i=i>>>0,a=a>>>0,l||I(i,a,this.length);let f=a,x=1,R=this[i+--f];for(;f>0&&(x*=256);)R+=this[i+--f]*x;return x*=128,R>=x&&(R-=Math.pow(2,8*a)),R},r.prototype.readInt8=function(i,a){return i=i>>>0,a||I(i,1,this.length),this[i]&128?(255-this[i]+1)*-1:this[i]},r.prototype.readInt16LE=function(i,a){i=i>>>0,a||I(i,2,this.length);const l=this[i]|this[i+1]<<8;return l&32768?l|4294901760:l},r.prototype.readInt16BE=function(i,a){i=i>>>0,a||I(i,2,this.length);const l=this[i+1]|this[i]<<8;return l&32768?l|4294901760:l},r.prototype.readInt32LE=function(i,a){return i=i>>>0,a||I(i,4,this.length),this[i]|this[i+1]<<8|this[i+2]<<16|this[i+3]<<24},r.prototype.readInt32BE=function(i,a){return i=i>>>0,a||I(i,4,this.length),this[i]<<24|this[i+1]<<16|this[i+2]<<8|this[i+3]},r.prototype.readBigInt64LE=ae(function(i){i=i>>>0,fe(i,"offset");const a=this[i],l=this[i+7];(a===void 0||l===void 0)&&we(i,this.length-8);const f=this[i+4]+this[i+5]*2**8+this[i+6]*2**16+(l<<24);return(BigInt(f)<<BigInt(32))+BigInt(a+this[++i]*2**8+this[++i]*2**16+this[++i]*2**24)}),r.prototype.readBigInt64BE=ae(function(i){i=i>>>0,fe(i,"offset");const a=this[i],l=this[i+7];(a===void 0||l===void 0)&&we(i,this.length-8);const f=(a<<24)+this[++i]*2**16+this[++i]*2**8+this[++i];return(BigInt(f)<<BigInt(32))+BigInt(this[++i]*2**24+this[++i]*2**16+this[++i]*2**8+l)}),r.prototype.readFloatLE=function(i,a){return i=i>>>0,a||I(i,4,this.length),t.read(this,i,!0,23,4)},r.prototype.readFloatBE=function(i,a){return i=i>>>0,a||I(i,4,this.length),t.read(this,i,!1,23,4)},r.prototype.readDoubleLE=function(i,a){return i=i>>>0,a||I(i,8,this.length),t.read(this,i,!0,52,8)},r.prototype.readDoubleBE=function(i,a){return i=i>>>0,a||I(i,8,this.length),t.read(this,i,!1,52,8)};function _(i,a,l,f,x,R){if(!r.isBuffer(i))throw new TypeError('"buffer" argument must be a Buffer instance');if(a>x||a<R)throw new RangeError('"value" argument is out of bounds');if(l+f>i.length)throw new RangeError("Index out of range")}r.prototype.writeUintLE=r.prototype.writeUIntLE=function(i,a,l,f){if(i=+i,a=a>>>0,l=l>>>0,!f){const C=Math.pow(2,8*l)-1;_(this,i,a,l,C,0)}let x=1,R=0;for(this[a]=i&255;++R<l&&(x*=256);)this[a+R]=i/x&255;return a+l},r.prototype.writeUintBE=r.prototype.writeUIntBE=function(i,a,l,f){if(i=+i,a=a>>>0,l=l>>>0,!f){const C=Math.pow(2,8*l)-1;_(this,i,a,l,C,0)}let x=l-1,R=1;for(this[a+x]=i&255;--x>=0&&(R*=256);)this[a+x]=i/R&255;return a+l},r.prototype.writeUint8=r.prototype.writeUInt8=function(i,a,l){return i=+i,a=a>>>0,l||_(this,i,a,1,255,0),this[a]=i&255,a+1},r.prototype.writeUint16LE=r.prototype.writeUInt16LE=function(i,a,l){return i=+i,a=a>>>0,l||_(this,i,a,2,65535,0),this[a]=i&255,this[a+1]=i>>>8,a+2},r.prototype.writeUint16BE=r.prototype.writeUInt16BE=function(i,a,l){return i=+i,a=a>>>0,l||_(this,i,a,2,65535,0),this[a]=i>>>8,this[a+1]=i&255,a+2},r.prototype.writeUint32LE=r.prototype.writeUInt32LE=function(i,a,l){return i=+i,a=a>>>0,l||_(this,i,a,4,4294967295,0),this[a+3]=i>>>24,this[a+2]=i>>>16,this[a+1]=i>>>8,this[a]=i&255,a+4},r.prototype.writeUint32BE=r.prototype.writeUInt32BE=function(i,a,l){return i=+i,a=a>>>0,l||_(this,i,a,4,4294967295,0),this[a]=i>>>24,this[a+1]=i>>>16,this[a+2]=i>>>8,this[a+3]=i&255,a+4};function oe(i,a,l,f,x){Te(a,f,x,i,l,7);let R=Number(a&BigInt(4294967295));i[l++]=R,R=R>>8,i[l++]=R,R=R>>8,i[l++]=R,R=R>>8,i[l++]=R;let C=Number(a>>BigInt(32)&BigInt(4294967295));return i[l++]=C,C=C>>8,i[l++]=C,C=C>>8,i[l++]=C,C=C>>8,i[l++]=C,l}function U(i,a,l,f,x){Te(a,f,x,i,l,7);let R=Number(a&BigInt(4294967295));i[l+7]=R,R=R>>8,i[l+6]=R,R=R>>8,i[l+5]=R,R=R>>8,i[l+4]=R;let C=Number(a>>BigInt(32)&BigInt(4294967295));return i[l+3]=C,C=C>>8,i[l+2]=C,C=C>>8,i[l+1]=C,C=C>>8,i[l]=C,l+8}r.prototype.writeBigUInt64LE=ae(function(i,a=0){return oe(this,i,a,BigInt(0),BigInt("0xffffffffffffffff"))}),r.prototype.writeBigUInt64BE=ae(function(i,a=0){return U(this,i,a,BigInt(0),BigInt("0xffffffffffffffff"))}),r.prototype.writeIntLE=function(i,a,l,f){if(i=+i,a=a>>>0,!f){const $=Math.pow(2,8*l-1);_(this,i,a,l,$-1,-$)}let x=0,R=1,C=0;for(this[a]=i&255;++x<l&&(R*=256);)i<0&&C===0&&this[a+x-1]!==0&&(C=1),this[a+x]=(i/R>>0)-C&255;return a+l},r.prototype.writeIntBE=function(i,a,l,f){if(i=+i,a=a>>>0,!f){const $=Math.pow(2,8*l-1);_(this,i,a,l,$-1,-$)}let x=l-1,R=1,C=0;for(this[a+x]=i&255;--x>=0&&(R*=256);)i<0&&C===0&&this[a+x+1]!==0&&(C=1),this[a+x]=(i/R>>0)-C&255;return a+l},r.prototype.writeInt8=function(i,a,l){return i=+i,a=a>>>0,l||_(this,i,a,1,127,-128),i<0&&(i=255+i+1),this[a]=i&255,a+1},r.prototype.writeInt16LE=function(i,a,l){return i=+i,a=a>>>0,l||_(this,i,a,2,32767,-32768),this[a]=i&255,this[a+1]=i>>>8,a+2},r.prototype.writeInt16BE=function(i,a,l){return i=+i,a=a>>>0,l||_(this,i,a,2,32767,-32768),this[a]=i>>>8,this[a+1]=i&255,a+2},r.prototype.writeInt32LE=function(i,a,l){return i=+i,a=a>>>0,l||_(this,i,a,4,2147483647,-2147483648),this[a]=i&255,this[a+1]=i>>>8,this[a+2]=i>>>16,this[a+3]=i>>>24,a+4},r.prototype.writeInt32BE=function(i,a,l){return i=+i,a=a>>>0,l||_(this,i,a,4,2147483647,-2147483648),i<0&&(i=4294967295+i+1),this[a]=i>>>24,this[a+1]=i>>>16,this[a+2]=i>>>8,this[a+3]=i&255,a+4},r.prototype.writeBigInt64LE=ae(function(i,a=0){return oe(this,i,a,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),r.prototype.writeBigInt64BE=ae(function(i,a=0){return U(this,i,a,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function re(i,a,l,f,x,R){if(l+f>i.length)throw new RangeError("Index out of range");if(l<0)throw new RangeError("Index out of range")}function ie(i,a,l,f,x){return a=+a,l=l>>>0,x||re(i,a,l,4),t.write(i,a,l,f,23,4),l+4}r.prototype.writeFloatLE=function(i,a,l){return ie(this,i,a,!0,l)},r.prototype.writeFloatBE=function(i,a,l){return ie(this,i,a,!1,l)};function pe(i,a,l,f,x){return a=+a,l=l>>>0,x||re(i,a,l,8),t.write(i,a,l,f,52,8),l+8}r.prototype.writeDoubleLE=function(i,a,l){return pe(this,i,a,!0,l)},r.prototype.writeDoubleBE=function(i,a,l){return pe(this,i,a,!1,l)},r.prototype.copy=function(i,a,l,f){if(!r.isBuffer(i))throw new TypeError("argument should be a Buffer");if(l||(l=0),!f&&f!==0&&(f=this.length),a>=i.length&&(a=i.length),a||(a=0),f>0&&f<l&&(f=l),f===l||i.length===0||this.length===0)return 0;if(a<0)throw new RangeError("targetStart out of bounds");if(l<0||l>=this.length)throw new RangeError("Index out of range");if(f<0)throw new RangeError("sourceEnd out of bounds");f>this.length&&(f=this.length),i.length-a<f-l&&(f=i.length-a+l);const x=f-l;return this===i&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(a,l,f):Uint8Array.prototype.set.call(i,this.subarray(l,f),a),x},r.prototype.fill=function(i,a,l,f){if(typeof i=="string"){if(typeof a=="string"?(f=a,a=0,l=this.length):typeof l=="string"&&(f=l,l=this.length),f!==void 0&&typeof f!="string")throw new TypeError("encoding must be a string");if(typeof f=="string"&&!r.isEncoding(f))throw new TypeError("Unknown encoding: "+f);if(i.length===1){const R=i.charCodeAt(0);(f==="utf8"&&R<128||f==="latin1")&&(i=R)}}else typeof i=="number"?i=i&255:typeof i=="boolean"&&(i=Number(i));if(a<0||this.length<a||this.length<l)throw new RangeError("Out of range index");if(l<=a)return this;a=a>>>0,l=l===void 0?this.length:l>>>0,i||(i=0);let x;if(typeof i=="number")for(x=a;x<l;++x)this[x]=i;else{const R=r.isBuffer(i)?i:r.from(i,f),C=R.length;if(C===0)throw new TypeError('The value "'+i+'" is invalid for argument "value"');for(x=0;x<l-a;++x)this[x+a]=R[x%C]}return this};const ue={};function Ee(i,a,l){ue[i]=class extends l{constructor(){super(),Object.defineProperty(this,"message",{value:a.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${i}]`,this.stack,delete this.name}get code(){return i}set code(f){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:f,writable:!0})}toString(){return`${this.name} [${i}]: ${this.message}`}}}Ee("ERR_BUFFER_OUT_OF_BOUNDS",function(i){return i?`${i} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ee("ERR_INVALID_ARG_TYPE",function(i,a){return`The "${i}" argument must be of type number. Received type ${typeof a}`},TypeError),Ee("ERR_OUT_OF_RANGE",function(i,a,l){let f=`The value of "${i}" is out of range.`,x=l;return Number.isInteger(l)&&Math.abs(l)>2**32?x=Ce(String(l)):typeof l=="bigint"&&(x=String(l),(l>BigInt(2)**BigInt(32)||l<-(BigInt(2)**BigInt(32)))&&(x=Ce(x)),x+="n"),f+=` It must be ${a}. Received ${x}`,f},RangeError);function Ce(i){let a="",l=i.length;const f=i[0]==="-"?1:0;for(;l>=f+4;l-=3)a=`_${i.slice(l-3,l)}${a}`;return`${i.slice(0,l)}${a}`}function Ae(i,a,l){fe(a,"offset"),(i[a]===void 0||i[a+l]===void 0)&&we(a,i.length-(l+1))}function Te(i,a,l,f,x,R){if(i>l||i<a){const C=typeof a=="bigint"?"n":"";let $;throw a===0||a===BigInt(0)?$=`>= 0${C} and < 2${C} ** ${(R+1)*8}${C}`:$=`>= -(2${C} ** ${(R+1)*8-1}${C}) and < 2 ** ${(R+1)*8-1}${C}`,new ue.ERR_OUT_OF_RANGE("value",$,i)}Ae(f,x,R)}function fe(i,a){if(typeof i!="number")throw new ue.ERR_INVALID_ARG_TYPE(a,"number",i)}function we(i,a,l){throw Math.floor(i)!==i?(fe(i,l),new ue.ERR_OUT_OF_RANGE("offset","an integer",i)):a<0?new ue.ERR_BUFFER_OUT_OF_BOUNDS:new ue.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${a}`,i)}const ye=/[^+/0-9A-Za-z-_]/g;function Be(i){if(i=i.split("=")[0],i=i.trim().replace(ye,""),i.length<2)return"";for(;i.length%4!==0;)i=i+"=";return i}function ke(i,a){a=a||1/0;let l;const f=i.length;let x=null;const R=[];for(let C=0;C<f;++C){if(l=i.charCodeAt(C),l>55295&&l<57344){if(!x){if(l>56319){(a-=3)>-1&&R.push(239,191,189);continue}else if(C+1===f){(a-=3)>-1&&R.push(239,191,189);continue}x=l;continue}if(l<56320){(a-=3)>-1&&R.push(239,191,189),x=l;continue}l=(x-55296<<10|l-56320)+65536}else x&&(a-=3)>-1&&R.push(239,191,189);if(x=null,l<128){if((a-=1)<0)break;R.push(l)}else if(l<2048){if((a-=2)<0)break;R.push(l>>6|192,l&63|128)}else if(l<65536){if((a-=3)<0)break;R.push(l>>12|224,l>>6&63|128,l&63|128)}else if(l<1114112){if((a-=4)<0)break;R.push(l>>18|240,l>>12&63|128,l>>6&63|128,l&63|128)}else throw new Error("Invalid code point")}return R}function Se(i){const a=[];for(let l=0;l<i.length;++l)a.push(i.charCodeAt(l)&255);return a}function Re(i,a){let l,f,x;const R=[];for(let C=0;C<i.length&&!((a-=2)<0);++C)l=i.charCodeAt(C),f=l>>8,x=l%256,R.push(x),R.push(f);return R}function Fe(i){return e.toByteArray(Be(i))}function De(i,a,l,f){let x;for(x=0;x<f&&!(x+l>=a.length||x>=i.length);++x)a[x+l]=i[x];return x}function le(i,a){return i instanceof a||i!=null&&i.constructor!=null&&i.constructor.name!=null&&i.constructor.name===a.name}function se(i){return i!==i}const be=function(){const i="0123456789abcdef",a=new Array(256);for(let l=0;l<16;++l){const f=l*16;for(let x=0;x<16;++x)a[f+x]=i[l]+i[x]}return a}();function ae(i){return typeof BigInt>"u"?B:i}function B(){throw new Error("BigInt not supported")}}(ai)),ai}var At=hn();const Wi=class vt{constructor(){d(this,"key",null),d(this,"awsS3Service",new an)}async encrypt(e){const t=JSON.stringify(e),n=await this.getKey(),o=window.crypto.getRandomValues(new Uint8Array(vt.GCM_IV_LENGTH)),h=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:o},n,new TextEncoder().encode(t)),c=new Uint8Array([...o,...new Uint8Array(h)]);return At.Buffer.from(c).toString("base64")}async decrypt(e){try{const t=await this.getKey(),n=new Uint8Array(At.Buffer.from(e,"base64")),o=n.slice(0,vt.GCM_IV_LENGTH),h=n.slice(vt.GCM_IV_LENGTH),c=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:o},t,h);return new TextDecoder().decode(c)}catch(t){return console.error("Decryption error:",t),null}}async getKey(){if(!this.key)try{const e=await this.awsS3Service.getDataFromS3("fda-app-secure-store","aesKey.json"),t=At.Buffer.from(e.key,"base64");this.key=await window.crypto.subtle.importKey("raw",t,{name:"AES-GCM"},!1,["encrypt","decrypt"])}catch(e){throw new Error(`Key retrieval failed: ${e}`)}return this.key}};d(Wi,"GCM_IV_LENGTH",12);let Ht=Wi;const cn=15,dn={development:!0,serverHost:"http://localhost:5000",endPoints:{getHealth:"/api/v2/get_health",sendHealthReport:void 0},coldStartDuration:0,schemaVersion:"1.4",encrypted:!1},un={development:!0,serverHost:"http://localhost:5000",endPoints:{getHealth:"/vitals-v2/get-health",sendHealthReport:void 0},coldStartDuration:0,schemaVersion:"2.1",encrypted:!0},gn={development:!0,serverHost:"https://backend.panoptic.ai",endPoints:{getHealth:"/v2/dev/get-health",sendHealthReport:"/email/dev"},coldStartDuration:25,schemaVersion:"1.2",encrypted:!1},fn={development:!1,serverHost:"https://backend.panoptic.ai",endPoints:{getHealth:"/v2/get-health",sendHealthReport:"/email"},coldStartDuration:25,schemaVersion:"1.2",encrypted:!1},mn={development:!0,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/v2/dev/get-health",sendHealthReport:"/email/dev"},coldStartDuration:25,schemaVersion:"1.4",encrypted:!1},ji={development:!1,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/v2/get-health",sendHealthReport:"/email"},coldStartDuration:25,schemaVersion:"1.4",encrypted:!1},pn={development:!1,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/v2/get-health-company",sendHealthReport:"/email"},coldStartDuration:25,schemaVersion:"1.2",encrypted:!1},vn={development:!0,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/v2/dev/get-health-company",sendHealthReport:"/email/dev"},coldStartDuration:25,schemaVersion:"1.5",encrypted:!1},wn={development:!1,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/v2/get-health-company",sendHealthReport:"/email"},coldStartDuration:25,schemaVersion:"1.5",encrypted:!1},yn={development:!0,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/vitals-v2-dev/get-health",sendHealthReport:void 0},coldStartDuration:25,schemaVersion:"2.2",encrypted:!0},bn={development:!1,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/vitals-v2/get-health",sendHealthReport:void 0},coldStartDuration:25,schemaVersion:"2.2",encrypted:!0};class hi{constructor(e){d(this,"windowDuration",cn),d(this,"deviceId",Qt()),d(this,"config",ji),d(this,"apiKey"),d(this,"aesCryptor"),d(this,"httpCall",(...t)=>fetch(...t)),this.config=e}setServerUrl(e){this.config.serverHost=e}getUrl(){return this.config.serverHost+this.config.endPoints.getHealth}get httpHeaders(){const e={"Content-Type":"application/json"};return this.apiKey&&(e["X-Api-Key"]=this.apiKey),e}async wakeUpServer(){const e=this.getUrl();this.aesCryptor=new Ht;let t={isAlive:!0};this.config.encrypted&&(t={data:await this.aesCryptor.encrypt(t)}),await this.httpCall(e,{method:"POST",headers:this.httpHeaders,body:JSON.stringify(t)})}async callAPI(e,t){this.aesCryptor=new Ht;let n=t;this.config.encrypted&&(n={data:await this.aesCryptor.encrypt(t)});const o=await this.httpCall(e,{method:"POST",headers:this.httpHeaders,body:JSON.stringify(n)});if(o.status!=200){const c=await o.text();throw new Error(`Error: ${o.status} ${c}`)}let h=await o.json();if(this.config.encrypted){const c=await this.aesCryptor.decrypt(h.data);c&&(h=JSON.parse(c))}return h}getUrlSES(){return this.config.serverHost+this.config.endPoints.sendHealthReport}async sendHealthReport(e,t,n,o){const h=this.getUrlSES(),c={type:"attachment",params:{Recipients:e,EmailContent:n.emailContent,EmailSubject:n.emailSubject,FileName:n.fileName,Attachments:t,Source:o}},r=await this.httpCall(h,{method:"POST",headers:this.httpHeaders,body:JSON.stringify(c)});if(r.status!=200)throw new Error(r.statusText);return r.json()}}var wt={exports:{}},xn=wt.exports,ci;function kn(){return ci||(ci=1,function(s,e){(function(t,n){var o="1.0.39",h="",c="?",r="function",m="undefined",y="object",k="string",D="major",v="model",w="name",p="type",u="vendor",g="version",b="architecture",E="console",S="mobile",T="tablet",M="smarttv",P="wearable",A="embedded",H=500,J="Amazon",ee="Apple",q="ASUS",G="BlackBerry",Z="Browser",N="Chrome",Y="Edge",ce="Firefox",de="Google",V="Huawei",L="LG",O="Microsoft",I="Motorola",_="Opera",oe="Samsung",U="Sharp",re="Sony",ie="Xiaomi",pe="Zebra",ue="Facebook",Ee="Chromium OS",Ce="Mac OS",Ae=" Browser",Te=function(B,i){var a={};for(var l in B)i[l]&&i[l].length%2===0?a[l]=i[l].concat(B[l]):a[l]=B[l];return a},fe=function(B){for(var i={},a=0;a<B.length;a++)i[B[a].toUpperCase()]=B[a];return i},we=function(B,i){return typeof B===k?ye(i).indexOf(ye(B))!==-1:!1},ye=function(B){return B.toLowerCase()},Be=function(B){return typeof B===k?B.replace(/[^\d\.]/g,h).split(".")[0]:n},ke=function(B,i){if(typeof B===k)return B=B.replace(/^\s\s*/,h),typeof i===m?B:B.substring(0,H)},Se=function(B,i){for(var a=0,l,f,x,R,C,$;a<i.length&&!C;){var K=i[a],z=i[a+1];for(l=f=0;l<K.length&&!C&&K[l];)if(C=K[l++].exec(B),C)for(x=0;x<z.length;x++)$=C[++f],R=z[x],typeof R===y&&R.length>0?R.length===2?typeof R[1]==r?this[R[0]]=R[1].call(this,$):this[R[0]]=R[1]:R.length===3?typeof R[1]===r&&!(R[1].exec&&R[1].test)?this[R[0]]=$?R[1].call(this,$,R[2]):n:this[R[0]]=$?$.replace(R[1],R[2]):n:R.length===4&&(this[R[0]]=$?R[3].call(this,$.replace(R[1],R[2])):n):this[R]=$||n;a+=2}},Re=function(B,i){for(var a in i)if(typeof i[a]===y&&i[a].length>0){for(var l=0;l<i[a].length;l++)if(we(i[a][l],B))return a===c?n:a}else if(we(i[a],B))return a===c?n:a;return i.hasOwnProperty("*")?i["*"]:B},Fe={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},De={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},le={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[w,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[w,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[w,g],[/opios[\/ ]+([\w\.]+)/i],[g,[w,_+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[g,[w,_+" GX"]],[/\bopr\/([\w\.]+)/i],[g,[w,_]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[g,[w,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[w,g],[/quark(?:pc)?\/([-\w\.]+)/i],[g,[w,"Quark"]],[/\bddg\/([\w\.]+)/i],[g,[w,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[w,"UC"+Z]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[g,[w,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[w,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[w,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[g,[w,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[g,[w,"Smart Lenovo "+Z]],[/(avast|avg)\/([\w\.]+)/i],[[w,/(.+)/,"$1 Secure "+Z],g],[/\bfocus\/([\w\.]+)/i],[g,[w,ce+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[w,_+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[w,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[w,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[w,_+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[w,"MIUI "+Z]],[/fxios\/([-\w\.]+)/i],[g,[w,ce]],[/\bqihu|(qi?ho?o?|360)browser/i],[[w,"360"+Ae]],[/\b(qq)\/([\w\.]+)/i],[[w,/(.+)/,"$1Browser"],g],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[w,/(.+)/,"$1"+Ae],g],[/samsungbrowser\/([\w\.]+)/i],[g,[w,oe+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[w,/_/g," "],g],[/metasr[\/ ]?([\d\.]+)/i],[g,[w,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[w,"Sogou Mobile"],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[w,g],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[w],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[w,ue],g],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[w,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[w,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[g,[w,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[w,N+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[w,N+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[w,"Android "+Z]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[w,g],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[g,[w,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[g,w],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[w,[g,Re,Fe]],[/(webkit|khtml)\/([\w\.]+)/i],[w,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[w,"Netscape"],g],[/(wolvic)\/([\w\.]+)/i],[w,g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[w,ce+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[w,[g,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[w,[g,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[b,"amd64"]],[/(ia32(?=;))/i],[[b,ye]],[/((?:i[346]|x)86)[;\)]/i],[[b,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[b,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[b,"armhf"]],[/windows (ce|mobile); ppc;/i],[[b,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[b,/ower/,h,ye]],[/(sun4\w)[;\)]/i],[[b,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[b,ye]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[v,[u,oe],[p,T]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[v,[u,oe],[p,S]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[v,[u,ee],[p,S]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[v,[u,ee],[p,T]],[/(macintosh);/i],[v,[u,ee]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[v,[u,U],[p,S]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[v,[u,V],[p,T]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[v,[u,V],[p,S]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[v,/_/g," "],[u,ie],[p,S]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[v,/_/g," "],[u,ie],[p,T]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[v,[u,"OPPO"],[p,S]],[/\b(opd2\d{3}a?) bui/i],[v,[u,"OPPO"],[p,T]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[v,[u,"Vivo"],[p,S]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[v,[u,"Realme"],[p,S]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[v,[u,I],[p,S]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[v,[u,I],[p,T]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[v,[u,L],[p,T]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[v,[u,L],[p,S]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[v,[u,"Lenovo"],[p,T]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[v,/_/g," "],[u,"Nokia"],[p,S]],[/(pixel c)\b/i],[v,[u,de],[p,T]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[v,[u,de],[p,S]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[v,[u,re],[p,S]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[v,"Xperia Tablet"],[u,re],[p,T]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[v,[u,"OnePlus"],[p,S]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[v,[u,J],[p,T]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[v,/(.+)/g,"Fire Phone $1"],[u,J],[p,S]],[/(playbook);[-\w\),; ]+(rim)/i],[v,u,[p,T]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[v,[u,G],[p,S]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[v,[u,q],[p,T]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[v,[u,q],[p,S]],[/(nexus 9)/i],[v,[u,"HTC"],[p,T]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[u,[v,/_/g," "],[p,S]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[v,[u,"TCL"],[p,T]],[/(itel) ((\w+))/i],[[u,ye],v,[p,Re,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[v,[u,"Acer"],[p,T]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[v,[u,"Meizu"],[p,S]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[v,[u,"Ulefone"],[p,S]],[/droid.+; (a(?:015|06[35]|142p?))/i],[v,[u,"Nothing"],[p,S]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[u,v,[p,S]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[u,v,[p,T]],[/(surface duo)/i],[v,[u,O],[p,T]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[v,[u,"Fairphone"],[p,S]],[/(u304aa)/i],[v,[u,"AT&T"],[p,S]],[/\bsie-(\w*)/i],[v,[u,"Siemens"],[p,S]],[/\b(rct\w+) b/i],[v,[u,"RCA"],[p,T]],[/\b(venue[\d ]{2,7}) b/i],[v,[u,"Dell"],[p,T]],[/\b(q(?:mv|ta)\w+) b/i],[v,[u,"Verizon"],[p,T]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[v,[u,"Barnes & Noble"],[p,T]],[/\b(tm\d{3}\w+) b/i],[v,[u,"NuVision"],[p,T]],[/\b(k88) b/i],[v,[u,"ZTE"],[p,T]],[/\b(nx\d{3}j) b/i],[v,[u,"ZTE"],[p,S]],[/\b(gen\d{3}) b.+49h/i],[v,[u,"Swiss"],[p,S]],[/\b(zur\d{3}) b/i],[v,[u,"Swiss"],[p,T]],[/\b((zeki)?tb.*\b) b/i],[v,[u,"Zeki"],[p,T]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[u,"Dragon Touch"],v,[p,T]],[/\b(ns-?\w{0,9}) b/i],[v,[u,"Insignia"],[p,T]],[/\b((nxa|next)-?\w{0,9}) b/i],[v,[u,"NextBook"],[p,T]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[u,"Voice"],v,[p,S]],[/\b(lvtel\-)?(v1[12]) b/i],[[u,"LvTel"],v,[p,S]],[/\b(ph-1) /i],[v,[u,"Essential"],[p,S]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[v,[u,"Envizen"],[p,T]],[/\b(trio[-\w\. ]+) b/i],[v,[u,"MachSpeed"],[p,T]],[/\btu_(1491) b/i],[v,[u,"Rotor"],[p,T]],[/(shield[\w ]+) b/i],[v,[u,"Nvidia"],[p,T]],[/(sprint) (\w+)/i],[u,v,[p,S]],[/(kin\.[onetw]{3})/i],[[v,/\./g," "],[u,O],[p,S]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[v,[u,pe],[p,T]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[v,[u,pe],[p,S]],[/smart-tv.+(samsung)/i],[u,[p,M]],[/hbbtv.+maple;(\d+)/i],[[v,/^/,"SmartTV"],[u,oe],[p,M]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[u,L],[p,M]],[/(apple) ?tv/i],[u,[v,ee+" TV"],[p,M]],[/crkey/i],[[v,N+"cast"],[u,de],[p,M]],[/droid.+aft(\w+)( bui|\))/i],[v,[u,J],[p,M]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[v,[u,U],[p,M]],[/(bravia[\w ]+)( bui|\))/i],[v,[u,re],[p,M]],[/(mitv-\w{5}) bui/i],[v,[u,ie],[p,M]],[/Hbbtv.*(technisat) (.*);/i],[u,v,[p,M]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[u,ke],[v,ke],[p,M]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[p,M]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[u,v,[p,E]],[/droid.+; (shield) bui/i],[v,[u,"Nvidia"],[p,E]],[/(playstation [345portablevi]+)/i],[v,[u,re],[p,E]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[v,[u,O],[p,E]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[v,[u,oe],[p,P]],[/((pebble))app/i],[u,v,[p,P]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[v,[u,ee],[p,P]],[/droid.+; (glass) \d/i],[v,[u,de],[p,P]],[/droid.+; (wt63?0{2,3})\)/i],[v,[u,pe],[p,P]],[/(quest( \d| pro)?)/i],[v,[u,ue],[p,P]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[u,[p,A]],[/(aeobc)\b/i],[v,[u,J],[p,A]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[v,[p,S]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[v,[p,T]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[p,T]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[p,S]],[/(android[-\w\. ]{0,9});.+buil/i],[v,[u,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[w,Y+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[w,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[w,g],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,w]],os:[[/microsoft (windows) (vista|xp)/i],[w,g],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[w,[g,Re,De]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[g,Re,De],[w,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[w,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[w,Ce],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[g,w],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[w,g],[/\(bb(10);/i],[g,[w,G]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[g,[w,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[w,ce+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[w,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[g,[w,"watchOS"]],[/crkey\/([\d\.]+)/i],[g,[w,N+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[w,Ee],g],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[w,g],[/(sunos) ?([\w\.\d]*)/i],[[w,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[w,g]]},se=function(B,i){if(typeof B===y&&(i=B,B=n),!(this instanceof se))return new se(B,i).getResult();var a=typeof t!==m&&t.navigator?t.navigator:n,l=B||(a&&a.userAgent?a.userAgent:h),f=a&&a.userAgentData?a.userAgentData:n,x=i?Te(le,i):le,R=a&&a.userAgent==l;return this.getBrowser=function(){var C={};return C[w]=n,C[g]=n,Se.call(C,l,x.browser),C[D]=Be(C[g]),R&&a&&a.brave&&typeof a.brave.isBrave==r&&(C[w]="Brave"),C},this.getCPU=function(){var C={};return C[b]=n,Se.call(C,l,x.cpu),C},this.getDevice=function(){var C={};return C[u]=n,C[v]=n,C[p]=n,Se.call(C,l,x.device),R&&!C[p]&&f&&f.mobile&&(C[p]=S),R&&C[v]=="Macintosh"&&a&&typeof a.standalone!==m&&a.maxTouchPoints&&a.maxTouchPoints>2&&(C[v]="iPad",C[p]=T),C},this.getEngine=function(){var C={};return C[w]=n,C[g]=n,Se.call(C,l,x.engine),C},this.getOS=function(){var C={};return C[w]=n,C[g]=n,Se.call(C,l,x.os),R&&!C[w]&&f&&f.platform&&f.platform!="Unknown"&&(C[w]=f.platform.replace(/chrome os/i,Ee).replace(/macos/i,Ce)),C},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return l},this.setUA=function(C){return l=typeof C===k&&C.length>H?ke(C,H):C,this},this.setUA(l),this};se.VERSION=o,se.BROWSER=fe([w,g,D]),se.CPU=fe([b]),se.DEVICE=fe([v,u,p,E,S,M,T,P,A]),se.ENGINE=se.OS=fe([w,g]),s.exports&&(e=s.exports=se),e.UAParser=se;var be=typeof t!==m&&(t.jQuery||t.Zepto);if(be&&!be.ua){var ae=new se;be.ua=ae.getResult(),be.ua.get=function(){return ae.getUA()},be.ua.set=function(B){ae.setUA(B);var i=ae.getResult();for(var a in i)be.ua[a]=i[a]}}})(typeof window=="object"?window:xn)}(wt,wt.exports)),wt.exports}var Sn=kn();const Nt=(s,e)=>e.some(t=>s instanceof t);let di,ui;function Dn(){return di||(di=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function En(){return ui||(ui=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const zt=new WeakMap,Ft=new WeakMap,kt=new WeakMap;function Rn(s){const e=new Promise((t,n)=>{const o=()=>{s.removeEventListener("success",h),s.removeEventListener("error",c)},h=()=>{t(Le(s.result)),o()},c=()=>{n(s.error),o()};s.addEventListener("success",h),s.addEventListener("error",c)});return kt.set(e,s),e}function Cn(s){if(zt.has(s))return;const e=new Promise((t,n)=>{const o=()=>{s.removeEventListener("complete",h),s.removeEventListener("error",c),s.removeEventListener("abort",c)},h=()=>{t(),o()},c=()=>{n(s.error||new DOMException("AbortError","AbortError")),o()};s.addEventListener("complete",h),s.addEventListener("error",c),s.addEventListener("abort",c)});zt.set(s,e)}let Wt={get(s,e,t){if(s instanceof IDBTransaction){if(e==="done")return zt.get(s);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Le(s[e])},set(s,e,t){return s[e]=t,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function qi(s){Wt=s(Wt)}function Tn(s){return En().includes(s)?function(...e){return s.apply(jt(this),e),Le(this.request)}:function(...e){return Le(s.apply(jt(this),e))}}function Mn(s){return typeof s=="function"?Tn(s):(s instanceof IDBTransaction&&Cn(s),Nt(s,Dn())?new Proxy(s,Wt):s)}function Le(s){if(s instanceof IDBRequest)return Rn(s);if(Ft.has(s))return Ft.get(s);const e=Mn(s);return e!==s&&(Ft.set(s,e),kt.set(e,s)),e}const jt=s=>kt.get(s);function Pn(s,e,{blocked:t,upgrade:n,blocking:o,terminated:h}={}){const c=indexedDB.open(s,e),r=Le(c);return n&&c.addEventListener("upgradeneeded",m=>{n(Le(c.result),m.oldVersion,m.newVersion,Le(c.transaction),m)}),t&&c.addEventListener("blocked",m=>t(m.oldVersion,m.newVersion,m)),r.then(m=>{h&&m.addEventListener("close",()=>h()),o&&m.addEventListener("versionchange",y=>o(y.oldVersion,y.newVersion,y))}).catch(()=>{}),r}const An=["get","getKey","getAll","getAllKeys","count"],Fn=["put","add","delete","clear"],It=new Map;function gi(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(It.get(e))return It.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,o=Fn.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(o||An.includes(t)))return;const h=async function(c,...r){const m=this.transaction(c,o?"readwrite":"readonly");let y=m.store;return n&&(y=y.index(r.shift())),(await Promise.all([y[t](...r),o&&m.done]))[0]};return It.set(e,h),h}qi(s=>({...s,get:(e,t,n)=>gi(e,t)||s.get(e,t,n),has:(e,t)=>!!gi(e,t)||s.has(e,t)}));const In=["continue","continuePrimaryKey","advance"],fi={},qt=new WeakMap,Gi=new WeakMap,_n={get(s,e){if(!In.includes(e))return s[e];let t=fi[e];return t||(t=fi[e]=function(...n){qt.set(this,Gi.get(this)[e](...n))}),t}};async function*Bn(...s){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...s)),!e)return;e=e;const t=new Proxy(e,_n);for(Gi.set(t,e),kt.set(t,jt(e));e;)yield t,e=await(qt.get(t)||e.continue()),qt.delete(t)}function mi(s,e){return e===Symbol.asyncIterator&&Nt(s,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&Nt(s,[IDBIndex,IDBObjectStore])}qi(s=>({...s,get(e,t,n){return mi(e,t)?Bn:s.get(e,t,n)},has(e,t){return mi(e,t)||s.has(e,t)}}));async function On(s){const e=JSON.parse(s);if(!e)return;if(e.userInfo)return e;if(!e.data)return;const t=await new Ht().decrypt(e.data);if(!t)return;const n=JSON.parse(t);if(!(!n||!n.userInfo))return n}async function $n(s,e){const t=e==null?void 0:e.body;if(typeof t!="string")return!1;const n=await On(t);return n?(console.log("[Request Saver] Saving request",n),(await Pn("ai.panoptic.request")).transaction("requests","readwrite").objectStore("requests").put({id:1,url:s,request:e}),!0):!1}function Vn(s=fetch){return async(e,t)=>{try{await $n(e,t)}catch(n){console.error("[Request Saver] ",n)}return s(e,t)}}function Yi(s){let e=0,t=0,n=0,o=0;for(let m=0;m<s.height;m++)for(let y=0;y<s.width;y++){let k=y*m*4,D=s.data[k],v=s.data[k+1],w=s.data[k+2];(D!==0||v!==0||w!==0)&&(e+=D,t+=v,n+=w,o++)}if(o===0)return;const h=e/o,c=t/o,r=n/o;if(!(isNaN(h)||isNaN(c)||isNaN(r)))return[h,c,r]}function Ln(s,e){if(s===void 0)return;const{data:t,width:n,height:o}=s,h=[],c=[];for(let r=0;r<e;r++)for(let m=0;m<e;m++){const y=Math.floor(m*n/e),k=Math.min(Math.floor((m+1)*n/e),n),D=Math.floor(r*o/e),v=Math.min(Math.floor((r+1)*o/e),o);c.push({startX:y,endX:k,startY:D,endY:v})}for(const r of c){const{startX:m,endX:y,startY:k,endY:D}=r,v=y-m,w=D-k,p=v*w;if(p===0){const M=(k*n+m)*4;h.push([t[M],t[M+1],t[M+2]]);continue}let u=0,g=0,b=0;for(let M=k;M<D;M++){const P=(M*n+m)*4,A=(M*n+y)*4;for(let H=P;H<A;H+=4)u+=t[H],g+=t[H+1],b+=t[H+2]}const E=u/p,S=g/p,T=b/p;h.push([E,S,T])}return h}function Un(s,e){if(s===void 0)return;const{data:t,width:n,height:o}=s,h=[],c=[];for(let r=0;r<e;r++)for(let m=0;m<e;m++){const y=Math.floor(m*n/e),k=Math.min(Math.floor((m+1)*n/e),n),D=Math.floor(r*o/e),v=Math.min(Math.floor((r+1)*o/e),o);c.push({startX:y,endX:k,startY:D,endY:v})}for(const r of c){const{startX:m,endX:y,startY:k,endY:D}=r,v=y-m,w=D-k,p=v*w;if(p===0){const M=(k*n+m)*4,P=t[M],A=t[M+1],H=t[M+2],[J,ee,q]=pi(P,A,H);h.push([J,ee,q]);continue}let u=0,g=0,b=0;for(let M=k;M<D;M++)for(let P=m;P<y;P++){const A=(M*n+P)*4,H=t[A],J=t[A+1],ee=t[A+2],[q,G,Z]=pi(H,J,ee);u+=q,g+=G,b+=Z}const E=u/p,S=g/p,T=b/p;h.push([E,S,T])}return h}function pi(s,e,t){const n=.299*s+.587*e+.114*t,o=-.14713*s-.28886*e+.436*t,h=.615*s-.51499*e-.10001*t;return[n,o,h]}async function vi(s){return Promise.all(s.map(Hn))}async function Hn(s){const e={};for(const t in s.pixels)e[t]={type:s.pixels[t].type,pixels:await s.pixels[t].pixels};return{...s,pixels:e}}const Nn=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,wi=s=>{if(typeof s!="string")throw new TypeError("Invalid argument expected string");const e=s.match(Nn);if(!e)throw new Error(`Invalid argument not valid semver ('${s}' received)`);return e.shift(),e},yi=s=>s==="*"||s==="x"||s==="X",bi=s=>{const e=parseInt(s,10);return isNaN(e)?s:e},zn=(s,e)=>typeof s!=typeof e?[String(s),String(e)]:[s,e],Wn=(s,e)=>{if(yi(s)||yi(e))return 0;const[t,n]=zn(bi(s),bi(e));return t>n?1:t<n?-1:0},xi=(s,e)=>{for(let t=0;t<Math.max(s.length,e.length);t++){const n=Wn(s[t]||"0",e[t]||"0");if(n!==0)return n}return 0},Ne=(s,e)=>{const t=wi(s),n=wi(e),o=t.pop(),h=n.pop(),c=xi(t,n);return c!==0?c:o&&h?xi(o.split("."),h.split(".")):o||h?o?-1:1:0},Qi=15,Gt=new Map([[ne.Local,dn],[ne.LocalV2,un],[ne.RemoteDev,gn],[ne.RemoteProd,fn],[ne.AwsDev,mn],[ne.AwsProd,ji],[ne.RemoteProdEnterprise,pn],[ne.AwsDevEnterprise,vn],[ne.AwsProdEnterprise,wn],[ne.Schema2Dev,yn],[ne.Schema2Prod,bn]]);class ki{constructor(e){d(this,"wakeUpRequestTime"),d(this,"serverAwaken",!1),d(this,"scanId"),d(this,"client"),d(this,"cfg",{serverId:ne.RemoteProd,dataWindowDuration:Qi}),this.client=new hi(Gt.get(ne.AwsProd)),e.dataWindowDuration&&(Q("Configure dataWindowDuration: "+e.dataWindowDuration),this.client.windowDuration=e.dataWindowDuration),e.serverId!==void 0&&(Q("Configure serverId: "+e.serverId),this.client=new hi(Gt.get(e.serverId)),this.client.apiKey=this.cfg.apiKey),e.serverUrl&&(Q("Configure serverUrl: "+e.serverUrl),this.client.setServerUrl(e.serverUrl)),e.apiKey&&(Q("Configure apiKey: "+Os(e.apiKey)),this.cfg.apiKey=e.apiKey,this.client.apiKey=this.cfg.apiKey),e.httpCall&&(Q("Configure httpCall"),this.client.httpCall=e.httpCall),e.enableSavingRequest&&(Q("Configure enableSavingRequest"),this.client.httpCall=Vn(this.client.httpCall)),e.landmarksSampleRate!==void 0&&(Q("Configure landmarksSampleRate: "+e.landmarksSampleRate),this.cfg.landmarksSampleRate=e.landmarksSampleRate)}get readyTime(){return this.client.config.coldStartDuration-this.client.windowDuration}get _isReady(){return this.wakeUpRequestTime===void 0?!1:this.serverAwaken?!0:(new Date().getTime()-this.wakeUpRequestTime)/1e3>this.readyTime}userInfo(e){const t={},n=e;return Object.keys(n).forEach(o=>{n[o]!==void 0&&(t[o]=n[o])}),t}async _wakeUpServer(){let e=new Date().getTime();return this.serverAwaken=!1,this.wakeUpRequestTime=new Date().getTime(),Q("Wake up server now..."),new Promise((t,n)=>{this.client.wakeUpServer().then(()=>{this.serverAwaken=!0,t()}).catch(o=>{this.serverAwaken=!1,n(o)}).finally(()=>{let o=new Date().getTime()-e;Q("Wake up time: ",o)})})}async wakeUpServer(){return this.wakeUpRequestTime!==void 0?this._waitUntilReady():this._wakeUpServer()}isReadySync(){return this._isReady}async isReady(){if(this._isReady)return!0;let e=Bs(.5,"timeout");return Promise.race([e,this.waitUntilReady()]).then(t=>t!=="timeout")}async _waitUntilReady(){return new Promise(e=>{let t=setInterval(()=>{this._isReady&&(clearInterval(t),e())},200)})}async waitUntilReady(){return this.wakeUpRequestTime==null&&this.wakeUpServer(),this._waitUntilReady()}begin(){return this.scanId=Qt(),this._wakeUpServer().catch(e=>console.log(e)),Promise.resolve()}async analyze(e,t,n){var o;const h=(o=e[0].pixels.face)==null?void 0:o.type;if(Ne(this.client.config.schemaVersion,"2")>0)var c=await this.getHealthV2(e,t,n);else if(h=="rgb1x1")c=await this.getHealthRgb1x1(await vi(e),t);else throw new Error("Unsupported pixel Size");return this.parseHealthFromJson(c)}async getHealthRgb1x1(e,t){const n=this.client.getUrl(),o=e.filter(k=>{var D;return(D=k.pixels.face)==null?void 0:D.pixels}).map(k=>{var D;return(D=k.pixels.face)==null?void 0:D.pixels[0][0]}),h=e.filter(k=>{var D;return(D=k.pixels.face)==null?void 0:D.pixels}).map(k=>{var D;return(D=k.pixels.face)==null?void 0:D.pixels[0][1]}),c=e.filter(k=>{var D;return(D=k.pixels.face)==null?void 0:D.pixels}).map(k=>{var D;return(D=k.pixels.face)==null?void 0:D.pixels[0][2]}),r=e.map(k=>k.timestamp),m=e.filter(k=>{var D;return(D=k.pixels.chest)==null?void 0:D.pixels}).map(k=>{var D;return(D=k.pixels.chest)==null?void 0:D.pixels[0][0]}),y={r:o,g:h,b:c,timestamp:r,userInfo:this.userInfo(t),deviceId:this.client.deviceId,windowDuration:this.client.windowDuration,deviceType:"web"};return m!==void 0&&m.length>0?m.length>=h.length?(y.respPixels=m,y.version="1.3"):console.warn("[HttpEndpointsClient] Too few respiratory pixels. Falling back to schema 1.2."):console.warn("[HttpEndpointsClient] No respiratory pixels. Falling back to schema 1.2."),this.scanId!==void 0&&(y.scanId=this.scanId),await this.client.callAPI(n,y)}async getHealthV2(e,t,n){var o;const h=this.client.getUrl(),c=this.prepareDataV2(await vi(e)),r=this.prepareDeviceInfo(),m={...c,pixelsFormat:(o=e[0].pixels.face)==null?void 0:o.type,userInfo:this.userInfo(t),deviceInfo:r,measurementMode:"Resting",faceDetectorOption:"mp-face-mesh",metadata:{requestTime:Date.now(),dev:this.client.config.development},videoFrameInfo:n};return this.scanId!==void 0&&(m.deviceInfo.scanId=this.scanId),await this.client.callAPI(h,m)}prepareDataV2(e){const t=[],n=[],o=[];let h="2.1";if(e.map(c=>{var r,m,y,k,D,v,w,p,u,g;const b=(r=c.pixels.face)==null?void 0:r.pixels;if(b){const T={values:b,timestamp:c.timestamp};(m=c.pixels.chin)!=null&&m.pixels&&(h="2.2",T.chin=(y=c.pixels.chin)==null?void 0:y.pixels),(k=c.pixels.leftCheek)!=null&&k.pixels&&(h="2.2",T.leftCheek=(D=c.pixels.leftCheek)==null?void 0:D.pixels),(v=c.pixels.rightCheek)!=null&&v.pixels&&(h="2.2",T.rightCheek=(w=c.pixels.rightCheek)==null?void 0:w.pixels),(p=c.pixels.glabella)!=null&&p.pixels&&(h="2.2",T.glabella=(u=c.pixels.glabella)==null?void 0:u.pixels),t.push(T)}const E=(g=c.pixels.chest)==null?void 0:g.pixels;E&&(E[0].length===1?n.push(this.mean(E)[0]):(h="2.3",E.length==1?n.push(E[0]):n.push(E)));const S=this.getLandmarksV2(c.landmarks);if(S){const T=c.facebox,M={bbox:[T.xCenter-T.width/2,T.yCenter-T.height/2,T.xCenter+T.width/2,T.yCenter+T.height/2],landmarks:S,timestamp:c.timestamp};o.push(M)}}),o.length>1&&this.cfg.landmarksSampleRate!==void 0){const c=this.cfg.landmarksSampleRate,r=o[o.length-1].timestamp-o[0].timestamp;if(o.length/r>c){const m=1/c,y=[];let k=o[0].timestamp;y.push(o[0]);for(let D=1;D<o.length;D++)o[D].timestamp-k>=m&&(y.push(o[D]),k=o[D].timestamp);o.length=0,o.push(...y)}}return{version:h,pixels:t,respPixels:n,facialMarkers:o.length==0?null:o}}getLandmarksV2(e){if(!e||e.length==0)return null;const t={};return[4,10,11,14,34,136,152,168,205,264,365,425].map(n=>{t[n]=[e[n].x,e[n].y],e[n].z!==void 0&&t[n].push(e[n].z)}),t}prepareDeviceInfo(){const{device:e}=Sn.UAParser(navigator.userAgent);return{deviceId:this.client.deviceId,deviceBrand:e!=null&&e.vendor?e.vendor:"unknown",deviceModel:e!=null&&e.model?e.model:"unknown",deviceType:"web"}}mean(e){if(e.length===0)return[0,0,0];const t=e[0].length;return e.reduce((n,o)=>{for(let h=0;h<t;h++)n[h]+=o[h];return n},Array(t).fill(0)).map(n=>n/e.length)}end(){throw new Error("Method not implemented.")}reset(){this.serverAwaken=!1,this.wakeUpRequestTime=void 0,this.scanId=void 0}parseHealthFromJson(e){return Q(e),Ne(this.client.config.schemaVersion,"2")>0?this.parseHealthV2(e):this.parseHealthV1(e)}parseHealthV1(e){let t=e.vital_signs,n=e.health_risks,o=e.holistic_health,h={datetime:new Date};if(o&&(h.holisticHealth={},o.general_wellness!==void 0&&(h.holisticHealth.generalWellness=o.general_wellness),o.bmi!==void 0&&(h.holisticHealth.bmi=o.bmi),o.hhe_version!==void 0&&(h.holisticHealth.version=o.hhe_version),o.absi!==void 0&&(h.holisticHealth.absi=o.absi),o.cardiac_workload!==void 0&&(h.holisticHealth.cardiacWorkload=o.cardiac_workload),o.pulse_respiratory_quotient!==void 0&&(h.holisticHealth.pulseRespiratoryQuotient=o.pulse_respiratory_quotient),o.waist_to_height_ratio!==void 0&&(h.holisticHealth.waistToHeightRatio=o.waist_to_height_ratio)),t["0_server"].scan_parameters!==void 0){let c=t["0_server"].scan_parameters,r={conditions:c.conditions!==void 0?c.conditions:void 0,invalidPixelPercentage:c.invalid_pixel_percentage!==void 0?c.invalid_pixel_percentage:void 0,signalDuration:c.signal_duration!==void 0?c.signal_duration:void 0,signalQuality:c.signal_quality!==void 0?c.signal_quality:void 0,snr:c.snr!==void 0?c.snr:void 0};h.scanParameters=r}return t&&(h.vitalSigns={heartRate:t.heart_rate,spo2:t.spo2,ibi:t.hrv_ibi},t.respiratory_rate!==void 0&&(h.vitalSigns.respiratoryRate=t.respiratory_rate),t.stress!==void 0&&(h.vitalSigns.stress=t.stress),t.stress_score!==void 0&&(h.vitalSigns.stressScore=t.stress_score),t.hrv_sdnn!==void 0&&(h.vitalSigns.hrvSdnn=t.hrv_sdnn),t.hrv_rmssd!==void 0&&(h.vitalSigns.hrvRmssd=t.hrv_rmssd),t.temperature!==void 0&&(h.vitalSigns.temperature=t.temperature),t.blood_pressure!==void 0&&(h.vitalSigns.bloodPressure=t.blood_pressure),t.blood_pressure_systolic!==void 0&&(h.vitalSigns.bloodPressureSystolic=t.blood_pressure_systolic),t.blood_pressure_diastolic!==void 0&&(h.vitalSigns.bloodPressureDiastolic=t.blood_pressure_diastolic),t.facial_skin_age!==void 0&&(h.vitalSigns.facialSkinAge=t.facial_skin_age),t.blood_alcohol!==void 0&&(h.vitalSigns.bloodAlcohol=t.blood_alcohol),t.blood_sugar!==void 0&&(h.vitalSigns.bloodSugar=t.blood_sugar),t["0_server"].version!==void 0&&(h.vitalSigns.version=t["0_server"].version)),n.cvd_risk_general!==void 0&&(h.risks==null&&(h.risks={}),h.risks.cardiovascularRisks={generalRisk:n.cvd_risk_general,coronaryHeartDisease:n.cvd_risk_CHD,congestiveHeartFailure:n.cvd_risk_CHF,intermittentClaudication:n.cvd_risk_IC,stroke:n.cvd_risk_Stroke}),n.covid_risk!==void 0&&(h.risks==null&&(h.risks={}),h.risks.covidRisk={covidRisk:n.covid_risk}),n.diabetesRisk!==void 0&&(h.risks==null&&(h.risks={}),h.risks.diabetesRisk=n.diabetesRisk),n.hypertensionRisk!==void 0&&(h.risks==null&&(h.risks={}),h.risks.hypertensionRisk=n.hypertensionRisk),n.cholesterolRisk!==void 0&&(h.risks==null&&(h.risks={}),h.risks.cholesterolRisk=n.cholesterolRisk),n.hre_version!==void 0&&h.risks&&(h.risks.version=n.hre_version),h}parseHealthV2(e){let t=e.vitalSigns,n=e.healthRisks,o=e.wellness,h=e.signalAnalysis,c=e.serverInfo,r={datetime:new Date};if(o&&(r.holisticHealth={},o.generalWellness!==void 0&&(r.holisticHealth.generalWellness=o.generalWellness),o.bmi!==void 0&&(r.holisticHealth.bmi=o.bmi),o.absi!==void 0&&(r.holisticHealth.absi=o.absi),o.absiz!==void 0&&(r.holisticHealth.absiz=o.absiz),o.cardiacWorkload!==void 0&&(r.holisticHealth.cardiacWorkload=o.cardiacWorkload),o.pulseRespiratoryQuotient!==void 0&&(r.holisticHealth.pulseRespiratoryQuotient=o.pulseRespiratoryQuotient),o.waistToHeightRatio!==void 0&&(r.holisticHealth.waistToHeightRatio=o.waistToHeightRatio),o.cardiovascularSystemWellness!==void 0&&(r.holisticHealth.cardiovascularSystemWellness=o.cardiovascularSystemWellness),o.mentalWellness!==void 0&&(r.holisticHealth.mentalWellness=o.mentalWellness),o.physicalWellness!==void 0&&(r.holisticHealth.physicalWellness=o.physicalWellness),o.respiratorySystemWellness!==void 0&&(r.holisticHealth.respiratorySystemWellness=o.respiratorySystemWellness)),t&&(r.vitalSigns={},t.heartRate!==void 0&&(r.vitalSigns.heartRate=t.heartRate),t.spo2!==void 0&&(r.vitalSigns.spo2=t.spo2),t.hrvIbi!==void 0&&(r.vitalSigns.ibi=t.hrvIbi),t.respiratoryRate!==void 0&&(r.vitalSigns.respiratoryRate=t.respiratoryRate),t.stress!==void 0&&(r.vitalSigns.stress=t.stress),t.stressScore!==void 0&&(r.vitalSigns.stressScore=t.stressScore),t.hrvSdnn!==void 0&&(r.vitalSigns.hrvSdnn=t.hrvSdnn),t.hrvRmssd!==void 0&&(r.vitalSigns.hrvRmssd=t.hrvRmssd),t.bloodPressure!==void 0&&(r.vitalSigns.bloodPressure=t.bloodPressure),t.bloodPressureSystolic!==void 0&&(r.vitalSigns.bloodPressureSystolic=t.bloodPressureSystolic),t.bloodPressureDiastolic!==void 0&&(r.vitalSigns.bloodPressureDiastolic=t.bloodPressureDiastolic),t.facialSkinAge!==void 0&&(r.vitalSigns.facialSkinAge=t.facialSkinAge)),n&&(r.risks={},n.cvdRiskGeneral!==void 0&&(r.risks.cardiovascularRisks={generalRisk:n.cvdRiskGeneral,coronaryHeartDisease:n.cvdRiskCHD,congestiveHeartFailure:n.cvdRiskCHF,intermittentClaudication:n.cvdRiskIC,stroke:n.cvdRiskStroke}),n.covidRisk!==void 0&&(r.risks.covidRisk={covidRisk:n.covidRisk}),n.diabetesRisk!==void 0&&(r.risks.diabetesRisk=n.diabetesRisk),n.hypertensionRisk!==void 0&&(r.risks.hypertensionRisk=n.hypertensionRisk),n.cholesterolRisk!==void 0&&(r.risks.cholesterolRisk=n.cholesterolRisk)),h){if(r.scanParameters={},h.signalConditions!==void 0){const m=h.signalConditions;r.scanParameters.signalConditions={noSpeedJitter:m.noSpeedJitter,goodAverageSpeed:m.goodAverageSpeed,fixedHeadPosition:m.fixedHeadPosition,noHeadTurning:m.noHeadTurning,adequateBrightness:m.adequateBrightness,evenLightingOnFace:m.evenLightingOnFace,goodSnr:m.goodSnr,signalSteadiness:m.signalSteadiness,goodSignalPercentage:m.goodSignalPercentage,hrSteadiness:m.hrSteadiness,hrSignalQuality:m.hrSignalQuality,rrSignalQuality:m.rrSignalQuality,bpSignalQuality:m.bpSignalQuality}}h.signalDuration!==void 0&&(r.scanParameters.signalDuration=h.signalDuration),h.signalQuality!==void 0&&(r.scanParameters.signalQuality=h.signalQuality),h.snr!==void 0&&(r.scanParameters.snr=h.snr),h.warning!==void 0&&(r.scanParameters.warning=h.warning)}return c&&(r.serverInfo={userPlan:c.userPlan,userId:c.userId},c.datetime!==void 0&&(r.serverInfo.datetime=c.datetime),c.datetimeStr!==void 0&&(r.serverInfo.datetimeStr=c.datetimeStr),c.elapse!==void 0&&(r.serverInfo.elapse=c.elapse),c.version!==void 0&&(r.serverInfo.version=c.version),c.errorCode!==void 0&&(r.serverInfo.errorCode=c.datetime)),r}}class jn{constructor(e,t,n,o,h=navigator.hardwareConcurrency*2,c){d(this,"workerManagers",[]),d(this,"createWorker"),d(this,"workerName"),d(this,"timeout"),d(this,"workerCount"),d(this,"onCreated"),d(this,"workerFunction"),d(this,"isEnabled",!0),this.onCreated=c,this.createWorker=e,this.workerName=n,this.timeout=o,this.workerCount=h,this.workerFunction=t,this.onCreated=c,this.isEnabled&&this.newWorker()}async newWorker(){const e=this.createWorker(),t=new qn(e,this.workerName,this.timeout);return this.onCreated&&await this.onCreated(t),this.workerManagers.push(t),t}async callWorker(e,t){if(!this.isEnabled&&this.workerFunction)return this.workerFunction(e);const n=this.workerManagers.find(o=>!o.isBusy);return n?n.callWorker(e,t):this.workerManagers.length<this.workerCount?(await this.newWorker()).callWorker(e,t):Promise.reject(new Error(`${this.workerName}: All ${this.workerCount} workers are busy`))}get hasAvailableWorker(){return this.workerManagers.some(e=>!e.isBusy)||this.workerManagers.length<this.workerCount}terminateAll(){this.workerManagers.forEach(e=>e.terminate()),this.workerManagers=[]}}class qn{constructor(e,t,n){d(this,"timeout"),d(this,"worker"),d(this,"workerName"),d(this,"pendingPromises",{}),this.timeout=n||1e3,this.worker=e,this.workerName=t||"Worker",this.worker.onmessage=o=>{const{result:h,hash:c,error:r}=o.data,m=this.pendingPromises[c];m&&(clearTimeout(m.timer),r?m.reject(new Error(`Worker ${this.workerName} Error: ${r}`)):m.resolve(h),delete this.pendingPromises[c])},this.worker.onerror=o=>{for(const h in this.pendingPromises)clearTimeout(this.pendingPromises[h].timer),this.pendingPromises[h].reject(new Error(`Worker ${this.workerName} Error: ${o.message}`)),delete this.pendingPromises[h];console.error(`Worker ${t} error: ${o.message}`)}}get isBusy(){return Object.keys(this.pendingPromises).length>2}callWorker(e,t){const n=crypto.randomUUID();return new Promise((o,h)=>{const c=setTimeout(()=>{if(this.pendingPromises[n]){const y=Object.keys(this.pendingPromises).length;this.pendingPromises[n].reject(new Error(`Worker ${this.workerName} Timeout. ${y>1?`${y} pending promises.`:""}`))}delete this.pendingPromises[n]},this.timeout);this.pendingPromises[n]&&(clearTimeout(this.pendingPromises[n].timer),this.pendingPromises[n].reject(new Error(`Worker ${this.workerName} Duplicate hash: ${n}`)),delete this.pendingPromises[n]),this.pendingPromises[n]={resolve:o,reject:h,timer:c};const r=performance.now();this.worker.postMessage({inputData:e,hash:n},t);const m=performance.now()-r;m>5&&console.warn(`Worker ${this.workerName} postMessage took ${m} ms, which may cause frame drops.`)})}terminate(){this.worker.terminate();for(const e in this.pendingPromises)clearTimeout(this.pendingPromises[e].timer),this.pendingPromises[e].reject(new Error(`Worker ${this.workerName} terminated.`)),delete this.pendingPromises[e]}}const _t={};function ve(s,e,t,n,o,h){return _t[t]||(_t[t]=new jn(s,e,t,n,o,h)),_t[t]}function St(s){return Yi(s)}self.onmessage=s=>{const{inputData:e,hash:t}=s.data,n=St(e);self.postMessage({result:n,hash:t})};class Bt{constructor(){d(this,"dataType","ggg1x1"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/B5lsALhE-ppZ36LXi.js",import.meta.url),{type:"module"})),d(this,"workerPool",ve(this.workerFactory,St,"Ggg1x1WorkerPool"))}async extract(e){const t=await e;if(!t)return;const n=await this.workerPool.callWorker(t);if(!(!n||n[1]===void 0))return[[n[1]]]}}function Ki(s){const e=Yi(s);if(!e)return null;const[t,n,o]=e,h=.299*t+.587*n+.114*o,c=-.14713*t-.28886*n+.436*o,r=.615*t-.51499*n-.10001*o;return[h,c,r]}self.onmessage=s=>{const{inputData:e,hash:t}=s.data,n=Ki(e);self.postMessage({result:n,hash:t})};class Gn{constructor(){d(this,"dataType","yyy1x1"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/CXHLiYOT-BPLMuNyk.js",import.meta.url),{type:"module"})),d(this,"workerPool",ve(this.workerFactory,Ki,"Yuv1x1WorkerPool"))}async extract(e){const t=await e;if(!t)return;const n=await this.workerPool.callWorker(t);if(n)return[[n[0]]]}}class Ot{constructor(){d(this,"dataType","rgb1x1"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/B5lsALhE-ppZ36LXi.js",import.meta.url),{type:"module"})),d(this,"workerPool",ve(this.workerFactory,St,"Rgb1x1WorkerPool"))}async extract(e){const t=await e;if(!t)return;const n=await this.workerPool.callWorker(t);if(n)return[n]}}function Kt(s){const{imageData:e,size:t}=s;return Ln(e,t)}self.onmessage=s=>{const{inputData:e,hash:t}=s.data,n=Kt(e);self.postMessage({result:n,hash:t})};class Yn{constructor(){d(this,"dataType","rgb8x8"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BJ8tLFkU-CydYnlpG.js",import.meta.url),{type:"module"})),d(this,"workerPool",ve(this.workerFactory,Kt,"Rgb8x8WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:8})}}class Qn{constructor(){d(this,"dataType","rgb32x32"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BJ8tLFkU-CydYnlpG.js",import.meta.url),{type:"module"})),d(this,"workerPool",ve(this.workerFactory,Kt,"Rgb32x32WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:32})}}function qe(s){const{imageData:e,size:t}=s;return Un(e,t)}self.onmessage=s=>{const{inputData:e,hash:t}=s.data,n=qe(e);self.postMessage({result:n,hash:t})};class Kn{constructor(){d(this,"dataType","yuv8x8"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BQisuE9N-gDDR2tiQ.js",import.meta.url),{type:"module"})),d(this,"workerPool",ve(this.workerFactory,qe,"Yuv8x8WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:8})}}class Xn{constructor(){d(this,"dataType","yuv32x32"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BQisuE9N-gDDR2tiQ.js",import.meta.url),{type:"module"})),d(this,"workerPool",ve(this.workerFactory,qe,"Yuv32x32WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:32})}}class Jn{constructor(){d(this,"dataType","yuv64x64"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BQisuE9N-gDDR2tiQ.js",import.meta.url),{type:"module"})),d(this,"workerPool",ve(this.workerFactory,qe,"Yuv64x64WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:64})}}class Zn{constructor(){d(this,"dataType","yuv1x1"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BQisuE9N-gDDR2tiQ.js",import.meta.url),{type:"module"})),d(this,"workerPool",ve(this.workerFactory,qe,"Yuv1x1WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:1})}}class ea{constructor(){d(this,"dataType","meanRgb1x1"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/B5lsALhE-ppZ36LXi.js",import.meta.url),{type:"module"})),d(this,"workerPool",ve(this.workerFactory,St,"ChestMeanRgb1x1WorkerPool"))}async extract(e){const t=await e;if(!t)return;const n=await this.workerPool.callWorker(t);if(n)return[n]}}function $t(s,e="rgb1x1"){if(s==="face")switch(e){case"rgb1x1":return new Ot;case"rgb8x8":return new Yn;case"rgb32x32":return new Qn;case"yuv1x1":return new Zn;case"yuv8x8":return new Kn;case"yuv32x32":return new Xn;case"yuv64x64":return new Jn;case"ggg1x1":return new Bt;default:return new Ot}else if(s==="chest")switch(e){case"ggg1x1":return new Bt;case"yyy1x1":return new Gn;case"meanRgb1x1":return new ea;default:return new Bt}else return new Ot}function Vt(s){const e=(s==null?void 0:s.pixelDataType)??"rgb1x1",t=(s==null?void 0:s.chestPixelDataType)??"ggg1x1";return((s==null?void 0:s.enabledROIs)??["face","chest"]).reduce((n,o)=>(o==="face"?n.face=$t(o,e):o==="chest"?n.chest=$t(o,t):n[o]=$t(o,e),n),{})}const Yt="2.1.0-b1";class ta{constructor(){d(this,"threshold",1),d(this,"lastOKTime",0),d(this,"lastPixels"),d(this,"detected",!1)}reset(){this.lastOKTime=0,this.lastPixels=void 0,this.detected=!1}diff(e,t){let n=0;for(let o=0;o<e.length;o++){const h=e[o],c=t[o];for(let r=0;r<h.length;r++)n+=c[r]-h[r]}return n}detect(e,t){if(e){if(this.lastPixels!==void 0){if(this.diff(e,this.lastPixels)!==0)this.lastOKTime=t;else if(t-this.lastOKTime>this.threshold)return this.detected=!0,!0}return this.lastPixels=e,!1}}}const Si=25,Di=5,Ei=1/6,Ri=1;class ia{constructor(){d(this,"instanceId"),d(this,"stage",j.Idle),d(this,"startTime",new Date),d(this,"health"),d(this,"firstDataTime"),d(this,"frameData",[]),d(this,"lastSendTime"),d(this,"sendingData",!1),d(this,"error"),d(this,"cfg",{serverId:ne.RemoteProd,dataCollectionDuration:Si,dataSendingRate:Ei,dataSendingDuration:Di,dataWindowDuration:Qi,faceLostTimeout:Ri}),d(this,"blinkDetector",ni(We.dummy)),d(this,"healthAnalyzer"),d(this,"pixelsExtractors"),d(this,"duplicatedPixelDetector",new ta),window.__vital_sign_engine_plugin__=this,this.instanceId=Qt(),Q(`VitalSignEngine Plugin InstanceId: ${this.instanceId}`),Q(`VitalSignEngine Plugin (TSVitalSignCamera-${Yt})`),this.healthAnalyzer=new ki({serverId:ne.AwsProd}),this.pixelsExtractors=Vt(),this.configure({serverId:ne.AwsEnterpriseProd})}configure(e){Q("Configuring. Instance Id = ",this.instanceId),this.healthAnalyzer=new ki(e),e.pixelDataType&&(Q("Configure pixelDataType: "+e.pixelDataType),this.cfg.pixelDataType=e.pixelDataType,this.pixelsExtractors=Vt(e)),e.chestPixelDataType&&(Q("Configure chestPixelDataType: "+e.chestPixelDataType),this.cfg.chestPixelDataType=e.chestPixelDataType,this.pixelsExtractors=Vt(e)),e.dataCollectionDuration&&(Q("Configure dataCollectionDuration: "+e.dataCollectionDuration),this.cfg.dataCollectionDuration=e.dataCollectionDuration),e.dataSendingDuration&&(Q("Configure dataSendingDuration: "+e.dataSendingDuration),this.cfg.dataSendingDuration=e.dataSendingDuration),e.dataSendingRate&&(Q("Configure dataSendingRate: "+e.dataSendingRate),this.cfg.dataSendingRate=e.dataSendingRate),e.blinkDetectorType!==void 0&&(Q("Configure blink detecor type"),this.blinkDetector=ni(e.blinkDetectorType),e.blinkDetectorConfig!==void 0&&this.blinkDetector.configure(e.blinkDetectorConfig)),e.blinkDetectorConfig!==void 0&&(Q("Configure blink detector"),this.blinkDetector.configure(e.blinkDetectorConfig)),e.faceLostTimeout!==void 0&&(Q("Configure faceLostTimeout"),this.cfg.faceLostTimeout=e.faceLostTimeout)}get stageTime(){switch(this.stage){case j.WaitingData:return-1;case j.CollectingData:return this.cfg.dataCollectionDuration||Si;case j.AnalyzingData:return this.cfg.dataSendingDuration||Di;case j.Idle:return-1}}get elapsedTime(){return(new Date().getTime()-this.startTime.getTime())/1e3}get remainingTime(){return Math.max(this.stageTime-this.elapsedTime,0)}get nextStage(){return this.elapsedTime<=this.stageTime?!1:this.stage!==j.AnalyzingData?!0:!this.sendingData}frameDataTimestamp(e){return this.firstDataTime===void 0?0:(e-this.firstDataTime)/1e3}get healthResult(){return{stage:this.stage,remainingTime:this.remainingTime,totalTime:this.stageTime===-1?void 0:this.stageTime,health:this.health,error:this.error}}async isReady(){return this.healthAnalyzer.isReady()}async waitUntilReady(){return this.healthAnalyzer.waitUntilReady()}reset(){this.blinkDetector.reset(),this.frameData=[],this.firstDataTime=void 0,this.lastSendTime=void 0,this.sendingData=!1,this.healthAnalyzer.reset(),this.duplicatedPixelDetector.reset()}async start(){if(this.stage!==j.Idle)return Promise.reject(new Error("already started"));this.health=void 0,this.error=void 0,this.reset(),this.healthAnalyzer.begin(),this.setStage(j.WaitingData)}get stageName(){switch(this.stage){case j.Idle:return"Idle";case j.AnalyzingData:return"Analyzing";case j.CollectingData:return"Collecting";case j.WaitingData:return"Waiting"}}setStage(e){this.stage=e,this.startTime=new Date,Q(this.stageName)}async stop(){this.stage!==j.Idle&&(this.setStage(j.Idle),this.reset(),this.healthAnalyzer.reset())}toIdleStage(){this.setStage(j.Idle),this.reset(),this.healthAnalyzer.reset()}faceLostError(){Q("Error: face lost"),this.toIdleStage(),this.error=new Error("face lost")}duplicatedRGBError(){Q("Error: duplicated RGB values"),this.toIdleStage(),this.error=new Error("duplicated rgb")}faceLost(e){if(this.frameData.length==0)return!1;const t=this.frameData[this.frameData.length-1],n=this.cfg.faceLostTimeout===void 0?Ri:this.cfg.faceLostTimeout;return!(this.frameDataTimestamp(e)-t.timestamp<n)}getHealth(e){var t,n;const o=e.videoFrameInfo.timestamp;if(this.stage===j.Idle)return(t=e.images)!=null&&t.face&&e.faceBox&&this.extractPixels(e.images),this.healthResult;if(this.stage==j.WaitingData)return this.faceLost(o)||this.blinkDetector.noEyes||this.blinkDetector.unstable?(this.faceLostError(),this.healthResult):(this.blinkDetector.detect(e.landmarks),this.healthAnalyzer.isReadySync()?(this.setStage(j.CollectingData),this.healthResult):(Q("Waiting server to awake..."),this.healthResult));if(this.stage==j.CollectingData)return this.faceLost(o)||this.blinkDetector.noEyes||this.blinkDetector.unstable?(this.faceLostError(),this.healthResult):(this.blinkDetector.detect(e.landmarks),(n=e.images)!=null&&n.face&&e.faceBox&&(this.addData(e.images,e.faceBox,e.landmarks,o),this.duplicatedPixelDetector.detected)?(this.duplicatedRGBError(),this.healthResult):(this.nextStage&&this.setStage(j.AnalyzingData),this.healthResult));if(this.stage==j.AnalyzingData){if(this.blinkDetector.blinkCount==0)return Q("Error: no blink"),this.toIdleStage(),this.error=new Error("no blink"),this.healthResult;let h=this.cfg.dataSendingRate||Ei;return e.images&&e.faceBox&&this.addData(e.images,e.faceBox,e.landmarks,o),this.sendData(1/h,e.userInfo,e.videoFrameInfo),this.nextStage&&this.toIdleStage(),this.healthResult}else return this.nextStage&&this.setStage(j.Idle),this.healthResult}addData(e,t,n,o){if(e.face===void 0)return;this.firstDataTime===void 0&&(this.firstDataTime=o);let h={pixels:this.extractPixels(e),timestamp:this.frameDataTimestamp(o),facebox:t,landmarks:n};this.frameData.push(h)}extractPixels(e){var t;let n={};for(const o in this.pixelsExtractors){const h=o,c=this.pixelsExtractors[h];if(!c)continue;const r=e[h];if(!r)continue;const m=(t=this.pixelsExtractors[h])==null?void 0:t.extract(r.imageData);m&&(n[h]={type:c.dataType,pixels:m})}return n}handleError(e){Q(`Error: ${e}`),this.toIdleStage(),this.error=e}sendData(e,t,n){if(this.sendingData||this.elapsedTime>=this.stageTime)return;if(this.lastSendTime===void 0){this.lastSendTime=new Date,this._sendData(t,n).catch(c=>this.handleError(c));return}let o=new Date,h=this.lastSendTime;(o.getTime()-h.getTime())/1e3<e||this._sendData(t,n).catch(c=>this.handleError(c))}async _sendData(e,t){if(this.sendingData=!0,this.frameData.length===0)throw this.sendingData=!1,new Error("no pixel data");const n=this.frameData,o=await this.healthAnalyzer.analyze(n,e,t);this.stage===j.AnalyzingData&&(this.health=o),this.lastSendTime=new Date,this.sendingData=!1}async sendHealthReport(e,t,n,o){return this.healthAnalyzer.client.sendHealthReport(e,t,n,o)}}function sa(){return new ia}var he=(s=>(s[s.MediaPipe=0]="MediaPipe",s[s.OpenCV=1]="OpenCV",s[s.Dummy=2]="Dummy",s[s.TFMediaPipe=3]="TFMediaPipe",s[s.FaceApi=4]="FaceApi",s[s.MPFaceMesh=5]="MPFaceMesh",s[s.MPFaceDetector=6]="MPFaceDetector",s[s.MPFaceMeshThreaded=7]="MPFaceMeshThreaded",s))(he||{}),na=(s=>(s.SelfHosted="self-hosted",s.CDN="cdn",s))(na||{}),Pe=(s=>(s[s.cif352x288=0]="cif352x288",s[s.sd480x360=1]="sd480x360",s[s.hd1280x720=2]="hd1280x720",s[s.hd1920x1080=3]="hd1920x1080",s))(Pe||{});function aa(s){switch(s){case 0:return{width:352,height:288};case 1:return{width:480,height:360};case 2:return{width:1280,height:720};case 3:return{width:1920,height:1080}}}class oa{constructor(e){d(this,"video"),d(this,"canvas"),this.video=e,this.canvas=document.createElement("canvas")}start(){if(!this.video.srcObject)throw new Error("Video element has no srcObject");return Promise.resolve()}stop(){return Promise.resolve()}captureFrame(e,t){const n=this.cropFrame(this.video,e),o=Promise.resolve(n.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,n.width,n.height));return{timestamp:t??performance.now(),width:n.width,height:n.height,getImageData:()=>o,getCanvas:()=>Promise.resolve(n)}}cropFrame(e,t){const n=this.canvas;return n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(e,t.x,t.y,t.width,t.height,0,0,n.width,n.height),n.getContext("2d").canvas}}var Ci={exports:{}},Ti;function ra(){return Ti||(Ti=1,function(s){s.exports=function(e){var t={};function n(o){if(t[o])return t[o].exports;var h=t[o]={i:o,l:!1,exports:{}};return e[o].call(h.exports,h,h.exports,n),h.l=!0,h.exports}return n.m=e,n.c=t,n.d=function(o,h,c){n.o(o,h)||Object.defineProperty(o,h,{configurable:!1,enumerable:!0,get:c})},n.n=function(o){var h=o&&o.__esModule?function(){return o.default}:function(){return o};return n.d(h,"a",h),h},n.o=function(o,h){return Object.prototype.hasOwnProperty.call(o,h)},n.p="",n(n.s=1)}([function(e,t,n){var o={MOBILE:"mobile",TABLET:"tablet",SMART_TV:"smarttv",CONSOLE:"console",WEARABLE:"wearable",BROWSER:void 0},h={CHROME:"Chrome",FIREFOX:"Firefox",OPERA:"Opera",YANDEX:"Yandex",SAFARI:"Safari",INTERNET_EXPLORER:"Internet Explorer",EDGE:"Edge",CHROMIUM:"Chromium",IE:"IE",MOBILE_SAFARI:"Mobile Safari",EDGE_CHROMIUM:"Edge Chromium"},c={IOS:"iOS",ANDROID:"Android",WINDOWS_PHONE:"Windows Phone",WINDOWS:"Windows",MAC_OS:"Mac OS"},r={isMobile:!1,isTablet:!1,isBrowser:!1,isSmartTV:!1,isConsole:!1,isWearable:!1};e.exports={BROWSER_TYPES:h,DEVICE_TYPES:o,OS_TYPES:c,defaultData:r}},function(e,t,n){var o=n(2),h=n(0),c=h.BROWSER_TYPES,r=h.OS_TYPES,m=h.DEVICE_TYPES,y=n(4),k=y.checkType,D=y.broPayload,v=y.mobilePayload,w=y.wearPayload,p=y.consolePayload,u=y.stvPayload,g=y.getNavigatorInstance,b=y.isIOS13Check,E=new o,S=E.getBrowser(),T=E.getDevice(),M=E.getEngine(),P=E.getOS(),A=E.getUA(),H=c.CHROME,J=c.CHROMIUM,ee=c.IE,q=c.INTERNET_EXPLORER,G=c.OPERA,Z=c.FIREFOX,N=c.SAFARI,Y=c.EDGE,ce=c.YANDEX,de=c.MOBILE_SAFARI,V=m.MOBILE,L=m.TABLET,O=m.SMART_TV,I=m.BROWSER,_=m.WEARABLE,oe=m.CONSOLE,U=r.ANDROID,re=r.WINDOWS_PHONE,ie=r.IOS,pe=r.WINDOWS,ue=r.MAC_OS,Ee=function(){return T.type===V},Ce=function(){return T.type===L},Ae=function(){switch(T.type){case V:case L:return!0;default:return!1}},Te=function(){return P.name===r.WINDOWS&&P.version==="10"?typeof A=="string"&&A.indexOf("Edg/")!==-1:!1},fe=function(){return T.type===O},we=function(){return T.type===I},ye=function(){return T.type===_},Be=function(){return T.type===oe},ke=function(){return P.name===U},Se=function(){return P.name===pe},Re=function(){return P.name===ue},Fe=function(){return P.name===re},De=function(){return P.name===ie},le=function(){return S.name===H},se=function(){return S.name===Z},be=function(){return S.name===J},ae=function(){return S.name===Y},B=function(){return S.name===ce},i=function(){return S.name===N||S.name===de},a=function(){return S.name===de},l=function(){return S.name===G},f=function(){return S.name===q||S.name===ee},x=function(){var Me=g(),ct=Me&&Me.userAgent.toLowerCase();return typeof ct=="string"?/electron/.test(ct):!1},R=function(){var Me=g();return Me&&(/iPad|iPhone|iPod/.test(Me.platform)||Me.platform==="MacIntel"&&Me.maxTouchPoints>1)&&!window.MSStream},C=function(){return b("iPad")},$=function(){return b("iPhone")},K=function(){return b("iPod")},z=function(){return S.major},W=function(){return S.version},X=function(){return P.version?P.version:"none"},Ge=function(){return P.name?P.name:"none"},Ye=function(){return S.name},Qe=function(){return T.vendor?T.vendor:"none"},Ke=function(){return T.model?T.model:"none"},Xe=function(){return M.name},Je=function(){return M.version},Ze=function(){return A},et=function(){return T.type},tt=fe(),it=Be(),st=ye(),nt=a()||C(),at=be(),ot=Ae()||C(),rt=Ee(),lt=Ce()||C(),ht=we(),Et=ke(),Rt=Fe(),Ct=De()||C(),Tt=le(),Mt=se(),ns=i(),as=l(),os=f(),rs=X(),ls=Ge(),hs=z(),cs=W(),ds=Ye(),us=Qe(),gs=Ke(),fs=Xe(),ms=Je(),ps=Ze(),vs=ae()||Te(),ws=B(),ys=et(),bs=R(),xs=C(),ks=$(),Ss=K(),Ds=x(),Es=Te(),Rs=ae(),Cs=Se(),Ts=Re(),Ve=k(T.type);function Ms(){var Me=Ve.isBrowser,ct=Ve.isMobile,Ps=Ve.isTablet,Jt=Ve.isSmartTV,Zt=Ve.isConsole,ei=Ve.isWearable;if(Me)return D(Me,S,M,P,A);if(Jt)return u(Jt,M,P,A);if(Zt)return p(Zt,M,P,A);if(ct||Ps)return v(Ve,T,P,A);if(ei)return w(ei,M,P,A)}e.exports={deviceDetect:Ms,isSmartTV:tt,isConsole:it,isWearable:st,isMobileSafari:nt,isChromium:at,isMobile:ot,isMobileOnly:rt,isTablet:lt,isBrowser:ht,isAndroid:Et,isWinPhone:Rt,isIOS:Ct,isChrome:Tt,isFirefox:Mt,isSafari:ns,isOpera:as,isIE:os,osVersion:rs,osName:ls,fullBrowserVersion:hs,browserVersion:cs,browserName:ds,mobileVendor:us,mobileModel:gs,engineName:fs,engineVersion:ms,getUA:ps,isEdge:vs,isYandex:ws,deviceType:ys,isIOS13:bs,isIPad13:xs,isIPhone13:ks,isIPod13:Ss,isElectron:Ds,isEdgeChromium:Es,isLegacyEdge:Rs,isWindows:Cs,isMacOs:Ts}},function(e,t,n){var o;/*!
* UAParser.js v0.7.18
* Lightweight JavaScript-based User-Agent string parser
* https://github.com/faisalman/ua-parser-js
*
* Copyright © 2012-2016 Faisal Salman <fyzlman@gmail.com>
* Dual licensed under GPLv2 or MIT
*/(function(h,c){var r="0.7.18",m="",y="?",k="function",D="undefined",v="object",w="string",p="major",u="model",g="name",b="type",E="vendor",S="version",T="architecture",M="console",P="mobile",A="tablet",H="smarttv",J="wearable",ee="embedded",q={extend:function(V,L){var O={};for(var I in V)L[I]&&L[I].length%2===0?O[I]=L[I].concat(V[I]):O[I]=V[I];return O},has:function(V,L){return typeof V=="string"?L.toLowerCase().indexOf(V.toLowerCase())!==-1:!1},lowerize:function(V){return V.toLowerCase()},major:function(V){return typeof V===w?V.replace(/[^\d\.]/g,"").split(".")[0]:c},trim:function(V){return V.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},G={rgx:function(V,L){for(var O=0,I,_,oe,U,re,ie;O<L.length&&!re;){var pe=L[O],ue=L[O+1];for(I=_=0;I<pe.length&&!re;)if(re=pe[I++].exec(V),re)for(oe=0;oe<ue.length;oe++)ie=re[++_],U=ue[oe],typeof U===v&&U.length>0?U.length==2?typeof U[1]==k?this[U[0]]=U[1].call(this,ie):this[U[0]]=U[1]:U.length==3?typeof U[1]===k&&!(U[1].exec&&U[1].test)?this[U[0]]=ie?U[1].call(this,ie,U[2]):c:this[U[0]]=ie?ie.replace(U[1],U[2]):c:U.length==4&&(this[U[0]]=ie?U[3].call(this,ie.replace(U[1],U[2])):c):this[U]=ie||c;O+=2}},str:function(V,L){for(var O in L)if(typeof L[O]===v&&L[O].length>0){for(var I=0;I<L[O].length;I++)if(q.has(L[O][I],V))return O===y?c:O}else if(q.has(L[O],V))return O===y?c:O;return V}},Z={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},N={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[g,S],[/(opios)[\/\s]+([\w\.]+)/i],[[g,"Opera Mini"],S],[/\s(opr)\/([\w\.]+)/i],[[g,"Opera"],S],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark)\/([\w\.-]+)/i],[g,S],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[g,"IE"],S],[/(edge|edgios|edgea)\/((\d+)?[\w\.]+)/i],[[g,"Edge"],S],[/(yabrowser)\/([\w\.]+)/i],[[g,"Yandex"],S],[/(puffin)\/([\w\.]+)/i],[[g,"Puffin"],S],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[g,"UCBrowser"],S],[/(comodo_dragon)\/([\w\.]+)/i],[[g,/_/g," "],S],[/(micromessenger)\/([\w\.]+)/i],[[g,"WeChat"],S],[/(qqbrowserlite)\/([\w\.]+)/i],[g,S],[/(QQ)\/([\d\.]+)/i],[g,S],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[g,S],[/(BIDUBrowser)[\/\s]?([\w\.]+)/i],[g,S],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[g,S],[/(MetaSr)[\/\s]?([\w\.]+)/i],[g],[/(LBBROWSER)/i],[g],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[S,[g,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[S,[g,"Facebook"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[S,[g,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[g,/(.+)/,"$1 WebView"],S],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[g,/(.+(?:g|us))(.+)/,"$1 $2"],S],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[S,[g,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[g,S],[/(dolfin)\/([\w\.]+)/i],[[g,"Dolphin"],S],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[g,"Chrome"],S],[/(coast)\/([\w\.]+)/i],[[g,"Opera Coast"],S],[/fxios\/([\w\.-]+)/i],[S,[g,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[S,[g,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[S,g],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[g,"GSA"],S],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[g,[S,G.str,Z.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[g,S],[/(navigator|netscape)\/([\w\.-]+)/i],[[g,"Netscape"],S],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[g,S]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[T,"amd64"]],[/(ia32(?=;))/i],[[T,q.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[T,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[T,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[T,/ower/,"",q.lowerize]],[/(sun4\w)[;\)]/i],[[T,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[T,q.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[u,E,[b,A]],[/applecoremedia\/[\w\.]+ \((ipad)/],[u,[E,"Apple"],[b,A]],[/(apple\s{0,1}tv)/i],[[u,"Apple TV"],[E,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[E,u,[b,A]],[/(kf[A-z]+)\sbuild\/.+silk\//i],[u,[E,"Amazon"],[b,A]],[/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i],[[u,G.str,Z.device.amazon.model],[E,"Amazon"],[b,P]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[u,E,[b,P]],[/\((ip[honed|\s\w*]+);/i],[u,[E,"Apple"],[b,P]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[E,u,[b,P]],[/\(bb10;\s(\w+)/i],[u,[E,"BlackBerry"],[b,P]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[u,[E,"Asus"],[b,A]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[E,"Sony"],[u,"Xperia Tablet"],[b,A]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[u,[E,"Sony"],[b,P]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[E,u,[b,M]],[/android.+;\s(shield)\sbuild/i],[u,[E,"Nvidia"],[b,M]],[/(playstation\s[34portablevi]+)/i],[u,[E,"Sony"],[b,M]],[/(sprint\s(\w+))/i],[[E,G.str,Z.device.sprint.vendor],[u,G.str,Z.device.sprint.model],[b,P]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[E,u,[b,A]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[E,[u,/_/g," "],[b,P]],[/(nexus\s9)/i],[u,[E,"HTC"],[b,A]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[u,[E,"Huawei"],[b,P]],[/(microsoft);\s(lumia[\s\w]+)/i],[E,u,[b,P]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[u,[E,"Microsoft"],[b,M]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[E,"Microsoft"],[b,P]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[u,[E,"Motorola"],[b,P]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[u,[E,"Motorola"],[b,A]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[E,q.trim],[u,q.trim],[b,H]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[E,"Samsung"],[b,H]],[/\(dtv[\);].+(aquos)/i],[u,[E,"Sharp"],[b,H]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[E,"Samsung"],u,[b,A]],[/smart-tv.+(samsung)/i],[E,[b,H],u],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[E,"Samsung"],u,[b,P]],[/sie-(\w*)/i],[u,[E,"Siemens"],[b,P]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[E,"Nokia"],u,[b,P]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[u,[E,"Acer"],[b,A]],[/android.+([vl]k\-?\d{3})\s+build/i],[u,[E,"LG"],[b,A]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[E,"LG"],u,[b,A]],[/(lg) netcast\.tv/i],[E,u,[b,H]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[u,[E,"LG"],[b,P]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[u,[E,"Lenovo"],[b,A]],[/linux;.+((jolla));/i],[E,u,[b,P]],[/((pebble))app\/[\d\.]+\s/i],[E,u,[b,J]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[E,u,[b,P]],[/crkey/i],[[u,"Chromecast"],[E,"Google"]],[/android.+;\s(glass)\s\d/i],[u,[E,"Google"],[b,J]],[/android.+;\s(pixel c)\s/i],[u,[E,"Google"],[b,A]],[/android.+;\s(pixel xl|pixel)\s/i],[u,[E,"Google"],[b,P]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[u,/_/g," "],[E,"Xiaomi"],[b,P]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[u,/_/g," "],[E,"Xiaomi"],[b,A]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[u,[E,"Meizu"],[b,A]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})\s+build/i],[u,[E,"OnePlus"],[b,P]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[u,[E,"RCA"],[b,A]],[/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i],[u,[E,"Dell"],[b,A]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[u,[E,"Verizon"],[b,A]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[E,"Barnes & Noble"],u,[b,A]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[u,[E,"NuVision"],[b,A]],[/android.+;\s(k88)\sbuild/i],[u,[E,"ZTE"],[b,A]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[u,[E,"Swiss"],[b,P]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[u,[E,"Swiss"],[b,A]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[u,[E,"Zeki"],[b,A]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[E,"Dragon Touch"],u,[b,A]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[u,[E,"Insignia"],[b,A]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[u,[E,"NextBook"],[b,A]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[E,"Voice"],u,[b,P]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[E,"LvTel"],u,[b,P]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[u,[E,"Envizen"],[b,A]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[E,u,[b,A]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[u,[E,"MachSpeed"],[b,A]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[E,u,[b,A]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[u,[E,"Rotor"],[b,A]],[/android.+(KS(.+))\s+build/i],[u,[E,"Amazon"],[b,A]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[E,u,[b,A]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[b,q.lowerize],E,u],[/(android[\w\.\s\-]{0,9});.+build/i],[u,[E,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[S,[g,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[g,S],[/rv\:([\w\.]{1,9}).+(gecko)/i],[S,g]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[g,S],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[g,[S,G.str,Z.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[g,"Windows"],[S,G.str,Z.os.windows.version]],[/\((bb)(10);/i],[[g,"BlackBerry"],S],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]*)/i,/linux;.+(sailfish);/i],[g,S],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[g,"Symbian"],S],[/\((series40);/i],[g],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[g,"Firefox OS"],S],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[g,S],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[g,"Chromium OS"],S],[/(sunos)\s?([\w\.\d]*)/i],[[g,"Solaris"],S],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[g,S],[/(haiku)\s(\w+)/i],[g,S],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[S,/_/g,"."],[g,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[g,"Mac OS"],[S,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]*)/i],[g,S]]},Y=function(V,L){if(typeof V=="object"&&(L=V,V=c),!(this instanceof Y))return new Y(V,L).getResult();var O=V||(h&&h.navigator&&h.navigator.userAgent?h.navigator.userAgent:m),I=L?q.extend(N,L):N;return this.getBrowser=function(){var _={name:c,version:c};return G.rgx.call(_,O,I.browser),_.major=q.major(_.version),_},this.getCPU=function(){var _={architecture:c};return G.rgx.call(_,O,I.cpu),_},this.getDevice=function(){var _={vendor:c,model:c,type:c};return G.rgx.call(_,O,I.device),_},this.getEngine=function(){var _={name:c,version:c};return G.rgx.call(_,O,I.engine),_},this.getOS=function(){var _={name:c,version:c};return G.rgx.call(_,O,I.os),_},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return O},this.setUA=function(_){return O=_,this},this};Y.VERSION=r,Y.BROWSER={NAME:g,MAJOR:p,VERSION:S},Y.CPU={ARCHITECTURE:T},Y.DEVICE={MODEL:u,VENDOR:E,TYPE:b,CONSOLE:M,MOBILE:P,SMARTTV:H,TABLET:A,WEARABLE:J,EMBEDDED:ee},Y.ENGINE={NAME:g,VERSION:S},Y.OS={NAME:g,VERSION:S},typeof t!==D?(typeof e!==D&&e.exports&&(t=e.exports=Y),t.UAParser=Y):n(3)?(o=(function(){return Y}).call(t,n,t,e),o!==c&&(e.exports=o)):h&&(h.UAParser=Y);var ce=h&&(h.jQuery||h.Zepto);if(typeof ce!==D){var de=new Y;ce.ua=de.getResult(),ce.ua.get=function(){return de.getUA()},ce.ua.set=function(V){de.setUA(V);var L=de.getResult();for(var O in L)ce.ua[O]=L[O]}}})(typeof window=="object"?window:this)},function(e,t){(function(n){e.exports=n}).call(t,{})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(g){for(var b=1;b<arguments.length;b++){var E=arguments[b];for(var S in E)Object.prototype.hasOwnProperty.call(E,S)&&(g[S]=E[S])}return g},h=n(0),c=h.DEVICE_TYPES,r=h.defaultData,m=function(g){switch(g){case c.MOBILE:return{isMobile:!0};case c.TABLET:return{isTablet:!0};case c.SMART_TV:return{isSmartTV:!0};case c.CONSOLE:return{isConsole:!0};case c.WEARABLE:return{isWearable:!0};case c.BROWSER:return{isBrowser:!0};default:return r}},y=function(g,b,E,S,T){return{isBrowser:g,browserMajorVersion:b.major,browserFullVersion:b.version,browserName:b.name,engineName:E.name||!1,engineVersion:E.version,osName:S.name,osVersion:S.version,userAgent:T}},k=function(g,b,E,S){return o({},g,{vendor:b.vendor,model:b.model,os:E.name,osVersion:E.version,ua:S})},D=function(g,b,E,S){return{isSmartTV:g,engineName:b.name,engineVersion:b.version,osName:E.name,osVersion:E.version,userAgent:S}},v=function(g,b,E,S){return{isConsole:g,engineName:b.name,engineVersion:b.version,osName:E.name,osVersion:E.version,userAgent:S}},w=function(g,b,E,S){return{isWearable:g,engineName:b.name,engineVersion:b.version,osName:E.name,osVersion:E.version,userAgent:S}},p=t.getNavigatorInstance=function(){return typeof window<"u"&&(window.navigator||navigator)?window.navigator||navigator:!1},u=t.isIOS13Check=function(g){var b=p();return b&&b.platform&&(b.platform.indexOf(g)!==-1||b.platform==="MacIntel"&&b.maxTouchPoints>1&&!window.MSStream)};e.exports={checkType:m,broPayload:y,mobilePayload:k,stvPayload:D,consolePayload:v,wearPayload:w,getNavigatorInstance:p,isIOS13Check:u}}])}(Ci)),Ci.exports}var te=ra();const la=on(te);function ha(s){return new oa(s)}class ca{constructor(e,t){d(this,"video"),d(this,"onFrame"),d(this,"croppingRegion"),d(this,"width",1920),d(this,"height",1080),d(this,"_deviceId"),d(this,"callback"),d(this,"callbackFrameRate",30),d(this,"animationId"),d(this,"handleIOS17Bug",!0),d(this,"handleIOS17ObjectFitBug",!0),d(this,"preferredCamera"),d(this,"objectFit","cover"),d(this,"lastFrameTime"),d(this,"videoFrameCapturer"),this.video=e,this.onFrame=t.onFrame,t.width&&(this.width=t.width),t.height&&(this.height=t.height),t.croppingRegion&&(this.croppingRegion=t.croppingRegion),t.deviceId&&(this._deviceId=t.deviceId),t.callbackFrameRate&&(this.callbackFrameRate=t.callbackFrameRate),t.handleIOS17Bug!==void 0&&(this.handleIOS17Bug=t.handleIOS17Bug),t.preferredCamera!==void 0&&(this.preferredCamera=t.preferredCamera),this.handleIOS17Bug&&this.preferredCamera==null&&(this.preferredCamera="Front Camera"),t.handleIOS17ObjectFitBug!==void 0&&(this.handleIOS17ObjectFitBug=t.handleIOS17ObjectFitBug),getComputedStyle(this.video).objectFit!=="cover"&&(console.warn("[Camera] Forcing the object-fit to 'cover'."),this.video.style.setProperty("object-fit",this.objectFit,"important")),this.callback=n=>{if(this.animationId=requestAnimationFrame(this.callback),this.callbackFrameRate>0&&this.lastFrameTime!==void 0&&n-this.lastFrameTime<1e3/(this.callbackFrameRate*1.1)||(this.lastFrameTime=n,!this.video.srcObject||!this.videoFrameCapturer||!this.video.videoWidth||!this.video.videoHeight||!this.onFrame))return;const o=this.croppingRegion??{x:0,y:0,width:this.video.videoWidth,height:this.video.videoHeight},h=this.videoFrameCapturer.captureFrame(o,n);this.onFrame(h)}}set deviceId(e){this._deviceId!==e&&(this._deviceId=e,console.log(`[Camera] setting device id: ${this._deviceId}`),this.initInputDevice())}async initInputDevice(){var e={ideal:"user"};(this.deviceId||this.preferredCamera)&&(e=void 0);const t=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:this.width},height:{ideal:this.height},frameRate:{ideal:60},deviceId:this.deviceId,facingMode:e}});if(this.video.srcObject=t,console.log("[Camera] Assigned video source."),t.getVideoTracks().length>0&&t.getVideoTracks()[0].getSettings().deviceId){const[n]=t.getVideoTracks(),o=n.getSettings();if(console.log("[Camera] Device settings: ",o),this._deviceId=o.deviceId,o.frameRate!==void 0){const h=o.frameRate;this.callbackFrameRate=Math.min(h,this.callbackFrameRate??h),console.log(`[Camera] Callback frame rate set to ${this.callbackFrameRate} fps`)}}}get deviceId(){return this._deviceId}async start(){if(this.handleIOS17Bug&&(console.log("[Camera] Handling iOS 17 bug..."),this.video.style.opacity="0"),this.handleIOS17ObjectFitBug){console.log("[Camera] Handling iOS 17.2 object-fit bug...");const t=getComputedStyle(this.video).objectFit;t&&t!==""&&(this.video.style.objectFit="none")}const e=!this.deviceId||this.deviceId==="";await this.initInputDevice(),this.preferredCamera&&e&&await this.selectPreferredCamera(),this.handleIOS17Bug&&setTimeout(()=>{console.log("[Camera] iOS 17 bug handled"),this.video.style.opacity="1"},1500),this.handleIOS17ObjectFitBug&&setTimeout(()=>{console.log("[Camera] iOS 17.2 object-fit bug handled"),this.video.style.objectFit=this.objectFit},500),this.video.onplaying=async()=>{this.videoFrameCapturer=ha(this.video),await this.videoFrameCapturer.start(),this.callback(performance.now())}}async selectPreferredCamera(e=10){const t=async()=>{console.log("[Camera] Enumerating devices...");let h=await navigator.mediaDevices.enumerateDevices();return console.log(`[Camera] ${h.length} devices found`),h=h.filter(c=>c.kind==="videoinput"),console.log(`[Camera] ${h.length} camera devices found`),this.preferredCamera&&(h=h.filter(c=>c.label===this.preferredCamera),console.log(`[Camera] ${h.length} preferred devices found`)),h.length>0?(this.deviceId=h[0].deviceId,!0):!1};let n=0,o=!1;do{try{console.log(`[Camera] Trying to set preferred camera "${this.preferredCamera}"...`);const h=new Promise(c=>setTimeout(c,e*1e3)).then(()=>!1);o=await Promise.race([t(),h])}catch(h){o=!1,console.log(h)}if(o){console.log(`[Camera] Successfully selected preferred camera "${this.preferredCamera}"`);break}console.log(`[Camera] No camera found. Retry after ${500/1e3} second.`),await new Promise(h=>setTimeout(h,500)),n+=500}while(!o&&n<e*1e3)}async stop(){return this.videoFrameCapturer&&(await this.videoFrameCapturer.stop(),this.videoFrameCapturer=void 0),this.video&&this.video.srcObject&&(this.video.srcObject.getVideoTracks().forEach(e=>{e.enabled=!1,e.stop()}),this.video.srcObject=null),this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=void 0),this.waitUntilStopped().then(()=>{})}async waitUntilStopped(e){return new Promise(t=>{let n=0,o=100;const h=setInterval(()=>{n+=o;try{this.video.srcObject.getVideoTracks(),e&&n>=e&&(clearInterval(h),t(!1))}catch{clearInterval(h),t(!0)}},o)})}}class Mi{constructor(e){d(this,"name","noname"),d(this,"frameCount",0),d(this,"start"),d(this,"resetInterval",10),d(this,"frameTimes",[]),d(this,"lastFrameTime",0),this.name=e}reset(){this.frameCount=0,this.start=new Date}tick(){const e=Date.now();if((this.start===void 0||this.elapsed>this.resetInterval)&&(this.log(!1),this.reset()),this.lastFrameTime>0){const t=(e-this.lastFrameTime)/1e3;this.frameTimes.push(t),this.frameTimes.length>60&&this.frameTimes.shift()}this.lastFrameTime=e,this.frameCount=this.frameCount+1}get elapsed(){return this.start===void 0?0:(new Date().getTime()-this.start.getTime())/1e3}get average(){return this.frameTimes.length===0?0:1/(this.frameTimes.reduce((e,t)=>e+t)/this.frameTimes.length)}get current(){return this.average.toFixed(2)}log(e=!1){e&&console.log(`[FPS ${this.name}] ${this.current}fps`)}}function da(s){let e=document.createElement("canvas");return e.width=s.videoWidth,e.height=s.videoHeight,e.getContext("2d").drawImage(s,0,0),e}function ua(s){if(s instanceof HTMLCanvasElement)return s;let e=document.createElement("canvas");return e.width=s.width,e.height=s.width,e.getContext("2d").drawImage(s,0,0),e}function Pi(s){let e;return s.image instanceof HTMLVideoElement?e=da(s.image):s.image instanceof HTMLImageElement?e=ua(s.image):e=s.image,e}async function ko(){const s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAEYklEQVR4Xu3UAQkAAAwCwdm/9HI83BLIOdw5AgQIRAQWySkmAQIEzmB5AgIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw";return new Promise(e=>{const t=document.createElement("img");t.src=s,t.onload=()=>e(t)})}async function So(){const s=new ImageData(1,1);return s.data[0]=255,s.data[1]=255,s.data[2]=255,s.data[3]=255,s}async function ga(s){return new Promise(e=>setTimeout(e,s))}function Do(s){let e=1,t=1,n=0,o=0;return s.forEach(h=>{e=Math.min(h.x,e),t=Math.min(h.y,t),n=Math.max(h.x,n),o=Math.max(h.y,o)}),{xCenter:e+(n-e)/2,yCenter:t+(o-t)/2,width:n-e,height:o-t}}const yt=class Oe{constructor(e){d(this,"createDetector"),d(this,"maxFps",30),this.createDetector=e}async getFaceDetector(){return Oe.faceDetector==null&&(Oe.faceDetector=this.createDetector()),Oe.faceDetector}get lastSendTime(){return Oe.lastSendTime}set lastSendTime(e){Oe.lastSendTime=e}get modelState(){return Oe.modelState}set modelState(e){Oe.modelState=e}async loadModels(e){if(this.modelState!=="loaded"){if(this.modelState===void 0){this.modelState="loading";try{await(await this.getFaceDetector()).loadModels(e)}catch(t){throw this.modelState=void 0,t}console.log("[FaceDetectorProxy] model loaded."),this.modelState="loaded";return}do await ga(500);while(this.modelState!=="loading")}}timeout(e){return new Promise((t,n)=>setTimeout(n,e))}async detect(e){if(this.modelState!=="loaded"){console.log("[FaceDetectorProxy] model not ready");const h=Pi(e);return{faceBox:void 0,landmarks:[],videoFrame:h}}const t=1e3/this.maxFps,n=new Date;if(this.lastSendTime===void 0||n.getTime()-this.lastSendTime.getTime()>t)return this.lastSendTime=n,Promise.race([this.timeout(1e3),(await this.getFaceDetector()).detect(e)]);const o=Pi(e);return{faceBox:void 0,landmarks:[],videoFrame:o}}};d(yt,"faceDetector"),d(yt,"modelState"),d(yt,"lastSendTime");let Ue=yt;const fa=(()=>{const s={loadModelsFromRoot:!1};return typeof window<"u"?(window.__vital_sign_camera_global_options__===void 0&&(window.__vital_sign_camera_global_options__=s),window.__vital_sign_camera_global_options__):typeof self<"u"?(self.__vital_sign_camera_global_options__===void 0&&(self.__vital_sign_camera_global_options__=s),self.__vital_sign_camera_global_options__):s})();function ma(s){return s.startsWith("http")||s.startsWith("/")||!fa.loadModelsFromRoot?s:`/${s}`}async function Dt(){return new Promise((s,e)=>{if(typeof FaceMeshUMD<"u"){s(FaceMeshUMD);return}const t=ma("assets/facemesh.umd.cjs");if(document.querySelector(`script[src="${t}"]`)){s(FaceMeshUMD);return}const n=document.createElement("script");n.src=t,document.head.appendChild(n),n.addEventListener("load",()=>{console.log("[VitalSignCamera] Imported FaceMeshUMD"),s(FaceMeshUMD)}),n.addEventListener("error",o=>{console.error("[VitalSignCamera] Failed to import FaceMeshUMD",o),e(o)})})}async function Ai(s){switch(console.log(`[VitalSignCamera] Creating face detector of type ${s}...`),s){case he.MediaPipe:const{MediaPipeFaceDetector:e}=await Ie(async()=>{const{MediaPipeFaceDetector:y}=await import("./Brr1gpSt-2VdVcADs.js");return{MediaPipeFaceDetector:y}},[]);return new Ue(()=>new e);case he.OpenCV:const{OpenCVFaceDetector:t}=await Ie(async()=>{const{OpenCVFaceDetector:y}=await import("./CSUGaeuC-CDcDjEYn.js");return{OpenCVFaceDetector:y}},__vite__mapDeps([0,1]));return new Ue(()=>new t);case he.Dummy:const{DummyFaceDetector:n}=await Ie(async()=>{const{DummyFaceDetector:y}=await import("./BM-SCt0I-E0-jNt2w.js");return{DummyFaceDetector:y}},[]);return new n;case he.TFMediaPipe:const{TFMediaPipeFaceDetector:o}=await Ie(async()=>{const{TFMediaPipeFaceDetector:y}=await import("./Dw9s1-BC-Dec3WeYE.js");return{TFMediaPipeFaceDetector:y}},__vite__mapDeps([2,1]));return new Ue(()=>new o);case he.FaceApi:const{FaceApiFaceDetector:h}=await Ie(async()=>{const{FaceApiFaceDetector:y}=await import("./sogQrOT1-qb_Yr_j8.js");return{FaceApiFaceDetector:y}},__vite__mapDeps([3,4]));return new h;case he.MPFaceMesh:const{MPVisionFaceMeshDetector:c}=await Ie(async()=>{const{MPVisionFaceMeshDetector:y}=await import("./CAb34dWC-C3AksZ3j.js");return{MPVisionFaceMeshDetector:y}},__vite__mapDeps([5,6]));return new Ue(()=>new c);case he.MPFaceDetector:const{MPVisionFaceDetector:r}=await Ie(async()=>{const{MPVisionFaceDetector:y}=await import("./DAnk5QpJ-Bf6lb9Xb.js");return{MPVisionFaceDetector:y}},__vite__mapDeps([7,6]));return new Ue(()=>new r);case he.MPFaceMeshThreaded:const{MPVisionFaceMeshDetectorThread:m}=await Dt();return new Ue(()=>new m)}}function pa(s){var e;const t=(e=s.srcObject)==null?void 0:e.getVideoTracks()[0];if(t.getCapabilities!==void 0){const n=t.getCapabilities().facingMode;return n&&n[0]}else return t.getSettings().facingMode}function va(s){const e=pa(s);return e&&e==="environment"?"none":"scaleX(-1)"}function Xi(s){const{image:e,facebox:t}=s;let n=t.width*e.width,o=t.height*e.height,h=(t.xCenter-t.width/2)*e.width,c=(t.yCenter-t.height/2)*e.height;o=o*.7;const r=new OffscreenCanvas(e.width,e.height),m=r.getContext("2d");m==null||m.putImageData(e,0,0);const y=new OffscreenCanvas(n,o),k=y.getContext("2d");k.drawImage(r,h,c,n,o,0,0,n,o);let D=k.getImageData(0,0,y.width,y.height).data,v=0,w=0;for(let p=0;p<D.length;p+=4)v+=Math.max(D[p],D[p+1],D[p+2]),w++;return v/w}self.onmessage=s=>{const{inputData:e,hash:t}=s.data,n=Xi(e);self.postMessage({result:n,hash:t})};const wa=90,ya=[.3,.9],ba=[.4,.6],xa=[.3,.7],Fi=.1,ka=30,Sa=te.isMobile&&!te.isTablet,Da=10,Ii=Sa||te.isAndroid?Da:15;function He(s){return Array.isArray(s)?s:[s.min,s.max]}class Ea{constructor(e,t){d(this,"MOVEMENT_ARRAY",[]),d(this,"_conditions"),d(this,"vitalSignEngine"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/DaF7aLs5-Blck71Yz.js",import.meta.url),{type:"module"})),d(this,"workerPool",ve(this.workerFactory,Xi,"CheckBrightness")),d(this,"minimumFrameRate",Ii),d(this,"minimumBrightness",wa),d(this,"validXRange",ba),d(this,"validYRange",xa),d(this,"validDistanceRange",ya),this.vitalSignEngine=e,(t==null?void 0:t.boundaryRangeX)!==void 0&&(this.validXRange=He(t.boundaryRangeX)),(t==null?void 0:t.boundaryRangeY)!==void 0&&(this.validYRange=He(t.boundaryRangeY)),(t==null?void 0:t.distanceRange)!==void 0&&(this.validDistanceRange=He(t.distanceRange))}configure(e){(e==null?void 0:e.minimumFrameRate)!==void 0&&(this.minimumFrameRate=e.minimumFrameRate),(e==null?void 0:e.validDistanceRange)!==void 0&&(this.validDistanceRange=He(e.validDistanceRange)),(e==null?void 0:e.validXRange)!==void 0&&(this.validXRange=He(e.validXRange)),(e==null?void 0:e.validYRange)!==void 0&&(this.validYRange=He(e.validYRange))}get conditions(){return this._conditions}resetMovementArray(){this.MOVEMENT_ARRAY=[]}reset(){this.resetMovementArray(),this._conditions=void 0}async getBrightness(e,t){var n;const o=(n=e.getContext("2d",{willReadFrequently:!0}))==null?void 0:n.getImageData(0,0,e.width,e.height);return o?await this.workerPool.callWorker({image:o,facebox:t}):0}checkDistance(e){let t=this.validDistanceRange;return e.height>t[1]?$e.TooClose:e.height<t[0]?$e.TooFar:$e.OK}checkFacePosition(e){if(e===void 0)return xe.Unknown;let t=this.validXRange,n=this.validYRange,o=xe.Centered;return e.yCenter<n[0]&&(o=xe.TooHigh),e.yCenter>n[1]&&(o=xe.TooLow),e.xCenter<t[0]&&(o=xe.TooRight),e.xCenter>t[1]&&(o=xe.TooLeft),o}async checkCondition(e,t,n){let o=!0;if(e!==void 0){let k=t?await this.getBrightness(e,t):0;o=this.minimumBrightness<=k}const h=t?this.checkDistance(t):$e.TooFar,c=this.checkFacePosition(t);let r=!1;if(this.MOVEMENT_ARRAY.length>=ka){this.MOVEMENT_ARRAY.shift();let k=0,D=0,v=1,w=1;for(let g=0;g<this.MOVEMENT_ARRAY.length;g++)k=this.MOVEMENT_ARRAY[g][0]>k?this.MOVEMENT_ARRAY[g][0]:k,D=this.MOVEMENT_ARRAY[g][1]>D?this.MOVEMENT_ARRAY[g][1]:D,v=this.MOVEMENT_ARRAY[g][0]<v?this.MOVEMENT_ARRAY[g][0]:v,w=this.MOVEMENT_ARRAY[g][1]<w?this.MOVEMENT_ARRAY[g][1]:w;const p=k.valueOf()-v.valueOf(),u=D.valueOf()-w.valueOf();r=p<=Fi&&u<=Fi}t&&this.MOVEMENT_ARRAY.push([t.xCenter,t.yCenter]);let m=await this.vitalSignEngine.isReady();const y=n>=this.minimumFrameRate;return{lighting:o,distance:h===$e.OK,centered:c===xe.Centered,movement:r,serverReady:m,frameRate:y,distanceCondition:h,facePositionCondition:c,fps:n}}async processFrame(e,t,n,o,h){h==="measuring"&&(o=Math.max(Ii,o)),this._conditions=await this.checkCondition(n?e:void 0,t,o)}}function Ra(s,e,t){const n=new Ea(s,t||void 0);return n.configure(e),n}async function Ca(){try{let s=await navigator.mediaDevices.enumerateDevices();return s=s.filter(e=>e.kind==="videoinput"),s.map((e,t)=>({label:e.label,id:e.deviceId,deviceIndex:t}))}catch{return[]}}function Ta(s,e){if(s.length!=e.length)return!1;for(let t=0;t<s.length;t++)if(s[t].id!==e[t].id||s[t].label!==e[t].label)return!1;return!0}class Ma{constructor(e,t){d(this,"camera"),d(this,"devices",[]),d(this,"timer"),d(this,"selectedDevice"),d(this,"onChanged"),this.camera=e,this.onChanged=t}start(){this.timer===void 0&&(this.timer=setInterval(async()=>{const e=await Ca();(!Ta(e,this.devices)||this.camera.device!==this.selectedDevice)&&(this.devices=e,this.selectedDevice=this.camera.device,this.onChanged&&this.onChanged(this.devices))},1e3))}}async function Pa(s){const{DefaultAgeEstimator:e}=await Ie(async()=>{const{DefaultAgeEstimator:t}=await import("./DDvcQKT4-BQDg0Lp3.js");return{DefaultAgeEstimator:t}},__vite__mapDeps([8,4]));return new Promise(t=>{const n=new e(s,()=>{t(n)})})}class Aa{constructor(e,t={}){d(this,"canvas"),d(this,"ctx"),d(this,"config"),d(this,"ecgPhase",0),d(this,"tracePoints",[]),d(this,"tracePosition",0),d(this,"ecgAnimationStopped",!1),this.config={width:t.width||600,height:t.height||200,maxPoints:t.maxPoints||300,lineColor:t.lineColor||"#00ff00",backgroundColor:t.backgroundColor||"#000000",gridColor:t.gridColor||"#333333",visualizationType:t.visualizationType||"PPG",debug:t.debug||!1,...t},this.canvas=document.createElement("canvas"),this.canvas.width=this.config.width,this.canvas.height=this.config.height,this.canvas.style.border="1px solid #333",this.canvas.style.backgroundColor=this.config.backgroundColor,this.canvas.style.display="block",this.canvas.style.width=`${this.config.width}px`,this.canvas.style.height=`${this.config.height}px`,e.appendChild(this.canvas),this.log("Canvas created and appended");const n=this.canvas.getContext("2d");if(!n)throw new Error("Could not get 2D context from canvas");this.ctx=n,this.clear()}log(e,...t){this.config.debug&&console.log(`[Signal Visualizer] ${e}`,...t)}updateSignal(e,t,n){var o;if(this.log("updateSignal:",{hasData:!!e,valuesLength:((o=e==null?void 0:e.values)==null?void 0:o.length)||0,sampleRate:e==null?void 0:e.sampleRate,visualizationType:this.config.visualizationType,heartRate:t==null?void 0:t.heartRate}),this.ctx.clearRect(0,0,this.config.width,this.config.height),this.ctx.fillStyle=this.config.backgroundColor,this.ctx.fillRect(0,0,this.config.width,this.config.height),this.config.visualizationType==="ECG"){if(n===j.Idle||!t){this.stopECGAnimation(),this.drawNoSignal();return}this.ecgAnimationStopped=!1,this.drawECGSignal(t)}else{if(!e||e.values.length===0){this.drawNoSignal();return}this.drawGrid(),this.drawSignalArray(e.values,e.sampleRate),this.drawInfo(e)}}clear(){this.ctx.save(),this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over",this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.clearRect(0,0,this.config.width,this.config.height),this.ctx.fillStyle=this.config.backgroundColor,this.ctx.fillRect(0,0,this.config.width,this.config.height),this.ctx.restore()}stopECGAnimation(){this.ecgAnimationStopped=!0,this.tracePoints=[],this.tracePosition=0,this.ecgPhase=0,this.log("ECG animation stopped")}drawNoSignal(){this.ctx.fillStyle="#666666",this.ctx.font="16px monospace",this.ctx.textAlign="center",this.ctx.fillText("No Signal Data",this.config.width/2,this.config.height/2)}drawGrid(){this.ctx.save(),this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over",this.ctx.strokeStyle=this.config.gridColor,this.ctx.lineWidth=1,this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0;const e=this.config.width/10;for(let n=0;n<=this.config.width;n+=e)this.ctx.beginPath(),this.ctx.moveTo(n,0),this.ctx.lineTo(n,this.config.height),this.ctx.stroke();const t=this.config.height/5;for(let n=0;n<=this.config.height;n+=t)this.ctx.beginPath(),this.ctx.moveTo(0,n),this.ctx.lineTo(this.config.width,n),this.ctx.stroke();this.ctx.restore()}drawECGSignal(e){if(this.ecgAnimationStopped){this.drawNoSignal();return}this.drawGrid();const t=(e==null?void 0:e.heartRate)||72,n=60/t*1e3,o=60/t*30,h=n/o;this.ecgPhase=(this.ecgPhase+h)%n;const c=this.ecgPhase/n,r=(this.generateECGWaveform(c,t)+1)*(this.config.height*.3)+this.config.height*.2;for(this.tracePoints.push({x:this.tracePosition,y:r}),this.tracePosition+=2;this.tracePoints.length>0&&this.tracePoints[0].x<-10;)this.tracePoints.shift();this.tracePosition>this.config.width+10&&(this.tracePosition=0,this.tracePoints=[]),this.drawMovingTrace(),this.drawECGInfo(t)}drawMovingTrace(){if(!(this.tracePoints.length<2)){this.ctx.shadowColor="#ff4444",this.ctx.shadowBlur=8,this.ctx.strokeStyle="#ff6b6b",this.ctx.lineWidth=4,this.ctx.beginPath(),this.ctx.moveTo(this.tracePoints[0].x,this.tracePoints[0].y);for(let e=1;e<this.tracePoints.length;e++)this.ctx.lineTo(this.tracePoints[e].x,this.tracePoints[e].y);this.ctx.stroke(),this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0}}generateECGWaveform(e,t){const n=(Math.random()-.5)*.05,o=Math.max(.08,Math.min(.2,.15*(72/t))),h=.8+(Math.random()-.5)*.3;if(e>=0&&e<=o){const c=e/o;return c<.15?c*(5+Math.random())*h*.7:c<.3?h*(.9+Math.random()*.2):c<.5?(1-(c-.3)/.2)*h*(.8+Math.random()*.4):Math.max(0,1-(c-.5)/.5)*h*(.2+Math.random()*.3)}else return n}drawSignalArray(e,t){const n=Math.min(e.length,this.config.maxPoints);if(n<2)return;const o=Math.min(...e),h=Math.max(...e)-o||1;this.ctx.save(),this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over",this.ctx.strokeStyle=this.config.lineColor,this.ctx.lineWidth=2,this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0,this.ctx.beginPath();const c=this.config.width/(n-1);for(let r=0;r<n;r++){const m=r*c,y=(e[r]-o)/h,k=this.config.height-y*(this.config.height*.8)-this.config.height*.1;r===0?this.ctx.moveTo(m,k):this.ctx.lineTo(m,k)}this.ctx.stroke(),this.ctx.restore()}drawECGInfo(e){this.ctx.fillStyle="#ffffff",this.ctx.font="12px monospace",this.ctx.textAlign="left",["ECG Animation",`Rate: ${e} BPM`,"Visual Demo Only"].forEach((t,n)=>{this.ctx.fillText(t,10,20+n*15)})}drawInfo(e){const{values:t,sampleRate:n}=e;this.ctx.fillStyle="#ffffff",this.ctx.font="12px monospace",this.ctx.textAlign="left",[`Samples: ${t.length}`,`Sample Rate: ${n.toFixed(1)} Hz`,`Duration: ${(t.length/n).toFixed(1)}s`].forEach((o,h)=>{this.ctx.fillText(o,10,20+h*15)})}destroy(){this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}}class Fa{constructor(e){d(this,"config",{earlyEstimation:!1,minDuration:10,minConfidence:.6,debug:!1}),d(this,"estimation_",null),d(this,"signalBuffer",[]),d(this,"timestamps",[]),d(this,"maxBufferSize",300),d(this,"minSamplesForEstimation",30),d(this,"currentPulseRate",0),d(this,"onPulseRateUpdate"),d(this,"heartRateHistory",[]),d(this,"maxHistorySize",10),e&&this.configure(e)}log(e,...t){this.config.debug&&console.log(`[Realtime Estimater] ${e}`,...t)}get estimation(){return this.estimation_}get signalData(){return this.signalBuffer.length===0?null:{values:[...this.signalBuffer],timestamps:[...this.timestamps],sampleRate:this.timestamps.length>1?1e3/((this.timestamps[this.timestamps.length-1]-this.timestamps[0])/(this.timestamps.length-1)):30}}configure(e){e&&(this.config={...this.config,...e})}processFrame(e,t,n,o){if(this.log(`processFrame called, stage=${t}, hasROI=${!!(o!=null&&o.face)}`),t===j.Idle){this.log(`Skipping - idle stage (${t})`);return}if(!o||!o.face){this.log("Skipping - no ROI data");return}this.log(`Processing frame with ROI in stage ${t}`),this.processFrameAsync(e,o.face)}async processFrameAsync(e,t){const n=await this.extractRealPPGSignal(e,t);n!==null?(this.signalBuffer.push(n),this.timestamps.push(Date.now()),this.log(`Added to buffer - intensity: ${n.toFixed(2)}, buffer size: ${this.signalBuffer.length}`),this.signalBuffer.length>this.maxBufferSize&&(this.signalBuffer.shift(),this.timestamps.shift()),this.signalBuffer.length>=this.minSamplesForEstimation?(this.log(`Processing signal - ${this.signalBuffer.length} samples`),this.processSignal()):this.signalBuffer.length>=15&&!this.estimation_?(this.log(`Attempting early guess - ${this.signalBuffer.length} samples`),this.processSignal()):this.log(`Not enough samples yet (${this.signalBuffer.length}/${this.minSamplesForEstimation})`)):this.log("Failed to extract intensity")}async extractRealPPGSignal(e,t){try{this.log("Extracting PPG signal from ROI");const n=await t.imageData;if(!n)return this.log("No imageData available"),null;const o=n.data;this.log(`ImageData length: ${o.length}`);let h=0,c=0;for(let m=0;m<o.length;m+=4)h+=o[m+1],c++;const r=c>0?h/c:null;return this.log(`Extracted intensity: ${r}`),r}catch(n){return console.warn("Failed to extract PPG signal:",n),null}}processSignal(){var e;if(this.signalBuffer.length<this.minSamplesForEstimation){this.log(`Not enough samples (${this.signalBuffer.length}/${this.minSamplesForEstimation})`);return}try{const t=this.bandpassFilter(this.signalBuffer),n=this.calculateAutocorrelation(t);this.log(`Raw signal range: [${Math.min(...this.signalBuffer).toFixed(2)}-${Math.max(...this.signalBuffer).toFixed(2)}]`),this.log(`Filtered signal range: [${Math.min(...t).toFixed(2)}-${Math.max(...t).toFixed(2)}]`),this.log(`Autocorr range: [${Math.min(...n).toFixed(4)}-${Math.max(...n).toFixed(4)}]`);const o=this.findDominantPeak(n);if(this.log(`signalLength=${this.signalBuffer.length}, filteredLength=${t.length}, autocorrLength=${n.length}, peakIndex=${o}`),o>0){const h=1e3/this.getAverageTimeInterval(),c=h/o,r=c*60;this.log(`sampleRate=${h.toFixed(1)}, peakIndex=${o}, frequency=${c.toFixed(2)}, heartRate=${r.toFixed(1)}`);const m=this.signalBuffer.length<90,y=m?150:130;if(r>=(m?50:60)&&r<=y){const k=Math.round(r),D=this.calculateSignalMetrics(t),v=D.confidence,w=v>(this.config.minConfidence||.3)&&this.signalBuffer.length>=this.minSamplesForEstimation&&this.checkHeartRateStability();this.log(`confidence=${(v*100).toFixed(1)}%, snr=${D.snr.toFixed(2)}, signalQuality=${D.signalQuality.toFixed(1)}, isStable=${w}, signalLength=${this.signalBuffer.length}`);const p=1e-4,u=this.signalBuffer.length<90,g=u?1e-4:this.config.minConfidence||.3;if(v>=p){const b=u?this.heartRateHistory.length>=2:this.checkHeartRateStability(),E=v>g&&b;(!this.estimation_||this.estimation_.heartRate!==k||u)&&(this.estimation_={heartRate:k,confidence:v,isStable:E,snr:D.snr,signalQuality:D.signalQuality},this.heartRateHistory.push(k),this.heartRateHistory.length>this.maxHistorySize&&this.heartRateHistory.shift(),this.currentPulseRate=k,(e=this.onPulseRateUpdate)==null||e.call(this,this.currentPulseRate),this.log(`Updated estimation - HR: ${k} BPM, Confidence: ${(v*100).toFixed(1)}%, Early: ${u}`))}else this.signalBuffer.length>=10?this.provideEarlyGuess(t,n):this.log(`Confidence too low (${(v*100).toFixed(1)}%) for display`)}}}catch(t){console.warn("Failed to process PPG signal:",t)}}bandpassFilter(e){const t=[];if(e.length<3)return t;const n=50;for(let c=0;c<e.length;c++){const r=Math.max(0,c-n),m=Math.min(e.length,c+n+1),y=e.slice(r,m),k=y.reduce((v,w)=>v+w,0)/y.length,D=(e[c]-k)*10;t.push(D)}const o=[],h=5;for(let c=0;c<t.length;c++){const r=Math.max(0,c-h),m=Math.min(t.length,c+h+1),y=t.slice(r,m);o.push(y.reduce((k,D)=>k+D,0)/y.length)}return o}calculateAutocorrelation(e){const t=[],n=e.length,o=e.reduce((c,r)=>c+r,0)/n,h=e.reduce((c,r)=>c+Math.pow(r-o,2),0)/n;for(let c=0;c<Math.min(n-1,150);c++){let r=0,m=0;for(let k=0;k<n-c;k++)r+=(e[k]-o)*(e[k+c]-o),m++;const y=m>0?r/(m*h+1e-10):0;t.push(y)}return t}findDominantPeak(e){if(e.length<10)return this.log(`Autocorr too short (${e.length})`),0;const t=1e3/this.getAverageTimeInterval(),n=Math.floor(t/(150/60)),o=Math.floor(t/(50/60));this.log(`sampleRate=${t.toFixed(1)}, minPeriod=${n}, maxPeriod=${o}, autocorrRange=[${n+1}-${Math.min(o,e.length-1)}]`);const h=n+1,c=Math.min(o,e.length-1),r=e.slice(h,c+1);this.log(`Autocorr values [${h}-${c}]:`,r.map((k,D)=>`${h+D}:${k.toFixed(4)}`).join(", "));let m=0,y=0;for(let k=Math.max(5,n);k<Math.min(o,e.length);k++)e[k]>m&&(m=e[k],y=k);return y>0?(this.log(`Found best peak at index ${y}, value=${m.toFixed(4)}`),y):(this.log("No acceptable peaks found"),0)}calculateSignalMetrics(e){if(e.length<10)return{confidence:0,snr:0,signalQuality:0};const t=Math.max(...e)-Math.min(...e),n=e.reduce((w,p)=>w+p,0)/e.length,o=e.reduce((w,p)=>w+Math.pow(p-n,2),0)/e.length,h=Math.sqrt(o),c=Math.min(t/20,1),r=t/(h+.001),m=Math.min(r/5,1),y=Math.max(0,1-h/(t+.001)*2);let k=0;if(e.length>5){const w=e.slice(0,Math.floor(e.length/2)),p=e.slice(Math.floor(e.length/2)),u=Math.max(...w)-Math.min(...w),g=Math.max(...p)-Math.min(...p),b=(u+g)/2;k=1-Math.abs(u-g)/(b+.001)}const D=c*.3+m*.4+y*.2+k*.1,v=c*.4+y*.4+k*.2;return{confidence:Math.max(0,Math.min(1,D)),snr:Math.max(0,r),signalQuality:Math.max(0,Math.min(100,v*100))}}provideEarlyGuess(e,t){var n;const o=1e3/this.getAverageTimeInterval(),h=Math.floor(o/(150/60)),c=Math.floor(o/(50/60));let r=0,m=0;for(let y=Math.max(5,h);y<Math.min(c,t.length);y++)t[y]>r&&(r=t[y],m=y);if(m>0){const y=o/m,k=Math.round(y*60);if(k>=50&&k<=150){const D=this.calculateSignalMetrics(e),v=Math.max(D.confidence*.3,.001);(!this.estimation_||!0)&&(this.estimation_={heartRate:k,confidence:v,isStable:!1,snr:D.snr,signalQuality:D.signalQuality},this.currentPulseRate=k,(n=this.onPulseRateUpdate)==null||n.call(this,this.currentPulseRate),this.log(`Early guess - HR: ${k} BPM, Confidence: ${(v*100).toFixed(1)}% (BEST GUESS)`))}}}checkHeartRateStability(){if(this.heartRateHistory.length<5)return!1;const e=this.heartRateHistory.reduce((n,o)=>n+o,0)/this.heartRateHistory.length,t=this.heartRateHistory.reduce((n,o)=>n+Math.pow(o-e,2),0)/this.heartRateHistory.length;return Math.sqrt(t)<10}updateWithServerResult(e,t,n){var o;this.log(`Updating estimation with server result: ${e} BPM, SNR: ${t}, Signal Quality: ${n}`),this.estimation_={heartRate:Math.round(e),confidence:1,isStable:!0,snr:t,signalQuality:n},this.currentPulseRate=Math.round(e),(o=this.onPulseRateUpdate)==null||o.call(this,this.currentPulseRate)}reset(){this.estimation_=null,this.signalBuffer=[],this.timestamps=[],this.currentPulseRate=0,this.heartRateHistory=[]}getAverageTimeInterval(){if(this.timestamps.length<2)return 33;let e=0;for(let t=1;t<this.timestamps.length;t++)e+=this.timestamps[t]-this.timestamps[t-1];return e/(this.timestamps.length-1)}}async function Ia(s){return new Fa(s)}function _a(s){let e=document.createElement("div"),t=document.createElement("div");return e.appendChild(t),s.after(e),e.style.pointerEvents="none",e}function Ba(s,e,t){const n=e.clientWidth/e.clientHeight,o=t.videoWidth/t.videoHeight;let h,c;o>n?(h=e.clientHeight,c=h*o):(c=e.clientWidth,h=c/o);const r=(h-e.clientHeight)/2,m=(c-e.clientWidth)/2;return{left:(s.xCenter-s.width/2)*c-m,top:(s.yCenter-s.height/2)*h-r,width:s.width*c,height:s.height*h}}class _i{constructor(e,t){d(this,"boundingBox"),d(this,"video"),d(this,"color"),this.video=e,this.color=(t==null?void 0:t.color)||"red",this.enabled=!0}set enabled(e){var t;e&&!this.boundingBox&&(this.boundingBox=_a(this.video)),!e&&this.boundingBox&&((t=this.boundingBox.parentElement)==null||t.removeChild(this.boundingBox),this.boundingBox=void 0)}updateOptions(e){e.color&&e.color!==this.color&&(this.color=e.color)}update(e){if(!this.boundingBox)return;this.boundingBox.style.position="fixed";const{x:t,y:n,width:o,height:h}=this.video.getBoundingClientRect();this.boundingBox.style.left=`${t}px`,this.boundingBox.style.top=`${n}px`,this.boundingBox.style.width=`${o}px`,this.boundingBox.style.height=`${h}px`,this.boundingBox.style.transform=`${this.video.style.transform}`,this.boundingBox.style.overflow="clip";const c=this.boundingBox.children[0];if(e===void 0){c.style.setProperty("display","none");return}const r=Ba(e,this.video,this.video);c.style.display="block",c.style.position="relative",c.style.left=`${r.left}px`,c.style.top=`${r.top}px`,c.style.width=`${r.width}px`,c.style.height=`${r.height}px`,c.style.borderStyle="solid",c.style.borderColor=this.color||"red"}}const Oa=".up-down-mask-animation{mask:linear-gradient(to bottom,transparent,black,transparent);-webkit-mask-size:100% 10%;mask-size:100% 10%;-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;animation:moveMaskUpDown var(--face-mesh-animation-duration, 2s) linear infinite}@keyframes moveMaskUpDown{0%{-webkit-mask-position:0% 0;mask-position:0% 0}50%{-webkit-mask-position:0% 100%;mask-position:0% 100%}to{-webkit-mask-position:0% 0;mask-position:0% 0}}.left-right-mask-animation{mask:linear-gradient(to right,transparent,black,transparent);-webkit-mask-size:10% 100%;mask-size:10% 100%;-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;animation:moveMaskLeftRight var(--face-mesh-animation-duration, 2s) linear infinite}@keyframes moveMaskLeftRight{0%{-webkit-mask-position:0% 0;mask-position:0% 0}50%{-webkit-mask-position:100% 0;mask-position:100% 0}to{-webkit-mask-position:0% 0;mask-position:0% 0}}.four-way-mask-animation{mask:linear-gradient(to bottom,transparent,black,transparent),linear-gradient(to right,transparent,black,transparent);-webkit-mask-size:100% 10%,10% 100%;mask-size:100% 10%,10% 100%;-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-composite:source-over;mask-composite:add;animation:moveMaskFourWay var(--face-mesh-animation-duration, 2s) linear infinite}@keyframes moveMaskFourWay{0%{-webkit-mask-position:0% 0,0% 0;mask-position:0% 0,0% 0}25%{-webkit-mask-position:0% 100%,0% 0;mask-position:0% 100%,0% 0}50%{-webkit-mask-position:0% 0%,0% 0;mask-position:0% 0%,0% 0}75%{-webkit-mask-position:0% 0%,100% 0;mask-position:0% 0%,100% 0}to{-webkit-mask-position:0% 0,0% 0;mask-position:0% 0,0% 0}}";async function $a(){const{FACEMESH_FACE_OVAL:s}=await Dt();return s}async function Va(s,e,t,n){if(e===void 0||t===void 0)return;s.save();const o=s.canvas.width,h=s.canvas.height,c=(n==null?void 0:n.lineWidth)||await La(e,o);for(var r=0;r<t.length;r++){const m=t[r];s.beginPath();const y=e[m[0]],k=e[m[1]];s.moveTo(y.x*o,y.y*h),s.lineTo(k.x*o,k.y*h),s.lineWidth=c,s.strokeStyle=(n==null?void 0:n.color)||"lightgreen",s.stroke()}s.restore()}async function La(s,e){const t=await Ua(s)*.01*e;return console.log("lineWidth = ",t),t}async function Ua(s){const e=(await $a()).map(([t])=>s[t].x);return Math.abs(Math.max(...e)-Math.min(...e))}class Bi{constructor(e,t){d(this,"faceMesh"),d(this,"canvas"),d(this,"video"),d(this,"color","lightgreen"),d(this,"lineWidth"),d(this,"animateStyle"),d(this,"animationSpeed"),d(this,"animationDelay"),d(this,"animationDirection"),this.video=e,this.color=(t==null?void 0:t.color)||this.color,this.lineWidth=(t==null?void 0:t.lineWidth)||this.lineWidth,this.animationSpeed=t==null?void 0:t.animationSpeed,this.animationDelay=t==null?void 0:t.animationDelay,this.animationDirection=t==null?void 0:t.animationDirection,this.enabled=!0,this.animateStyle=document.createElement("style"),this.animateStyle.innerHTML=Oa,this.animate=(t==null?void 0:t.animate)!==void 0?t.animate:!0}destroy(){console.log("[VitalSignCamera] Trying to destroy face mesh..."),this.faceMesh&&this.faceMesh.parentElement&&(this.faceMesh.parentElement.removeChild(this.faceMesh),console.log("[VitalSignCamera] Face mesh removed."),this.faceMesh=void 0,this.canvas=void 0),this.animateStyle.parentElement&&(this.animateStyle.parentElement.removeChild(this.animateStyle),console.log("[VitalSignCamera] Face mesh animation CSS removed."))}get animationClass(){return this.animationDirection==="vertical"?"up-down-mask-animation":this.animationDirection==="horizontal"?"left-right-mask-animation":this.animationDirection=="both"?"four-way-mask-animation":"up-down-mask-animation"}set enabled(e){var t;e&&!this.faceMesh&&(this.faceMesh=document.createElement("div"),this.canvas=document.createElement("canvas"),this.canvas.style.setProperty("--face-mesh-animation-duration",`${this.animationSpeed??8}s`),this.canvas.style.setProperty("--face-mesh-animation-delay",`${this.animationDelay??-1.5}s`),console.log("Applying animation class",this.animationDirection,this.animationSpeed),this.canvas.className=`face-mesh-canvas ${this.animationClass}`,this.faceMesh.appendChild(this.canvas),this.faceMesh.style.width="0px",this.faceMesh.style.height="0px",this.faceMesh.style.pointerEvents="none",this.faceMesh.style.overflow="clip",this.video.after(this.faceMesh),console.log("[VitalSignCamera] Face mesh inserted.")),!e&&this.faceMesh&&((t=this.faceMesh.parentElement)==null||t.removeChild(this.faceMesh),this.faceMesh=void 0,this.canvas=void 0)}set animate(e){var t;e&&!this.animate&&(document.body.append(this.animateStyle),console.log("[VitalSignCamera] Face mesh CSS inserted.")),!e&&this.animate&&((t=this.animateStyle.parentElement)==null||t.removeChild(this.animateStyle))}get animate(){return this.animateStyle.parentElement!==null}get enabled(){return this.faceMesh!==void 0}updateOptions(e){e.color!==void 0&&e.color!==this.color&&(this.color=e.color),e.lineWidth!==void 0&&e.lineWidth!==this.lineWidth&&(this.lineWidth=e.lineWidth),e.animate!==void 0&&e.animate!==this.animate&&(this.animate=e.animate),e.animationSpeed!==void 0&&e.animationSpeed!==this.animationSpeed&&(this.animationSpeed=e.animationSpeed,this.canvas&&this.canvas.style.setProperty("--face-mesh-animation-duration",`${this.animationSpeed}s`)),e.animationDelay!==void 0&&e.animationDelay!==this.animationDelay&&(this.animationDelay=e.animationDelay,this.canvas&&this.canvas.style.setProperty("--face-mesh-animation-delay",`${this.animationDelay}s`)),e.animationDirection!==void 0&&e.animationDirection!==this.animationDirection&&(this.animationDirection=e.animationDirection,this.canvas&&(this.canvas.className=`face-mesh-canvas ${this.animationClass}`))}update(e){if(!this.faceMesh||!this.canvas)return;this.faceMesh.style.position="fixed";const{x:t,y:n,width:o,height:h}=this.video.getBoundingClientRect();this.faceMesh.style.left=`${t}px`,this.faceMesh.style.top=`${n}px`,this.faceMesh.style.width=`${o}px`,this.faceMesh.style.height=`${h}px`,this.faceMesh.style.transform=`${this.video.style.transform}`,this.faceMesh.style.overflow="clip",this.redraw(e);const c=this.computeStyle(this.faceMesh);this.canvas.style.left=c.left,this.canvas.style.top=c.top,this.canvas.style.width=c.width,this.canvas.style.height=c.height,this.canvas.style.aspectRatio=c.aspectRatio,this.canvas.style.position="relative"}async redraw(e){const{FACEMESH_TESSELATION:t}=await Dt();if(!this.faceMesh||!this.canvas){console.warn("Undefined canvas or face mesh");return}this.canvas.width=this.video.videoWidth,this.canvas.height=this.video.videoHeight;const n=this.canvas.getContext("2d");if(n===null){console.warn("Null Context");return}if(n.save(),n.clearRect(0,0,this.canvas.width,this.canvas.height),e!==void 0&&e.length>0){const o=await this.computeLineWidth(e);n.lineTo(this.canvas.width,this.canvas.height),Va(n,e,t,{color:this.color,lineWidth:o})}n.restore()}computeStyle(e){let t=0;const n=this.video.videoHeight,o=this.video.videoWidth;t=o&&n?o/n:0;const h={width:"",height:"",left:"0%",top:"0%",aspectRatio:`${t}`},c=e.clientWidth/e.clientHeight;return c<t?(h.left=`${(c-t)/c/2*100}%`,h.height="100%"):(h.top=`${(1/c-1/t)*c/2*100}%`,h.width="100%"),h}async computeLineWidth(e){const t=this.video.videoWidth,n=this.lineWidth===void 0?"1%":this.lineWidth,o=await Ha(e);var h;return typeof n=="string"?h=parseFloat(n)*.01*o*t:h=n,h}}async function Ha(s){const{FACEMESH_FACE_OVAL:e}=await Dt(),t=e.map(([n])=>s[n].x);return Math.abs(Math.max(...t)-Math.min(...t))}async function Na(s){const{RemoteBeautyAnalyzer:e}=await Ie(async()=>{const{RemoteBeautyAnalyzer:t}=await import("./CJQyNowQ-poQLYw9-.js");return{RemoteBeautyAnalyzer:t}},[]);return new e(s)}function Xt(s){var e;const{videoFrame:t,rect:n}=s,{x:o,y:h,w:c,h:r}=n,m=new OffscreenCanvas(t.width,t.height);(e=m.getContext("2d"))==null||e.putImageData(t,0,0);let y=new OffscreenCanvas(c,r).getContext("2d");return y.drawImage(m,o,h,c,r,0,0,c,r),y.getImageData(0,0,c,r)}self.onmessage=s=>{const{inputData:e,hash:t}=s.data,n=Xt(e);self.postMessage({result:n,hash:t},[n.data.buffer])};class za{constructor(e,t,n){if(d(this,"type","chest"),d(this,"boundingBox"),d(this,"imageData"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BVv6I5U7-eMazRsx3.js",import.meta.url),{type:"module"})),d(this,"workerPool",ve(this.workerFactory,Xt,"ChestROIExtractorWorker")),this.boundingBox=this.chestRect({width:e.width,height:e.height},t,n),this.boundingBox===void 0){this.imageData=Promise.resolve(void 0);return}this.imageData=e.getImageData().then(o=>{if(!(!o||!this.boundingBox))return this.workerPool.callWorker({videoFrame:o,rect:this.boundingBox})})}chestRect(e,t,n){if(!t||!n)return;let o=t.width*e.width,h=t.height*e.height,c=(n.xCenter-t.width/2)*e.width,r=(t.yCenter-t.height/2)*e.height;if(r=r+h,r+h>e.height&&(h=e.height-r),!(o<=0||h<=0)&&!(h<.1*n.height*e.height))return{x:c,y:r,w:o,h}}}class Wa{constructor(e,t,n,o="rgb1x1",h=ne.AwsEnterpriseProd){if(d(this,"type","face"),d(this,"boundingBox"),d(this,"imageData"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BVv6I5U7-eMazRsx3.js",import.meta.url),{type:"module"})),d(this,"workerPool",ve(this.workerFactory,Xt,"FaceROIExtractorWorker")),this.boundingBox=this.faceRect({width:e.width,height:e.height},t,n,o,h),this.boundingBox===void 0){this.imageData=Promise.resolve(void 0);return}this.imageData=e.getImageData().then(c=>{if(!(!c||!this.boundingBox))return this.workerPool.callWorker({videoFrame:c,rect:this.boundingBox})})}faceRect(e,t,n,o,h){var c;if(!t||!n)return;let r=1,m=t.width*e.width*r,y=t.height*e.height*r,k=(n.xCenter-t.width/2*r)*e.width,D=(n.yCenter-t.height/2*r)*e.height;if(m==0||y==0)return;let v=(c=Gt.get(h))==null?void 0:c.schemaVersion;return(o=="rgb1x1"||o=="yuv1x1"&&v&&Ne(v,"2.0")<0)&&(y=y*.7),{x:k,y:D,w:m,h:y}}}function Oi(s){const e=s.map(n=>n.x),t=s.map(n=>n.y);return{min:{x:Math.min(...e),y:Math.min(...t)},max:{x:Math.max(...e),y:Math.max(...t)}}}function ja(s){const e=s.reduce((t,n)=>({x:t.x+n.x,y:t.y+n.y}),{x:0,y:0});return{x:e.x/s.length,y:e.y/s.length}}function qa(s,e,t){const n=[s[0].x,s[0].y,s[1].x,s[1].y],o=[e[0].x,e[0].y,e[1].x,e[1].y],[h,c,r,m]=n,y=Math.sqrt(Math.pow(Math.abs(h-r),2)+Math.pow(Math.abs(c-m),2)),[k,D,v,w]=o,p=k-v,u=D-w,g=[1,0],b=[r-h,m-c],E=g[0]*b[0]+g[1]*b[1],S=Math.sqrt(g[0]*g[0]+g[1]*g[1]),T=Math.sqrt(b[0]*b[0]+b[1]*b[1]),M=Math.acos(E/(S*T)),P=Math.abs(Math.cos(M)*y/2),A=Math.abs(Math.sin(M)*y/2),H={x:t.x-p/2,y:t.y-u/2*.8},J={x:t.x-P/2,y:t.y-A/2},ee={x:t.x+P/2,y:t.y+A/2},q={x:H.x+P/2,y:H.y+A/2},G={x:H.x-P/2,y:H.y-A/2};return[J,ee,q,G]}function Ga(s,e){const t=Oi(e),n=t.min.x,o=t.min.y,h=t.max.x,c=t.max.y,r=[(h-n)*.25,(c-o)*.25];let m,y,k,D;switch(s){case"forehead":m=e[151].x,y=e[151].y,k=r[0]*2,D=r[1]*.5;break;case"glabella":m=e[8].x,y=e[8].y,k=r[0]*.6,D=r[1]*.6;break;case"rightCheek":m=e[425].x,y=e[425].y-r[1]*.2,k=r[0]*.8,D=r[1]*.6;break;case"leftCheek":m=e[205].x,y=e[205].y-r[1]*.2,k=r[0]*.8,D=r[1]*.6;break;case"chin":m=e[200].x,y=e[200].y,k=r[0]*.8,D=r[1]*.4;break;case"neck":const g=[e[205],e[425]],b=[e[168],e[4]],E=e[152],S=qa(g,b,E),T=Oi(S),M=ja(S);m=M.x,y=M.y,k=T.max.x-T.min.x,D=T.max.y-T.min.y,y+=D,D*=2;break;case"rightLowerCheek":m=e[425].x,y=e[425].y,k=r[0],D=r[1]/2,y+=D/2;break;case"rightUpperCheek":m=e[425].x,y=e[425].y,k=r[0],D=r[1]/2,y-=D/2;break;case"leftLowerCheek":m=e[205].x,y=e[205].y,k=r[0],D=r[1]/2,y+=D/2;break;case"leftUpperCheek":m=e[205].x,y=e[205].y,k=r[0],D=r[1]/2,y-=D/2;break;default:throw new Error(`Unsupported ROI part: ${s}`)}const v=m-k/2,w=y-D/2,p=v+k,u=w+D;return[{x:v,y:w},{x:p,y:w},{x:p,y:u},{x:v,y:u}]}function Ji(s,e){if(e.length===0)return{x:0,y:0,w:0,h:0};if(e.length===1){const c=e[0];return{x:Math.floor(c.x)*s.width,y:Math.floor(c.y)*s.height,w:1,h:1}}let t=e[0].x,n=e[0].y,o=e[0].x,h=e[0].y;for(let c=1;c<e.length;c++){const r=e[c];r.x<t&&(t=r.x),r.y<n&&(n=r.y),r.x>o&&(o=r.x),r.y>h&&(h=r.y)}return{x:t*s.width,y:n*s.height,w:(o-t)*s.width,h:(h-n)*s.height}}function Zi(s){var e;const{videoFrame:t,normalizedPoints:n}=s,{x:o,y:h,w:c,h:r}=Ji(t,n),m=new OffscreenCanvas(t.width,t.height);(e=m.getContext("2d"))==null||e.putImageData(t,0,0);let y=new OffscreenCanvas(c,r).getContext("2d");y.beginPath();for(let k=0;k<n.length;k++){const D=n[k],v=(D.x-o/t.width)*(t.width/c)*c,w=(D.y-h/t.height)*(t.height/r)*r;k===0?y.moveTo(v,w):y.lineTo(v,w)}return y.closePath(),y.clip(),y.drawImage(m,o,h,c,r,0,0,c,r),y.getImageData(0,0,c,r)}self.onmessage=s=>{const{inputData:e,hash:t}=s.data,n=Zi(e);self.postMessage({result:n,hash:t},[n.data.buffer])};class Ya{constructor(e,t,n){d(this,"type"),d(this,"boundingBox"),d(this,"imageData"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/CDhEsE-f-CpFHRKS_.js",import.meta.url),{type:"module"})),d(this,"workerPool",ve(this.workerFactory,Zi,"PolygonROIExtractorWorker",1e3,48)),this.type=t,this.boundingBox=Ji(e,n),this.imageData=e.getImageData().then(o=>{if(!(!o||!this.boundingBox))return this.workerPool.callWorker({videoFrame:o,normalizedPoints:n})})}}class Qa{constructor(e,t){d(this,"canvas"),d(this,"config"),d(this,"faceDetectionSamplingInterval"),d(this,"debug",!1),d(this,"sampledFaceDetection"),d(this,"firstFaceDetection"),this.canvas=document.createElement("canvas"),this.config=t,this.faceDetectionSamplingInterval=e,console.log("[VitalSignCamera] DefaultFaceROIExtractor initialized")}reset(){this.sampledFaceDetection=void 0,this.firstFaceDetection=void 0}processFrame(e,t,n){n==="idle"&&(this.sampledFaceDetection=void 0,this.firstFaceDetection=void 0);const o=new Date().getTime();return(!this.sampledFaceDetection||!this.faceDetectionSamplingInterval||o-this.sampledFaceDetection.timestamp>this.faceDetectionSamplingInterval)&&(this.sampledFaceDetection={timestamp:new Date().getTime(),...t}),this.firstFaceDetection===void 0&&(this.firstFaceDetection=t),{images:(this.config.enabledROIs??["face","chest"]).reduce((h,c)=>{var r,m,y,k,D,v;if(c==="face")h.face=new Wa(e,(r=this.firstFaceDetection)==null?void 0:r.faceBox,(m=this.sampledFaceDetection)==null?void 0:m.faceBox,this.config.pixelDataType,this.config.serverId);else if(c==="chest")h.chest=new za(e,(y=this.firstFaceDetection)==null?void 0:y.faceBox,(k=this.sampledFaceDetection)==null?void 0:k.faceBox);else{if(!((D=this.sampledFaceDetection)!=null&&D.landmarks)||this.sampledFaceDetection.landmarks.length===0)return h;const w=Ga(c,(v=this.sampledFaceDetection)==null?void 0:v.landmarks),p=new Ya(e,c,w);h[c]=p}return this.debug&&h[c]&&this.debugRoi(h[c]),h},{})}}cropFrame(e,t){const n=this.canvas;return n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(e,t.x,t.y,t.width,t.height,0,0,n.width,n.height),n.getContext("2d").canvas}async debugRoi(e){var t;const n=await e.imageData;if(n===void 0){console.log("[VitalSignCamera] debugRoi: imageData is undefined");return}const o=document.createElement("canvas");o.width=n.width,o.height=n.height,(t=o.getContext("2d"))==null||t.putImageData(n,0,0);const h=o.toDataURL(),c=`debug-${e.type}`,r=document.getElementById(c);if(r)r.setAttribute("src",h);else{const m=document.createElement("img");m.id=c,m.setAttribute("src",h),document.body.appendChild(m)}}}function $i(s,e){var t;return console.log(`[VitalSignCamera] createFaceROIExtractor for ${(t=e.enabledROIs)==null?void 0:t.join(", ")} ROIs`),new Qa(s,e)}const es=te.isMobile&&!te.isTablet,Ka=es?Pe.sd480x360:te.isTablet?Pe.hd1280x720:Pe.hd1920x1080,Vi={engineConfig:{serverId:ne.Schema2Prod,dataCollectionDuration:25,dataSendingDuration:5,enabledROIs:["face","chest"],pixelDataType:"rgb1x1",chestPixelDataType:"ggg1x1",landmarksSampleRate:10},conditionCheckerConfig:{minimumFrameRate:es||te.isAndroid?10:15},presetFormat:Ka,maxFaceDetectionFps:5},Xa={engineConfig:{serverId:ne.Schema2Prod,dataCollectionDuration:18,dataSendingDuration:10,enabledROIs:["face","chest","leftCheek","rightCheek","chin","glabella"],pixelDataType:"rgb8x8",chestPixelDataType:"meanRgb1x1",landmarksSampleRate:10},conditionCheckerConfig:{minimumFrameRate:25},presetFormat:te.isMobile?Pe.hd1280x720:Pe.hd1920x1080,maxFaceDetectionFps:15};function ts(s){switch(s){case _e.relaxed:return Vi;case _e.strict:return Xa;default:return Vi}}class Ja{constructor(e){d(this,"lastFramerateOKTime",new Date),d(this,"requiredStableDuration",1e4),d(this,"waitingResponse",!1),this.camera=e}reset(){this.lastFramerateOKTime=new Date}process(e,t){var n;if(this.camera.precisionMode===void 0)return;const o=(n=ts(this.camera.precisionMode).conditionCheckerConfig)==null?void 0:n.minimumFrameRate;if(!(o===void 0||(e>=o&&(this.lastFramerateOKTime=new Date),!this.lastFramerateOKTime)||this.waitingResponse)&&new Date().getTime()-this.lastFramerateOKTime.getTime()>=this.requiredStableDuration&&this.camera.precisionMode!==_e.relaxed&&t==="idle")if(this.camera.onPrecisionModeWillUpdate){this.waitingResponse=!0,this.camera.onPrecisionModeWillUpdate({currentMode:this.camera.precisionMode,newMode:_e.relaxed,reason:"lowFrameRate",response:h=>{this.waitingResponse=!1,h==="proceed"?this.updatePrecisionModeToRelaxed("response"):h==="wait"?this.reset():this.waitingResponse=!1}});return}else console.log("No onPrecisionModeWillUpdate handler, proceeding to update precision mode."),this.updatePrecisionModeToRelaxed()}updatePrecisionModeToRelaxed(e="lowFrameRate"){this.camera.precisionMode=_e.relaxed,this.camera.onPrecisionModeUpdated&&this.camera.onPrecisionModeUpdated({previousMode:_e.strict,currentMode:_e.relaxed,reason:e}),console.log(`[VitalSignCamera] Precision mode switched to relaxed after stable frame rate for ${this.requiredStableDuration} ms`)}}class Za{constructor(){d(this,"config"),d(this,"currentStage"),d(this,"currentStageStartTime"),d(this,"grabbedFrames",[]),this.config={grabbingPoints:void 0}}configure(e){this.config=e}reset(){this.currentStage=void 0,this.currentStageStartTime=void 0,this.grabbedFrames=[]}processFrame(e,t,n){if(!this.config.grabbingPoints||this.config.grabbingPoints.length===0||(this.currentStage!==t&&(this.currentStage=t,this.currentStageStartTime=Date.now()),!this.currentStageStartTime))return;const o=Date.now()-this.currentStageStartTime,h=this.config.grabbingPoints||[];for(const c of h)c.stage===t&&(this.grabbedFrames.some(r=>r.stage===c.stage&&r.offset===c.offset)||o<c.offset||(console.log(`[Frame Grabber] Grabbing frame at stage ${j[c.stage]} with offset ${c.offset} ms`),this.grabbedFrames.push({canvas:e.getCanvas(),stage:c.stage,offset:c.offset})))}}function eo(){return new Za}const ft=te.isMobile&&!te.isTablet;class to{constructor(e){d(this,"id",`${Math.floor(Math.random()*1e4)}`),d(this,"deviceCaps",la),d(this,"version",Yt),d(this,"_isActive"),d(this,"_userInfo"),d(this,"_config"),d(this,"faceDetectorType"),d(this,"_presetFormat"),d(this,"checkBrightness",!0),d(this,"_device"),d(this,"preferredCamera"),d(this,"maxFps"),d(this,"maxFaceDetectionFps"),d(this,"_precisionMode"),d(this,"disableAgeEstimation"),d(this,"enableBeautyAnalysis"),d(this,"_visualizationOptions"),d(this,"customConditionRange"),d(this,"faceDetectionRegion"),d(this,"faceDetectionModelLocation"),d(this,"_realtimeEstimationConfig"),d(this,"vsStatus","idle"),d(this,"_faceDetectionResult"),d(this,"faceDetectionTimer"),d(this,"faceDetectionFunction"),d(this,"camera",null),d(this,"cameraStartTime"),d(this,"videoFrameInfo",null),d(this,"videoFrame"),d(this,"healthResult"),d(this,"video",null),d(this,"transform","none"),d(this,"_videoSettings"),d(this,"cameraFps",new Mi("camera")),d(this,"faceDetectionFps",new Mi("face detection")),d(this,"activateAfterBound",!1),d(this,"boundingBox"),d(this,"faceMesh"),d(this,"faceDetectionSamplingInterval"),d(this,"vitalSignEngine"),d(this,"faceDetector"),d(this,"roiExtractor"),d(this,"ageEstimator"),d(this,"beautyAnalyzer"),d(this,"realtimeEstimator"),d(this,"conditionChecker"),d(this,"frameGrabber"),d(this,"precisionModeChecker",new Ja(this)),d(this,"cameraDevices"),d(this,"onVideoFrameProcessed"),d(this,"onTransformUpdated"),d(this,"onVideoSettingsUpdated"),d(this,"onCameraDevicesUpdated"),d(this,"onInitialized"),d(this,"onPrecisionModeUpdated"),d(this,"onPrecisionModeWillUpdate"),d(this,"onError");var t;window.__vital_sign_camera_impl__=this,console.log(`[VitalSignCamera] Welcome to VitalSignCamera ${Yt}`),console.log("[VitalSignCamera] Initializing with props...",e);let n=new Date;this._isActive=!1,this.activateAfterBound=e.isActive,this._config=e.config||{},this._device=e.device,this.preferredCamera=e.preferredCamera,this._userInfo=e.userInfo,this._visualizationOptions=e.visualizationOptions,this.faceDetectionRegion=e.faceDetectionRegion,this.faceDetectionSamplingInterval=e.faceDetectionSamplingInterval,this._realtimeEstimationConfig=e.realtimeEstimationConfig,te.isMobile?ft?this._presetFormat=Pe.sd480x360:this._presetFormat=Pe.hd1280x720:this._presetFormat=Pe.hd1920x1080,e.customConditionRange!==void 0&&(this.customConditionRange=e.customConditionRange),e.checkBrightness!==void 0?this.checkBrightness=e.checkBrightness:(te.isAndroid&&(console.log("[VitalSignCamera] Android detected. Turn off brightness check."),this.checkBrightness=!1),e.faceDetectorType===he.Dummy&&(console.log("[VitalSignCamera] Dummy face detector being used. Turn off brightness check."),this.checkBrightness=!1)),e.faceDetectorType!==void 0?(console.log(`[VitalSignCamera] Setting face detector type ${e.faceDetectorType}...`),this.faceDetectorType=e.faceDetectorType):(console.log("[VitalSignCamera] Auto setting face detector type..."),te.isAndroid?(console.log("[VitalSignCamera] Android detected"),console.log("[VitalSignCamera] Setting new MediaPipe face detector"),this.faceDetectorType=he.MPFaceMesh):te.isIOS&&Ne(te.browserVersion,"18.0")<0?(console.log("[VitalSignCamera] Setting new MediaPipe facemesh detector"),this.faceDetectorType=he.MPFaceMesh):(console.log("[VitalSignCamera] Setting new MediaPipe facemesh threaded detector"),this.faceDetectorType=he.MPFaceMeshThreaded)),e.presetFormat!==void 0&&(this._presetFormat=e.presetFormat),e.maxFps!==void 0?(console.log(`[VitalSignCamera] Setting max camera fps to ${e.maxFps}`),this.maxFps=e.maxFps):(this.maxFps=ft?30:60,console.log(`[VitalSignCamera] Auto setting max camera fps to ${this.maxFps}`)),e.maxFaceDetectionFps!==void 0?(console.log(`[VitalSignCamera] Setting max face detection fps to ${e.maxFaceDetectionFps}`),this.maxFaceDetectionFps=e.maxFaceDetectionFps):ft||te.isAndroid?(this.maxFaceDetectionFps=2,console.log(`[VitalSignCamera] Mobile phone or Android detected, auto setting max face detection fps to ${this.maxFaceDetectionFps}`)):(this.maxFaceDetectionFps=5,console.log(`[VitalSignCamera] Auto setting max face detection fps to ${this.maxFaceDetectionFps}`)),((t=e.config)==null?void 0:t.blinkDetectorType)===We.default&&(console.log("[VitalSignCamera] Blink detector enabled, forcing face detection fps to 15"),this.maxFaceDetectionFps=Math.max(15,this.maxFaceDetectionFps)),e.disableAgeEstimation!==void 0?(console.log(`[VitalSignCamera] Setting age estimation: ${!e.disableAgeEstimation}`),this.disableAgeEstimation=e.disableAgeEstimation):(console.log("[VitalSignCamera] Auto setting age estimation..."),ft?(console.log("[VitalSignCamera] is phone -> ageEstimation = false"),this.disableAgeEstimation=!0):(console.log("[VitalSignCamera] Not phone -> ageEstimation = true"),this.disableAgeEstimation=!1)),e.enableBeautyAnalysis!==void 0?(console.log(`[VitalSignCamera] Setting beauty analysis: ${e.enableBeautyAnalysis}`),this.enableBeautyAnalysis=e.enableBeautyAnalysis,this.enableBeautyAnalysis&&this.disableAgeEstimation&&(console.log("[VitalSignCamera] Beauty analysis ON -> Forcing ageEstimation = true"),this.disableAgeEstimation=!1)):this.enableBeautyAnalysis=!1,e.frameGrabberConfig!==void 0&&(this.frameGrabber=eo(),this.frameGrabber.configure(e.frameGrabberConfig));const o=this.disableAgeEstimation,h=this.enableBeautyAnalysis;this.onVideoFrameProcessed=e.onVideoFrameProcessed,this.onVideoSettingsUpdated=e.onVideoSettingsUpdated,this.onCameraDevicesUpdated=e.onCameraDevicesUpdated,this.onInitialized=e.onInitialized,this.onPrecisionModeUpdated=e.onPrecisionModeUpdated,this.onPrecisionModeWillUpdate=e.onPrecisionModeWillUpdate,this.onError=e.onError,this.vitalSignEngine=sa(),this.roiExtractor=$i(this.faceDetectionSamplingInterval,this.config),this.sdkCredentials=e.sdkCredentials,this.conditionChecker=Ra(this.vitalSignEngine,e.conditionCheckerConfig,this.customConditionRange),e.precisionMode!==void 0&&(this.precisionMode=e.precisionMode),this.cameraDevices=new Ma(this,c=>{this.onCameraDevicesUpdated&&this.onCameraDevicesUpdated({devices:c,selected:this.device})}),this.cameraDevices.start(),(async()=>{var c;try{o||(this.ageEstimator=await Pa(e.faceApiModelPath),this.ageEstimator.configure(e.ageEstimationConfig)),h&&(this.beautyAnalyzer=await Na({apiKey:(c=e.config)==null?void 0:c.apiKey})),this._realtimeEstimationConfig&&(this.realtimeEstimator=await Ia(this._realtimeEstimationConfig)),this.faceDetector=await this.createFaceDetector(e.faceDetectionModelLocation),this.onInitialized&&this.onInitialized();const r=(new Date().getTime()-n.getTime())/1e3;console.log(`[VitalSignCamera] initialized. Loading time ${r}s.`)}catch(r){console.error(r),console.log("[VitalSignCamera] initialization failed."),this.onError&&this.onError(r),this.camera&&this.cameraStartTime&&this.stopCamera()}})()}async createFaceDetector(e){try{console.log("[VitalSignCamera] Model loading location: ",e);let t=await Ai(this.faceDetectorType);return await t.loadModels(e),t}catch(t){if(this.faceDetectorType==he.MPFaceMeshThreaded)return console.warn("[VitalSignCamera] Failed to initialize MediaPipe FaceMesh threaded detector. Falling back to non-threaded version."),this.faceDetectorType=he.MPFaceMesh,await this.createFaceDetector(e);throw t}}bind(e){this.video=e,this.video.setAttribute("autoplay","true"),this.video.setAttribute("playsinline",""),this.config&&(this.vitalSignEngine.configure(this.config),this.vitalSignEngine.isReady()),this.faceDetectorType===he.TFMediaPipe&&this.vitalSignEngine.configure({blinkDetectorType:We.default}),this.isActive=this.activateAfterBound}set device(e){const t=this.isActive;this._device&&this._device.length>0&&this._device!==e&&this.stopCamera(),this._device=e,e?t&&this.startCamera():this.stopCamera()}get device(){return this._device}set isActive(e){e?this.startCamera():this.stopCamera()}get isActive(){return this._isActive}set presetFormat(e){if(this._presetFormat===e)return;const t=this.isActive;this.stopCamera(),this._presetFormat=e,t&&this.startCamera()}get presetFormat(){return this._presetFormat}set config(e){this._config={...this._config},Object.keys(e).forEach(t=>{const n=t;e[n]!==void 0&&(this._config[n]=e[n])}),this.config&&(this.vitalSignEngine.configure(this.config),this.roiExtractor=$i(this.faceDetectionSamplingInterval,this.config))}get config(){let e={...this._config};const t=new URLSearchParams(location.search).get("PANOPTIC_API_KEY");return t&&(e.apiKey=t),e}set userInfo(e){this._userInfo={...this._userInfo},Object.keys(e).forEach(t=>{const n=t;e[n]!==void 0&&(this._userInfo[n]=e[n])})}get userInfo(){let e={...this._userInfo};const t=new URLSearchParams(location.search).get("PANOPTIC_USER_ID");return t&&(e.userId=t),e}get sdkCredentials(){if(!(!this.config.apiKey&&!this.userInfo.userId))return{apiKey:this.config.apiKey,userId:this.userInfo.userId}}set sdkCredentials(e){e!=null&&e.apiKey&&(this.config={apiKey:e==null?void 0:e.apiKey}),e!=null&&e.userId&&(this.userInfo={userId:e==null?void 0:e.userId})}get precisionMode(){return this._precisionMode}set precisionMode(e){if(!e)return;this._precisionMode!==e&&(this.onPrecisionModeUpdated&&this.onPrecisionModeUpdated({previousMode:this._precisionMode,currentMode:e,reason:"manual"}),this.precisionModeChecker.reset()),this._precisionMode=e;const t=ts(e);this.config=t.engineConfig,this.vitalSignEngine.configure(this.config),t.conditionCheckerConfig&&this.conditionChecker.configure(t.conditionCheckerConfig),t.presetFormat&&(this.presetFormat=t.presetFormat),t.maxFaceDetectionFps!==void 0&&(this.maxFaceDetectionFps=t.maxFaceDetectionFps,this.faceDetectionFunction&&this.startFaceDetection())}set faceDetectionResult(e){var t,n,o,h;this._faceDetectionResult=e,(t=this.faceDetectionResult)!=null&&t.videoFrame.width&&(n=this.faceDetectionResult)!=null&&n.videoFrame.height&&(this.videoFrameInfo={timestamp:performance.now(),width:(o=this.faceDetectionResult)==null?void 0:o.videoFrame.width,height:(h=this.faceDetectionResult)==null?void 0:h.videoFrame.height})}get faceDetectionResult(){return this._faceDetectionResult}get videoSettings(){return this._videoSettings}set videoSettings(e){if(this._videoSettings=e,e&&this.video){if(!this.onVideoSettingsUpdated)return;this.onVideoSettingsUpdated({video:this.video,settings:e})}}get visualizationOptions(){return this._visualizationOptions}set visualizationOptions(e){var t,n;if(this._visualizationOptions=e,!this.isActive)return;const o=(e==null?void 0:e.boundingBox)&&e.boundingBox.enabled!==!1;o&&!this.boundingBox&&this.video&&(this.boundingBox=new _i(this.video,(t=this._visualizationOptions)==null?void 0:t.boundingBox)),!o&&this.boundingBox&&(this.boundingBox.enabled=!1,this.boundingBox=void 0),this.boundingBox&&e!=null&&e.boundingBox&&this.boundingBox.updateOptions(e==null?void 0:e.boundingBox);const h=(e==null?void 0:e.faceMesh)&&e.faceMesh.enabled!==!1;h&&!this.faceMesh&&this.video&&(this.faceMesh=new Bi(this.video,(n=this._visualizationOptions)==null?void 0:n.faceMesh)),!h&&this.faceMesh&&(this.faceMesh.destroy(),this.faceMesh=void 0),this.faceMesh&&e!=null&&e.faceMesh&&this.faceMesh.updateOptions(e==null?void 0:e.faceMesh)}get faceMeshElement(){var e;return(e=this.faceMesh)==null?void 0:e.faceMesh}get boundingBoxElement(){var e;return(e=this.boundingBox)==null?void 0:e.boundingBox}get grabbedFrames(){var e;return(e=this.frameGrabber)==null?void 0:e.grabbedFrames}get realtimeEstimationConfig(){return this._realtimeEstimationConfig}set realtimeEstimationConfig(e){this._realtimeEstimationConfig=e,this.realtimeEstimator&&this.realtimeEstimator.configure(e)}get faceDetectionRegionAbs(){if(!this.faceDetectionRegion||!this.videoSettings)return;const{x:e,y:t,width:n,height:o}=this.faceDetectionRegion,h=this.videoSettings.width,c=this.videoSettings.height;return{x:typeof e=="string"?parseFloat(e)/100*h:e,y:typeof t=="string"?parseFloat(t)/100*c:t,width:typeof n=="string"?parseFloat(n)/100*h:n,height:typeof o=="string"?parseFloat(o)/100*c:o}}get processedFrame(){var e,t,n,o,h,c,r,m,y;if(this.videoFrameInfo===null||!this.videoFrame)return;const k=this.healthResult;return k!=null&&k.health&&(k.health.beautyAnalysis=(e=this.beautyAnalyzer)==null?void 0:e.result,k.health.vitalSigns={...k.health.vitalSigns,facialSkinAge:((n=(t=this.beautyAnalyzer)==null?void 0:t.result)==null?void 0:n.skinAge)||((h=(o=this.ageEstimator)==null?void 0:o.estimation)==null?void 0:h.age)}),{videoFrameInfo:this.videoFrameInfo,videoFrame:this.videoFrame,facebox:(c=this.faceDetectionResult)==null?void 0:c.faceBox,healthResult:k,scanConditions:this.conditionChecker.conditions,landmarks:(r=this.faceDetectionResult)==null?void 0:r.landmarks,realtimeEstimation:((m=this.realtimeEstimator)==null?void 0:m.estimation)||null,signalData:((y=this.realtimeEstimator)==null?void 0:y.signalData)||null}}updateVideoSettings(e){if(!e||!e.srcObject)return this.videoSettings=void 0,"not-ready";const t=e.srcObject.id,n=e.srcObject.getVideoTracks()[0].getSettings(),{width:o,height:h,frameRate:c}=n;return o===void 0||h===void 0?"undefined":(console.log(`[VitalSignCamera] Video Settings in ${te.browserName}: ${o}x${h} @ ${c} fps`),this.transform=va(e),e.style.transform=this.transform,this.onTransformUpdated&&this.onTransformUpdated(this.transform),this.videoSettings={videoId:t,width:e.videoWidth||o,height:e.videoHeight||h,transformX:this.transform},"ok")}startCamera(){var e,t;this._isActive||(this._isActive=!0,this.processVideoFrame(),(e=this.visualizationOptions)!=null&&e.boundingBox&&this.visualizationOptions.boundingBox.enabled!==!1&&!this.boundingBox&&this.video&&(this.boundingBox=new _i(this.video,this.visualizationOptions.boundingBox)),(t=this.visualizationOptions)!=null&&t.faceMesh&&this.visualizationOptions.faceMesh.enabled!==!1&&!this.faceMesh&&this.video&&(this.faceMesh=new Bi(this.video,this.visualizationOptions.faceMesh)))}async stopCamera(){var e,t;this._isActive&&(this._isActive=!1,this.vitalSignEngine.stop(),(e=this.boundingBox)==null||e.update(void 0),(t=this.faceMesh)==null||t.update(void 0),this.faceDetectionResult=void 0,this.videoFrame=void 0,this.boundingBox&&(this.boundingBox.enabled=!1,this.boundingBox=void 0),this.faceMesh&&(this.faceMesh.destroy(),this.faceMesh=void 0),this.video&&this.stopVideo(),this.conditionChecker.reset(),this.camera&&(await this.camera.stop(),this.cameraStartTime=void 0))}async waitCameraToStop(e){return this.camera?await this.camera.waitUntilStopped(e):!0}async stopVideo(){const e=this.video;e.srcObject&&e.srcObject.getVideoTracks().forEach(t=>t.stop()),this.vitalSignEngine.stop(),clearInterval(this.faceDetectionTimer),this.faceDetectionTimer=void 0,this.faceDetectionFunction=void 0,console.log("[VitalSignCamera] stop Camera")}startScanning(){var e,t;console.log("[VitalSignCamera] start scanning..."),this.vsStatus="measuring",(e=this.frameGrabber)==null||e.reset(),(t=this.realtimeEstimator)==null||t.reset(),this.vitalSignEngine.start()}stopScanning(){console.log("[VitalSignCamera] stop scanning..."),this.vitalSignEngine.stop()}convertFaceBox(e){if(e===void 0)return;if(!this.videoSettings||!this.faceDetectionRegionAbs)return e;const t=(e.xCenter*this.faceDetectionRegionAbs.width+this.faceDetectionRegionAbs.x)/this.videoSettings.width,n=(e.yCenter*this.faceDetectionRegionAbs.height+this.faceDetectionRegionAbs.y)/this.videoSettings.height,o=e.width*this.faceDetectionRegionAbs.width/this.videoSettings.width,h=e.height*this.faceDetectionRegionAbs.height/this.videoSettings.height;return{xCenter:t,yCenter:n,width:o,height:h}}convertLandmarks(e){if(e===void 0)return;if(this.videoSettings===void 0||!this.faceDetectionRegionAbs)return e;const t=this.videoSettings,n=this.faceDetectionRegionAbs;return e.map(o=>{const h=(o.x*n.width+n.x)/t.width,c=(o.y*n.height+n.y)/t.height,r=o.z;return{x:h,y:c,z:r}})}startFaceDetection(){this.faceDetectionFunction!==void 0&&(this.faceDetectionTimer&&(clearInterval(this.faceDetectionTimer),this.faceDetectionTimer=void 0),this.faceDetectionTimer=setInterval(this.faceDetectionFunction,1e3/this.maxFaceDetectionFps))}async processVideoFrame(){const e=this.video,{width:t,height:n}=aa(this.presetFormat||Pe.hd1920x1080);this.precisionModeChecker.reset();const o=new ca(e,{width:t,height:n,deviceId:this.device,preferredCamera:this.preferredCamera,callbackFrameRate:this.maxFps,handleIOS17Bug:te.isIOS&&Ne(te.browserVersion,"17")>=0,handleIOS17ObjectFitBug:te.isIOS&&Ne(te.browserVersion,"17.2")>=0,onFrame:y=>{var k,D,v,w,p,u,g,b,E,S,T,M,P,A,H,J;if(o.croppingRegion=this.faceDetectionRegionAbs,this.cameraStartTime===void 0)return;const ee=new Date().getTime()-this.cameraStartTime.getTime();if((((k=this.videoSettings)==null?void 0:k.width)!=e.videoWidth||((D=this.videoSettings)==null?void 0:D.height)!=e.videoHeight)&&this.updateVideoSettings(e)!=="ok"&&ee>5e3){console.error("[VitalSignCamera] Could not get camera settings."),o.stop(),this.onError&&this.onError(new Error("undefined camera dimension"));return}if(this.cameraFps.tick(),this.faceDetectionResult==null)return;this.conditionChecker.processFrame(this.faceDetectionResult.videoFrame,(v=this.faceDetectionResult)==null?void 0:v.faceBox,this.vsStatus==="idle"?this.checkBrightness:!1,this.cameraFps.average,this.vsStatus),this.precisionModeChecker.process(this.cameraFps.average,this.vsStatus);const{images:q}=this.roiExtractor.processFrame(y,this.faceDetectionResult,this.vsStatus);this.videoFrame=y;const G=this.faceDetectionResult.faceBox,Z={faceBox:G,landmarks:this.faceDetectionResult.landmarks,videoFrameInfo:y,images:q,userInfo:this.userInfo},N=this.vitalSignEngine.getHealth(Z);if(this.healthResult=N,this.vsStatus==="measuring"&&(N.stage===j.Idle&&(this.vsStatus="idle",this.vitalSignEngine.stop(),N.error&&this.onError&&this.onError(N.error)),(p=(w=N.health)==null?void 0:w.vitalSigns)!=null&&p.heartRate&&((b=this.realtimeEstimator)==null||b.updateWithServerResult(N.health.vitalSigns.heartRate,(u=N.health.scanParameters)==null?void 0:u.snr,(g=N.health.scanParameters)==null?void 0:g.signalQuality)),(E=this.ageEstimator)==null||E.processFrame(y,N.stage,N.remainingTime),(S=this.realtimeEstimator)==null||S.processFrame(y,N.stage,N.remainingTime,q),(P=this.beautyAnalyzer)==null||P.processFrame(y,G,(M=(T=this.ageEstimator)==null?void 0:T.estimation)==null?void 0:M.age,N.stage,N.remainingTime),(A=this.frameGrabber)==null||A.processFrame(y,N.stage,N.remainingTime)),this.boundingBox){const Y=this.convertFaceBox((H=this.faceDetectionResult)==null?void 0:H.faceBox);this.boundingBox.update(Y)}if(this.faceMesh){const Y=this.convertLandmarks((J=this.faceDetectionResult)==null?void 0:J.landmarks);this.faceMesh.update(Y)}this.processedFrame&&this.onVideoFrameProcessed&&this.onVideoFrameProcessed(this.processedFrame)}});try{o.croppingRegion=this.faceDetectionRegionAbs,await o.start(),this.updateVideoSettings(e),this._device=o.deviceId,this.cameraStartTime=new Date}catch(y){console.error("[VitalSignCamera] Could not start camera: ",y),this.onError&&this.onError(y);return}let h=!1;const c=3;let r=0;const m=document.createElement("canvas");this.faceDetectionFunction=async()=>{if(this.faceDetector===void 0||!this.faceDetectionTimer||this.cameraFps.frameCount==0||h||!e.srcObject||this.videoSettings===void 0)return;const y=this.videoSettings;h=!0;const k=this.faceDetectionRegionAbs||{x:0,y:0,width:y.width,height:y.height},D=k.width/k.height;if(m.width=D>1?320:320*D,m.height=m.width/D,this.faceDetectorType!==he.Dummy){let v=m.getContext("2d",{willReadFrequently:!0});v==null||v.drawImage(e,k.x,k.y,k.width,k.height,0,0,m.width,m.height)}try{this.faceDetector.detect({image:m}).then(v=>{this.faceDetectionFps.tick(),this.faceDetectionResult={...v,faceDetectionRegion:k}})}catch(v){r++,console.error(`Face detector crashed: ${v}`),console.log(`Face detector crash count: ${r}`),r>c&&(console.log(`Face detector crashed ${r} times, falling back to dummy detector.`),this.faceDetectorType=he.Dummy,this.faceDetector=await Ai(this.faceDetectorType))}h=!1},this.startFaceDetection(),this.camera=o}}function io(s){return new to(s)}var $e=(s=>(s.OK="ok",s.TooFar="tooFar",s.TooClose="tooClose",s))($e||{}),xe=(s=>(s.Centered="centered",s.TooHigh="tooHigh",s.TooLow="tooLow",s.TooLeft="tooLeft",s.TooRight="tooRight",s.Unknown="unknown",s))(xe||{}),_e=(s=>(s.relaxed="relaxed",s.strict="strict",s))(_e||{});function so(s){return typeof s=="boolean"?s?"Yes":"No":typeof s=="string"?s:typeof s=="number"?s.toFixed(1):s===void 0?"undefined":s===null?"null":"unknown type"}function no(s){switch(s){case pt.Poor:return"Poor";case pt.Good:return"Good";case pt.Excellent:return"Excellent";case void 0:return"undefined";case null:return"null";default:return"Unknown"}}function F(s,e){return e===null?`<!-- ${s} is null -->`:e===void 0?`<!-- ${s} is undefined -->`:`<!-- ${s}: ${typeof e} --><li>${s}: ${so(e)}</li>`}function ao(s,e){var n,o,h,c,r,m,y,k,D,v,w,p,u,g,b,E,S,T,M,P,A,H,J,ee,q,G,Z,N,Y,ce,de,V,L,O,I,_,oe,U,re,ie,pe,ue,Ee,Ce,Ae,Te,fe,we,ye,Be,ke,Se,Re,Fe,De,le,se,be,ae,B,i,a,l,f,x,R,C,$,K,z,W,X,Ge,Ye,Qe,Ke,Xe,Je,Ze,et,tt,it,st,nt,at,ot,rt,lt,ht;const t=(n=e.healthResult)==null?void 0:n.health;if(t)if(t){const Et=((h=(o=t.scanParameters)==null?void 0:o.conditions)==null?void 0:h[0])!==void 0?(r=(c=t.scanParameters)==null?void 0:c.conditions)==null?void 0:r[0]:(y=(m=t.scanParameters)==null?void 0:m.signalConditions)==null?void 0:y.hrSteadiness,Rt=((D=(k=t.scanParameters)==null?void 0:k.conditions)==null?void 0:D[1])!==void 0?(w=(v=t.scanParameters)==null?void 0:v.conditions)==null?void 0:w[1]:(u=(p=t.scanParameters)==null?void 0:p.signalConditions)==null?void 0:u.goodSnr,Ct=((b=(g=t.scanParameters)==null?void 0:g.conditions)==null?void 0:b[2])!==void 0?(S=(E=t.scanParameters)==null?void 0:E.conditions)==null?void 0:S[2]:(M=(T=t.scanParameters)==null?void 0:T.signalConditions)==null?void 0:M.noSpeedJitter,Tt=((A=(P=t.scanParameters)==null?void 0:P.conditions)==null?void 0:A[3])!==void 0?(J=(H=t.scanParameters)==null?void 0:H.conditions)==null?void 0:J[3]:(q=(ee=t.scanParameters)==null?void 0:ee.signalConditions)==null?void 0:q.goodAverageSpeed,Mt=((Z=(G=t.scanParameters)==null?void 0:G.conditions)==null?void 0:Z[4])!==void 0?(Y=(N=t.scanParameters)==null?void 0:N.conditions)==null?void 0:Y[4]:(de=(ce=t.scanParameters)==null?void 0:ce.signalConditions)==null?void 0:de.signalSteadiness;s.innerHTML=`
    <hr/>
    <fieldset>
      <legend>Vital Signs</legend>
      <ul>
      ${F("Heart Rate",(V=t.vitalSigns)==null?void 0:V.heartRate)}
      ${F("SPO2",(L=t.vitalSigns)==null?void 0:L.spo2)}
      ${F("Respiratory Rate",(O=t.vitalSigns)==null?void 0:O.respiratoryRate)}
      ${F("HRV SDNN",(I=t.vitalSigns)==null?void 0:I.hrvSdnn)}
      ${F("HRV RMSSD",(_=t.vitalSigns)==null?void 0:_.hrvRmssd)}
      ${F("Temperature",(oe=t.vitalSigns)==null?void 0:oe.temperature)}
      ${F("Blood Pressure",(U=t.vitalSigns)==null?void 0:U.bloodPressure)}
      ${F("Blood Pressure Systolic",(re=t.vitalSigns)==null?void 0:re.bloodPressureSystolic)}
      ${F("Blood Pressure Diastolic",(ie=t.vitalSigns)==null?void 0:ie.bloodPressureDiastolic)}
      ${F("Blood Alcohol",(pe=t.vitalSigns)==null?void 0:pe.bloodAlcohol)}
      ${F("Blood Sugar",(ue=t.vitalSigns)==null?void 0:ue.bloodSugar)}
      ${F("Facial Skin Age",(Ee=t.vitalSigns)==null?void 0:Ee.facialSkinAge)}
      </ul>
    </fieldset>
    <fieldset>
      <legend>Cardiovascular Risk</legend>
      <ul>
      ${F("General Risk",(Ae=(Ce=t.risks)==null?void 0:Ce.cardiovascularRisks)==null?void 0:Ae.generalRisk)}
      ${F("Coronary Heart Disease",(fe=(Te=t.risks)==null?void 0:Te.cardiovascularRisks)==null?void 0:fe.coronaryHeartDisease)}
      ${F("Congestive Heart Failure",(ye=(we=t.risks)==null?void 0:we.cardiovascularRisks)==null?void 0:ye.congestiveHeartFailure)}
      ${F("Intermittent Claudication",(ke=(Be=t.risks)==null?void 0:Be.cardiovascularRisks)==null?void 0:ke.intermittentClaudication)}
      ${F("Stroke",(Re=(Se=t.risks)==null?void 0:Se.cardiovascularRisks)==null?void 0:Re.stroke)}
      </ul>
    </fieldset>
    <fieldset>
      <legend>Holistic Health</legend>
      <ul>
      ${F("General Wellness",(Fe=t.holisticHealth)==null?void 0:Fe.generalWellness)}
      ${F("BMI",(De=t.holisticHealth)==null?void 0:De.bmi)}
      ${F("ABSI",(le=t.holisticHealth)==null?void 0:le.absi)}
      ${F("ABSIZ",(se=t.holisticHealth)==null?void 0:se.absiz)}
      ${F("Cardiac Workload",(be=t.holisticHealth)==null?void 0:be.cardiacWorkload)}
      ${F("Pulse Respiratory Quotient",(ae=t.holisticHealth)==null?void 0:ae.pulseRespiratoryQuotient)}
      ${F("Waist To Height Ratio",(B=t.holisticHealth)==null?void 0:B.waistToHeightRatio)}
      ${F("Cardiovascular System Wellness",(i=t.holisticHealth)==null?void 0:i.cardiovascularSystemWellness)}
      ${F("Mental Wellness",(a=t.holisticHealth)==null?void 0:a.mentalWellness)}
      ${F("Physical Wellness",(l=t.holisticHealth)==null?void 0:l.physicalWellness)}
      ${F("Respiratory System Wellness",(f=t.holisticHealth)==null?void 0:f.respiratorySystemWellness)}
      </ul>
    </fieldset>

    <fieldset>
      <legend>Health Risks</legend>
      <ul>
      ${F("Covid Risk",(R=(x=t.risks)==null?void 0:x.covidRisk)==null?void 0:R.covidRisk)}
      ${F("Diabetes Risk",(C=t.risks)==null?void 0:C.diabetesRisk)}
      ${F("Hypertension Risk",($=t.risks)==null?void 0:$.hypertensionRisk)}
      </ul>
    </fieldset>

    <fieldset>
      <legend>Scan Parameters</legend>
      <ul>
      ${F("Signal Quality",(K=t.scanParameters)==null?void 0:K.signalQuality)}
      ${F("Warning",(z=t.scanParameters)==null?void 0:z.warning)}
      ${F("HR Steadiness",Et)}
      ${F("Good SNR",Rt)}
      ${F("No Speed Jitter",Ct)}
      ${F("Good Average Speed",Tt)}
      ${F("Signal Steadiness",Mt)}
      ${F("Fixed Head Position",(X=(W=t.scanParameters)==null?void 0:W.signalConditions)==null?void 0:X.fixedHeadPosition)}
      ${F("No Head turning",(Ye=(Ge=t.scanParameters)==null?void 0:Ge.signalConditions)==null?void 0:Ye.noHeadTurning)}
      ${F("Adequate Brightness",(Ke=(Qe=t.scanParameters)==null?void 0:Qe.signalConditions)==null?void 0:Ke.adequateBrightness)}
      ${F("Even Lighting On Face",(Je=(Xe=t.scanParameters)==null?void 0:Xe.signalConditions)==null?void 0:Je.evenLightingOnFace)}
      ${F("Good Signal Percentage",no((et=(Ze=t.scanParameters)==null?void 0:Ze.signalConditions)==null?void 0:et.goodSignalPercentage))}
      ${F("HR Signal Quality",(it=(tt=t.scanParameters)==null?void 0:tt.signalConditions)==null?void 0:it.hrSignalQuality)}
      ${F("RR Signal Quality",(nt=(st=t.scanParameters)==null?void 0:st.signalConditions)==null?void 0:nt.rrSignalQuality)}
      ${F("BP Signal Quality",(ot=(at=t.scanParameters)==null?void 0:at.signalConditions)==null?void 0:ot.bpSignalQuality)}
      ${F("Invalid Pixel Percentage",(rt=t.scanParameters)==null?void 0:rt.invalidPixelPercentage)}
      ${F("Signal Duration",(lt=t.scanParameters)==null?void 0:lt.signalDuration)}
      ${F("SNR",(ht=t.scanParameters)==null?void 0:ht.snr)}
      </ul>
    </fieldset>
    `}else is(s)}function is(s){s.innerHTML=""}function mt(s){return s===void 0?{dot:'<span class="status-light" style="background-color: #6c757d;"></span>',text:"undefined"}:s?{dot:'<span class="status-light" style="background-color: #28a745;"></span>',text:"OK"}:{dot:'<span class="status-light" style="background-color: #dc3545;"></span>',text:"Failed"}}function oo(s,e){if(s===void 0)return{dot:'<span class="status-light" style="background-color: #6c757d;"></span>',text:"undefined"};if(s)return{dot:'<span class="status-light" style="background-color: #28a745;"></span>',text:"OK"};switch(e){case xe.TooLeft:return{dot:'<span class="status-light" style="background-color: #dc3545;"></span>',text:"Failed (Too Left)"};case xe.TooRight:return{dot:'<span class="status-light" style="background-color: #dc3545;"></span>',text:"Failed (Too Right)"};case xe.TooHigh:return{dot:'<span class="status-light" style="background-color: #dc3545;"></span>',text:"Failed (Too High)"};case xe.TooLow:return{dot:'<span class="status-light" style="background-color: #dc3545;"></span>',text:"Failed (Too Low)"};case xe.Unknown:return{dot:'<span class="status-light" style="background-color: #dc3545;"></span>',text:"Failed (Unknown)"};default:return{dot:'<span class="status-light" style="background-color: #dc3545;"></span>',text:"Failed"}}}function ro(s,e){if(s===void 0)return{dot:'<span class="status-light" style="background-color: #6c757d;"></span>',text:"undefined"};if(s)return{dot:'<span class="status-light" style="background-color: #28a745;"></span>',text:"OK"};switch(e){case $e.TooFar:return{dot:'<span class="status-light" style="background-color: #dc3545;"></span>',text:"Failed (Too Far)"};case $e.TooClose:return{dot:'<span class="status-light" style="background-color: #dc3545;"></span>',text:"Failed (Too Close)"};default:return{dot:'<span class="status-light" style="background-color: #dc3545;"></span>',text:"Failed"}}}function lo(s){return!(s===void 0||!s.lighting||!s.centered||!s.movement||!s.distance||!s.frameRate||!s.serverReady)}function ho(s,e){var m,y,k,D,v,w,p,u,g,b;const t=mt((m=e.scanConditions)==null?void 0:m.lighting),n=oo((y=e.scanConditions)==null?void 0:y.centered,(k=e.scanConditions)==null?void 0:k.facePositionCondition),o=mt((D=e.scanConditions)==null?void 0:D.movement),h=ro((v=e.scanConditions)==null?void 0:v.distance,(w=e.scanConditions)==null?void 0:w.distanceCondition),c=mt((p=e.scanConditions)==null?void 0:p.frameRate),r=mt((u=e.scanConditions)==null?void 0:u.serverReady);s.innerHTML=`
    <ul>
        <li>${t.dot} Lighting: ${t.text}</li>
        <li>${n.dot} Centered: ${n.text}</li>
        <li>${o.dot} Movement: ${o.text}</li>
        <li>${h.dot} Distance: ${h.text}</li>
        <li>${c.dot} Frame Rate: ${c.text} (FPS: ${(b=(g=e.scanConditions)==null?void 0:g.fps)==null?void 0:b.toFixed(2)})</li>
        <li>${r.dot} Server Ready: ${r.text}</li>
    </ul>
  `}var Lt;function ss(s,e){Lt=e,Lt?(s.innerHTML=`${Lt}`,s.style.display="inline-block"):(s.innerHTML="",s.style.display="none")}function co(s){ss(s,void 0)}function uo(s,e,t){s.innerHTML=e.map(n=>{const o=t.device===n.id?"selected":"";return`<option value="${n.id}" ${o}>${n.label}</option>`}).join(`
`)}async function go(s,e){const t=document.getElementById("cameraBtn"),n=document.getElementById("cameraDropdown");t==null||t.addEventListener("click",o=>{o.stopPropagation();const h=n.style.display==="block";n.style.display=h?"none":"block"}),document.addEventListener("click",o=>{!(t!=null&&t.contains(o.target))&&!(n!=null&&n.contains(o.target))&&(n.style.display="none")}),e.onCameraDevicesUpdated=o=>{uo(s,o.devices,e),o.devices.length>1&&s.removeAttribute("disabled")},s.addEventListener("change",()=>{e.device=s.value,n.style.display="none"})}function fo(s,e){var t;((t=e.healthResult)==null?void 0:t.stage)!==j.Idle?s.setAttribute("hidden",""):s.removeAttribute("hidden")}let ze=!1,bt=!1;function mo(s,e,t,n,o,h,c,r){s.addEventListener("click",()=>{if(ze)e.stopScanning(),s.innerHTML='<i class="fas fa-play"></i> Start Scan',s.removeAttribute("disabled"),ze=!1,bt=!1,o("Scan cancelled");else{c(t),r(n),bt=!1;const m=document.querySelector("#pulseValue"),y=document.querySelector("#qualityValue"),k=document.querySelector("#snrValue"),D=document.querySelector("#confidenceValue"),v=document.querySelector("#qualityScore");m.textContent="--",y.textContent="--",k.textContent="--",D.textContent="--",v.textContent="--",h(),s.innerHTML='<i class="fas fa-spinner fa-spin"></i> Scanning...',s.setAttribute("disabled","true"),ze=!0,e.startScanning()}})}function po(s,e){var n,o,h;if(!ze)return;let t="";switch((n=e.healthResult)==null?void 0:n.stage){case j.CollectingData:t=`Scanning... ${(((o=e.healthResult)==null?void 0:o.remainingTime)||0).toFixed(0)}s`;break;case j.AnalyzingData:t=`Analyzing... ${(((h=e.healthResult)==null?void 0:h.remainingTime)||0).toFixed(0)}s`;break;default:return}t&&(s.innerHTML=`<i class="fas fa-spinner fa-spin"></i> ${t}`)}function vo(s,e){bt||(bt=!0,s.innerHTML='<i class="fas fa-play"></i> Start Scan',s.removeAttribute("disabled"),ze=!1,e("Vital signs scan completed successfully!"))}const wo={apiKey:"3AQMwZWvDf566xPwuMfvd5FLjPEw3j6G3Q3SPpAC",userId:"07a51b41-e1a4-4570-94a7-04ef371cc4f3"},yo={age:30,gender:Li.Male,weight:60,height:170};window.onload=()=>{const s=document.querySelector("#startScanBtn"),e=document.querySelector("#scanConditions"),t=document.querySelector("#report"),n=document.querySelector("video"),o=document.querySelector("#error"),h=document.querySelector("#cameraPicker"),c=document.querySelector("#pulseValue"),r=document.querySelector("#qualityValue"),m=document.querySelector("#snrValue"),y=document.querySelector("#confidenceValue"),k=document.querySelector("#signalVisualizerContainer"),D=document.querySelector("#settingsBtn"),v=io({precisionMode:_e.relaxed,isActive:!0,sdkCredentials:wo,userInfo:yo,visualizationOptions:{boundingBox:{enabled:!0}},realtimeEstimationConfig:{earlyEstimation:!0,minDuration:5,minConfidence:.3}});v.onError=b=>ss(o,b),v.bind(n),go(h,v);let w=null,p="PPG";function u(b=p){p=b,w&&(w.destroy(),w=null),w=new Aa(k,{width:300,height:100,maxPoints:200,lineColor:"#00ff00",backgroundColor:"transparent",visualizationType:b})}v.onVideoFrameProcessed=b=>{var E;if(ho(e,b),fo(h,b),ao(t,b),po(s,b),ze||(lo(b.scanConditions)?s.removeAttribute("disabled"):s.setAttribute("disabled","true")),b.realtimeEstimation){const S=b.realtimeEstimation;if(S.heartRate&&(c.textContent=Math.round(S.heartRate).toString()),S.signalQuality!==void 0&&S.signalQuality!==null){const T=Math.round(S.signalQuality/100*5),M="★".repeat(T),P="☆".repeat(5-T);r.textContent=M+P;const A=document.querySelector("#qualityScore");A.textContent=`${Math.round(S.signalQuality)}%`}S.snr!==void 0&&S.snr!==null&&(m.textContent=S.snr.toFixed(1)),y.textContent=Math.round(S.confidence*100).toString()}if(w&&b.signalData&&b.realtimeEstimation){const S=b.signalData.values.length,T={...b.signalData,values:b.signalData.values.slice(-200),timestamps:b.signalData.timestamps.slice(-200)};console.log(`Signal data: original ${S} points, sliced to ${T.values.length} points`),w.updateSignal(T,b.realtimeEstimation,(E=b.healthResult)==null?void 0:E.stage)}b.healthResult&&b.healthResult.health&&vo(s,g)},mo(s,v,t,o,g,u,is,co),D.addEventListener("click",()=>{p=p==="PPG"?"ECG":"PPG",u(p),g(`Visualization type changed to ${p}`)});function g(b){const E=document.createElement("div");E.className="toast",E.textContent=b,document.body.appendChild(E),setTimeout(()=>{E.classList.add("show")},10),setTimeout(()=>{E.classList.remove("show"),setTimeout(()=>{document.body.removeChild(E)},300)},3e3)}};export{Dt as a,bo as b,xo as c,So as d,ua as f,fa as g,ko as h,j,na as n,Pi as r,on as s,Do as u};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BWAQPQyi-C5V0j-Yx.js","assets/DiWRqEKA-CT5oFAGR.js","assets/CLfIALQ9-CxIkLwLD.js","assets/C2sKXxLE-i_ow4Vux.js","assets/TRRPulLx-Bx8nZkZ2.js","assets/C3-2sbsJ-7tLxEHVz.js","assets/DNiMR7Uc-BXvHAZ5J.js","assets/DVSaSWk3-Dg7outVf.js","assets/C4IL5Qct-DJp1C_OT.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const h of c.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function t(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(r){if(r.ep)return;r.ep=!0;const c=t(r);fetch(r.href,c)}})();const Pn="modulepreload",In=function(n){return"/sdk-live-demo/realtime-demo/"+n},It={},Se=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){let m=function(y){return Promise.all(y.map(E=>Promise.resolve(E).then(T=>({status:"fulfilled",value:T}),T=>({status:"rejected",reason:T}))))};document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),l=h?.nonce||h?.getAttribute("nonce");r=m(t.map(y=>{if(y=In(y),y in It)return;It[y]=!0;const E=y.endsWith(".css"),T=E?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${y}"]${T}`))return;const w=document.createElement("link");if(w.rel=E?"stylesheet":Pn,E||(w.as="script"),w.crossOrigin="",w.href=y,l&&w.setAttribute("nonce",l),document.head.appendChild(w),E)return new Promise((b,p)=>{w.addEventListener("load",b),w.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${y}`)))})}))}function c(h){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=h,window.dispatchEvent(l),!l.defaultPrevented)throw h}return r.then(h=>{for(const l of h||[])l.status==="rejected"&&c(l.reason);return e().catch(c)})};var Fn=Object.defineProperty,_n=(n,e,t)=>e in n?Fn(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,d=(n,e,t)=>_n(n,typeof e!="symbol"?e+"":e,t),pi=(n=>(n[n.Male=0]="Male",n[n.Female=1]="Female",n))(pi||{}),Je=(n=>(n[n.Poor=0]="Poor",n[n.Good=1]="Good",n[n.Excellent=2]="Excellent",n))(Je||{}),ie=(n=>(n[n.Local=0]="Local",n[n.LocalV2=101]="LocalV2",n[n.RemoteDev=1]="RemoteDev",n[n.RemoteProd=2]="RemoteProd",n[n.AwsDev=3]="AwsDev",n[n.AwsProd=4]="AwsProd",n[n.RemoteProdEnterprise=5]="RemoteProdEnterprise",n[n.AwsFirebaseEnterpriseProd=5]="AwsFirebaseEnterpriseProd",n[n.AwsProdEnterprise=6]="AwsProdEnterprise",n[n.AwsEnterpriseProd=6]="AwsEnterpriseProd",n[n.AwsDevEnterprise=7]="AwsDevEnterprise",n[n.AwsEnterpriseDev=7]="AwsEnterpriseDev",n[n.FdaDev=8]="FdaDev",n[n.FdaProd=9]="FdaProd",n[n.Schema2Dev=10]="Schema2Dev",n[n.Schema2Prod=11]="Schema2Prod",n))(ie||{}),We=(n=>(n[n.default=0]="default",n[n.dummy=1]="dummy",n))(We||{}),z=(n=>(n[n.WaitingData=0]="WaitingData",n[n.CollectingData=1]="CollectingData",n[n.AnalyzingData=2]="AnalyzingData",n[n.Idle=3]="Idle",n))(z||{});async function Bn(n,e){return new Promise(t=>{setTimeout(()=>{t(e)},n*1e3)})}function Q(...n){console.log("[VSE Plugin]",...n)}function On(n){let e="";const t=(n.length-n.length*.8)/2;for(let s=0;s<n.length;s++)s>=t&&s<n.length-t?e+="#":e+=n[s];return e}let Ye;const Vn=new Uint8Array(16);function Ln(){if(!Ye&&(Ye=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ye))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ye(Vn)}const re=[];for(let n=0;n<256;++n)re.push((n+256).toString(16).slice(1));function Un(n,e=0){return re[n[e+0]]+re[n[e+1]]+re[n[e+2]]+re[n[e+3]]+"-"+re[n[e+4]]+re[n[e+5]]+"-"+re[n[e+6]]+re[n[e+7]]+"-"+re[n[e+8]]+re[n[e+9]]+"-"+re[n[e+10]]+re[n[e+11]]+re[n[e+12]]+re[n[e+13]]+re[n[e+14]]+re[n[e+15]]}const $n=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ft={randomUUID:$n};function Ct(n,e,t){if(Ft.randomUUID&&!n)return Ft.randomUUID();n=n||{};const s=n.random||(n.rng||Ln)();return s[6]=s[6]&15|64,s[8]=s[8]&63|128,Un(s)}function _t(n,e){return(e.getTime()-n.getTime())/1e3}function Nn(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(n[t].x!=e[t].x||n[t].y!=e[t].y)return!1;return!0}function vt(n,e){return Math.sqrt((e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y))}function Hn(n,e,t=20){let s="|";for(let r=0;r<t;r++)r/t>e?s+=" ":s+="█";return s+=`| ${e.toFixed(2)}`,`${n}: ${s}`}function de(...n){console.log("[Blink Detector]",...n)}let vi=class{constructor(n="",e=!1){d(this,"frameCount",0),d(this,"start",new Date),d(this,"name","noname"),d(this,"enableLog",!1),d(this,"lastLogTime",new Date),d(this,"logInterval",10),this.name=n,this.enableLog=e}get averageFps(){if(this.frameCount===0&&(this.start=new Date),!(this.elapsed<.5))return this.frameCount/this.elapsed}get elapsed(){return(new Date().getTime()-this.start.getTime())/1e3}tick(){this.frameCount=this.frameCount+1}reset(){this.frameCount=0,this.start=new Date,this.lastLogTime=new Date}log(){if(this.averageFps==null||(new Date().getTime()-this.lastLogTime.getTime())/1e3<this.logInterval)return;const n=this.averageFps.toFixed(2);this.enableLog&&(console.log(`[FPS ${this.name}] (${this.frameCount}/${this.elapsed})) ${n}fps`),this.lastLogTime=new Date)}};class nt{constructor(e,t){d(this,"duration"),d(this,"name"),d(this,"observers",[]),d(this,"startTime",new Date),d(this,"fps"),d(this,"signals",[]),this.name=e,this.fps=new vi(e),this.duration=t}get size(){return this.fps.averageFps===void 0?10:this.fps.averageFps*this.duration}clear(){this.signals=[],this.fps.reset(),this.startTime=new Date}add(e){if(this.fps.tick(),this.observers.forEach(t=>{var s;return(s=t.willAdd)==null?void 0:s.call(t,e)}),this.signals.length<this.size)this.signals.push({timestamp:new Date,value:e});else{for(;this.signals.length>this.size;)this.signals.shift();this.signals.push({timestamp:new Date,value:e})}this.observers.forEach(t=>{var s;return(s=t.onAdded)==null?void 0:s.call(t,e)})}get max(){return this.signals.length===0?0:Math.max(...this.signals.map(e=>e.value))}get lastEntry(){if(this.signals.length!==0)return this.signals[this.signals.length-1]}get last(){if(this.signals.length!=0)return this.signals[this.signals.length-1].value}visualize(e=0,t=1,s=20){const r=this.lastEntry||{timestamp:new Date,value:0};let c="|";for(let h=0;h<s;h++){const l=e+h/s*(t-e);l>=0?l>r.value?c+=" ":c+="█":l<r.value?c+=" ":c+="█"}return c+=`| ${r.value.toFixed(2)}`,`${((r.timestamp.getTime()-this.startTime.getTime())/1e3).toFixed(2)}s ${this.name}: ${c}`}derivative(){const e=new nt(`${this.name}'`,this.size),t=this;return this.observers.push({willAdd(s){t.last!==void 0&&e.add(s-t.last)}}),e}detectPeak(e,t){if(this.fps.averageFps===void 0)return!1;const s=Math.min(Math.floor(this.fps.averageFps*e),this.signals.length);if(s<2||this.signals.length<2)return!1;const r=this.signals[this.signals.length-1].value,c=this.signals.slice(this.signals.length-1-s,this.signals.length-2).map(l=>l.value),h=Wn(c);return r-h>h*t}}function Wn(n){return n.reduce((e,t)=>e+t,0)/n.length}const zn=.2,jn=1/20,qn=.5,Gn=2,Yn=2;class Kn{constructor(e="No name"){d(this,"name"),d(this,"movement",0),d(this,"debug",!1),d(this,"config",{movementThreshold:zn,startMovementDurationThreshold:jn,stopMovementDurationThreshold:qn,freezedTheshold:Gn,movementDurationThreshold:Yn,normalizeValue:.02}),d(this,"lastPosition"),d(this,"startMoveTime"),d(this,"startStayTime"),d(this,"lastZeroMovementTime"),d(this,"_isMoving",!1),d(this,"_lastStateChagneTime"),this.name=e}configure(e){e.stopMovementDurationThreshold!==void 0&&(de("Configure Movement Detector stopMovementDurationThreshold: ",e.stopMovementDurationThreshold),this.config.stopMovementDurationThreshold=e.stopMovementDurationThreshold),e.startMovementDurationThreshold!==void 0&&(de("Configure Movement Detector startMovementDurationThreshold: ",e.startMovementDurationThreshold),this.config.startMovementDurationThreshold=e.startMovementDurationThreshold),e.movementThreshold!==void 0&&(de("Configure Movement Detector movementThreshold: ",e.movementThreshold),this.config.movementThreshold=e.movementThreshold),e.freezedTheshold!==void 0&&(de("Configure Movement Detector freezedTheshold: ",e.freezedTheshold),this.config.freezedTheshold=e.freezedTheshold),e.unstableDurationThreshold!==void 0&&(de("Configure Movement Detector unstableDurationThreshold: ",e.unstableDurationThreshold),this.config.movementDurationThreshold=e.unstableDurationThreshold)}reset(){this.lastPosition=void 0,this.startMoveTime=void 0,this.startStayTime=void 0,this.lastZeroMovementTime=void 0,this._lastStateChagneTime=void 0,this._isMoving=!1}get movedLongEnough(){return this.startMoveTime===void 0?!1:_t(this.startMoveTime,new Date)>this.config.startMovementDurationThreshold}get stayStillLongEnough(){return this.startStayTime===void 0?!1:_t(this.startStayTime,new Date)>this.config.stopMovementDurationThreshold}update(e){if(this.lastPosition===void 0){this.lastPosition=e;return}this.movement=vt(e,this.lastPosition)/this.config.normalizeValue,this.lastPosition=e,this.movement>this.config.movementThreshold?(this.startStayTime=void 0,this.startMoveTime===void 0&&(this.startMoveTime=new Date),this.movedLongEnough&&(this.isMoving=!0)):(this.startMoveTime=void 0,this.startStayTime===void 0&&(this.startStayTime=new Date),this.stayStillLongEnough&&(this.isMoving=!1)),this.debugLog(Hn("Movement",this.movement)),this.movement===0?this.lastZeroMovementTime===void 0&&(this.lastZeroMovementTime=new Date):this.lastZeroMovementTime=void 0}get isDead(){return this.lastZeroMovementTime===void 0?!1:(new Date().getTime()-this.lastZeroMovementTime.getTime())/1e3>this.config.freezedTheshold}get unstable(){return this._lastStateChagneTime===void 0||!this.isMoving?!1:(new Date().getTime()-this._lastStateChagneTime.getTime())/1e3>this.config.movementDurationThreshold}get isMoving(){return this._isMoving}set isMoving(e){this._isMoving!==e&&(this._isMoving=e,this._lastStateChagneTime=new Date,this._isMoving?this.debugLog(`${this.name} is moving.`):this.debugLog(`${this.name} is not moving`))}debugLog(...e){this.debug&&de(...e)}}class wi{constructor(e,t){d(this,"landmarks",[]),d(this,"ltrb"),d(this,"name"),d(this,"fps"),d(this,"ears"),d(this,"movementDetector"),this.ltrb=e,this.name=t,this.fps=new vi(t),this.movementDetector=new Kn(t),this.ears=new nt(`${t} EAR`,2)}reset(){this.movementDetector.reset(),this.fps.reset(),this.ears.clear()}update(e){Nn(this.landmarks,e)||this.fps.tick(),this.fps.log(),this.landmarks=e,this.ears.add(this.aspectRatio),this.movementDetector.update(this.midPoint)}get maxEar(){return this.ears.max}get normalizedEar(){return this.aspectRatio/this.maxEar}get averageFps(){return this.fps.averageFps}get movement(){return this.movementDetector.movement}get isMoving(){return this.movementDetector.isMoving}get detectionLost(){return this.movementDetector.isDead}get unstable(){return this.movementDetector.unstable}get leftPoint(){return{x:this.landmarks[this.ltrb.left].x,y:this.landmarks[this.ltrb.left].y}}get rightPoint(){return{x:this.landmarks[this.ltrb.right].x,y:this.landmarks[this.ltrb.right].y}}get topPoint(){return{x:this.landmarks[this.ltrb.top].x,y:this.landmarks[this.ltrb.top].y}}get bottomPoint(){return{x:this.landmarks[this.ltrb.bottom].x,y:this.landmarks[this.ltrb.bottom].y}}get width(){return vt(this.leftPoint,this.rightPoint)}get height(){return vt(this.topPoint,this.bottomPoint)}get aspectRatio(){return this.height/this.width}get midPoint(){return{x:(this.leftPoint.x+this.rightPoint.x)/2,y:(this.leftPoint.y+this.rightPoint.y)/2}}}const Ke=[[263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]],Qe=[[33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]],Qn={left:Ke[0][0],top:Ke[11][1],right:Ke[15][1],bottom:Ke[4][0]},Xn={left:Qe[0][0],top:Qe[11][1],right:Qe[15][1],bottom:Qe[4][0]};class Jn extends wi{constructor(){super(Qn,"Left Eye")}}class Zn extends wi{constructor(){super(Xn,"Right Eye")}}class es{constructor(){d(this,"fps",15),d(this,"blinkCount",5),d(this,"noEyes",!1),d(this,"unstable",!1)}configure(e){}reset(){}detect(e){return!0}}const ts=.15,is=10;class ns{constructor(){d(this,"leftEye",new Jn),d(this,"rightEye",new Zn),d(this,"avgEars"),d(this,"dEars"),d(this,"debug",!1),d(this,"_blinkCount",0),d(this,"_isReset",!1),d(this,"config",{enableBlinkDetector:!0,minFps:is,earDiffThreshold:ts,enableMovementDetection:!0}),de("Blink detector created"),this.avgEars=new nt("EAR",this.leftEye.ears.duration),this.dEars=this.avgEars.derivative()}configure(e){e.earDiffThreshold!==void 0&&(de("Configure Blink Detector earDiffThreshold: ",e.earDiffThreshold),this.config.earDiffThreshold=e.earDiffThreshold),e.minFps!==void 0&&(de("Configure Blink Detector minFps: ",e.minFps),this.config.minFps=e.minFps),e.enableMovementDetection&&(de("Configure Blink Detector enableMovementDetection: ",e.enableMovementDetection),this.config.enableMovementDetection=e.enableMovementDetection),this.leftEye.movementDetector.configure(e),this.rightEye.movementDetector.configure(e)}get noEyes(){return this.leftEye.detectionLost||this.rightEye.detectionLost}get unstable(){return this.leftEye.unstable||this.rightEye.unstable}get fps(){return((this.leftEye.averageFps||0)+(this.rightEye.averageFps||0))/2}reset(){this._isReset=!0,this._blinkCount=0,this.leftEye.reset(),this.rightEye.reset(),this.avgEars.clear(),this.dEars.clear()}get blinkCount(){return this.leftEye.averageFps!==void 0&&this.rightEye.averageFps!==void 0&&this.leftEye.averageFps<this.config.minFps&&this.rightEye.averageFps<this.config.minFps?(de(`FPS < ${this.config.minFps}, blink detection is unreliable. Always return blink count 1.`),1):this._blinkCount}detect(e){if(this._isReset||this.reset(),this.leftEye.update(e),this.rightEye.update(e),this.config.enableMovementDetection){if(this.unstable)return de("Error: unstable eyes"),!1;if(this.leftEye.isMoving||this.rightEye.isMoving)return!1;if(this.noEyes)return de("Error: no eyes"),!1}this.avgEars.add(1-(this.leftEye.normalizedEar+this.rightEye.normalizedEar)/2);const t=this.dEars.last||0,s=t>this.config.earDiffThreshold;if(this.debug&&de(this.dEars.visualize(-1,1,30)),s){this._blinkCount++;const r=((this.leftEye.averageFps||0)+(this.rightEye.averageFps||0))/2;de(`Blink Detected ${this._blinkCount}. EAR_DIFF=${t.toFixed(2)} FPS=${r.toFixed(1)}`)}return s}}function Bt(n){switch(n){case We.default:return new ns;case We.dummy:return new es}}const yi=class bi{constructor(){d(this,"endpoint","https://aws-backend.panoptic.ai/s3/"),d(this,"s3ApiKey","TJ3CJ2ebRs0YK3HIwopu529q92qAZ1waBI5mWIq5")}async getDataFromS3(e,t){try{const s={type:"get-json",params:{bucket:e,objectKey:t}},r={"Content-Type":"application/json","X-Api-Key":this.s3ApiKey},c=await fetch(this.endpoint,{method:"POST",headers:r,body:JSON.stringify(s)});if(c.status!=200)throw new Error(c.statusText);return await c.json()}catch(s){throw console.error(`${bi.TAG}: Error fetching data from S3:`,s),s}}};d(yi,"TAG","AWS S3 Client");let ss=yi;var br=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function as(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function xr(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),t}var Ot={},je={},Vt;function rs(){if(Vt)return je;Vt=1,je.byteLength=l,je.toByteArray=y,je.fromByteArray=w;for(var n=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=0,c=s.length;r<c;++r)n[r]=s[r],e[s.charCodeAt(r)]=r;e[45]=62,e[95]=63;function h(b){var p=b.length;if(p%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var u=b.indexOf("=");u===-1&&(u=p);var g=u===p?0:4-u%4;return[u,g]}function l(b){var p=h(b),u=p[0],g=p[1];return(u+g)*3/4-g}function m(b,p,u){return(p+u)*3/4-u}function y(b){var p,u=h(b),g=u[0],k=u[1],D=new t(m(b,g,k)),x=0,R=k>0?g-4:g,A;for(A=0;A<R;A+=4)p=e[b.charCodeAt(A)]<<18|e[b.charCodeAt(A+1)]<<12|e[b.charCodeAt(A+2)]<<6|e[b.charCodeAt(A+3)],D[x++]=p>>16&255,D[x++]=p>>8&255,D[x++]=p&255;return k===2&&(p=e[b.charCodeAt(A)]<<2|e[b.charCodeAt(A+1)]>>4,D[x++]=p&255),k===1&&(p=e[b.charCodeAt(A)]<<10|e[b.charCodeAt(A+1)]<<4|e[b.charCodeAt(A+2)]>>2,D[x++]=p>>8&255,D[x++]=p&255),D}function E(b){return n[b>>18&63]+n[b>>12&63]+n[b>>6&63]+n[b&63]}function T(b,p,u){for(var g,k=[],D=p;D<u;D+=3)g=(b[D]<<16&16711680)+(b[D+1]<<8&65280)+(b[D+2]&255),k.push(E(g));return k.join("")}function w(b){for(var p,u=b.length,g=u%3,k=[],D=16383,x=0,R=u-g;x<R;x+=D)k.push(T(b,x,x+D>R?R:x+D));return g===1?(p=b[u-1],k.push(n[p>>2]+n[p<<4&63]+"==")):g===2&&(p=(b[u-2]<<8)+b[u-1],k.push(n[p>>10]+n[p>>4&63]+n[p<<2&63]+"=")),k.join("")}return je}var ot={};var Lt;function os(){return Lt||(Lt=1,ot.read=function(n,e,t,s,r){var c,h,l=r*8-s-1,m=(1<<l)-1,y=m>>1,E=-7,T=t?r-1:0,w=t?-1:1,b=n[e+T];for(T+=w,c=b&(1<<-E)-1,b>>=-E,E+=l;E>0;c=c*256+n[e+T],T+=w,E-=8);for(h=c&(1<<-E)-1,c>>=-E,E+=s;E>0;h=h*256+n[e+T],T+=w,E-=8);if(c===0)c=1-y;else{if(c===m)return h?NaN:(b?-1:1)*(1/0);h=h+Math.pow(2,s),c=c-y}return(b?-1:1)*h*Math.pow(2,c-s)},ot.write=function(n,e,t,s,r,c){var h,l,m,y=c*8-r-1,E=(1<<y)-1,T=E>>1,w=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,b=s?0:c-1,p=s?1:-1,u=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,h=E):(h=Math.floor(Math.log(e)/Math.LN2),e*(m=Math.pow(2,-h))<1&&(h--,m*=2),h+T>=1?e+=w/m:e+=w*Math.pow(2,1-T),e*m>=2&&(h++,m/=2),h+T>=E?(l=0,h=E):h+T>=1?(l=(e*m-1)*Math.pow(2,r),h=h+T):(l=e*Math.pow(2,T-1)*Math.pow(2,r),h=0));r>=8;n[t+b]=l&255,b+=p,l/=256,r-=8);for(h=h<<r|l,y+=r;y>0;n[t+b]=h&255,b+=p,h/=256,y-=8);n[t+b-p]|=u*128}),ot}var Ut;function ls(){return Ut||(Ut=1,(function(n){const e=rs(),t=os(),s=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=l,n.SlowBuffer=D,n.INSPECT_MAX_BYTES=50;const r=2147483647;n.kMaxLength=r,l.TYPED_ARRAY_SUPPORT=c(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const i=new Uint8Array(1),a={foo:function(){return 42}};return Object.setPrototypeOf(a,Uint8Array.prototype),Object.setPrototypeOf(i,a),i.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function h(i){if(i>r)throw new RangeError('The value "'+i+'" is invalid for option "size"');const a=new Uint8Array(i);return Object.setPrototypeOf(a,l.prototype),a}function l(i,a,o){if(typeof i=="number"){if(typeof a=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return T(i)}return m(i,a,o)}l.poolSize=8192;function m(i,a,o){if(typeof i=="string")return w(i,a);if(ArrayBuffer.isView(i))return p(i);if(i==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i);if(he(i,ArrayBuffer)||i&&he(i.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(he(i,SharedArrayBuffer)||i&&he(i.buffer,SharedArrayBuffer)))return u(i,a,o);if(typeof i=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const f=i.valueOf&&i.valueOf();if(f!=null&&f!==i)return l.from(f,a,o);const v=g(i);if(v)return v;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof i[Symbol.toPrimitive]=="function")return l.from(i[Symbol.toPrimitive]("string"),a,o);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i)}l.from=function(i,a,o){return m(i,a,o)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array);function y(i){if(typeof i!="number")throw new TypeError('"size" argument must be of type number');if(i<0)throw new RangeError('The value "'+i+'" is invalid for option "size"')}function E(i,a,o){return y(i),i<=0?h(i):a!==void 0?typeof o=="string"?h(i).fill(a,o):h(i).fill(a):h(i)}l.alloc=function(i,a,o){return E(i,a,o)};function T(i){return y(i),h(i<0?0:k(i)|0)}l.allocUnsafe=function(i){return T(i)},l.allocUnsafeSlow=function(i){return T(i)};function w(i,a){if((typeof a!="string"||a==="")&&(a="utf8"),!l.isEncoding(a))throw new TypeError("Unknown encoding: "+a);const o=x(i,a)|0;let f=h(o);const v=f.write(i,a);return v!==o&&(f=f.slice(0,v)),f}function b(i){const a=i.length<0?0:k(i.length)|0,o=h(a);for(let f=0;f<a;f+=1)o[f]=i[f]&255;return o}function p(i){if(he(i,Uint8Array)){const a=new Uint8Array(i);return u(a.buffer,a.byteOffset,a.byteLength)}return b(i)}function u(i,a,o){if(a<0||i.byteLength<a)throw new RangeError('"offset" is outside of buffer bounds');if(i.byteLength<a+(o||0))throw new RangeError('"length" is outside of buffer bounds');let f;return a===void 0&&o===void 0?f=new Uint8Array(i):o===void 0?f=new Uint8Array(i,a):f=new Uint8Array(i,a,o),Object.setPrototypeOf(f,l.prototype),f}function g(i){if(l.isBuffer(i)){const a=k(i.length)|0,o=h(a);return o.length===0||i.copy(o,0,0,a),o}if(i.length!==void 0)return typeof i.length!="number"||ae(i.length)?h(0):b(i);if(i.type==="Buffer"&&Array.isArray(i.data))return b(i.data)}function k(i){if(i>=r)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return i|0}function D(i){return+i!=i&&(i=0),l.alloc(+i)}l.isBuffer=function(i){return i!=null&&i._isBuffer===!0&&i!==l.prototype},l.compare=function(i,a){if(he(i,Uint8Array)&&(i=l.from(i,i.offset,i.byteLength)),he(a,Uint8Array)&&(a=l.from(a,a.offset,a.byteLength)),!l.isBuffer(i)||!l.isBuffer(a))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(i===a)return 0;let o=i.length,f=a.length;for(let v=0,S=Math.min(o,f);v<S;++v)if(i[v]!==a[v]){o=i[v],f=a[v];break}return o<f?-1:f<o?1:0},l.isEncoding=function(i){switch(String(i).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(i,a){if(!Array.isArray(i))throw new TypeError('"list" argument must be an Array of Buffers');if(i.length===0)return l.alloc(0);let o;if(a===void 0)for(a=0,o=0;o<i.length;++o)a+=i[o].length;const f=l.allocUnsafe(a);let v=0;for(o=0;o<i.length;++o){let S=i[o];if(he(S,Uint8Array))v+S.length>f.length?(l.isBuffer(S)||(S=l.from(S)),S.copy(f,v)):Uint8Array.prototype.set.call(f,S,v);else if(l.isBuffer(S))S.copy(f,v);else throw new TypeError('"list" argument must be an Array of Buffers');v+=S.length}return f};function x(i,a){if(l.isBuffer(i))return i.length;if(ArrayBuffer.isView(i)||he(i,ArrayBuffer))return i.byteLength;if(typeof i!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof i);const o=i.length,f=arguments.length>2&&arguments[2]===!0;if(!f&&o===0)return 0;let v=!1;for(;;)switch(a){case"ascii":case"latin1":case"binary":return o;case"utf8":case"utf-8":return Ee(i).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return o*2;case"hex":return o>>>1;case"base64":return Ue(i).length;default:if(v)return f?-1:Ee(i).length;a=(""+a).toLowerCase(),v=!0}}l.byteLength=x;function R(i,a,o){let f=!1;if((a===void 0||a<0)&&(a=0),a>this.length||((o===void 0||o>this.length)&&(o=this.length),o<=0)||(o>>>=0,a>>>=0,o<=a))return"";for(i||(i="utf8");;)switch(i){case"hex":return N(this,a,o);case"utf8":case"utf-8":return W(this,a,o);case"ascii":return fe(this,a,o);case"latin1":case"binary":return U(this,a,o);case"base64":return Z(this,a,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,a,o);default:if(f)throw new TypeError("Unknown encoding: "+i);i=(i+"").toLowerCase(),f=!0}}l.prototype._isBuffer=!0;function A(i,a,o){const f=i[a];i[a]=i[o],i[o]=f}l.prototype.swap16=function(){const i=this.length;if(i%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let a=0;a<i;a+=2)A(this,a,a+1);return this},l.prototype.swap32=function(){const i=this.length;if(i%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let a=0;a<i;a+=4)A(this,a,a+3),A(this,a+1,a+2);return this},l.prototype.swap64=function(){const i=this.length;if(i%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let a=0;a<i;a+=8)A(this,a,a+7),A(this,a+1,a+6),A(this,a+2,a+5),A(this,a+3,a+4);return this},l.prototype.toString=function(){const i=this.length;return i===0?"":arguments.length===0?W(this,0,i):R.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(i){if(!l.isBuffer(i))throw new TypeError("Argument must be a Buffer");return this===i?!0:l.compare(this,i)===0},l.prototype.inspect=function(){let i="";const a=n.INSPECT_MAX_BYTES;return i=this.toString("hex",0,a).replace(/(.{2})/g,"$1 ").trim(),this.length>a&&(i+=" ... "),"<Buffer "+i+">"},s&&(l.prototype[s]=l.prototype.inspect),l.prototype.compare=function(i,a,o,f,v){if(he(i,Uint8Array)&&(i=l.from(i,i.offset,i.byteLength)),!l.isBuffer(i))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof i);if(a===void 0&&(a=0),o===void 0&&(o=i?i.length:0),f===void 0&&(f=0),v===void 0&&(v=this.length),a<0||o>i.length||f<0||v>this.length)throw new RangeError("out of range index");if(f>=v&&a>=o)return 0;if(f>=v)return-1;if(a>=o)return 1;if(a>>>=0,o>>>=0,f>>>=0,v>>>=0,this===i)return 0;let S=v-f,C=o-a;const L=Math.min(S,C),J=this.slice(f,v),q=i.slice(a,o);for(let G=0;G<L;++G)if(J[G]!==q[G]){S=J[G],C=q[G];break}return S<C?-1:C<S?1:0};function P(i,a,o,f,v){if(i.length===0)return-1;if(typeof o=="string"?(f=o,o=0):o>2147483647?o=2147483647:o<-2147483648&&(o=-2147483648),o=+o,ae(o)&&(o=v?0:i.length-1),o<0&&(o=i.length+o),o>=i.length){if(v)return-1;o=i.length-1}else if(o<0)if(v)o=0;else return-1;if(typeof a=="string"&&(a=l.from(a,f)),l.isBuffer(a))return a.length===0?-1:M(i,a,o,f,v);if(typeof a=="number")return a=a&255,typeof Uint8Array.prototype.indexOf=="function"?v?Uint8Array.prototype.indexOf.call(i,a,o):Uint8Array.prototype.lastIndexOf.call(i,a,o):M(i,[a],o,f,v);throw new TypeError("val must be string, number or Buffer")}function M(i,a,o,f,v){let S=1,C=i.length,L=a.length;if(f!==void 0&&(f=String(f).toLowerCase(),f==="ucs2"||f==="ucs-2"||f==="utf16le"||f==="utf-16le")){if(i.length<2||a.length<2)return-1;S=2,C/=2,L/=2,o/=2}function J(G,ee){return S===1?G[ee]:G.readUInt16BE(ee*S)}let q;if(v){let G=-1;for(q=o;q<C;q++)if(J(i,q)===J(a,G===-1?0:q-G)){if(G===-1&&(G=q),q-G+1===L)return G*S}else G!==-1&&(q-=q-G),G=-1}else for(o+L>C&&(o=C-L),q=o;q>=0;q--){let G=!0;for(let ee=0;ee<L;ee++)if(J(i,q+ee)!==J(a,ee)){G=!1;break}if(G)return q}return-1}l.prototype.includes=function(i,a,o){return this.indexOf(i,a,o)!==-1},l.prototype.indexOf=function(i,a,o){return P(this,i,a,o,!0)},l.prototype.lastIndexOf=function(i,a,o){return P(this,i,a,o,!1)};function F(i,a,o,f){o=Number(o)||0;const v=i.length-o;f?(f=Number(f),f>v&&(f=v)):f=v;const S=a.length;f>S/2&&(f=S/2);let C;for(C=0;C<f;++C){const L=parseInt(a.substr(C*2,2),16);if(ae(L))return C;i[o+C]=L}return C}function Y(i,a,o,f){return Te(Ee(a,i.length-o),i,o,f)}function $(i,a,o,f){return Te(Ce(a),i,o,f)}function j(i,a,o,f){return Te(Ue(a),i,o,f)}function K(i,a,o,f){return Te(Ae(a,i.length-o),i,o,f)}l.prototype.write=function(i,a,o,f){if(a===void 0)f="utf8",o=this.length,a=0;else if(o===void 0&&typeof a=="string")f=a,o=this.length,a=0;else if(isFinite(a))a=a>>>0,isFinite(o)?(o=o>>>0,f===void 0&&(f="utf8")):(f=o,o=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const v=this.length-a;if((o===void 0||o>v)&&(o=v),i.length>0&&(o<0||a<0)||a>this.length)throw new RangeError("Attempt to write outside buffer bounds");f||(f="utf8");let S=!1;for(;;)switch(f){case"hex":return F(this,i,a,o);case"utf8":case"utf-8":return Y(this,i,a,o);case"ascii":case"latin1":case"binary":return $(this,i,a,o);case"base64":return j(this,i,a,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return K(this,i,a,o);default:if(S)throw new TypeError("Unknown encoding: "+f);f=(""+f).toLowerCase(),S=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Z(i,a,o){return a===0&&o===i.length?e.fromByteArray(i):e.fromByteArray(i.slice(a,o))}function W(i,a,o){o=Math.min(i.length,o);const f=[];let v=a;for(;v<o;){const S=i[v];let C=null,L=S>239?4:S>223?3:S>191?2:1;if(v+L<=o){let J,q,G,ee;switch(L){case 1:S<128&&(C=S);break;case 2:J=i[v+1],(J&192)===128&&(ee=(S&31)<<6|J&63,ee>127&&(C=ee));break;case 3:J=i[v+1],q=i[v+2],(J&192)===128&&(q&192)===128&&(ee=(S&15)<<12|(J&63)<<6|q&63,ee>2047&&(ee<55296||ee>57343)&&(C=ee));break;case 4:J=i[v+1],q=i[v+2],G=i[v+3],(J&192)===128&&(q&192)===128&&(G&192)===128&&(ee=(S&15)<<18|(J&63)<<12|(q&63)<<6|G&63,ee>65535&&ee<1114112&&(C=ee))}}C===null?(C=65533,L=1):C>65535&&(C-=65536,f.push(C>>>10&1023|55296),C=56320|C&1023),f.push(C),v+=L}return ue(f)}const X=4096;function ue(i){const a=i.length;if(a<=X)return String.fromCharCode.apply(String,i);let o="",f=0;for(;f<a;)o+=String.fromCharCode.apply(String,i.slice(f,f+=X));return o}function fe(i,a,o){let f="";o=Math.min(i.length,o);for(let v=a;v<o;++v)f+=String.fromCharCode(i[v]&127);return f}function U(i,a,o){let f="";o=Math.min(i.length,o);for(let v=a;v<o;++v)f+=String.fromCharCode(i[v]);return f}function N(i,a,o){const f=i.length;(!a||a<0)&&(a=0),(!o||o<0||o>f)&&(o=f);let v="";for(let S=a;S<o;++S)v+=xe[i[S]];return v}function V(i,a,o){const f=i.slice(a,o);let v="";for(let S=0;S<f.length-1;S+=2)v+=String.fromCharCode(f[S]+f[S+1]*256);return v}l.prototype.slice=function(i,a){const o=this.length;i=~~i,a=a===void 0?o:~~a,i<0?(i+=o,i<0&&(i=0)):i>o&&(i=o),a<0?(a+=o,a<0&&(a=0)):a>o&&(a=o),a<i&&(a=i);const f=this.subarray(i,a);return Object.setPrototypeOf(f,l.prototype),f};function _(i,a,o){if(i%1!==0||i<0)throw new RangeError("offset is not uint");if(i+a>o)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(i,a,o){i=i>>>0,a=a>>>0,o||_(i,a,this.length);let f=this[i],v=1,S=0;for(;++S<a&&(v*=256);)f+=this[i+S]*v;return f},l.prototype.readUintBE=l.prototype.readUIntBE=function(i,a,o){i=i>>>0,a=a>>>0,o||_(i,a,this.length);let f=this[i+--a],v=1;for(;a>0&&(v*=256);)f+=this[i+--a]*v;return f},l.prototype.readUint8=l.prototype.readUInt8=function(i,a){return i=i>>>0,a||_(i,1,this.length),this[i]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(i,a){return i=i>>>0,a||_(i,2,this.length),this[i]|this[i+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(i,a){return i=i>>>0,a||_(i,2,this.length),this[i]<<8|this[i+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(i,a){return i=i>>>0,a||_(i,4,this.length),(this[i]|this[i+1]<<8|this[i+2]<<16)+this[i+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(i,a){return i=i>>>0,a||_(i,4,this.length),this[i]*16777216+(this[i+1]<<16|this[i+2]<<8|this[i+3])},l.prototype.readBigUInt64LE=oe(function(i){i=i>>>0,pe(i,"offset");const a=this[i],o=this[i+7];(a===void 0||o===void 0)&&ye(i,this.length-8);const f=a+this[++i]*2**8+this[++i]*2**16+this[++i]*2**24,v=this[++i]+this[++i]*2**8+this[++i]*2**16+o*2**24;return BigInt(f)+(BigInt(v)<<BigInt(32))}),l.prototype.readBigUInt64BE=oe(function(i){i=i>>>0,pe(i,"offset");const a=this[i],o=this[i+7];(a===void 0||o===void 0)&&ye(i,this.length-8);const f=a*2**24+this[++i]*2**16+this[++i]*2**8+this[++i],v=this[++i]*2**24+this[++i]*2**16+this[++i]*2**8+o;return(BigInt(f)<<BigInt(32))+BigInt(v)}),l.prototype.readIntLE=function(i,a,o){i=i>>>0,a=a>>>0,o||_(i,a,this.length);let f=this[i],v=1,S=0;for(;++S<a&&(v*=256);)f+=this[i+S]*v;return v*=128,f>=v&&(f-=Math.pow(2,8*a)),f},l.prototype.readIntBE=function(i,a,o){i=i>>>0,a=a>>>0,o||_(i,a,this.length);let f=a,v=1,S=this[i+--f];for(;f>0&&(v*=256);)S+=this[i+--f]*v;return v*=128,S>=v&&(S-=Math.pow(2,8*a)),S},l.prototype.readInt8=function(i,a){return i=i>>>0,a||_(i,1,this.length),this[i]&128?(255-this[i]+1)*-1:this[i]},l.prototype.readInt16LE=function(i,a){i=i>>>0,a||_(i,2,this.length);const o=this[i]|this[i+1]<<8;return o&32768?o|4294901760:o},l.prototype.readInt16BE=function(i,a){i=i>>>0,a||_(i,2,this.length);const o=this[i+1]|this[i]<<8;return o&32768?o|4294901760:o},l.prototype.readInt32LE=function(i,a){return i=i>>>0,a||_(i,4,this.length),this[i]|this[i+1]<<8|this[i+2]<<16|this[i+3]<<24},l.prototype.readInt32BE=function(i,a){return i=i>>>0,a||_(i,4,this.length),this[i]<<24|this[i+1]<<16|this[i+2]<<8|this[i+3]},l.prototype.readBigInt64LE=oe(function(i){i=i>>>0,pe(i,"offset");const a=this[i],o=this[i+7];(a===void 0||o===void 0)&&ye(i,this.length-8);const f=this[i+4]+this[i+5]*2**8+this[i+6]*2**16+(o<<24);return(BigInt(f)<<BigInt(32))+BigInt(a+this[++i]*2**8+this[++i]*2**16+this[++i]*2**24)}),l.prototype.readBigInt64BE=oe(function(i){i=i>>>0,pe(i,"offset");const a=this[i],o=this[i+7];(a===void 0||o===void 0)&&ye(i,this.length-8);const f=(a<<24)+this[++i]*2**16+this[++i]*2**8+this[++i];return(BigInt(f)<<BigInt(32))+BigInt(this[++i]*2**24+this[++i]*2**16+this[++i]*2**8+o)}),l.prototype.readFloatLE=function(i,a){return i=i>>>0,a||_(i,4,this.length),t.read(this,i,!0,23,4)},l.prototype.readFloatBE=function(i,a){return i=i>>>0,a||_(i,4,this.length),t.read(this,i,!1,23,4)},l.prototype.readDoubleLE=function(i,a){return i=i>>>0,a||_(i,8,this.length),t.read(this,i,!0,52,8)},l.prototype.readDoubleBE=function(i,a){return i=i>>>0,a||_(i,8,this.length),t.read(this,i,!1,52,8)};function B(i,a,o,f,v,S){if(!l.isBuffer(i))throw new TypeError('"buffer" argument must be a Buffer instance');if(a>v||a<S)throw new RangeError('"value" argument is out of bounds');if(o+f>i.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(i,a,o,f){if(i=+i,a=a>>>0,o=o>>>0,!f){const C=Math.pow(2,8*o)-1;B(this,i,a,o,C,0)}let v=1,S=0;for(this[a]=i&255;++S<o&&(v*=256);)this[a+S]=i/v&255;return a+o},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(i,a,o,f){if(i=+i,a=a>>>0,o=o>>>0,!f){const C=Math.pow(2,8*o)-1;B(this,i,a,o,C,0)}let v=o-1,S=1;for(this[a+v]=i&255;--v>=0&&(S*=256);)this[a+v]=i/S&255;return a+o},l.prototype.writeUint8=l.prototype.writeUInt8=function(i,a,o){return i=+i,a=a>>>0,o||B(this,i,a,1,255,0),this[a]=i&255,a+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(i,a,o){return i=+i,a=a>>>0,o||B(this,i,a,2,65535,0),this[a]=i&255,this[a+1]=i>>>8,a+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(i,a,o){return i=+i,a=a>>>0,o||B(this,i,a,2,65535,0),this[a]=i>>>8,this[a+1]=i&255,a+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(i,a,o){return i=+i,a=a>>>0,o||B(this,i,a,4,4294967295,0),this[a+3]=i>>>24,this[a+2]=i>>>16,this[a+1]=i>>>8,this[a]=i&255,a+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(i,a,o){return i=+i,a=a>>>0,o||B(this,i,a,4,4294967295,0),this[a]=i>>>24,this[a+1]=i>>>16,this[a+2]=i>>>8,this[a+3]=i&255,a+4};function le(i,a,o,f,v){Be(a,f,v,i,o,7);let S=Number(a&BigInt(4294967295));i[o++]=S,S=S>>8,i[o++]=S,S=S>>8,i[o++]=S,S=S>>8,i[o++]=S;let C=Number(a>>BigInt(32)&BigInt(4294967295));return i[o++]=C,C=C>>8,i[o++]=C,C=C>>8,i[o++]=C,C=C>>8,i[o++]=C,o}function H(i,a,o,f,v){Be(a,f,v,i,o,7);let S=Number(a&BigInt(4294967295));i[o+7]=S,S=S>>8,i[o+6]=S,S=S>>8,i[o+5]=S,S=S>>8,i[o+4]=S;let C=Number(a>>BigInt(32)&BigInt(4294967295));return i[o+3]=C,C=C>>8,i[o+2]=C,C=C>>8,i[o+1]=C,C=C>>8,i[o]=C,o+8}l.prototype.writeBigUInt64LE=oe(function(i,a=0){return le(this,i,a,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=oe(function(i,a=0){return H(this,i,a,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(i,a,o,f){if(i=+i,a=a>>>0,!f){const L=Math.pow(2,8*o-1);B(this,i,a,o,L-1,-L)}let v=0,S=1,C=0;for(this[a]=i&255;++v<o&&(S*=256);)i<0&&C===0&&this[a+v-1]!==0&&(C=1),this[a+v]=(i/S>>0)-C&255;return a+o},l.prototype.writeIntBE=function(i,a,o,f){if(i=+i,a=a>>>0,!f){const L=Math.pow(2,8*o-1);B(this,i,a,o,L-1,-L)}let v=o-1,S=1,C=0;for(this[a+v]=i&255;--v>=0&&(S*=256);)i<0&&C===0&&this[a+v+1]!==0&&(C=1),this[a+v]=(i/S>>0)-C&255;return a+o},l.prototype.writeInt8=function(i,a,o){return i=+i,a=a>>>0,o||B(this,i,a,1,127,-128),i<0&&(i=255+i+1),this[a]=i&255,a+1},l.prototype.writeInt16LE=function(i,a,o){return i=+i,a=a>>>0,o||B(this,i,a,2,32767,-32768),this[a]=i&255,this[a+1]=i>>>8,a+2},l.prototype.writeInt16BE=function(i,a,o){return i=+i,a=a>>>0,o||B(this,i,a,2,32767,-32768),this[a]=i>>>8,this[a+1]=i&255,a+2},l.prototype.writeInt32LE=function(i,a,o){return i=+i,a=a>>>0,o||B(this,i,a,4,2147483647,-2147483648),this[a]=i&255,this[a+1]=i>>>8,this[a+2]=i>>>16,this[a+3]=i>>>24,a+4},l.prototype.writeInt32BE=function(i,a,o){return i=+i,a=a>>>0,o||B(this,i,a,4,2147483647,-2147483648),i<0&&(i=4294967295+i+1),this[a]=i>>>24,this[a+1]=i>>>16,this[a+2]=i>>>8,this[a+3]=i&255,a+4},l.prototype.writeBigInt64LE=oe(function(i,a=0){return le(this,i,a,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=oe(function(i,a=0){return H(this,i,a,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ce(i,a,o,f,v,S){if(o+f>i.length)throw new RangeError("Index out of range");if(o<0)throw new RangeError("Index out of range")}function ne(i,a,o,f,v){return a=+a,o=o>>>0,v||ce(i,a,o,4),t.write(i,a,o,f,23,4),o+4}l.prototype.writeFloatLE=function(i,a,o){return ne(this,i,a,!0,o)},l.prototype.writeFloatBE=function(i,a,o){return ne(this,i,a,!1,o)};function we(i,a,o,f,v){return a=+a,o=o>>>0,v||ce(i,a,o,8),t.write(i,a,o,f,52,8),o+8}l.prototype.writeDoubleLE=function(i,a,o){return we(this,i,a,!0,o)},l.prototype.writeDoubleBE=function(i,a,o){return we(this,i,a,!1,o)},l.prototype.copy=function(i,a,o,f){if(!l.isBuffer(i))throw new TypeError("argument should be a Buffer");if(o||(o=0),!f&&f!==0&&(f=this.length),a>=i.length&&(a=i.length),a||(a=0),f>0&&f<o&&(f=o),f===o||i.length===0||this.length===0)return 0;if(a<0)throw new RangeError("targetStart out of bounds");if(o<0||o>=this.length)throw new RangeError("Index out of range");if(f<0)throw new RangeError("sourceEnd out of bounds");f>this.length&&(f=this.length),i.length-a<f-o&&(f=i.length-a+o);const v=f-o;return this===i&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(a,o,f):Uint8Array.prototype.set.call(i,this.subarray(o,f),a),v},l.prototype.fill=function(i,a,o,f){if(typeof i=="string"){if(typeof a=="string"?(f=a,a=0,o=this.length):typeof o=="string"&&(f=o,o=this.length),f!==void 0&&typeof f!="string")throw new TypeError("encoding must be a string");if(typeof f=="string"&&!l.isEncoding(f))throw new TypeError("Unknown encoding: "+f);if(i.length===1){const S=i.charCodeAt(0);(f==="utf8"&&S<128||f==="latin1")&&(i=S)}}else typeof i=="number"?i=i&255:typeof i=="boolean"&&(i=Number(i));if(a<0||this.length<a||this.length<o)throw new RangeError("Out of range index");if(o<=a)return this;a=a>>>0,o=o===void 0?this.length:o>>>0,i||(i=0);let v;if(typeof i=="number")for(v=a;v<o;++v)this[v]=i;else{const S=l.isBuffer(i)?i:l.from(i,f),C=S.length;if(C===0)throw new TypeError('The value "'+i+'" is invalid for argument "value"');for(v=0;v<o-a;++v)this[v+a]=S[v%C]}return this};const ge={};function Me(i,a,o){ge[i]=class extends o{constructor(){super(),Object.defineProperty(this,"message",{value:a.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${i}]`,this.stack,delete this.name}get code(){return i}set code(f){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:f,writable:!0})}toString(){return`${this.name} [${i}]: ${this.message}`}}}Me("ERR_BUFFER_OUT_OF_BOUNDS",function(i){return i?`${i} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Me("ERR_INVALID_ARG_TYPE",function(i,a){return`The "${i}" argument must be of type number. Received type ${typeof a}`},TypeError),Me("ERR_OUT_OF_RANGE",function(i,a,o){let f=`The value of "${i}" is out of range.`,v=o;return Number.isInteger(o)&&Math.abs(o)>2**32?v=_e(String(o)):typeof o=="bigint"&&(v=String(o),(o>BigInt(2)**BigInt(32)||o<-(BigInt(2)**BigInt(32)))&&(v=_e(v)),v+="n"),f+=` It must be ${a}. Received ${v}`,f},RangeError);function _e(i){let a="",o=i.length;const f=i[0]==="-"?1:0;for(;o>=f+4;o-=3)a=`_${i.slice(o-3,o)}${a}`;return`${i.slice(0,o)}${a}`}function Le(i,a,o){pe(a,"offset"),(i[a]===void 0||i[a+o]===void 0)&&ye(a,i.length-(o+1))}function Be(i,a,o,f,v,S){if(i>o||i<a){const C=typeof a=="bigint"?"n":"";let L;throw a===0||a===BigInt(0)?L=`>= 0${C} and < 2${C} ** ${(S+1)*8}${C}`:L=`>= -(2${C} ** ${(S+1)*8-1}${C}) and < 2 ** ${(S+1)*8-1}${C}`,new ge.ERR_OUT_OF_RANGE("value",L,i)}Le(f,v,S)}function pe(i,a){if(typeof i!="number")throw new ge.ERR_INVALID_ARG_TYPE(a,"number",i)}function ye(i,a,o){throw Math.floor(i)!==i?(pe(i,o),new ge.ERR_OUT_OF_RANGE("offset","an integer",i)):a<0?new ge.ERR_BUFFER_OUT_OF_BOUNDS:new ge.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${a}`,i)}const be=/[^+/0-9A-Za-z-_]/g;function ze(i){if(i=i.split("=")[0],i=i.trim().replace(be,""),i.length<2)return"";for(;i.length%4!==0;)i=i+"=";return i}function Ee(i,a){a=a||1/0;let o;const f=i.length;let v=null;const S=[];for(let C=0;C<f;++C){if(o=i.charCodeAt(C),o>55295&&o<57344){if(!v){if(o>56319){(a-=3)>-1&&S.push(239,191,189);continue}else if(C+1===f){(a-=3)>-1&&S.push(239,191,189);continue}v=o;continue}if(o<56320){(a-=3)>-1&&S.push(239,191,189),v=o;continue}o=(v-55296<<10|o-56320)+65536}else v&&(a-=3)>-1&&S.push(239,191,189);if(v=null,o<128){if((a-=1)<0)break;S.push(o)}else if(o<2048){if((a-=2)<0)break;S.push(o>>6|192,o&63|128)}else if(o<65536){if((a-=3)<0)break;S.push(o>>12|224,o>>6&63|128,o&63|128)}else if(o<1114112){if((a-=4)<0)break;S.push(o>>18|240,o>>12&63|128,o>>6&63|128,o&63|128)}else throw new Error("Invalid code point")}return S}function Ce(i){const a=[];for(let o=0;o<i.length;++o)a.push(i.charCodeAt(o)&255);return a}function Ae(i,a){let o,f,v;const S=[];for(let C=0;C<i.length&&!((a-=2)<0);++C)o=i.charCodeAt(C),f=o>>8,v=o%256,S.push(v),S.push(f);return S}function Ue(i){return e.toByteArray(ze(i))}function Te(i,a,o,f){let v;for(v=0;v<f&&!(v+o>=a.length||v>=i.length);++v)a[v+o]=i[v];return v}function he(i,a){return i instanceof a||i!=null&&i.constructor!=null&&i.constructor.name!=null&&i.constructor.name===a.name}function ae(i){return i!==i}const xe=(function(){const i="0123456789abcdef",a=new Array(256);for(let o=0;o<16;++o){const f=o*16;for(let v=0;v<16;++v)a[f+v]=i[o]+i[v]}return a})();function oe(i){return typeof BigInt>"u"?O:i}function O(){throw new Error("BigInt not supported")}})(Ot)),Ot}var lt=ls();const xi=class Ze{constructor(){d(this,"key",null),d(this,"awsS3Service",new ss)}async encrypt(e){const t=JSON.stringify(e),s=await this.getKey(),r=window.crypto.getRandomValues(new Uint8Array(Ze.GCM_IV_LENGTH)),c=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r},s,new TextEncoder().encode(t)),h=new Uint8Array([...r,...new Uint8Array(c)]);return lt.Buffer.from(h).toString("base64")}async decrypt(e){try{const t=await this.getKey(),s=new Uint8Array(lt.Buffer.from(e,"base64")),r=s.slice(0,Ze.GCM_IV_LENGTH),c=s.slice(Ze.GCM_IV_LENGTH),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:r},t,c);return new TextDecoder().decode(h)}catch(t){return console.error("Decryption error:",t),null}}async getKey(){if(!this.key)try{const e=await this.awsS3Service.getDataFromS3("fda-app-secure-store","aesKey.json"),t=lt.Buffer.from(e.key,"base64");this.key=await window.crypto.subtle.importKey("raw",t,{name:"AES-GCM"},!1,["encrypt","decrypt"])}catch(e){throw new Error(`Key retrieval failed: ${e}`)}return this.key}};d(xi,"GCM_IV_LENGTH",12);let wt=xi;const cs=15,hs={development:!0,serverHost:"http://localhost:5000",endPoints:{getHealth:"/api/v2/get_health",sendHealthReport:void 0},coldStartDuration:0,schemaVersion:"1.4",encrypted:!1},ds={development:!0,serverHost:"http://localhost:5000",endPoints:{getHealth:"/vitals-v2/get-health",sendHealthReport:void 0},coldStartDuration:0,schemaVersion:"2.1",encrypted:!0},us={development:!0,serverHost:"https://backend.panoptic.ai",endPoints:{getHealth:"/v2/dev/get-health",sendHealthReport:"/email/dev"},coldStartDuration:25,schemaVersion:"1.2",encrypted:!1},fs={development:!1,serverHost:"https://backend.panoptic.ai",endPoints:{getHealth:"/v2/get-health",sendHealthReport:"/email"},coldStartDuration:25,schemaVersion:"1.2",encrypted:!1},gs={development:!0,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/v2/dev/get-health",sendHealthReport:"/email/dev"},coldStartDuration:25,schemaVersion:"1.4",encrypted:!1},ki={development:!1,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/v2/get-health",sendHealthReport:"/email"},coldStartDuration:25,schemaVersion:"1.4",encrypted:!1},ms={development:!1,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/v2/get-health-company",sendHealthReport:"/email"},coldStartDuration:25,schemaVersion:"1.2",encrypted:!1},ps={development:!0,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/v2/dev/get-health-company",sendHealthReport:"/email/dev"},coldStartDuration:25,schemaVersion:"1.5",encrypted:!1},vs={development:!1,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/v2/get-health-company",sendHealthReport:"/email"},coldStartDuration:25,schemaVersion:"1.5",encrypted:!1},ws={development:!0,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/vitals-v2-dev/get-health",sendHealthReport:void 0},coldStartDuration:25,schemaVersion:"2.2",encrypted:!0},ys={development:!1,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/vitals-v2/get-health",sendHealthReport:void 0},coldStartDuration:25,schemaVersion:"2.2",encrypted:!0};class $t{constructor(e){d(this,"windowDuration",cs),d(this,"deviceId",Ct()),d(this,"config",ki),d(this,"apiKey"),d(this,"aesCryptor"),d(this,"httpCall",(...t)=>fetch(...t)),this.config=e}setServerUrl(e){this.config.serverHost=e}getUrl(){return this.config.serverHost+this.config.endPoints.getHealth}get httpHeaders(){const e={"Content-Type":"application/json"};return this.apiKey&&(e["X-Api-Key"]=this.apiKey),e}async wakeUpServer(){const e=this.getUrl();this.aesCryptor=new wt;let t={isAlive:!0};this.config.encrypted&&(t={data:await this.aesCryptor.encrypt(t)}),await this.httpCall(e,{method:"POST",headers:this.httpHeaders,body:JSON.stringify(t)})}async callAPI(e,t){this.aesCryptor=new wt;let s=t;this.config.encrypted&&(s={data:await this.aesCryptor.encrypt(t)});const r=await this.httpCall(e,{method:"POST",headers:this.httpHeaders,body:JSON.stringify(s)});if(r.status!=200){const h=await r.text();throw new Error(`Error: ${r.status} ${h}`)}let c=await r.json();if(this.config.encrypted){const h=await this.aesCryptor.decrypt(c.data);h&&(c=JSON.parse(h))}return c}getUrlSES(){return this.config.serverHost+this.config.endPoints.sendHealthReport}async sendHealthReport(e,t,s,r){const c=this.getUrlSES(),h={type:"attachment",params:{Recipients:e,EmailContent:s.emailContent,EmailSubject:s.emailSubject,FileName:s.fileName,Attachments:t,Source:r}},l=await this.httpCall(c,{method:"POST",headers:this.httpHeaders,body:JSON.stringify(h)});if(l.status!=200)throw new Error(l.statusText);return l.json()}}var et={exports:{}},bs=et.exports,Nt;function xs(){return Nt||(Nt=1,(function(n,e){(function(t,s){var r="1.0.39",c="",h="?",l="function",m="undefined",y="object",E="string",T="major",w="model",b="name",p="type",u="vendor",g="version",k="architecture",D="console",x="mobile",R="tablet",A="smarttv",P="wearable",M="embedded",F=500,Y="Amazon",$="Apple",j="ASUS",K="BlackBerry",Z="Browser",W="Chrome",X="Edge",ue="Firefox",fe="Google",U="Huawei",N="LG",V="Microsoft",_="Motorola",B="Opera",le="Samsung",H="Sharp",ce="Sony",ne="Xiaomi",we="Zebra",ge="Facebook",Me="Chromium OS",_e="Mac OS",Le=" Browser",Be=function(O,i){var a={};for(var o in O)i[o]&&i[o].length%2===0?a[o]=i[o].concat(O[o]):a[o]=O[o];return a},pe=function(O){for(var i={},a=0;a<O.length;a++)i[O[a].toUpperCase()]=O[a];return i},ye=function(O,i){return typeof O===E?be(i).indexOf(be(O))!==-1:!1},be=function(O){return O.toLowerCase()},ze=function(O){return typeof O===E?O.replace(/[^\d\.]/g,c).split(".")[0]:s},Ee=function(O,i){if(typeof O===E)return O=O.replace(/^\s\s*/,c),typeof i===m?O:O.substring(0,F)},Ce=function(O,i){for(var a=0,o,f,v,S,C,L;a<i.length&&!C;){var J=i[a],q=i[a+1];for(o=f=0;o<J.length&&!C&&J[o];)if(C=J[o++].exec(O),C)for(v=0;v<q.length;v++)L=C[++f],S=q[v],typeof S===y&&S.length>0?S.length===2?typeof S[1]==l?this[S[0]]=S[1].call(this,L):this[S[0]]=S[1]:S.length===3?typeof S[1]===l&&!(S[1].exec&&S[1].test)?this[S[0]]=L?S[1].call(this,L,S[2]):s:this[S[0]]=L?L.replace(S[1],S[2]):s:S.length===4&&(this[S[0]]=L?S[3].call(this,L.replace(S[1],S[2])):s):this[S]=L||s;a+=2}},Ae=function(O,i){for(var a in i)if(typeof i[a]===y&&i[a].length>0){for(var o=0;o<i[a].length;o++)if(ye(i[a][o],O))return a===h?s:a}else if(ye(i[a],O))return a===h?s:a;return i.hasOwnProperty("*")?i["*"]:O},Ue={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},Te={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},he={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[b,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[b,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[b,g],[/opios[\/ ]+([\w\.]+)/i],[g,[b,B+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[g,[b,B+" GX"]],[/\bopr\/([\w\.]+)/i],[g,[b,B]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[g,[b,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[b,g],[/quark(?:pc)?\/([-\w\.]+)/i],[g,[b,"Quark"]],[/\bddg\/([\w\.]+)/i],[g,[b,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[b,"UC"+Z]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[g,[b,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[b,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[b,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[g,[b,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[g,[b,"Smart Lenovo "+Z]],[/(avast|avg)\/([\w\.]+)/i],[[b,/(.+)/,"$1 Secure "+Z],g],[/\bfocus\/([\w\.]+)/i],[g,[b,ue+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[b,B+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[b,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[b,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[b,B+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[b,"MIUI "+Z]],[/fxios\/([-\w\.]+)/i],[g,[b,ue]],[/\bqihu|(qi?ho?o?|360)browser/i],[[b,"360"+Le]],[/\b(qq)\/([\w\.]+)/i],[[b,/(.+)/,"$1Browser"],g],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[b,/(.+)/,"$1"+Le],g],[/samsungbrowser\/([\w\.]+)/i],[g,[b,le+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[b,/_/g," "],g],[/metasr[\/ ]?([\d\.]+)/i],[g,[b,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[b,"Sogou Mobile"],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[b,g],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[b],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[b,ge],g],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[b,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[b,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[g,[b,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[b,W+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[b,W+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[b,"Android "+Z]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[b,g],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[g,[b,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[g,b],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[b,[g,Ae,Ue]],[/(webkit|khtml)\/([\w\.]+)/i],[b,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[b,"Netscape"],g],[/(wolvic)\/([\w\.]+)/i],[b,g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[b,ue+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[b,[g,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[b,[g,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[k,"amd64"]],[/(ia32(?=;))/i],[[k,be]],[/((?:i[346]|x)86)[;\)]/i],[[k,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[k,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[k,"armhf"]],[/windows (ce|mobile); ppc;/i],[[k,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[k,/ower/,c,be]],[/(sun4\w)[;\)]/i],[[k,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[k,be]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[w,[u,le],[p,R]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[w,[u,le],[p,x]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[w,[u,$],[p,x]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[w,[u,$],[p,R]],[/(macintosh);/i],[w,[u,$]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[w,[u,H],[p,x]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[w,[u,U],[p,R]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[w,[u,U],[p,x]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[w,/_/g," "],[u,ne],[p,x]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[w,/_/g," "],[u,ne],[p,R]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[w,[u,"OPPO"],[p,x]],[/\b(opd2\d{3}a?) bui/i],[w,[u,"OPPO"],[p,R]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[w,[u,"Vivo"],[p,x]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[w,[u,"Realme"],[p,x]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[w,[u,_],[p,x]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[w,[u,_],[p,R]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[w,[u,N],[p,R]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[w,[u,N],[p,x]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[w,[u,"Lenovo"],[p,R]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[w,/_/g," "],[u,"Nokia"],[p,x]],[/(pixel c)\b/i],[w,[u,fe],[p,R]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[w,[u,fe],[p,x]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[w,[u,ce],[p,x]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[w,"Xperia Tablet"],[u,ce],[p,R]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[w,[u,"OnePlus"],[p,x]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[w,[u,Y],[p,R]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[w,/(.+)/g,"Fire Phone $1"],[u,Y],[p,x]],[/(playbook);[-\w\),; ]+(rim)/i],[w,u,[p,R]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[w,[u,K],[p,x]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[w,[u,j],[p,R]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[w,[u,j],[p,x]],[/(nexus 9)/i],[w,[u,"HTC"],[p,R]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[u,[w,/_/g," "],[p,x]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[w,[u,"TCL"],[p,R]],[/(itel) ((\w+))/i],[[u,be],w,[p,Ae,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[w,[u,"Acer"],[p,R]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[w,[u,"Meizu"],[p,x]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[w,[u,"Ulefone"],[p,x]],[/droid.+; (a(?:015|06[35]|142p?))/i],[w,[u,"Nothing"],[p,x]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[u,w,[p,x]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[u,w,[p,R]],[/(surface duo)/i],[w,[u,V],[p,R]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[w,[u,"Fairphone"],[p,x]],[/(u304aa)/i],[w,[u,"AT&T"],[p,x]],[/\bsie-(\w*)/i],[w,[u,"Siemens"],[p,x]],[/\b(rct\w+) b/i],[w,[u,"RCA"],[p,R]],[/\b(venue[\d ]{2,7}) b/i],[w,[u,"Dell"],[p,R]],[/\b(q(?:mv|ta)\w+) b/i],[w,[u,"Verizon"],[p,R]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[w,[u,"Barnes & Noble"],[p,R]],[/\b(tm\d{3}\w+) b/i],[w,[u,"NuVision"],[p,R]],[/\b(k88) b/i],[w,[u,"ZTE"],[p,R]],[/\b(nx\d{3}j) b/i],[w,[u,"ZTE"],[p,x]],[/\b(gen\d{3}) b.+49h/i],[w,[u,"Swiss"],[p,x]],[/\b(zur\d{3}) b/i],[w,[u,"Swiss"],[p,R]],[/\b((zeki)?tb.*\b) b/i],[w,[u,"Zeki"],[p,R]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[u,"Dragon Touch"],w,[p,R]],[/\b(ns-?\w{0,9}) b/i],[w,[u,"Insignia"],[p,R]],[/\b((nxa|next)-?\w{0,9}) b/i],[w,[u,"NextBook"],[p,R]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[u,"Voice"],w,[p,x]],[/\b(lvtel\-)?(v1[12]) b/i],[[u,"LvTel"],w,[p,x]],[/\b(ph-1) /i],[w,[u,"Essential"],[p,x]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[w,[u,"Envizen"],[p,R]],[/\b(trio[-\w\. ]+) b/i],[w,[u,"MachSpeed"],[p,R]],[/\btu_(1491) b/i],[w,[u,"Rotor"],[p,R]],[/(shield[\w ]+) b/i],[w,[u,"Nvidia"],[p,R]],[/(sprint) (\w+)/i],[u,w,[p,x]],[/(kin\.[onetw]{3})/i],[[w,/\./g," "],[u,V],[p,x]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[w,[u,we],[p,R]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[w,[u,we],[p,x]],[/smart-tv.+(samsung)/i],[u,[p,A]],[/hbbtv.+maple;(\d+)/i],[[w,/^/,"SmartTV"],[u,le],[p,A]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[u,N],[p,A]],[/(apple) ?tv/i],[u,[w,$+" TV"],[p,A]],[/crkey/i],[[w,W+"cast"],[u,fe],[p,A]],[/droid.+aft(\w+)( bui|\))/i],[w,[u,Y],[p,A]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[w,[u,H],[p,A]],[/(bravia[\w ]+)( bui|\))/i],[w,[u,ce],[p,A]],[/(mitv-\w{5}) bui/i],[w,[u,ne],[p,A]],[/Hbbtv.*(technisat) (.*);/i],[u,w,[p,A]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[u,Ee],[w,Ee],[p,A]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[p,A]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[u,w,[p,D]],[/droid.+; (shield) bui/i],[w,[u,"Nvidia"],[p,D]],[/(playstation [345portablevi]+)/i],[w,[u,ce],[p,D]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[w,[u,V],[p,D]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[w,[u,le],[p,P]],[/((pebble))app/i],[u,w,[p,P]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[w,[u,$],[p,P]],[/droid.+; (glass) \d/i],[w,[u,fe],[p,P]],[/droid.+; (wt63?0{2,3})\)/i],[w,[u,we],[p,P]],[/(quest( \d| pro)?)/i],[w,[u,ge],[p,P]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[u,[p,M]],[/(aeobc)\b/i],[w,[u,Y],[p,M]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[w,[p,x]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[w,[p,R]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[p,R]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[p,x]],[/(android[-\w\. ]{0,9});.+buil/i],[w,[u,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[b,X+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[b,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[b,g],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,b]],os:[[/microsoft (windows) (vista|xp)/i],[b,g],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[b,[g,Ae,Te]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[g,Ae,Te],[b,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[b,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[b,_e],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[g,b],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[b,g],[/\(bb(10);/i],[g,[b,K]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[g,[b,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[b,ue+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[b,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[g,[b,"watchOS"]],[/crkey\/([\d\.]+)/i],[g,[b,W+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[b,Me],g],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[b,g],[/(sunos) ?([\w\.\d]*)/i],[[b,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[b,g]]},ae=function(O,i){if(typeof O===y&&(i=O,O=s),!(this instanceof ae))return new ae(O,i).getResult();var a=typeof t!==m&&t.navigator?t.navigator:s,o=O||(a&&a.userAgent?a.userAgent:c),f=a&&a.userAgentData?a.userAgentData:s,v=i?Be(he,i):he,S=a&&a.userAgent==o;return this.getBrowser=function(){var C={};return C[b]=s,C[g]=s,Ce.call(C,o,v.browser),C[T]=ze(C[g]),S&&a&&a.brave&&typeof a.brave.isBrave==l&&(C[b]="Brave"),C},this.getCPU=function(){var C={};return C[k]=s,Ce.call(C,o,v.cpu),C},this.getDevice=function(){var C={};return C[u]=s,C[w]=s,C[p]=s,Ce.call(C,o,v.device),S&&!C[p]&&f&&f.mobile&&(C[p]=x),S&&C[w]=="Macintosh"&&a&&typeof a.standalone!==m&&a.maxTouchPoints&&a.maxTouchPoints>2&&(C[w]="iPad",C[p]=R),C},this.getEngine=function(){var C={};return C[b]=s,C[g]=s,Ce.call(C,o,v.engine),C},this.getOS=function(){var C={};return C[b]=s,C[g]=s,Ce.call(C,o,v.os),S&&!C[b]&&f&&f.platform&&f.platform!="Unknown"&&(C[b]=f.platform.replace(/chrome os/i,Me).replace(/macos/i,_e)),C},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return o},this.setUA=function(C){return o=typeof C===E&&C.length>F?Ee(C,F):C,this},this.setUA(o),this};ae.VERSION=r,ae.BROWSER=pe([b,g,T]),ae.CPU=pe([k]),ae.DEVICE=pe([w,u,p,D,x,A,R,P,M]),ae.ENGINE=ae.OS=pe([b,g]),n.exports&&(e=n.exports=ae),e.UAParser=ae;var xe=typeof t!==m&&(t.jQuery||t.Zepto);if(xe&&!xe.ua){var oe=new ae;xe.ua=oe.getResult(),xe.ua.get=function(){return oe.getUA()},xe.ua.set=function(O){oe.setUA(O);var i=oe.getResult();for(var a in i)xe.ua[a]=i[a]}}})(typeof window=="object"?window:bs)})(et,et.exports)),et.exports}var ks=xs();const yt=(n,e)=>e.some(t=>n instanceof t);let Ht,Wt;function Ss(){return Ht||(Ht=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ds(){return Wt||(Wt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const bt=new WeakMap,ct=new WeakMap,st=new WeakMap;function Es(n){const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("success",c),n.removeEventListener("error",h)},c=()=>{t(Ve(n.result)),r()},h=()=>{s(n.error),r()};n.addEventListener("success",c),n.addEventListener("error",h)});return st.set(e,n),e}function Cs(n){if(bt.has(n))return;const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("complete",c),n.removeEventListener("error",h),n.removeEventListener("abort",h)},c=()=>{t(),r()},h=()=>{s(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",c),n.addEventListener("error",h),n.addEventListener("abort",h)});bt.set(n,e)}let xt={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return bt.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ve(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Si(n){xt=n(xt)}function Ts(n){return Ds().includes(n)?function(...e){return n.apply(kt(this),e),Ve(this.request)}:function(...e){return Ve(n.apply(kt(this),e))}}function Rs(n){return typeof n=="function"?Ts(n):(n instanceof IDBTransaction&&Cs(n),yt(n,Ss())?new Proxy(n,xt):n)}function Ve(n){if(n instanceof IDBRequest)return Es(n);if(ct.has(n))return ct.get(n);const e=Rs(n);return e!==n&&(ct.set(n,e),st.set(e,n)),e}const kt=n=>st.get(n);function Ms(n,e,{blocked:t,upgrade:s,blocking:r,terminated:c}={}){const h=indexedDB.open(n,e),l=Ve(h);return s&&h.addEventListener("upgradeneeded",m=>{s(Ve(h.result),m.oldVersion,m.newVersion,Ve(h.transaction),m)}),t&&h.addEventListener("blocked",m=>t(m.oldVersion,m.newVersion,m)),l.then(m=>{c&&m.addEventListener("close",()=>c()),r&&m.addEventListener("versionchange",y=>r(y.oldVersion,y.newVersion,y))}).catch(()=>{}),l}const As=["get","getKey","getAll","getAllKeys","count"],Ps=["put","add","delete","clear"],ht=new Map;function zt(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(ht.get(e))return ht.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,r=Ps.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(r||As.includes(t)))return;const c=async function(h,...l){const m=this.transaction(h,r?"readwrite":"readonly");let y=m.store;return s&&(y=y.index(l.shift())),(await Promise.all([y[t](...l),r&&m.done]))[0]};return ht.set(e,c),c}Si(n=>({...n,get:(e,t,s)=>zt(e,t)||n.get(e,t,s),has:(e,t)=>!!zt(e,t)||n.has(e,t)}));const Is=["continue","continuePrimaryKey","advance"],jt={},St=new WeakMap,Di=new WeakMap,Fs={get(n,e){if(!Is.includes(e))return n[e];let t=jt[e];return t||(t=jt[e]=function(...s){St.set(this,Di.get(this)[e](...s))}),t}};async function*_s(...n){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...n)),!e)return;e=e;const t=new Proxy(e,Fs);for(Di.set(t,e),st.set(t,kt(e));e;)yield t,e=await(St.get(t)||e.continue()),St.delete(t)}function qt(n,e){return e===Symbol.asyncIterator&&yt(n,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&yt(n,[IDBIndex,IDBObjectStore])}Si(n=>({...n,get(e,t,s){return qt(e,t)?_s:n.get(e,t,s)},has(e,t){return qt(e,t)||n.has(e,t)}}));async function Bs(n){const e=JSON.parse(n);if(!e)return;if(e.userInfo)return e;if(!e.data)return;const t=await new wt().decrypt(e.data);if(!t)return;const s=JSON.parse(t);if(!(!s||!s.userInfo))return s}async function Os(n,e){const t=e?.body;if(typeof t!="string")return!1;const s=await Bs(t);return s?(console.log("[Request Saver] Saving request",s),(await Ms("ai.panoptic.request")).transaction("requests","readwrite").objectStore("requests").put({id:1,url:n,request:e}),!0):!1}function Vs(n=fetch){return async(e,t)=>{try{await Os(e,t)}catch(s){console.error("[Request Saver] ",s)}return n(e,t)}}function Ei(n){let e=0,t=0,s=0,r=0;for(let m=0;m<n.height;m++)for(let y=0;y<n.width;y++){let E=y*m*4,T=n.data[E],w=n.data[E+1],b=n.data[E+2];(T!==0||w!==0||b!==0)&&(e+=T,t+=w,s+=b,r++)}if(r===0)return;const c=e/r,h=t/r,l=s/r;if(!(isNaN(c)||isNaN(h)||isNaN(l)))return[c,h,l]}function Ls(n,e){if(n===void 0)return;const{data:t,width:s,height:r}=n,c=[],h=[];for(let l=0;l<e;l++)for(let m=0;m<e;m++){const y=Math.floor(m*s/e),E=Math.min(Math.floor((m+1)*s/e),s),T=Math.floor(l*r/e),w=Math.min(Math.floor((l+1)*r/e),r);h.push({startX:y,endX:E,startY:T,endY:w})}for(const l of h){const{startX:m,endX:y,startY:E,endY:T}=l,w=y-m,b=T-E,p=w*b;if(p===0){const A=(E*s+m)*4;c.push([t[A],t[A+1],t[A+2]]);continue}let u=0,g=0,k=0;for(let A=E;A<T;A++){const P=(A*s+m)*4,M=(A*s+y)*4;for(let F=P;F<M;F+=4)u+=t[F],g+=t[F+1],k+=t[F+2]}const D=u/p,x=g/p,R=k/p;c.push([D,x,R])}return c}function Us(n,e){if(n===void 0)return;const{data:t,width:s,height:r}=n,c=[],h=[];for(let l=0;l<e;l++)for(let m=0;m<e;m++){const y=Math.floor(m*s/e),E=Math.min(Math.floor((m+1)*s/e),s),T=Math.floor(l*r/e),w=Math.min(Math.floor((l+1)*r/e),r);h.push({startX:y,endX:E,startY:T,endY:w})}for(const l of h){const{startX:m,endX:y,startY:E,endY:T}=l,w=y-m,b=T-E,p=w*b;if(p===0){const A=(E*s+m)*4,P=t[A],M=t[A+1],F=t[A+2],[Y,$,j]=Gt(P,M,F);c.push([Y,$,j]);continue}let u=0,g=0,k=0;for(let A=E;A<T;A++)for(let P=m;P<y;P++){const M=(A*s+P)*4,F=t[M],Y=t[M+1],$=t[M+2],[j,K,Z]=Gt(F,Y,$);u+=j,g+=K,k+=Z}const D=u/p,x=g/p,R=k/p;c.push([D,x,R])}return c}function Gt(n,e,t){const s=.299*n+.587*e+.114*t,r=-.14713*n-.28886*e+.436*t,c=.615*n-.51499*e-.10001*t;return[s,r,c]}async function Yt(n){return Promise.all(n.map($s))}async function $s(n){const e={};for(const t in n.pixels)e[t]={type:n.pixels[t].type,pixels:await n.pixels[t].pixels};return{...n,pixels:e}}const Ns=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,Kt=n=>{if(typeof n!="string")throw new TypeError("Invalid argument expected string");const e=n.match(Ns);if(!e)throw new Error(`Invalid argument not valid semver ('${n}' received)`);return e.shift(),e},Qt=n=>n==="*"||n==="x"||n==="X",Xt=n=>{const e=parseInt(n,10);return isNaN(e)?n:e},Hs=(n,e)=>typeof n!=typeof e?[String(n),String(e)]:[n,e],Ws=(n,e)=>{if(Qt(n)||Qt(e))return 0;const[t,s]=Hs(Xt(n),Xt(e));return t>s?1:t<s?-1:0},Jt=(n,e)=>{for(let t=0;t<Math.max(n.length,e.length);t++){const s=Ws(n[t]||"0",e[t]||"0");if(s!==0)return s}return 0},He=(n,e)=>{const t=Kt(n),s=Kt(e),r=t.pop(),c=s.pop(),h=Jt(t,s);return h!==0?h:r&&c?Jt(r.split("."),c.split(".")):r||c?r?-1:1:0},Ci=15,Dt=new Map([[ie.Local,hs],[ie.LocalV2,ds],[ie.RemoteDev,us],[ie.RemoteProd,fs],[ie.AwsDev,gs],[ie.AwsProd,ki],[ie.RemoteProdEnterprise,ms],[ie.AwsDevEnterprise,ps],[ie.AwsProdEnterprise,vs],[ie.Schema2Dev,ws],[ie.Schema2Prod,ys]]);class Zt{constructor(e){d(this,"wakeUpRequestTime"),d(this,"serverAwaken",!1),d(this,"scanId"),d(this,"client"),d(this,"cfg",{serverId:ie.RemoteProd,dataWindowDuration:Ci}),this.client=new $t(Dt.get(ie.AwsProd)),e.dataWindowDuration&&(Q("Configure dataWindowDuration: "+e.dataWindowDuration),this.client.windowDuration=e.dataWindowDuration),e.serverId!==void 0&&(Q("Configure serverId: "+e.serverId),this.client=new $t(Dt.get(e.serverId)),this.client.apiKey=this.cfg.apiKey),e.serverUrl&&(Q("Configure serverUrl: "+e.serverUrl),this.client.setServerUrl(e.serverUrl)),e.apiKey&&(Q("Configure apiKey: "+On(e.apiKey)),this.cfg.apiKey=e.apiKey,this.client.apiKey=this.cfg.apiKey),e.httpCall&&(Q("Configure httpCall"),this.client.httpCall=e.httpCall),e.enableSavingRequest&&(Q("Configure enableSavingRequest"),this.client.httpCall=Vs(this.client.httpCall)),e.landmarksSampleRate!==void 0&&(Q("Configure landmarksSampleRate: "+e.landmarksSampleRate),this.cfg.landmarksSampleRate=e.landmarksSampleRate)}get readyTime(){return this.client.config.coldStartDuration-this.client.windowDuration}get _isReady(){return this.wakeUpRequestTime===void 0?!1:this.serverAwaken?!0:(new Date().getTime()-this.wakeUpRequestTime)/1e3>this.readyTime}userInfo(e){const t={},s=e;return Object.keys(s).forEach(r=>{s[r]!==void 0&&(t[r]=s[r])}),t}async _wakeUpServer(){let e=new Date().getTime();return this.serverAwaken=!1,this.wakeUpRequestTime=new Date().getTime(),Q("Wake up server now..."),new Promise((t,s)=>{this.client.wakeUpServer().then(()=>{this.serverAwaken=!0,t()}).catch(r=>{this.serverAwaken=!1,s(r)}).finally(()=>{let r=new Date().getTime()-e;Q("Wake up time: ",r)})})}async wakeUpServer(){return this.wakeUpRequestTime!==void 0?this._waitUntilReady():this._wakeUpServer()}isReadySync(){return this._isReady}async isReady(){if(this._isReady)return!0;let e=Bn(.5,"timeout");return Promise.race([e,this.waitUntilReady()]).then(t=>t!=="timeout")}async _waitUntilReady(){return new Promise(e=>{let t=setInterval(()=>{this._isReady&&(clearInterval(t),e())},200)})}async waitUntilReady(){return this.wakeUpRequestTime==null&&this.wakeUpServer(),this._waitUntilReady()}begin(){return this.scanId=Ct(),this._wakeUpServer().catch(e=>console.log(e)),Promise.resolve()}async analyze(e,t,s){var r;const c=(r=e[0].pixels.face)==null?void 0:r.type;if(He(this.client.config.schemaVersion,"2")>0)var h=await this.getHealthV2(e,t,s);else if(c=="rgb1x1")h=await this.getHealthRgb1x1(await Yt(e),t);else throw new Error("Unsupported pixel Size");return this.parseHealthFromJson(h)}async getHealthRgb1x1(e,t){const s=this.client.getUrl(),r=e.filter(E=>{var T;return(T=E.pixels.face)==null?void 0:T.pixels}).map(E=>{var T;return(T=E.pixels.face)==null?void 0:T.pixels[0][0]}),c=e.filter(E=>{var T;return(T=E.pixels.face)==null?void 0:T.pixels}).map(E=>{var T;return(T=E.pixels.face)==null?void 0:T.pixels[0][1]}),h=e.filter(E=>{var T;return(T=E.pixels.face)==null?void 0:T.pixels}).map(E=>{var T;return(T=E.pixels.face)==null?void 0:T.pixels[0][2]}),l=e.map(E=>E.timestamp),m=e.filter(E=>{var T;return(T=E.pixels.chest)==null?void 0:T.pixels}).map(E=>{var T;return(T=E.pixels.chest)==null?void 0:T.pixels[0][0]}),y={r,g:c,b:h,timestamp:l,userInfo:this.userInfo(t),deviceId:this.client.deviceId,windowDuration:this.client.windowDuration,deviceType:"web"};return m!==void 0&&m.length>0?m.length>=c.length?(y.respPixels=m,y.version="1.3"):console.warn("[HttpEndpointsClient] Too few respiratory pixels. Falling back to schema 1.2."):console.warn("[HttpEndpointsClient] No respiratory pixels. Falling back to schema 1.2."),this.scanId!==void 0&&(y.scanId=this.scanId),await this.client.callAPI(s,y)}async getHealthV2(e,t,s){var r;const c=this.client.getUrl(),h=this.prepareDataV2(await Yt(e)),l=this.prepareDeviceInfo(),m={...h,pixelsFormat:(r=e[0].pixels.face)==null?void 0:r.type,userInfo:this.userInfo(t),deviceInfo:l,measurementMode:"Resting",faceDetectorOption:"mp-face-mesh",metadata:{requestTime:Date.now(),dev:this.client.config.development},videoFrameInfo:s};return this.scanId!==void 0&&(m.deviceInfo.scanId=this.scanId),await this.client.callAPI(c,m)}prepareDataV2(e){const t=[],s=[],r=[];let c="2.1";if(e.map(h=>{var l,m,y,E,T,w,b,p,u,g;const k=(l=h.pixels.face)==null?void 0:l.pixels;if(k){const R={values:k,timestamp:h.timestamp};(m=h.pixels.chin)!=null&&m.pixels&&(c="2.2",R.chin=(y=h.pixels.chin)==null?void 0:y.pixels),(E=h.pixels.leftCheek)!=null&&E.pixels&&(c="2.2",R.leftCheek=(T=h.pixels.leftCheek)==null?void 0:T.pixels),(w=h.pixels.rightCheek)!=null&&w.pixels&&(c="2.2",R.rightCheek=(b=h.pixels.rightCheek)==null?void 0:b.pixels),(p=h.pixels.glabella)!=null&&p.pixels&&(c="2.2",R.glabella=(u=h.pixels.glabella)==null?void 0:u.pixels),t.push(R)}const D=(g=h.pixels.chest)==null?void 0:g.pixels;D&&(D[0].length===1?s.push(this.mean(D)[0]):(c="2.3",D.length==1?s.push(D[0]):s.push(D)));const x=this.getLandmarksV2(h.landmarks);if(x){const R=h.facebox,A={bbox:[R.xCenter-R.width/2,R.yCenter-R.height/2,R.xCenter+R.width/2,R.yCenter+R.height/2],landmarks:x,timestamp:h.timestamp};r.push(A)}}),r.length>1&&this.cfg.landmarksSampleRate!==void 0){const h=this.cfg.landmarksSampleRate,l=r[r.length-1].timestamp-r[0].timestamp;if(r.length/l>h){const m=1/h,y=[];let E=r[0].timestamp;y.push(r[0]);for(let T=1;T<r.length;T++)r[T].timestamp-E>=m&&(y.push(r[T]),E=r[T].timestamp);r.length=0,r.push(...y)}}return{version:c,pixels:t,respPixels:s,facialMarkers:r.length==0?null:r}}getLandmarksV2(e){if(!e||e.length==0)return null;const t={};return[4,10,11,14,34,136,152,168,205,264,365,425].map(s=>{t[s]=[e[s].x,e[s].y],e[s].z!==void 0&&t[s].push(e[s].z)}),t}prepareDeviceInfo(){const{device:e}=ks.UAParser(navigator.userAgent);return{deviceId:this.client.deviceId,deviceBrand:e!=null&&e.vendor?e.vendor:"unknown",deviceModel:e!=null&&e.model?e.model:"unknown",deviceType:"web"}}mean(e){if(e.length===0)return[0,0,0];const t=e[0].length;return e.reduce((s,r)=>{for(let c=0;c<t;c++)s[c]+=r[c];return s},Array(t).fill(0)).map(s=>s/e.length)}end(){throw new Error("Method not implemented.")}reset(){this.serverAwaken=!1,this.wakeUpRequestTime=void 0,this.scanId=void 0}parseHealthFromJson(e){return Q(e),He(this.client.config.schemaVersion,"2")>0?this.parseHealthV2(e):this.parseHealthV1(e)}parseHealthV1(e){let t=e.vital_signs,s=e.health_risks,r=e.holistic_health,c={datetime:new Date};if(r&&(c.holisticHealth={},r.general_wellness!==void 0&&(c.holisticHealth.generalWellness=r.general_wellness),r.bmi!==void 0&&(c.holisticHealth.bmi=r.bmi),r.hhe_version!==void 0&&(c.holisticHealth.version=r.hhe_version),r.absi!==void 0&&(c.holisticHealth.absi=r.absi),r.cardiac_workload!==void 0&&(c.holisticHealth.cardiacWorkload=r.cardiac_workload),r.pulse_respiratory_quotient!==void 0&&(c.holisticHealth.pulseRespiratoryQuotient=r.pulse_respiratory_quotient),r.waist_to_height_ratio!==void 0&&(c.holisticHealth.waistToHeightRatio=r.waist_to_height_ratio)),t["0_server"].scan_parameters!==void 0){let h=t["0_server"].scan_parameters,l={conditions:h.conditions!==void 0?h.conditions:void 0,invalidPixelPercentage:h.invalid_pixel_percentage!==void 0?h.invalid_pixel_percentage:void 0,signalDuration:h.signal_duration!==void 0?h.signal_duration:void 0,signalQuality:h.signal_quality!==void 0?h.signal_quality:void 0,snr:h.snr!==void 0?h.snr:void 0};c.scanParameters=l}return t&&(c.vitalSigns={heartRate:t.heart_rate,spo2:t.spo2,ibi:t.hrv_ibi},t.respiratory_rate!==void 0&&(c.vitalSigns.respiratoryRate=t.respiratory_rate),t.stress!==void 0&&(c.vitalSigns.stress=t.stress),t.stress_score!==void 0&&(c.vitalSigns.stressScore=t.stress_score),t.hrv_sdnn!==void 0&&(c.vitalSigns.hrvSdnn=t.hrv_sdnn),t.hrv_rmssd!==void 0&&(c.vitalSigns.hrvRmssd=t.hrv_rmssd),t.temperature!==void 0&&(c.vitalSigns.temperature=t.temperature),t.blood_pressure!==void 0&&(c.vitalSigns.bloodPressure=t.blood_pressure),t.blood_pressure_systolic!==void 0&&(c.vitalSigns.bloodPressureSystolic=t.blood_pressure_systolic),t.blood_pressure_diastolic!==void 0&&(c.vitalSigns.bloodPressureDiastolic=t.blood_pressure_diastolic),t.facial_skin_age!==void 0&&(c.vitalSigns.facialSkinAge=t.facial_skin_age),t.blood_alcohol!==void 0&&(c.vitalSigns.bloodAlcohol=t.blood_alcohol),t.blood_sugar!==void 0&&(c.vitalSigns.bloodSugar=t.blood_sugar),t["0_server"].version!==void 0&&(c.vitalSigns.version=t["0_server"].version)),s.cvd_risk_general!==void 0&&(c.risks==null&&(c.risks={}),c.risks.cardiovascularRisks={generalRisk:s.cvd_risk_general,coronaryHeartDisease:s.cvd_risk_CHD,congestiveHeartFailure:s.cvd_risk_CHF,intermittentClaudication:s.cvd_risk_IC,stroke:s.cvd_risk_Stroke}),s.covid_risk!==void 0&&(c.risks==null&&(c.risks={}),c.risks.covidRisk={covidRisk:s.covid_risk}),s.diabetesRisk!==void 0&&(c.risks==null&&(c.risks={}),c.risks.diabetesRisk=s.diabetesRisk),s.hypertensionRisk!==void 0&&(c.risks==null&&(c.risks={}),c.risks.hypertensionRisk=s.hypertensionRisk),s.cholesterolRisk!==void 0&&(c.risks==null&&(c.risks={}),c.risks.cholesterolRisk=s.cholesterolRisk),s.hre_version!==void 0&&c.risks&&(c.risks.version=s.hre_version),c}parseHealthV2(e){let t=e.vitalSigns,s=e.healthRisks,r=e.wellness,c=e.signalAnalysis,h=e.serverInfo,l={datetime:new Date};if(r&&(l.holisticHealth={},r.generalWellness!==void 0&&(l.holisticHealth.generalWellness=r.generalWellness),r.bmi!==void 0&&(l.holisticHealth.bmi=r.bmi),r.absi!==void 0&&(l.holisticHealth.absi=r.absi),r.absiz!==void 0&&(l.holisticHealth.absiz=r.absiz),r.cardiacWorkload!==void 0&&(l.holisticHealth.cardiacWorkload=r.cardiacWorkload),r.pulseRespiratoryQuotient!==void 0&&(l.holisticHealth.pulseRespiratoryQuotient=r.pulseRespiratoryQuotient),r.waistToHeightRatio!==void 0&&(l.holisticHealth.waistToHeightRatio=r.waistToHeightRatio),r.cardiovascularSystemWellness!==void 0&&(l.holisticHealth.cardiovascularSystemWellness=r.cardiovascularSystemWellness),r.mentalWellness!==void 0&&(l.holisticHealth.mentalWellness=r.mentalWellness),r.physicalWellness!==void 0&&(l.holisticHealth.physicalWellness=r.physicalWellness),r.respiratorySystemWellness!==void 0&&(l.holisticHealth.respiratorySystemWellness=r.respiratorySystemWellness)),t&&(l.vitalSigns={},t.heartRate!==void 0&&(l.vitalSigns.heartRate=t.heartRate),t.spo2!==void 0&&(l.vitalSigns.spo2=t.spo2),t.hrvIbi!==void 0&&(l.vitalSigns.ibi=t.hrvIbi),t.respiratoryRate!==void 0&&(l.vitalSigns.respiratoryRate=t.respiratoryRate),t.stress!==void 0&&(l.vitalSigns.stress=t.stress),t.stressScore!==void 0&&(l.vitalSigns.stressScore=t.stressScore),t.hrvSdnn!==void 0&&(l.vitalSigns.hrvSdnn=t.hrvSdnn),t.hrvRmssd!==void 0&&(l.vitalSigns.hrvRmssd=t.hrvRmssd),t.bloodPressure!==void 0&&(l.vitalSigns.bloodPressure=t.bloodPressure),t.bloodPressureSystolic!==void 0&&(l.vitalSigns.bloodPressureSystolic=t.bloodPressureSystolic),t.bloodPressureDiastolic!==void 0&&(l.vitalSigns.bloodPressureDiastolic=t.bloodPressureDiastolic),t.facialSkinAge!==void 0&&(l.vitalSigns.facialSkinAge=t.facialSkinAge)),s&&(l.risks={},s.cvdRiskGeneral!==void 0&&(l.risks.cardiovascularRisks={generalRisk:s.cvdRiskGeneral,coronaryHeartDisease:s.cvdRiskCHD,congestiveHeartFailure:s.cvdRiskCHF,intermittentClaudication:s.cvdRiskIC,stroke:s.cvdRiskStroke}),s.covidRisk!==void 0&&(l.risks.covidRisk={covidRisk:s.covidRisk}),s.diabetesRisk!==void 0&&(l.risks.diabetesRisk=s.diabetesRisk),s.hypertensionRisk!==void 0&&(l.risks.hypertensionRisk=s.hypertensionRisk),s.cholesterolRisk!==void 0&&(l.risks.cholesterolRisk=s.cholesterolRisk)),c){if(l.scanParameters={},c.signalConditions!==void 0){const m=c.signalConditions;l.scanParameters.signalConditions={noSpeedJitter:m.noSpeedJitter,goodAverageSpeed:m.goodAverageSpeed,fixedHeadPosition:m.fixedHeadPosition,noHeadTurning:m.noHeadTurning,adequateBrightness:m.adequateBrightness,evenLightingOnFace:m.evenLightingOnFace,goodSnr:m.goodSnr,signalSteadiness:m.signalSteadiness,goodSignalPercentage:m.goodSignalPercentage,hrSteadiness:m.hrSteadiness,hrSignalQuality:m.hrSignalQuality,rrSignalQuality:m.rrSignalQuality,bpSignalQuality:m.bpSignalQuality}}c.signalDuration!==void 0&&(l.scanParameters.signalDuration=c.signalDuration),c.signalQuality!==void 0&&(l.scanParameters.signalQuality=c.signalQuality),c.snr!==void 0&&(l.scanParameters.snr=c.snr),c.warning!==void 0&&(l.scanParameters.warning=c.warning)}return h&&(l.serverInfo={userPlan:h.userPlan,userId:h.userId},h.datetime!==void 0&&(l.serverInfo.datetime=h.datetime),h.datetimeStr!==void 0&&(l.serverInfo.datetimeStr=h.datetimeStr),h.elapse!==void 0&&(l.serverInfo.elapse=h.elapse),h.version!==void 0&&(l.serverInfo.version=h.version),h.errorCode!==void 0&&(l.serverInfo.errorCode=h.datetime)),l}}class zs{constructor(e,t,s,r,c=navigator.hardwareConcurrency*2,h){d(this,"workerManagers",[]),d(this,"createWorker"),d(this,"workerName"),d(this,"timeout"),d(this,"workerCount"),d(this,"onCreated"),d(this,"workerFunction"),d(this,"isEnabled",!0),this.onCreated=h,this.createWorker=e,this.workerName=s,this.timeout=r,this.workerCount=c,this.workerFunction=t,this.onCreated=h,this.isEnabled&&this.newWorker()}async newWorker(){const e=this.createWorker(),t=new js(e,this.workerName,this.timeout);return this.onCreated&&await this.onCreated(t),this.workerManagers.push(t),t}async callWorker(e,t){if(!this.isEnabled&&this.workerFunction)return this.workerFunction(e);const s=this.workerManagers.find(r=>!r.isBusy);return s?s.callWorker(e,t):this.workerManagers.length<this.workerCount?(await this.newWorker()).callWorker(e,t):Promise.reject(new Error(`${this.workerName}: All ${this.workerCount} workers are busy`))}get hasAvailableWorker(){return this.workerManagers.some(e=>!e.isBusy)||this.workerManagers.length<this.workerCount}terminateAll(){this.workerManagers.forEach(e=>e.terminate()),this.workerManagers=[]}}class js{constructor(e,t,s){d(this,"timeout"),d(this,"worker"),d(this,"workerName"),d(this,"pendingPromises",{}),this.timeout=s||1e3,this.worker=e,this.workerName=t||"Worker",this.worker.onmessage=r=>{const{result:c,hash:h,error:l}=r.data,m=this.pendingPromises[h];m&&(clearTimeout(m.timer),l?m.reject(new Error(`Worker ${this.workerName} Error: ${l}`)):m.resolve(c),delete this.pendingPromises[h])},this.worker.onerror=r=>{for(const c in this.pendingPromises)clearTimeout(this.pendingPromises[c].timer),this.pendingPromises[c].reject(new Error(`Worker ${this.workerName} Error: ${r.message}`)),delete this.pendingPromises[c];console.error(`Worker ${t} error: ${r.message}`)}}get isBusy(){return Object.keys(this.pendingPromises).length>2}callWorker(e,t){const s=crypto.randomUUID();return new Promise((r,c)=>{const h=setTimeout(()=>{if(this.pendingPromises[s]){const y=Object.keys(this.pendingPromises).length;this.pendingPromises[s].reject(new Error(`Worker ${this.workerName} Timeout. ${y>1?`${y} pending promises.`:""}`))}delete this.pendingPromises[s]},this.timeout);this.pendingPromises[s]&&(clearTimeout(this.pendingPromises[s].timer),this.pendingPromises[s].reject(new Error(`Worker ${this.workerName} Duplicate hash: ${s}`)),delete this.pendingPromises[s]),this.pendingPromises[s]={resolve:r,reject:c,timer:h};const l=performance.now();this.worker.postMessage({inputData:e,hash:s},t);const m=performance.now()-l;m>5&&console.warn(`Worker ${this.workerName} postMessage took ${m} ms, which may cause frame drops.`)})}terminate(){this.worker.terminate();for(const e in this.pendingPromises)clearTimeout(this.pendingPromises[e].timer),this.pendingPromises[e].reject(new Error(`Worker ${this.workerName} terminated.`)),delete this.pendingPromises[e]}}const dt={};function me(n,e,t,s,r,c){return dt[t]||(dt[t]=new zs(n,e,t,s,r,c)),dt[t]}function at(n){return Ei(n)}self.onmessage=n=>{const{inputData:e,hash:t}=n.data,s=at(e);self.postMessage({result:s,hash:t})};class ut{constructor(){d(this,"dataType","ggg1x1"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/B5lsALhE-ppZ36LXi.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,at,"Ggg1x1WorkerPool"))}async extract(e){const t=await e;if(!t)return;const s=await this.workerPool.callWorker(t);if(!(!s||s[1]===void 0))return[[s[1]]]}}function Ti(n){const e=Ei(n);if(!e)return null;const[t,s,r]=e,c=.299*t+.587*s+.114*r,h=-.14713*t-.28886*s+.436*r,l=.615*t-.51499*s-.10001*r;return[c,h,l]}self.onmessage=n=>{const{inputData:e,hash:t}=n.data,s=Ti(e);self.postMessage({result:s,hash:t})};class qs{constructor(){d(this,"dataType","yyy1x1"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/CXHLiYOT-BPLMuNyk.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Ti,"Yuv1x1WorkerPool"))}async extract(e){const t=await e;if(!t)return;const s=await this.workerPool.callWorker(t);if(s)return[[s[0]]]}}class ft{constructor(){d(this,"dataType","rgb1x1"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/B5lsALhE-ppZ36LXi.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,at,"Rgb1x1WorkerPool"))}async extract(e){const t=await e;if(!t)return;const s=await this.workerPool.callWorker(t);if(s)return[s]}}function Tt(n){const{imageData:e,size:t}=n;return Ls(e,t)}self.onmessage=n=>{const{inputData:e,hash:t}=n.data,s=Tt(e);self.postMessage({result:s,hash:t})};class Gs{constructor(){d(this,"dataType","rgb8x8"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BJ8tLFkU-CydYnlpG.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Tt,"Rgb8x8WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:8})}}class Ys{constructor(){d(this,"dataType","rgb32x32"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BJ8tLFkU-CydYnlpG.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Tt,"Rgb32x32WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:32})}}function qe(n){const{imageData:e,size:t}=n;return Us(e,t)}self.onmessage=n=>{const{inputData:e,hash:t}=n.data,s=qe(e);self.postMessage({result:s,hash:t})};class Ks{constructor(){d(this,"dataType","yuv8x8"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BQisuE9N-gDDR2tiQ.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,qe,"Yuv8x8WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:8})}}class Qs{constructor(){d(this,"dataType","yuv32x32"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BQisuE9N-gDDR2tiQ.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,qe,"Yuv32x32WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:32})}}class Xs{constructor(){d(this,"dataType","yuv64x64"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BQisuE9N-gDDR2tiQ.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,qe,"Yuv64x64WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:64})}}class Js{constructor(){d(this,"dataType","yuv1x1"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BQisuE9N-gDDR2tiQ.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,qe,"Yuv1x1WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:1})}}class Zs{constructor(){d(this,"dataType","meanRgb1x1"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/B5lsALhE-ppZ36LXi.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,at,"ChestMeanRgb1x1WorkerPool"))}async extract(e){const t=await e;if(!t)return;const s=await this.workerPool.callWorker(t);if(s)return[s]}}function gt(n,e="rgb1x1"){if(n==="face")switch(e){case"rgb1x1":return new ft;case"rgb8x8":return new Gs;case"rgb32x32":return new Ys;case"yuv1x1":return new Js;case"yuv8x8":return new Ks;case"yuv32x32":return new Qs;case"yuv64x64":return new Xs;case"ggg1x1":return new ut;default:return new ft}else if(n==="chest")switch(e){case"ggg1x1":return new ut;case"yyy1x1":return new qs;case"meanRgb1x1":return new Zs;default:return new ut}else return new ft}function mt(n){const e=n?.pixelDataType??"rgb1x1",t=n?.chestPixelDataType??"ggg1x1";return(n?.enabledROIs??["face","chest"]).reduce((s,r)=>(r==="face"?s.face=gt(r,e):r==="chest"?s.chest=gt(r,t):s[r]=gt(r,e),s),{})}const Et="2.1.0-b2";class ea{constructor(){d(this,"threshold",1),d(this,"lastOKTime",0),d(this,"lastPixels"),d(this,"detected",!1)}reset(){this.lastOKTime=0,this.lastPixels=void 0,this.detected=!1}diff(e,t){let s=0;for(let r=0;r<e.length;r++){const c=e[r],h=t[r];for(let l=0;l<c.length;l++)s+=h[l]-c[l]}return s}detect(e,t){if(e){if(this.lastPixels!==void 0){if(this.diff(e,this.lastPixels)!==0)this.lastOKTime=t;else if(t-this.lastOKTime>this.threshold)return this.detected=!0,!0}return this.lastPixels=e,!1}}}const ei=25,ti=5,ii=1/6,ni=1;class ta{constructor(){d(this,"instanceId"),d(this,"stage",z.Idle),d(this,"startTime",new Date),d(this,"health"),d(this,"firstDataTime"),d(this,"frameData",[]),d(this,"lastSendTime"),d(this,"sendingData",!1),d(this,"error"),d(this,"cfg",{serverId:ie.RemoteProd,dataCollectionDuration:ei,dataSendingRate:ii,dataSendingDuration:ti,dataWindowDuration:Ci,faceLostTimeout:ni}),d(this,"blinkDetector",Bt(We.dummy)),d(this,"healthAnalyzer"),d(this,"pixelsExtractors"),d(this,"duplicatedPixelDetector",new ea),window.__vital_sign_engine_plugin__=this,this.instanceId=Ct(),Q(`VitalSignEngine Plugin InstanceId: ${this.instanceId}`),Q(`VitalSignEngine Plugin (TSVitalSignCamera-${Et})`),this.healthAnalyzer=new Zt({serverId:ie.AwsProd}),this.pixelsExtractors=mt(),this.configure({serverId:ie.AwsEnterpriseProd})}configure(e){Q("Configuring. Instance Id = ",this.instanceId),this.healthAnalyzer=new Zt(e),e.pixelDataType&&(Q("Configure pixelDataType: "+e.pixelDataType),this.cfg.pixelDataType=e.pixelDataType,this.pixelsExtractors=mt(e)),e.chestPixelDataType&&(Q("Configure chestPixelDataType: "+e.chestPixelDataType),this.cfg.chestPixelDataType=e.chestPixelDataType,this.pixelsExtractors=mt(e)),e.dataCollectionDuration&&(Q("Configure dataCollectionDuration: "+e.dataCollectionDuration),this.cfg.dataCollectionDuration=e.dataCollectionDuration),e.dataSendingDuration&&(Q("Configure dataSendingDuration: "+e.dataSendingDuration),this.cfg.dataSendingDuration=e.dataSendingDuration),e.dataSendingRate&&(Q("Configure dataSendingRate: "+e.dataSendingRate),this.cfg.dataSendingRate=e.dataSendingRate),e.blinkDetectorType!==void 0&&(Q("Configure blink detecor type"),this.blinkDetector=Bt(e.blinkDetectorType),e.blinkDetectorConfig!==void 0&&this.blinkDetector.configure(e.blinkDetectorConfig)),e.blinkDetectorConfig!==void 0&&(Q("Configure blink detector"),this.blinkDetector.configure(e.blinkDetectorConfig)),e.faceLostTimeout!==void 0&&(Q("Configure faceLostTimeout"),this.cfg.faceLostTimeout=e.faceLostTimeout)}get stageTime(){switch(this.stage){case z.WaitingData:return-1;case z.CollectingData:return this.cfg.dataCollectionDuration||ei;case z.AnalyzingData:return this.cfg.dataSendingDuration||ti;case z.Idle:return-1}}get elapsedTime(){return(new Date().getTime()-this.startTime.getTime())/1e3}get remainingTime(){return Math.max(this.stageTime-this.elapsedTime,0)}get nextStage(){return this.elapsedTime<=this.stageTime?!1:this.stage!==z.AnalyzingData?!0:!this.sendingData}frameDataTimestamp(e){return this.firstDataTime===void 0?0:(e-this.firstDataTime)/1e3}get healthResult(){return{stage:this.stage,remainingTime:this.remainingTime,totalTime:this.stageTime===-1?void 0:this.stageTime,health:this.health,error:this.error}}async isReady(){return this.healthAnalyzer.isReady()}async waitUntilReady(){return this.healthAnalyzer.waitUntilReady()}reset(){this.blinkDetector.reset(),this.frameData=[],this.firstDataTime=void 0,this.lastSendTime=void 0,this.sendingData=!1,this.healthAnalyzer.reset(),this.duplicatedPixelDetector.reset()}async start(){if(this.stage!==z.Idle)return Promise.reject(new Error("already started"));this.health=void 0,this.error=void 0,this.reset(),this.healthAnalyzer.begin(),this.setStage(z.WaitingData)}get stageName(){switch(this.stage){case z.Idle:return"Idle";case z.AnalyzingData:return"Analyzing";case z.CollectingData:return"Collecting";case z.WaitingData:return"Waiting"}}setStage(e){this.stage=e,this.startTime=new Date,Q(this.stageName)}async stop(){this.stage!==z.Idle&&(this.setStage(z.Idle),this.reset(),this.healthAnalyzer.reset())}toIdleStage(){this.setStage(z.Idle),this.reset(),this.healthAnalyzer.reset()}faceLostError(){Q("Error: face lost"),this.toIdleStage(),this.error=new Error("face lost")}duplicatedRGBError(){Q("Error: duplicated RGB values"),this.toIdleStage(),this.error=new Error("duplicated rgb")}faceLost(e){if(this.frameData.length==0)return!1;const t=this.frameData[this.frameData.length-1],s=this.cfg.faceLostTimeout===void 0?ni:this.cfg.faceLostTimeout;return!(this.frameDataTimestamp(e)-t.timestamp<s)}getHealth(e){var t,s;const r=e.videoFrameInfo.timestamp;if(this.stage===z.Idle)return(t=e.images)!=null&&t.face&&e.faceBox&&this.extractPixels(e.images),this.healthResult;if(this.stage==z.WaitingData)return this.faceLost(r)||this.blinkDetector.noEyes||this.blinkDetector.unstable?(this.faceLostError(),this.healthResult):(this.blinkDetector.detect(e.landmarks),this.healthAnalyzer.isReadySync()?(this.setStage(z.CollectingData),this.healthResult):(Q("Waiting server to awake..."),this.healthResult));if(this.stage==z.CollectingData)return this.faceLost(r)||this.blinkDetector.noEyes||this.blinkDetector.unstable?(this.faceLostError(),this.healthResult):(this.blinkDetector.detect(e.landmarks),(s=e.images)!=null&&s.face&&e.faceBox&&(this.addData(e.images,e.faceBox,e.landmarks,r),this.duplicatedPixelDetector.detected)?(this.duplicatedRGBError(),this.healthResult):(this.nextStage&&this.setStage(z.AnalyzingData),this.healthResult));if(this.stage==z.AnalyzingData){if(this.blinkDetector.blinkCount==0)return Q("Error: no blink"),this.toIdleStage(),this.error=new Error("no blink"),this.healthResult;let c=this.cfg.dataSendingRate||ii;return e.images&&e.faceBox&&this.addData(e.images,e.faceBox,e.landmarks,r),this.sendData(1/c,e.userInfo,e.videoFrameInfo),this.nextStage&&this.toIdleStage(),this.healthResult}else return this.nextStage&&this.setStage(z.Idle),this.healthResult}addData(e,t,s,r){if(e.face===void 0)return;this.firstDataTime===void 0&&(this.firstDataTime=r);let c={pixels:this.extractPixels(e),timestamp:this.frameDataTimestamp(r),facebox:t,landmarks:s};this.frameData.push(c)}extractPixels(e){var t;let s={};for(const r in this.pixelsExtractors){const c=r,h=this.pixelsExtractors[c];if(!h)continue;const l=e[c];if(!l)continue;const m=(t=this.pixelsExtractors[c])==null?void 0:t.extract(l.imageData);m&&(s[c]={type:h.dataType,pixels:m})}return s}handleError(e){Q(`Error: ${e}`),this.toIdleStage(),this.error=e}sendData(e,t,s){if(this.sendingData||this.elapsedTime>=this.stageTime)return;if(this.lastSendTime===void 0){this.lastSendTime=new Date,this._sendData(t,s).catch(h=>this.handleError(h));return}let r=new Date,c=this.lastSendTime;(r.getTime()-c.getTime())/1e3<e||this._sendData(t,s).catch(h=>this.handleError(h))}async _sendData(e,t){if(this.sendingData=!0,this.frameData.length===0)throw this.sendingData=!1,new Error("no pixel data");const s=this.frameData,r=await this.healthAnalyzer.analyze(s,e,t);this.stage===z.AnalyzingData&&(this.health=r),this.lastSendTime=new Date,this.sendingData=!1}async sendHealthReport(e,t,s,r){return this.healthAnalyzer.client.sendHealthReport(e,t,s,r)}}function ia(){return new ta}var se=(n=>(n[n.MediaPipe=0]="MediaPipe",n[n.OpenCV=1]="OpenCV",n[n.Dummy=2]="Dummy",n[n.TFMediaPipe=3]="TFMediaPipe",n[n.FaceApi=4]="FaceApi",n[n.MPFaceMesh=5]="MPFaceMesh",n[n.MPFaceDetector=6]="MPFaceDetector",n[n.MPFaceMeshThreaded=7]="MPFaceMeshThreaded",n))(se||{}),na=(n=>(n.SelfHosted="self-hosted",n.CDN="cdn",n))(na||{}),De=(n=>(n[n.cif352x288=0]="cif352x288",n[n.sd480x360=1]="sd480x360",n[n.hd1280x720=2]="hd1280x720",n[n.hd1920x1080=3]="hd1920x1080",n))(De||{});function sa(n){switch(n){case 0:return{width:352,height:288};case 1:return{width:480,height:360};case 2:return{width:1280,height:720};case 3:return{width:1920,height:1080}}}class aa{constructor(e){d(this,"video"),d(this,"canvas"),this.video=e,this.canvas=document.createElement("canvas")}start(){if(!this.video.srcObject)throw new Error("Video element has no srcObject");return Promise.resolve()}stop(){return Promise.resolve()}captureFrame(e,t){const s=this.cropFrame(this.video,e),r=Promise.resolve(s.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,s.width,s.height));return{timestamp:t??performance.now(),width:s.width,height:s.height,getImageData:()=>r,getCanvas:()=>Promise.resolve(s)}}cropFrame(e,t){const s=this.canvas;return s.width=t.width,s.height=t.height,s.getContext("2d").drawImage(e,t.x,t.y,t.width,t.height,0,0,s.width,s.height),s.getContext("2d").canvas}}var si={exports:{}},ai;function ra(){return ai||(ai=1,(function(n){n.exports=(function(e){var t={};function s(r){if(t[r])return t[r].exports;var c=t[r]={i:r,l:!1,exports:{}};return e[r].call(c.exports,c,c.exports,s),c.l=!0,c.exports}return s.m=e,s.c=t,s.d=function(r,c,h){s.o(r,c)||Object.defineProperty(r,c,{configurable:!1,enumerable:!0,get:h})},s.n=function(r){var c=r&&r.__esModule?(function(){return r.default}):(function(){return r});return s.d(c,"a",c),c},s.o=function(r,c){return Object.prototype.hasOwnProperty.call(r,c)},s.p="",s(s.s=1)})([(function(e,t,s){var r={MOBILE:"mobile",TABLET:"tablet",SMART_TV:"smarttv",CONSOLE:"console",WEARABLE:"wearable",BROWSER:void 0},c={CHROME:"Chrome",FIREFOX:"Firefox",OPERA:"Opera",YANDEX:"Yandex",SAFARI:"Safari",INTERNET_EXPLORER:"Internet Explorer",EDGE:"Edge",CHROMIUM:"Chromium",IE:"IE",MOBILE_SAFARI:"Mobile Safari",EDGE_CHROMIUM:"Edge Chromium"},h={IOS:"iOS",ANDROID:"Android",WINDOWS_PHONE:"Windows Phone",WINDOWS:"Windows",MAC_OS:"Mac OS"},l={isMobile:!1,isTablet:!1,isBrowser:!1,isSmartTV:!1,isConsole:!1,isWearable:!1};e.exports={BROWSER_TYPES:c,DEVICE_TYPES:r,OS_TYPES:h,defaultData:l}}),(function(e,t,s){var r=s(2),c=s(0),h=c.BROWSER_TYPES,l=c.OS_TYPES,m=c.DEVICE_TYPES,y=s(4),E=y.checkType,T=y.broPayload,w=y.mobilePayload,b=y.wearPayload,p=y.consolePayload,u=y.stvPayload,g=y.getNavigatorInstance,k=y.isIOS13Check,D=new r,x=D.getBrowser(),R=D.getDevice(),A=D.getEngine(),P=D.getOS(),M=D.getUA(),F=h.CHROME,Y=h.CHROMIUM,$=h.IE,j=h.INTERNET_EXPLORER,K=h.OPERA,Z=h.FIREFOX,W=h.SAFARI,X=h.EDGE,ue=h.YANDEX,fe=h.MOBILE_SAFARI,U=m.MOBILE,N=m.TABLET,V=m.SMART_TV,_=m.BROWSER,B=m.WEARABLE,le=m.CONSOLE,H=l.ANDROID,ce=l.WINDOWS_PHONE,ne=l.IOS,we=l.WINDOWS,ge=l.MAC_OS,Me=function(){return R.type===U},_e=function(){return R.type===N},Le=function(){switch(R.type){case U:case N:return!0;default:return!1}},Be=function(){return P.name===l.WINDOWS&&P.version==="10"?typeof M=="string"&&M.indexOf("Edg/")!==-1:!1},pe=function(){return R.type===V},ye=function(){return R.type===_},be=function(){return R.type===B},ze=function(){return R.type===le},Ee=function(){return P.name===H},Ce=function(){return P.name===we},Ae=function(){return P.name===ge},Ue=function(){return P.name===ce},Te=function(){return P.name===ne},he=function(){return x.name===F},ae=function(){return x.name===Z},xe=function(){return x.name===Y},oe=function(){return x.name===X},O=function(){return x.name===ue},i=function(){return x.name===W||x.name===fe},a=function(){return x.name===fe},o=function(){return x.name===K},f=function(){return x.name===j||x.name===$},v=function(){var ke=g(),Ge=ke&&ke.userAgent.toLowerCase();return typeof Ge=="string"?/electron/.test(Ge):!1},S=function(){var ke=g();return ke&&(/iPad|iPhone|iPod/.test(ke.platform)||ke.platform==="MacIntel"&&ke.maxTouchPoints>1)&&!window.MSStream},C=function(){return k("iPad")},L=function(){return k("iPhone")},J=function(){return k("iPod")},q=function(){return x.major},G=function(){return x.version},ee=function(){return P.version?P.version:"none"},Bi=function(){return P.name?P.name:"none"},Oi=function(){return x.name},Vi=function(){return R.vendor?R.vendor:"none"},Li=function(){return R.model?R.model:"none"},Ui=function(){return A.name},$i=function(){return A.version},Ni=function(){return M},Hi=function(){return R.type},Wi=pe(),zi=ze(),ji=be(),qi=a()||C(),Gi=xe(),Yi=Le()||C(),Ki=Me(),Qi=_e()||C(),Xi=ye(),Ji=Ee(),Zi=Ue(),en=Te()||C(),tn=he(),nn=ae(),sn=i(),an=o(),rn=f(),on=ee(),ln=Bi(),cn=q(),hn=G(),dn=Oi(),un=Vi(),fn=Li(),gn=Ui(),mn=$i(),pn=Ni(),vn=oe()||Be(),wn=O(),yn=Hi(),bn=S(),xn=C(),kn=L(),Sn=J(),Dn=v(),En=Be(),Cn=oe(),Tn=Ce(),Rn=Ae(),Oe=E(R.type);function Mn(){var ke=Oe.isBrowser,Ge=Oe.isMobile,An=Oe.isTablet,Mt=Oe.isSmartTV,At=Oe.isConsole,Pt=Oe.isWearable;if(ke)return T(ke,x,A,P,M);if(Mt)return u(Mt,A,P,M);if(At)return p(At,A,P,M);if(Ge||An)return w(Oe,R,P,M);if(Pt)return b(Pt,A,P,M)}e.exports={deviceDetect:Mn,isSmartTV:Wi,isConsole:zi,isWearable:ji,isMobileSafari:qi,isChromium:Gi,isMobile:Yi,isMobileOnly:Ki,isTablet:Qi,isBrowser:Xi,isAndroid:Ji,isWinPhone:Zi,isIOS:en,isChrome:tn,isFirefox:nn,isSafari:sn,isOpera:an,isIE:rn,osVersion:on,osName:ln,fullBrowserVersion:cn,browserVersion:hn,browserName:dn,mobileVendor:un,mobileModel:fn,engineName:gn,engineVersion:mn,getUA:pn,isEdge:vn,isYandex:wn,deviceType:yn,isIOS13:bn,isIPad13:xn,isIPhone13:kn,isIPod13:Sn,isElectron:Dn,isEdgeChromium:En,isLegacyEdge:Cn,isWindows:Tn,isMacOs:Rn}}),(function(e,t,s){var r;(function(c,h){var l="0.7.18",m="",y="?",E="function",T="undefined",w="object",b="string",p="major",u="model",g="name",k="type",D="vendor",x="version",R="architecture",A="console",P="mobile",M="tablet",F="smarttv",Y="wearable",$="embedded",j={extend:function(U,N){var V={};for(var _ in U)N[_]&&N[_].length%2===0?V[_]=N[_].concat(U[_]):V[_]=U[_];return V},has:function(U,N){return typeof U=="string"?N.toLowerCase().indexOf(U.toLowerCase())!==-1:!1},lowerize:function(U){return U.toLowerCase()},major:function(U){return typeof U===b?U.replace(/[^\d\.]/g,"").split(".")[0]:h},trim:function(U){return U.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},K={rgx:function(U,N){for(var V=0,_,B,le,H,ce,ne;V<N.length&&!ce;){var we=N[V],ge=N[V+1];for(_=B=0;_<we.length&&!ce;)if(ce=we[_++].exec(U),ce)for(le=0;le<ge.length;le++)ne=ce[++B],H=ge[le],typeof H===w&&H.length>0?H.length==2?typeof H[1]==E?this[H[0]]=H[1].call(this,ne):this[H[0]]=H[1]:H.length==3?typeof H[1]===E&&!(H[1].exec&&H[1].test)?this[H[0]]=ne?H[1].call(this,ne,H[2]):h:this[H[0]]=ne?ne.replace(H[1],H[2]):h:H.length==4&&(this[H[0]]=ne?H[3].call(this,ne.replace(H[1],H[2])):h):this[H]=ne||h;V+=2}},str:function(U,N){for(var V in N)if(typeof N[V]===w&&N[V].length>0){for(var _=0;_<N[V].length;_++)if(j.has(N[V][_],U))return V===y?h:V}else if(j.has(N[V],U))return V===y?h:V;return U}},Z={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},W={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[g,x],[/(opios)[\/\s]+([\w\.]+)/i],[[g,"Opera Mini"],x],[/\s(opr)\/([\w\.]+)/i],[[g,"Opera"],x],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark)\/([\w\.-]+)/i],[g,x],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[g,"IE"],x],[/(edge|edgios|edgea)\/((\d+)?[\w\.]+)/i],[[g,"Edge"],x],[/(yabrowser)\/([\w\.]+)/i],[[g,"Yandex"],x],[/(puffin)\/([\w\.]+)/i],[[g,"Puffin"],x],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[g,"UCBrowser"],x],[/(comodo_dragon)\/([\w\.]+)/i],[[g,/_/g," "],x],[/(micromessenger)\/([\w\.]+)/i],[[g,"WeChat"],x],[/(qqbrowserlite)\/([\w\.]+)/i],[g,x],[/(QQ)\/([\d\.]+)/i],[g,x],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[g,x],[/(BIDUBrowser)[\/\s]?([\w\.]+)/i],[g,x],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[g,x],[/(MetaSr)[\/\s]?([\w\.]+)/i],[g],[/(LBBROWSER)/i],[g],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[x,[g,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[x,[g,"Facebook"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[x,[g,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[g,/(.+)/,"$1 WebView"],x],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[g,/(.+(?:g|us))(.+)/,"$1 $2"],x],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[x,[g,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[g,x],[/(dolfin)\/([\w\.]+)/i],[[g,"Dolphin"],x],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[g,"Chrome"],x],[/(coast)\/([\w\.]+)/i],[[g,"Opera Coast"],x],[/fxios\/([\w\.-]+)/i],[x,[g,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[x,[g,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[x,g],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[g,"GSA"],x],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[g,[x,K.str,Z.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[g,x],[/(navigator|netscape)\/([\w\.-]+)/i],[[g,"Netscape"],x],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[g,x]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[R,"amd64"]],[/(ia32(?=;))/i],[[R,j.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[R,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[R,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[R,/ower/,"",j.lowerize]],[/(sun4\w)[;\)]/i],[[R,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[R,j.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[u,D,[k,M]],[/applecoremedia\/[\w\.]+ \((ipad)/],[u,[D,"Apple"],[k,M]],[/(apple\s{0,1}tv)/i],[[u,"Apple TV"],[D,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[D,u,[k,M]],[/(kf[A-z]+)\sbuild\/.+silk\//i],[u,[D,"Amazon"],[k,M]],[/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i],[[u,K.str,Z.device.amazon.model],[D,"Amazon"],[k,P]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[u,D,[k,P]],[/\((ip[honed|\s\w*]+);/i],[u,[D,"Apple"],[k,P]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[D,u,[k,P]],[/\(bb10;\s(\w+)/i],[u,[D,"BlackBerry"],[k,P]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[u,[D,"Asus"],[k,M]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[D,"Sony"],[u,"Xperia Tablet"],[k,M]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[u,[D,"Sony"],[k,P]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[D,u,[k,A]],[/android.+;\s(shield)\sbuild/i],[u,[D,"Nvidia"],[k,A]],[/(playstation\s[34portablevi]+)/i],[u,[D,"Sony"],[k,A]],[/(sprint\s(\w+))/i],[[D,K.str,Z.device.sprint.vendor],[u,K.str,Z.device.sprint.model],[k,P]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[D,u,[k,M]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[D,[u,/_/g," "],[k,P]],[/(nexus\s9)/i],[u,[D,"HTC"],[k,M]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[u,[D,"Huawei"],[k,P]],[/(microsoft);\s(lumia[\s\w]+)/i],[D,u,[k,P]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[u,[D,"Microsoft"],[k,A]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[D,"Microsoft"],[k,P]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[u,[D,"Motorola"],[k,P]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[u,[D,"Motorola"],[k,M]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[D,j.trim],[u,j.trim],[k,F]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[D,"Samsung"],[k,F]],[/\(dtv[\);].+(aquos)/i],[u,[D,"Sharp"],[k,F]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[D,"Samsung"],u,[k,M]],[/smart-tv.+(samsung)/i],[D,[k,F],u],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[D,"Samsung"],u,[k,P]],[/sie-(\w*)/i],[u,[D,"Siemens"],[k,P]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[D,"Nokia"],u,[k,P]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[u,[D,"Acer"],[k,M]],[/android.+([vl]k\-?\d{3})\s+build/i],[u,[D,"LG"],[k,M]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[D,"LG"],u,[k,M]],[/(lg) netcast\.tv/i],[D,u,[k,F]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[u,[D,"LG"],[k,P]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[u,[D,"Lenovo"],[k,M]],[/linux;.+((jolla));/i],[D,u,[k,P]],[/((pebble))app\/[\d\.]+\s/i],[D,u,[k,Y]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[D,u,[k,P]],[/crkey/i],[[u,"Chromecast"],[D,"Google"]],[/android.+;\s(glass)\s\d/i],[u,[D,"Google"],[k,Y]],[/android.+;\s(pixel c)\s/i],[u,[D,"Google"],[k,M]],[/android.+;\s(pixel xl|pixel)\s/i],[u,[D,"Google"],[k,P]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[u,/_/g," "],[D,"Xiaomi"],[k,P]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[u,/_/g," "],[D,"Xiaomi"],[k,M]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[u,[D,"Meizu"],[k,M]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})\s+build/i],[u,[D,"OnePlus"],[k,P]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[u,[D,"RCA"],[k,M]],[/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i],[u,[D,"Dell"],[k,M]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[u,[D,"Verizon"],[k,M]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[D,"Barnes & Noble"],u,[k,M]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[u,[D,"NuVision"],[k,M]],[/android.+;\s(k88)\sbuild/i],[u,[D,"ZTE"],[k,M]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[u,[D,"Swiss"],[k,P]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[u,[D,"Swiss"],[k,M]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[u,[D,"Zeki"],[k,M]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[D,"Dragon Touch"],u,[k,M]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[u,[D,"Insignia"],[k,M]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[u,[D,"NextBook"],[k,M]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[D,"Voice"],u,[k,P]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[D,"LvTel"],u,[k,P]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[u,[D,"Envizen"],[k,M]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[D,u,[k,M]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[u,[D,"MachSpeed"],[k,M]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[D,u,[k,M]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[u,[D,"Rotor"],[k,M]],[/android.+(KS(.+))\s+build/i],[u,[D,"Amazon"],[k,M]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[D,u,[k,M]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[k,j.lowerize],D,u],[/(android[\w\.\s\-]{0,9});.+build/i],[u,[D,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[x,[g,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[g,x],[/rv\:([\w\.]{1,9}).+(gecko)/i],[x,g]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[g,x],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[g,[x,K.str,Z.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[g,"Windows"],[x,K.str,Z.os.windows.version]],[/\((bb)(10);/i],[[g,"BlackBerry"],x],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]*)/i,/linux;.+(sailfish);/i],[g,x],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[g,"Symbian"],x],[/\((series40);/i],[g],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[g,"Firefox OS"],x],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[g,x],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[g,"Chromium OS"],x],[/(sunos)\s?([\w\.\d]*)/i],[[g,"Solaris"],x],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[g,x],[/(haiku)\s(\w+)/i],[g,x],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[x,/_/g,"."],[g,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[g,"Mac OS"],[x,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]*)/i],[g,x]]},X=function(U,N){if(typeof U=="object"&&(N=U,U=h),!(this instanceof X))return new X(U,N).getResult();var V=U||(c&&c.navigator&&c.navigator.userAgent?c.navigator.userAgent:m),_=N?j.extend(W,N):W;return this.getBrowser=function(){var B={name:h,version:h};return K.rgx.call(B,V,_.browser),B.major=j.major(B.version),B},this.getCPU=function(){var B={architecture:h};return K.rgx.call(B,V,_.cpu),B},this.getDevice=function(){var B={vendor:h,model:h,type:h};return K.rgx.call(B,V,_.device),B},this.getEngine=function(){var B={name:h,version:h};return K.rgx.call(B,V,_.engine),B},this.getOS=function(){var B={name:h,version:h};return K.rgx.call(B,V,_.os),B},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return V},this.setUA=function(B){return V=B,this},this};X.VERSION=l,X.BROWSER={NAME:g,MAJOR:p,VERSION:x},X.CPU={ARCHITECTURE:R},X.DEVICE={MODEL:u,VENDOR:D,TYPE:k,CONSOLE:A,MOBILE:P,SMARTTV:F,TABLET:M,WEARABLE:Y,EMBEDDED:$},X.ENGINE={NAME:g,VERSION:x},X.OS={NAME:g,VERSION:x},typeof t!==T?(typeof e!==T&&e.exports&&(t=e.exports=X),t.UAParser=X):s(3)?(r=(function(){return X}).call(t,s,t,e),r!==h&&(e.exports=r)):c&&(c.UAParser=X);var ue=c&&(c.jQuery||c.Zepto);if(typeof ue!==T){var fe=new X;ue.ua=fe.getResult(),ue.ua.get=function(){return fe.getUA()},ue.ua.set=function(U){fe.setUA(U);var N=fe.getResult();for(var V in N)ue.ua[V]=N[V]}}})(typeof window=="object"?window:this)}),(function(e,t){(function(s){e.exports=s}).call(t,{})}),(function(e,t,s){Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(g){for(var k=1;k<arguments.length;k++){var D=arguments[k];for(var x in D)Object.prototype.hasOwnProperty.call(D,x)&&(g[x]=D[x])}return g},c=s(0),h=c.DEVICE_TYPES,l=c.defaultData,m=function(g){switch(g){case h.MOBILE:return{isMobile:!0};case h.TABLET:return{isTablet:!0};case h.SMART_TV:return{isSmartTV:!0};case h.CONSOLE:return{isConsole:!0};case h.WEARABLE:return{isWearable:!0};case h.BROWSER:return{isBrowser:!0};default:return l}},y=function(g,k,D,x,R){return{isBrowser:g,browserMajorVersion:k.major,browserFullVersion:k.version,browserName:k.name,engineName:D.name||!1,engineVersion:D.version,osName:x.name,osVersion:x.version,userAgent:R}},E=function(g,k,D,x){return r({},g,{vendor:k.vendor,model:k.model,os:D.name,osVersion:D.version,ua:x})},T=function(g,k,D,x){return{isSmartTV:g,engineName:k.name,engineVersion:k.version,osName:D.name,osVersion:D.version,userAgent:x}},w=function(g,k,D,x){return{isConsole:g,engineName:k.name,engineVersion:k.version,osName:D.name,osVersion:D.version,userAgent:x}},b=function(g,k,D,x){return{isWearable:g,engineName:k.name,engineVersion:k.version,osName:D.name,osVersion:D.version,userAgent:x}},p=t.getNavigatorInstance=function(){return typeof window<"u"&&(window.navigator||navigator)?window.navigator||navigator:!1},u=t.isIOS13Check=function(g){var k=p();return k&&k.platform&&(k.platform.indexOf(g)!==-1||k.platform==="MacIntel"&&k.maxTouchPoints>1&&!window.MSStream)};e.exports={checkType:m,broPayload:y,mobilePayload:E,stvPayload:T,consolePayload:w,wearPayload:b,getNavigatorInstance:p,isIOS13Check:u}})])})(si)),si.exports}var te=ra();const oa=as(te);function la(n){return new aa(n)}class ca{constructor(e,t){d(this,"video"),d(this,"onFrame"),d(this,"croppingRegion"),d(this,"width",1920),d(this,"height",1080),d(this,"_deviceId"),d(this,"callback"),d(this,"callbackFrameRate",30),d(this,"animationId"),d(this,"handleIOS17Bug",!0),d(this,"handleIOS17ObjectFitBug",!0),d(this,"preferredCamera"),d(this,"objectFit","cover"),d(this,"lastFrameTime"),d(this,"videoFrameCapturer"),this.video=e,this.onFrame=t.onFrame,t.width&&(this.width=t.width),t.height&&(this.height=t.height),t.croppingRegion&&(this.croppingRegion=t.croppingRegion),t.deviceId&&(this._deviceId=t.deviceId),t.callbackFrameRate&&(this.callbackFrameRate=t.callbackFrameRate),t.handleIOS17Bug!==void 0&&(this.handleIOS17Bug=t.handleIOS17Bug),t.preferredCamera!==void 0&&(this.preferredCamera=t.preferredCamera),this.handleIOS17Bug&&this.preferredCamera==null&&(this.preferredCamera="Front Camera"),t.handleIOS17ObjectFitBug!==void 0&&(this.handleIOS17ObjectFitBug=t.handleIOS17ObjectFitBug),getComputedStyle(this.video).objectFit!=="cover"&&(console.warn("[Camera] Forcing the object-fit to 'cover'."),this.video.style.setProperty("object-fit",this.objectFit,"important")),this.callback=s=>{if(this.animationId=requestAnimationFrame(this.callback),this.callbackFrameRate>0&&this.lastFrameTime!==void 0&&s-this.lastFrameTime<1e3/(this.callbackFrameRate*1.1)||(this.lastFrameTime=s,!this.video.srcObject||!this.videoFrameCapturer||!this.video.videoWidth||!this.video.videoHeight||!this.onFrame))return;const r=this.croppingRegion??{x:0,y:0,width:this.video.videoWidth,height:this.video.videoHeight},c=this.videoFrameCapturer.captureFrame(r,s);this.onFrame(c)}}set deviceId(e){this._deviceId!==e&&(this._deviceId=e,console.log(`[Camera] setting device id: ${this._deviceId}`),this.initInputDevice())}async initInputDevice(){var e={ideal:"user"};(this.deviceId||this.preferredCamera)&&(e=void 0);const t=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:this.width},height:{ideal:this.height},frameRate:{ideal:60},deviceId:this.deviceId,facingMode:e}});if(this.video.srcObject=t,console.log("[Camera] Assigned video source."),t.getVideoTracks().length>0&&t.getVideoTracks()[0].getSettings().deviceId){const[s]=t.getVideoTracks(),r=s.getSettings();if(console.log("[Camera] Device settings: ",r),this._deviceId=r.deviceId,r.frameRate!==void 0){const c=r.frameRate;this.callbackFrameRate=Math.min(c,this.callbackFrameRate??c),console.log(`[Camera] Callback frame rate set to ${this.callbackFrameRate} fps`)}}}get deviceId(){return this._deviceId}async start(){if(this.handleIOS17Bug&&(console.log("[Camera] Handling iOS 17 bug..."),this.video.style.opacity="0"),this.handleIOS17ObjectFitBug){console.log("[Camera] Handling iOS 17.2 object-fit bug...");const t=getComputedStyle(this.video).objectFit;t&&t!==""&&(this.video.style.objectFit="none")}const e=!this.deviceId||this.deviceId==="";await this.initInputDevice(),this.preferredCamera&&e&&await this.selectPreferredCamera(),this.handleIOS17Bug&&setTimeout(()=>{console.log("[Camera] iOS 17 bug handled"),this.video.style.opacity="1"},1500),this.handleIOS17ObjectFitBug&&setTimeout(()=>{console.log("[Camera] iOS 17.2 object-fit bug handled"),this.video.style.objectFit=this.objectFit},500),this.video.onplaying=async()=>{this.videoFrameCapturer=la(this.video),await this.videoFrameCapturer.start(),this.callback(performance.now())}}async selectPreferredCamera(e=10){const t=async()=>{console.log("[Camera] Enumerating devices...");let c=await navigator.mediaDevices.enumerateDevices();return console.log(`[Camera] ${c.length} devices found`),c=c.filter(h=>h.kind==="videoinput"),console.log(`[Camera] ${c.length} camera devices found`),this.preferredCamera&&(c=c.filter(h=>h.label===this.preferredCamera),console.log(`[Camera] ${c.length} preferred devices found`)),c.length>0?(this.deviceId=c[0].deviceId,!0):!1};let s=0,r=!1;do{try{console.log(`[Camera] Trying to set preferred camera "${this.preferredCamera}"...`);const c=new Promise(h=>setTimeout(h,e*1e3)).then(()=>!1);r=await Promise.race([t(),c])}catch(c){r=!1,console.log(c)}if(r){console.log(`[Camera] Successfully selected preferred camera "${this.preferredCamera}"`);break}console.log(`[Camera] No camera found. Retry after ${500/1e3} second.`),await new Promise(c=>setTimeout(c,500)),s+=500}while(!r&&s<e*1e3)}async stop(){return this.videoFrameCapturer&&(await this.videoFrameCapturer.stop(),this.videoFrameCapturer=void 0),this.video&&this.video.srcObject&&(this.video.srcObject.getVideoTracks().forEach(e=>{e.enabled=!1,e.stop()}),this.video.srcObject=null),this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=void 0),this.waitUntilStopped().then(()=>{})}async waitUntilStopped(e){return new Promise(t=>{let s=0,r=100;const c=setInterval(()=>{s+=r;try{this.video.srcObject.getVideoTracks(),e&&s>=e&&(clearInterval(c),t(!1))}catch{clearInterval(c),t(!0)}},r)})}}class ri{constructor(e){d(this,"name","noname"),d(this,"frameCount",0),d(this,"start"),d(this,"resetInterval",10),d(this,"frameTimes",[]),d(this,"lastFrameTime",0),this.name=e}reset(){this.frameCount=0,this.start=new Date}tick(){const e=Date.now();if((this.start===void 0||this.elapsed>this.resetInterval)&&(this.log(!1),this.reset()),this.lastFrameTime>0){const t=(e-this.lastFrameTime)/1e3;this.frameTimes.push(t),this.frameTimes.length>60&&this.frameTimes.shift()}this.lastFrameTime=e,this.frameCount=this.frameCount+1}get elapsed(){return this.start===void 0?0:(new Date().getTime()-this.start.getTime())/1e3}get average(){return this.frameTimes.length===0?0:1/(this.frameTimes.reduce((e,t)=>e+t)/this.frameTimes.length)}get current(){return this.average.toFixed(2)}log(e=!1){e&&console.log(`[FPS ${this.name}] ${this.current}fps`)}}function ha(n){let e=document.createElement("canvas");return e.width=n.videoWidth,e.height=n.videoHeight,e.getContext("2d").drawImage(n,0,0),e}function da(n){if(n instanceof HTMLCanvasElement)return n;let e=document.createElement("canvas");return e.width=n.width,e.height=n.width,e.getContext("2d").drawImage(n,0,0),e}function oi(n){let e;return n.image instanceof HTMLVideoElement?e=ha(n.image):n.image instanceof HTMLImageElement?e=da(n.image):e=n.image,e}async function kr(){const n="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAEYklEQVR4Xu3UAQkAAAwCwdm/9HI83BLIOdw5AgQIRAQWySkmAQIEzmB5AgIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw";return new Promise(e=>{const t=document.createElement("img");t.src=n,t.onload=()=>e(t)})}async function Sr(){const n=new ImageData(1,1);return n.data[0]=255,n.data[1]=255,n.data[2]=255,n.data[3]=255,n}async function ua(n){return new Promise(e=>setTimeout(e,n))}function Dr(n){let e=1,t=1,s=0,r=0;return n.forEach(c=>{e=Math.min(c.x,e),t=Math.min(c.y,t),s=Math.max(c.x,s),r=Math.max(c.y,r)}),{xCenter:e+(s-e)/2,yCenter:t+(r-t)/2,width:s-e,height:r-t}}const tt=class Pe{constructor(e){d(this,"createDetector"),d(this,"maxFps",30),this.createDetector=e}async getFaceDetector(){return Pe.faceDetector==null&&(Pe.faceDetector=this.createDetector()),Pe.faceDetector}get lastSendTime(){return Pe.lastSendTime}set lastSendTime(e){Pe.lastSendTime=e}get modelState(){return Pe.modelState}set modelState(e){Pe.modelState=e}async loadModels(e){if(this.modelState!=="loaded"){if(this.modelState===void 0){this.modelState="loading";try{await(await this.getFaceDetector()).loadModels(e)}catch(t){throw this.modelState=void 0,t}console.log("[FaceDetectorProxy] model loaded."),this.modelState="loaded";return}do await ua(500);while(this.modelState!=="loading")}}timeout(e){return new Promise((t,s)=>setTimeout(s,e))}async detect(e){if(this.modelState!=="loaded"){console.log("[FaceDetectorProxy] model not ready");const c=oi(e);return{faceBox:void 0,landmarks:[],videoFrame:c}}const t=1e3/this.maxFps,s=new Date;if(this.lastSendTime===void 0||s.getTime()-this.lastSendTime.getTime()>t)return this.lastSendTime=s,Promise.race([this.timeout(1e3),(await this.getFaceDetector()).detect(e)]);const r=oi(e);return{faceBox:void 0,landmarks:[],videoFrame:r}}};d(tt,"faceDetector"),d(tt,"modelState"),d(tt,"lastSendTime");let $e=tt;const fa=(()=>{const n={loadModelsFromRoot:!1};return typeof window<"u"?(window.__vital_sign_camera_global_options__===void 0&&(window.__vital_sign_camera_global_options__=n),window.__vital_sign_camera_global_options__):typeof self<"u"?(self.__vital_sign_camera_global_options__===void 0&&(self.__vital_sign_camera_global_options__=n),self.__vital_sign_camera_global_options__):n})();function ga(n){return n.startsWith("http")||n.startsWith("/")||!fa.loadModelsFromRoot?n:`/${n}`}async function rt(){return new Promise((n,e)=>{if(typeof FaceMeshUMD<"u"){n(FaceMeshUMD);return}const t=ga("assets/facemesh.umd.cjs");if(document.querySelector(`script[src="${t}"]`)){n(FaceMeshUMD);return}const s=document.createElement("script");s.src=t,document.head.appendChild(s),s.addEventListener("load",()=>{console.log("[VitalSignCamera] Imported FaceMeshUMD"),n(FaceMeshUMD)}),s.addEventListener("error",r=>{console.error("[VitalSignCamera] Failed to import FaceMeshUMD",r),e(r)})})}async function li(n){switch(console.log(`[VitalSignCamera] Creating face detector of type ${n}...`),n){case se.MediaPipe:const{MediaPipeFaceDetector:e}=await Se(async()=>{const{MediaPipeFaceDetector:y}=await import("./BCpbglXA-TWfTyG0L.js");return{MediaPipeFaceDetector:y}},[]);return new $e(()=>new e);case se.OpenCV:const{OpenCVFaceDetector:t}=await Se(async()=>{const{OpenCVFaceDetector:y}=await import("./BWAQPQyi-C5V0j-Yx.js");return{OpenCVFaceDetector:y}},__vite__mapDeps([0,1]));return new $e(()=>new t);case se.Dummy:const{DummyFaceDetector:s}=await Se(async()=>{const{DummyFaceDetector:y}=await import("./Bn12JWLC-CVWmh1nt.js");return{DummyFaceDetector:y}},[]);return new s;case se.TFMediaPipe:const{TFMediaPipeFaceDetector:r}=await Se(async()=>{const{TFMediaPipeFaceDetector:y}=await import("./CLfIALQ9-CxIkLwLD.js");return{TFMediaPipeFaceDetector:y}},__vite__mapDeps([2,1]));return new $e(()=>new r);case se.FaceApi:const{FaceApiFaceDetector:c}=await Se(async()=>{const{FaceApiFaceDetector:y}=await import("./C2sKXxLE-i_ow4Vux.js");return{FaceApiFaceDetector:y}},__vite__mapDeps([3,4]));return new c;case se.MPFaceMesh:const{MPVisionFaceMeshDetector:h}=await Se(async()=>{const{MPVisionFaceMeshDetector:y}=await import("./C3-2sbsJ-7tLxEHVz.js");return{MPVisionFaceMeshDetector:y}},__vite__mapDeps([5,6]));return new $e(()=>new h);case se.MPFaceDetector:const{MPVisionFaceDetector:l}=await Se(async()=>{const{MPVisionFaceDetector:y}=await import("./DVSaSWk3-Dg7outVf.js");return{MPVisionFaceDetector:y}},__vite__mapDeps([7,6]));return new $e(()=>new l);case se.MPFaceMeshThreaded:const{MPVisionFaceMeshDetectorThread:m}=await rt();return new $e(()=>new m)}}function ma(n){var e;const t=(e=n.srcObject)==null?void 0:e.getVideoTracks()[0];if(t.getCapabilities!==void 0){const s=t.getCapabilities().facingMode;return s&&s[0]}else return t.getSettings().facingMode}function pa(n){const e=ma(n);return e&&e==="environment"?"none":"scaleX(-1)"}function Ri(n){const{image:e,facebox:t}=n;let s=t.width*e.width,r=t.height*e.height,c=(t.xCenter-t.width/2)*e.width,h=(t.yCenter-t.height/2)*e.height;r=r*.7;const l=new OffscreenCanvas(e.width,e.height),m=l.getContext("2d");m?.putImageData(e,0,0);const y=new OffscreenCanvas(s,r),E=y.getContext("2d");E.drawImage(l,c,h,s,r,0,0,s,r);let T=E.getImageData(0,0,y.width,y.height).data,w=0,b=0;for(let p=0;p<T.length;p+=4)w+=Math.max(T[p],T[p+1],T[p+2]),b++;return w/b}self.onmessage=n=>{const{inputData:e,hash:t}=n.data,s=Ri(e);self.postMessage({result:s,hash:t})};const va=90,wa=[.3,.9],ya=[.4,.6],ba=[.3,.7],ci=.1,xa=30,ka=te.isMobile&&!te.isTablet,Sa=10,hi=ka||te.isAndroid?Sa:15;function Ne(n){return Array.isArray(n)?n:[n.min,n.max]}class Da{constructor(e,t){d(this,"MOVEMENT_ARRAY",[]),d(this,"_conditions"),d(this,"vitalSignEngine"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/DaF7aLs5-BKM5EhUa.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Ri,"CheckBrightness")),d(this,"minimumFrameRate",hi),d(this,"minimumBrightness",va),d(this,"validXRange",ya),d(this,"validYRange",ba),d(this,"validDistanceRange",wa),this.vitalSignEngine=e,t?.boundaryRangeX!==void 0&&(this.validXRange=Ne(t.boundaryRangeX)),t?.boundaryRangeY!==void 0&&(this.validYRange=Ne(t.boundaryRangeY)),t?.distanceRange!==void 0&&(this.validDistanceRange=Ne(t.distanceRange))}configure(e){e?.minimumFrameRate!==void 0&&(this.minimumFrameRate=e.minimumFrameRate),e?.validDistanceRange!==void 0&&(this.validDistanceRange=Ne(e.validDistanceRange)),e?.validXRange!==void 0&&(this.validXRange=Ne(e.validXRange)),e?.validYRange!==void 0&&(this.validYRange=Ne(e.validYRange))}get conditions(){return this._conditions}resetMovementArray(){this.MOVEMENT_ARRAY=[]}reset(){this.resetMovementArray(),this._conditions=void 0}async getBrightness(e,t){var s;const r=(s=e.getContext("2d",{willReadFrequently:!0}))==null?void 0:s.getImageData(0,0,e.width,e.height);return r?await this.workerPool.callWorker({image:r,facebox:t}):0}checkDistance(e){let t=this.validDistanceRange;return e.height>t[1]?Ie.TooClose:e.height<t[0]?Ie.TooFar:Ie.OK}checkFacePosition(e){if(e===void 0)return ve.Unknown;let t=this.validXRange,s=this.validYRange,r=ve.Centered;return e.yCenter<s[0]&&(r=ve.TooHigh),e.yCenter>s[1]&&(r=ve.TooLow),e.xCenter<t[0]&&(r=ve.TooRight),e.xCenter>t[1]&&(r=ve.TooLeft),r}async checkCondition(e,t,s){let r=!0;if(e!==void 0){let E=t?await this.getBrightness(e,t):0;r=this.minimumBrightness<=E}const c=t?this.checkDistance(t):Ie.TooFar,h=this.checkFacePosition(t);let l=!1;if(this.MOVEMENT_ARRAY.length>=xa){this.MOVEMENT_ARRAY.shift();let E=0,T=0,w=1,b=1;for(let g=0;g<this.MOVEMENT_ARRAY.length;g++)E=this.MOVEMENT_ARRAY[g][0]>E?this.MOVEMENT_ARRAY[g][0]:E,T=this.MOVEMENT_ARRAY[g][1]>T?this.MOVEMENT_ARRAY[g][1]:T,w=this.MOVEMENT_ARRAY[g][0]<w?this.MOVEMENT_ARRAY[g][0]:w,b=this.MOVEMENT_ARRAY[g][1]<b?this.MOVEMENT_ARRAY[g][1]:b;const p=E.valueOf()-w.valueOf(),u=T.valueOf()-b.valueOf();l=p<=ci&&u<=ci}t&&this.MOVEMENT_ARRAY.push([t.xCenter,t.yCenter]);let m=await this.vitalSignEngine.isReady();const y=s>=this.minimumFrameRate;return{lighting:r,distance:c===Ie.OK,centered:h===ve.Centered,movement:l,serverReady:m,frameRate:y,distanceCondition:c,facePositionCondition:h,fps:s}}async processFrame(e,t,s,r,c){c==="measuring"&&(r=Math.max(hi,r)),this._conditions=await this.checkCondition(s?e:void 0,t,r)}}function Ea(n,e,t){const s=new Da(n,t||void 0);return s.configure(e),s}async function Ca(){try{let n=await navigator.mediaDevices.enumerateDevices();return n=n.filter(e=>e.kind==="videoinput"),n.map((e,t)=>({label:e.label,id:e.deviceId,deviceIndex:t}))}catch{return[]}}function Ta(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(n[t].id!==e[t].id||n[t].label!==e[t].label)return!1;return!0}class Ra{constructor(e,t){d(this,"camera"),d(this,"devices",[]),d(this,"timer"),d(this,"selectedDevice"),d(this,"onChanged"),this.camera=e,this.onChanged=t}start(){this.timer===void 0&&(this.timer=setInterval(async()=>{const e=await Ca();(!Ta(e,this.devices)||this.camera.device!==this.selectedDevice)&&(this.devices=e,this.selectedDevice=this.camera.device,this.onChanged&&this.onChanged(this.devices))},1e3))}}async function Ma(n){const{DefaultAgeEstimator:e}=await Se(async()=>{const{DefaultAgeEstimator:t}=await import("./C4IL5Qct-DJp1C_OT.js");return{DefaultAgeEstimator:t}},__vite__mapDeps([8,4]));return new Promise(t=>{const s=new e(n,()=>{t(s)})})}class Aa{constructor(e,t={}){d(this,"canvas"),d(this,"ctx"),d(this,"config"),d(this,"ecgPhase",0),d(this,"tracePoints",[]),d(this,"tracePosition",0),d(this,"ecgAnimationStopped",!1),this.config={width:t.width||600,height:t.height||200,maxPoints:t.maxPoints||300,lineColor:t.lineColor||"#00ff00",backgroundColor:t.backgroundColor||"#000000",gridColor:t.gridColor||"#333333",visualizationType:t.visualizationType||"PPG",debug:t.debug||!1,...t},this.canvas=document.createElement("canvas"),this.canvas.width=this.config.width,this.canvas.height=this.config.height,this.canvas.style.border="1px solid #333",this.canvas.style.backgroundColor=this.config.backgroundColor,this.canvas.style.display="block",this.canvas.style.width=`${this.config.width}px`,this.canvas.style.height=`${this.config.height}px`,e.appendChild(this.canvas),this.log("Canvas created and appended");const s=this.canvas.getContext("2d");if(!s)throw new Error("Could not get 2D context from canvas");this.ctx=s,this.clear()}log(e,...t){this.config.debug&&console.log(`[Signal Visualizer] ${e}`,...t)}updateSignal(e,t,s){var r;if(this.log("updateSignal:",{hasData:!!e,valuesLength:((r=e?.values)==null?void 0:r.length)||0,sampleRate:e?.sampleRate,visualizationType:this.config.visualizationType,heartRate:t?.heartRate}),this.ctx.clearRect(0,0,this.config.width,this.config.height),this.ctx.fillStyle=this.config.backgroundColor,this.ctx.fillRect(0,0,this.config.width,this.config.height),this.config.visualizationType==="ECG"){if(s===z.Idle){this.stopECGAnimation(),this.drawNoSignal();return}this.ecgAnimationStopped=!1,this.drawECGSignal(t)}else{if(!e||e.values.length===0){this.drawNoSignal();return}this.drawGrid(),this.drawSignalArray(e.values,e.sampleRate),this.drawInfo(e)}}clear(){this.ctx.save(),this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over",this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.clearRect(0,0,this.config.width,this.config.height),this.ctx.fillStyle=this.config.backgroundColor,this.ctx.fillRect(0,0,this.config.width,this.config.height),this.ctx.restore()}stopECGAnimation(){this.ecgAnimationStopped=!0,this.tracePoints=[],this.tracePosition=0,this.ecgPhase=0,this.log("ECG animation stopped")}drawNoSignal(){this.ctx.fillStyle="#666666",this.ctx.font="16px monospace",this.ctx.textAlign="center",this.ctx.fillText("No Signal Data",this.config.width/2,this.config.height/2)}drawGrid(){this.ctx.save(),this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over",this.ctx.strokeStyle=this.config.gridColor,this.ctx.lineWidth=1,this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0;const e=this.config.width/10;for(let s=0;s<=this.config.width;s+=e)this.ctx.beginPath(),this.ctx.moveTo(s,0),this.ctx.lineTo(s,this.config.height),this.ctx.stroke();const t=this.config.height/5;for(let s=0;s<=this.config.height;s+=t)this.ctx.beginPath(),this.ctx.moveTo(0,s),this.ctx.lineTo(this.config.width,s),this.ctx.stroke();this.ctx.restore()}drawECGSignal(e){if(this.ecgAnimationStopped){this.drawNoSignal();return}this.drawGrid();const t=e?.heartRate||72,s=60/t*1e3,r=60/t*30,c=s/r;this.ecgPhase=(this.ecgPhase+c)%s;const h=this.ecgPhase/s,l=(this.generateECGWaveform(h,t)+1)*(this.config.height*.3)+this.config.height*.2;for(this.tracePoints.push({x:this.tracePosition,y:l}),this.tracePosition+=2;this.tracePoints.length>0&&this.tracePoints[0].x<-10;)this.tracePoints.shift();this.tracePosition>this.config.width+10&&(this.tracePosition=0,this.tracePoints=[]),this.drawMovingTrace(),this.drawECGInfo(t)}drawMovingTrace(){if(!(this.tracePoints.length<2)){this.ctx.shadowColor="#ff4444",this.ctx.shadowBlur=8,this.ctx.strokeStyle="#ff6b6b",this.ctx.lineWidth=4,this.ctx.beginPath(),this.ctx.moveTo(this.tracePoints[0].x,this.tracePoints[0].y);for(let e=1;e<this.tracePoints.length;e++)this.ctx.lineTo(this.tracePoints[e].x,this.tracePoints[e].y);this.ctx.stroke(),this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0}}generateECGWaveform(e,t){const s=(Math.random()-.5)*.05,r=Math.max(.08,Math.min(.2,.15*(72/t))),c=.8+(Math.random()-.5)*.3;if(e>=0&&e<=r){const h=e/r;return h<.15?h*(5+Math.random())*c*.7:h<.3?c*(.9+Math.random()*.2):h<.5?(1-(h-.3)/.2)*c*(.8+Math.random()*.4):Math.max(0,1-(h-.5)/.5)*c*(.2+Math.random()*.3)}else return s}drawSignalArray(e,t){const s=Math.min(e.length,this.config.maxPoints);if(s<2)return;const r=Math.min(...e),c=Math.max(...e)-r||1;this.ctx.save(),this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over",this.ctx.strokeStyle=this.config.lineColor,this.ctx.lineWidth=2,this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0,this.ctx.beginPath();const h=this.config.width/(s-1);for(let l=0;l<s;l++){const m=l*h,y=(e[l]-r)/c,E=this.config.height-y*(this.config.height*.8)-this.config.height*.1;l===0?this.ctx.moveTo(m,E):this.ctx.lineTo(m,E)}this.ctx.stroke(),this.ctx.restore()}drawECGInfo(e){this.ctx.fillStyle="#ffffff",this.ctx.font="12px monospace",this.ctx.textAlign="left",["ECG Animation",`Rate: ${e} BPM`,"Visual Demo Only"].forEach((t,s)=>{this.ctx.fillText(t,10,20+s*15)})}drawInfo(e){const{values:t,sampleRate:s}=e;this.ctx.fillStyle="#ffffff",this.ctx.font="12px monospace",this.ctx.textAlign="left",[`Samples: ${t.length}`,`Sample Rate: ${s.toFixed(1)} Hz`,`Duration: ${(t.length/s).toFixed(1)}s`].forEach((r,c)=>{this.ctx.fillText(r,10,20+c*15)})}destroy(){this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}}async function Pa(n){return new(await Se(async()=>{const{FdaRealtimeEstimator:e}=await import("./Bwl84QI3-B7L5NtHi.js");return{FdaRealtimeEstimator:e}},[])).FdaRealtimeEstimator(n)}function Ia(n){let e=document.createElement("div"),t=document.createElement("div");return e.appendChild(t),n.after(e),e.style.pointerEvents="none",e}function Fa(n,e,t){const s=e.clientWidth/e.clientHeight,r=t.videoWidth/t.videoHeight;let c,h;r>s?(c=e.clientHeight,h=c*r):(h=e.clientWidth,c=h/r);const l=(c-e.clientHeight)/2,m=(h-e.clientWidth)/2;return{left:(n.xCenter-n.width/2)*h-m,top:(n.yCenter-n.height/2)*c-l,width:n.width*h,height:n.height*c}}class di{constructor(e,t){d(this,"boundingBox"),d(this,"video"),d(this,"color"),this.video=e,this.color=t?.color||"red",this.enabled=!0}set enabled(e){var t;e&&!this.boundingBox&&(this.boundingBox=Ia(this.video)),!e&&this.boundingBox&&((t=this.boundingBox.parentElement)==null||t.removeChild(this.boundingBox),this.boundingBox=void 0)}updateOptions(e){e.color&&e.color!==this.color&&(this.color=e.color)}update(e){if(!this.boundingBox)return;this.boundingBox.style.position="fixed";const{x:t,y:s,width:r,height:c}=this.video.getBoundingClientRect();this.boundingBox.style.left=`${t}px`,this.boundingBox.style.top=`${s}px`,this.boundingBox.style.width=`${r}px`,this.boundingBox.style.height=`${c}px`,this.boundingBox.style.transform=`${this.video.style.transform}`,this.boundingBox.style.overflow="clip";const h=this.boundingBox.children[0];if(e===void 0){h.style.setProperty("display","none");return}const l=Fa(e,this.video,this.video);h.style.display="block",h.style.position="relative",h.style.left=`${l.left}px`,h.style.top=`${l.top}px`,h.style.width=`${l.width}px`,h.style.height=`${l.height}px`,h.style.borderStyle="solid",h.style.borderColor=this.color||"red"}}const _a=".up-down-mask-animation{mask:linear-gradient(to bottom,transparent,black,transparent);-webkit-mask-size:100% 10%;mask-size:100% 10%;-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;animation:moveMaskUpDown var(--face-mesh-animation-duration, 2s) linear infinite}@keyframes moveMaskUpDown{0%{-webkit-mask-position:0% 0;mask-position:0% 0}50%{-webkit-mask-position:0% 100%;mask-position:0% 100%}to{-webkit-mask-position:0% 0;mask-position:0% 0}}.left-right-mask-animation{mask:linear-gradient(to right,transparent,black,transparent);-webkit-mask-size:10% 100%;mask-size:10% 100%;-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;animation:moveMaskLeftRight var(--face-mesh-animation-duration, 2s) linear infinite}@keyframes moveMaskLeftRight{0%{-webkit-mask-position:0% 0;mask-position:0% 0}50%{-webkit-mask-position:100% 0;mask-position:100% 0}to{-webkit-mask-position:0% 0;mask-position:0% 0}}.four-way-mask-animation{mask:linear-gradient(to bottom,transparent,black,transparent),linear-gradient(to right,transparent,black,transparent);-webkit-mask-size:100% 10%,10% 100%;mask-size:100% 10%,10% 100%;-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-composite:source-over;mask-composite:add;animation:moveMaskFourWay var(--face-mesh-animation-duration, 2s) linear infinite}@keyframes moveMaskFourWay{0%{-webkit-mask-position:0% 0,0% 0;mask-position:0% 0,0% 0}25%{-webkit-mask-position:0% 100%,0% 0;mask-position:0% 100%,0% 0}50%{-webkit-mask-position:0% 0%,0% 0;mask-position:0% 0%,0% 0}75%{-webkit-mask-position:0% 0%,100% 0;mask-position:0% 0%,100% 0}to{-webkit-mask-position:0% 0,0% 0;mask-position:0% 0,0% 0}}";async function Ba(){const{FACEMESH_FACE_OVAL:n}=await rt();return n}async function Oa(n,e,t,s){if(e===void 0||t===void 0)return;n.save();const r=n.canvas.width,c=n.canvas.height,h=s?.lineWidth||await Va(e,r);for(var l=0;l<t.length;l++){const m=t[l];n.beginPath();const y=e[m[0]],E=e[m[1]];n.moveTo(y.x*r,y.y*c),n.lineTo(E.x*r,E.y*c),n.lineWidth=h,n.strokeStyle=s?.color||"lightgreen",n.stroke()}n.restore()}async function Va(n,e){const t=await La(n)*.01*e;return console.log("lineWidth = ",t),t}async function La(n){const e=(await Ba()).map(([t])=>n[t].x);return Math.abs(Math.max(...e)-Math.min(...e))}class ui{constructor(e,t){d(this,"faceMesh"),d(this,"canvas"),d(this,"video"),d(this,"color","lightgreen"),d(this,"lineWidth"),d(this,"animateStyle"),d(this,"animationSpeed"),d(this,"animationDelay"),d(this,"animationDirection"),this.video=e,this.color=t?.color||this.color,this.lineWidth=t?.lineWidth||this.lineWidth,this.animationSpeed=t?.animationSpeed,this.animationDelay=t?.animationDelay,this.animationDirection=t?.animationDirection,this.enabled=!0,this.animateStyle=document.createElement("style"),this.animateStyle.innerHTML=_a,this.animate=t?.animate!==void 0?t.animate:!0}destroy(){console.log("[VitalSignCamera] Trying to destroy face mesh..."),this.faceMesh&&this.faceMesh.parentElement&&(this.faceMesh.parentElement.removeChild(this.faceMesh),console.log("[VitalSignCamera] Face mesh removed."),this.faceMesh=void 0,this.canvas=void 0),this.animateStyle.parentElement&&(this.animateStyle.parentElement.removeChild(this.animateStyle),console.log("[VitalSignCamera] Face mesh animation CSS removed."))}get animationClass(){return this.animationDirection==="vertical"?"up-down-mask-animation":this.animationDirection==="horizontal"?"left-right-mask-animation":this.animationDirection=="both"?"four-way-mask-animation":"up-down-mask-animation"}set enabled(e){var t;e&&!this.faceMesh&&(this.faceMesh=document.createElement("div"),this.canvas=document.createElement("canvas"),this.canvas.style.setProperty("--face-mesh-animation-duration",`${this.animationSpeed??8}s`),this.canvas.style.setProperty("--face-mesh-animation-delay",`${this.animationDelay??-1.5}s`),console.log("Applying animation class",this.animationDirection,this.animationSpeed),this.canvas.className=`face-mesh-canvas ${this.animationClass}`,this.faceMesh.appendChild(this.canvas),this.faceMesh.style.width="0px",this.faceMesh.style.height="0px",this.faceMesh.style.pointerEvents="none",this.faceMesh.style.overflow="clip",this.video.after(this.faceMesh),console.log("[VitalSignCamera] Face mesh inserted.")),!e&&this.faceMesh&&((t=this.faceMesh.parentElement)==null||t.removeChild(this.faceMesh),this.faceMesh=void 0,this.canvas=void 0)}set animate(e){var t;e&&!this.animate&&(document.body.append(this.animateStyle),console.log("[VitalSignCamera] Face mesh CSS inserted.")),!e&&this.animate&&((t=this.animateStyle.parentElement)==null||t.removeChild(this.animateStyle))}get animate(){return this.animateStyle.parentElement!==null}get enabled(){return this.faceMesh!==void 0}updateOptions(e){e.color!==void 0&&e.color!==this.color&&(this.color=e.color),e.lineWidth!==void 0&&e.lineWidth!==this.lineWidth&&(this.lineWidth=e.lineWidth),e.animate!==void 0&&e.animate!==this.animate&&(this.animate=e.animate),e.animationSpeed!==void 0&&e.animationSpeed!==this.animationSpeed&&(this.animationSpeed=e.animationSpeed,this.canvas&&this.canvas.style.setProperty("--face-mesh-animation-duration",`${this.animationSpeed}s`)),e.animationDelay!==void 0&&e.animationDelay!==this.animationDelay&&(this.animationDelay=e.animationDelay,this.canvas&&this.canvas.style.setProperty("--face-mesh-animation-delay",`${this.animationDelay}s`)),e.animationDirection!==void 0&&e.animationDirection!==this.animationDirection&&(this.animationDirection=e.animationDirection,this.canvas&&(this.canvas.className=`face-mesh-canvas ${this.animationClass}`))}update(e){if(!this.faceMesh||!this.canvas)return;this.faceMesh.style.position="fixed";const{x:t,y:s,width:r,height:c}=this.video.getBoundingClientRect();this.faceMesh.style.left=`${t}px`,this.faceMesh.style.top=`${s}px`,this.faceMesh.style.width=`${r}px`,this.faceMesh.style.height=`${c}px`,this.faceMesh.style.transform=`${this.video.style.transform}`,this.faceMesh.style.overflow="clip",this.redraw(e);const h=this.computeStyle(this.faceMesh);this.canvas.style.left=h.left,this.canvas.style.top=h.top,this.canvas.style.width=h.width,this.canvas.style.height=h.height,this.canvas.style.aspectRatio=h.aspectRatio,this.canvas.style.position="relative"}async redraw(e){const{FACEMESH_TESSELATION:t}=await rt();if(!this.faceMesh||!this.canvas){console.warn("Undefined canvas or face mesh");return}this.canvas.width=this.video.videoWidth,this.canvas.height=this.video.videoHeight;const s=this.canvas.getContext("2d");if(s===null){console.warn("Null Context");return}if(s.save(),s.clearRect(0,0,this.canvas.width,this.canvas.height),e!==void 0&&e.length>0){const r=await this.computeLineWidth(e);s.lineTo(this.canvas.width,this.canvas.height),Oa(s,e,t,{color:this.color,lineWidth:r})}s.restore()}computeStyle(e){let t=0;const s=this.video.videoHeight,r=this.video.videoWidth;t=r&&s?r/s:0;const c={width:"",height:"",left:"0%",top:"0%",aspectRatio:`${t}`},h=e.clientWidth/e.clientHeight;return h<t?(c.left=`${(h-t)/h/2*100}%`,c.height="100%"):(c.top=`${(1/h-1/t)*h/2*100}%`,c.width="100%"),c}async computeLineWidth(e){const t=this.video.videoWidth,s=this.lineWidth===void 0?"1%":this.lineWidth,r=await Ua(e);var c;return typeof s=="string"?c=parseFloat(s)*.01*r*t:c=s,c}}async function Ua(n){const{FACEMESH_FACE_OVAL:e}=await rt(),t=e.map(([s])=>n[s].x);return Math.abs(Math.max(...t)-Math.min(...t))}async function $a(n){const{RemoteBeautyAnalyzer:e}=await Se(async()=>{const{RemoteBeautyAnalyzer:t}=await import("./BmgzXNFR-owrGLWW2.js");return{RemoteBeautyAnalyzer:t}},[]);return new e(n)}function Rt(n){var e;const{videoFrame:t,rect:s}=n,{x:r,y:c,w:h,h:l}=s,m=new OffscreenCanvas(t.width,t.height);(e=m.getContext("2d"))==null||e.putImageData(t,0,0);let y=new OffscreenCanvas(h,l).getContext("2d");return y.drawImage(m,r,c,h,l,0,0,h,l),y.getImageData(0,0,h,l)}self.onmessage=n=>{const{inputData:e,hash:t}=n.data,s=Rt(e);self.postMessage({result:s,hash:t},[s.data.buffer])};class Na{constructor(e,t,s){if(d(this,"type","chest"),d(this,"boundingBox"),d(this,"imageData"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BVv6I5U7-eMazRsx3.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Rt,"ChestROIExtractorWorker")),this.boundingBox=this.chestRect({width:e.width,height:e.height},t,s),this.boundingBox===void 0){this.imageData=Promise.resolve(void 0);return}this.imageData=e.getImageData().then(r=>{if(!(!r||!this.boundingBox))return this.workerPool.callWorker({videoFrame:r,rect:this.boundingBox})})}chestRect(e,t,s){if(!t||!s)return;let r=t.width*e.width,c=t.height*e.height,h=(s.xCenter-t.width/2)*e.width,l=(t.yCenter-t.height/2)*e.height;if(l=l+c,l+c>e.height&&(c=e.height-l),!(r<=0||c<=0)&&!(c<.1*s.height*e.height))return{x:h,y:l,w:r,h:c}}}class Ha{constructor(e,t,s,r="rgb1x1",c=ie.AwsEnterpriseProd){if(d(this,"type","face"),d(this,"boundingBox"),d(this,"imageData"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BVv6I5U7-eMazRsx3.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Rt,"FaceROIExtractorWorker")),this.boundingBox=this.faceRect({width:e.width,height:e.height},t,s,r,c),this.boundingBox===void 0){this.imageData=Promise.resolve(void 0);return}this.imageData=e.getImageData().then(h=>{if(!(!h||!this.boundingBox))return this.workerPool.callWorker({videoFrame:h,rect:this.boundingBox})})}faceRect(e,t,s,r,c){var h;if(!t||!s)return;let l=1,m=t.width*e.width*l,y=t.height*e.height*l,E=(s.xCenter-t.width/2*l)*e.width,T=(s.yCenter-t.height/2*l)*e.height;if(m==0||y==0)return;let w=(h=Dt.get(c))==null?void 0:h.schemaVersion;return(r=="rgb1x1"||r=="yuv1x1"&&w&&He(w,"2.0")<0)&&(y=y*.7),{x:E,y:T,w:m,h:y}}}function fi(n){const e=n.map(s=>s.x),t=n.map(s=>s.y);return{min:{x:Math.min(...e),y:Math.min(...t)},max:{x:Math.max(...e),y:Math.max(...t)}}}function Wa(n){const e=n.reduce((t,s)=>({x:t.x+s.x,y:t.y+s.y}),{x:0,y:0});return{x:e.x/n.length,y:e.y/n.length}}function za(n,e,t){const s=[n[0].x,n[0].y,n[1].x,n[1].y],r=[e[0].x,e[0].y,e[1].x,e[1].y],[c,h,l,m]=s,y=Math.sqrt(Math.pow(Math.abs(c-l),2)+Math.pow(Math.abs(h-m),2)),[E,T,w,b]=r,p=E-w,u=T-b,g=[1,0],k=[l-c,m-h],D=g[0]*k[0]+g[1]*k[1],x=Math.sqrt(g[0]*g[0]+g[1]*g[1]),R=Math.sqrt(k[0]*k[0]+k[1]*k[1]),A=Math.acos(D/(x*R)),P=Math.abs(Math.cos(A)*y/2),M=Math.abs(Math.sin(A)*y/2),F={x:t.x-p/2,y:t.y-u/2*.8},Y={x:t.x-P/2,y:t.y-M/2},$={x:t.x+P/2,y:t.y+M/2},j={x:F.x+P/2,y:F.y+M/2},K={x:F.x-P/2,y:F.y-M/2};return[Y,$,j,K]}function ja(n,e){const t=fi(e),s=t.min.x,r=t.min.y,c=t.max.x,h=t.max.y,l=[(c-s)*.25,(h-r)*.25];let m,y,E,T;switch(n){case"forehead":m=e[151].x,y=e[151].y,E=l[0]*2,T=l[1]*.5;break;case"glabella":m=e[8].x,y=e[8].y,E=l[0]*.6,T=l[1]*.6;break;case"rightCheek":m=e[425].x,y=e[425].y-l[1]*.2,E=l[0]*.8,T=l[1]*.6;break;case"leftCheek":m=e[205].x,y=e[205].y-l[1]*.2,E=l[0]*.8,T=l[1]*.6;break;case"chin":m=e[200].x,y=e[200].y,E=l[0]*.8,T=l[1]*.4;break;case"neck":const g=[e[205],e[425]],k=[e[168],e[4]],D=e[152],x=za(g,k,D),R=fi(x),A=Wa(x);m=A.x,y=A.y,E=R.max.x-R.min.x,T=R.max.y-R.min.y,y+=T,T*=2;break;case"rightLowerCheek":m=e[425].x,y=e[425].y,E=l[0],T=l[1]/2,y+=T/2;break;case"rightUpperCheek":m=e[425].x,y=e[425].y,E=l[0],T=l[1]/2,y-=T/2;break;case"leftLowerCheek":m=e[205].x,y=e[205].y,E=l[0],T=l[1]/2,y+=T/2;break;case"leftUpperCheek":m=e[205].x,y=e[205].y,E=l[0],T=l[1]/2,y-=T/2;break;default:throw new Error(`Unsupported ROI part: ${n}`)}const w=m-E/2,b=y-T/2,p=w+E,u=b+T;return[{x:w,y:b},{x:p,y:b},{x:p,y:u},{x:w,y:u}]}function Mi(n,e){if(e.length===0)return{x:0,y:0,w:0,h:0};if(e.length===1){const h=e[0];return{x:Math.floor(h.x)*n.width,y:Math.floor(h.y)*n.height,w:1,h:1}}let t=e[0].x,s=e[0].y,r=e[0].x,c=e[0].y;for(let h=1;h<e.length;h++){const l=e[h];l.x<t&&(t=l.x),l.y<s&&(s=l.y),l.x>r&&(r=l.x),l.y>c&&(c=l.y)}return{x:t*n.width,y:s*n.height,w:(r-t)*n.width,h:(c-s)*n.height}}function Ai(n){var e;const{videoFrame:t,normalizedPoints:s}=n,{x:r,y:c,w:h,h:l}=Mi(t,s),m=new OffscreenCanvas(t.width,t.height);(e=m.getContext("2d"))==null||e.putImageData(t,0,0);let y=new OffscreenCanvas(h,l).getContext("2d");y.beginPath();for(let E=0;E<s.length;E++){const T=s[E],w=(T.x-r/t.width)*(t.width/h)*h,b=(T.y-c/t.height)*(t.height/l)*l;E===0?y.moveTo(w,b):y.lineTo(w,b)}return y.closePath(),y.clip(),y.drawImage(m,r,c,h,l,0,0,h,l),y.getImageData(0,0,h,l)}self.onmessage=n=>{const{inputData:e,hash:t}=n.data,s=Ai(e);self.postMessage({result:s,hash:t},[s.data.buffer])};class qa{constructor(e,t,s){d(this,"type"),d(this,"boundingBox"),d(this,"imageData"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/CDhEsE-f-CpFHRKS_.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Ai,"PolygonROIExtractorWorker",1e3,48)),this.type=t,this.boundingBox=Mi(e,s),this.imageData=e.getImageData().then(r=>{if(!(!r||!this.boundingBox))return this.workerPool.callWorker({videoFrame:r,normalizedPoints:s})})}}class Ga{constructor(e,t){d(this,"canvas"),d(this,"config"),d(this,"faceDetectionSamplingInterval"),d(this,"debug",!1),d(this,"sampledFaceDetection"),d(this,"firstFaceDetection"),this.canvas=document.createElement("canvas"),this.config=t,this.faceDetectionSamplingInterval=e,console.log("[VitalSignCamera] DefaultFaceROIExtractor initialized")}reset(){this.sampledFaceDetection=void 0,this.firstFaceDetection=void 0}processFrame(e,t,s){s==="idle"&&(this.sampledFaceDetection=void 0,this.firstFaceDetection=void 0);const r=new Date().getTime();return(!this.sampledFaceDetection||!this.faceDetectionSamplingInterval||r-this.sampledFaceDetection.timestamp>this.faceDetectionSamplingInterval)&&(this.sampledFaceDetection={timestamp:new Date().getTime(),...t}),this.firstFaceDetection===void 0&&(this.firstFaceDetection=t),{images:(this.config.enabledROIs??["face","chest"]).reduce((c,h)=>{var l,m,y,E,T,w;if(h==="face")c.face=new Ha(e,(l=this.firstFaceDetection)==null?void 0:l.faceBox,(m=this.sampledFaceDetection)==null?void 0:m.faceBox,this.config.pixelDataType,this.config.serverId);else if(h==="chest")c.chest=new Na(e,(y=this.firstFaceDetection)==null?void 0:y.faceBox,(E=this.sampledFaceDetection)==null?void 0:E.faceBox);else{if(!((T=this.sampledFaceDetection)!=null&&T.landmarks)||this.sampledFaceDetection.landmarks.length===0)return c;const b=ja(h,(w=this.sampledFaceDetection)==null?void 0:w.landmarks),p=new qa(e,h,b);c[h]=p}return this.debug&&c[h]&&this.debugRoi(c[h]),c},{})}}cropFrame(e,t){const s=this.canvas;return s.width=t.width,s.height=t.height,s.getContext("2d").drawImage(e,t.x,t.y,t.width,t.height,0,0,s.width,s.height),s.getContext("2d").canvas}async debugRoi(e){var t;const s=await e.imageData;if(s===void 0){console.log("[VitalSignCamera] debugRoi: imageData is undefined");return}const r=document.createElement("canvas");r.width=s.width,r.height=s.height,(t=r.getContext("2d"))==null||t.putImageData(s,0,0);const c=r.toDataURL(),h=`debug-${e.type}`,l=document.getElementById(h);if(l)l.setAttribute("src",c);else{const m=document.createElement("img");m.id=h,m.setAttribute("src",c),document.body.appendChild(m)}}}function gi(n,e){var t;return console.log(`[VitalSignCamera] createFaceROIExtractor for ${(t=e.enabledROIs)==null?void 0:t.join(", ")} ROIs`),new Ga(n,e)}const Pi=te.isMobile&&!te.isTablet,Ya=Pi?De.sd480x360:te.isTablet?De.hd1280x720:De.hd1920x1080,mi={engineConfig:{serverId:ie.Schema2Prod,dataCollectionDuration:25,dataSendingDuration:5,enabledROIs:["face","chest"],pixelDataType:"rgb1x1",chestPixelDataType:"ggg1x1",landmarksSampleRate:10},conditionCheckerConfig:{minimumFrameRate:Pi||te.isAndroid?10:15},presetFormat:Ya,maxFaceDetectionFps:5},Ka={engineConfig:{serverId:ie.Schema2Prod,dataCollectionDuration:18,dataSendingDuration:10,enabledROIs:["face","chest","leftCheek","rightCheek","chin","glabella"],pixelDataType:"rgb8x8",chestPixelDataType:"meanRgb1x1",landmarksSampleRate:10},conditionCheckerConfig:{minimumFrameRate:25},presetFormat:te.isMobile?De.hd1280x720:De.hd1920x1080,maxFaceDetectionFps:15};function Ii(n){switch(n){case Re.relaxed:return mi;case Re.strict:return Ka;default:return mi}}class Qa{constructor(e){d(this,"lastFramerateOKTime",new Date),d(this,"requiredStableDuration",1e4),d(this,"waitingResponse",!1),this.camera=e}reset(){this.lastFramerateOKTime=new Date}process(e,t){var s;if(this.camera.precisionMode===void 0)return;const r=(s=Ii(this.camera.precisionMode).conditionCheckerConfig)==null?void 0:s.minimumFrameRate;if(!(r===void 0||(e>=r&&(this.lastFramerateOKTime=new Date),!this.lastFramerateOKTime)||this.waitingResponse)&&new Date().getTime()-this.lastFramerateOKTime.getTime()>=this.requiredStableDuration&&this.camera.precisionMode!==Re.relaxed&&t==="idle")if(this.camera.onPrecisionModeWillUpdate){this.waitingResponse=!0,this.camera.onPrecisionModeWillUpdate({currentMode:this.camera.precisionMode,newMode:Re.relaxed,reason:"lowFrameRate",response:c=>{this.waitingResponse=!1,c==="proceed"?this.updatePrecisionModeToRelaxed("response"):c==="wait"?this.reset():this.waitingResponse=!1}});return}else console.log("No onPrecisionModeWillUpdate handler, proceeding to update precision mode."),this.updatePrecisionModeToRelaxed()}updatePrecisionModeToRelaxed(e="lowFrameRate"){this.camera.precisionMode=Re.relaxed,this.camera.onPrecisionModeUpdated&&this.camera.onPrecisionModeUpdated({previousMode:Re.strict,currentMode:Re.relaxed,reason:e}),console.log(`[VitalSignCamera] Precision mode switched to relaxed after stable frame rate for ${this.requiredStableDuration} ms`)}}class Xa{constructor(){d(this,"config"),d(this,"currentStage"),d(this,"currentStageStartTime"),d(this,"grabbedFrames",[]),this.config={grabbingPoints:void 0}}configure(e){this.config=e}reset(){this.currentStage=void 0,this.currentStageStartTime=void 0,this.grabbedFrames=[]}processFrame(e,t,s){if(!this.config.grabbingPoints||this.config.grabbingPoints.length===0||(this.currentStage!==t&&(this.currentStage=t,this.currentStageStartTime=Date.now()),!this.currentStageStartTime))return;const r=Date.now()-this.currentStageStartTime,c=this.config.grabbingPoints||[];for(const h of c)h.stage===t&&(this.grabbedFrames.some(l=>l.stage===h.stage&&l.offset===h.offset)||r<h.offset||(console.log(`[Frame Grabber] Grabbing frame at stage ${z[h.stage]} with offset ${h.offset} ms`),this.grabbedFrames.push({canvas:e.getCanvas(),stage:h.stage,offset:h.offset})))}}function Ja(){return new Xa}const Xe=te.isMobile&&!te.isTablet;class Za{constructor(e){d(this,"id",`${Math.floor(Math.random()*1e4)}`),d(this,"deviceCaps",oa),d(this,"version",Et),d(this,"_isActive"),d(this,"_userInfo"),d(this,"_config"),d(this,"faceDetectorType"),d(this,"_presetFormat"),d(this,"checkBrightness",!0),d(this,"_device"),d(this,"preferredCamera"),d(this,"maxFps"),d(this,"maxFaceDetectionFps"),d(this,"_precisionMode"),d(this,"disableAgeEstimation"),d(this,"enableBeautyAnalysis"),d(this,"_visualizationOptions"),d(this,"customConditionRange"),d(this,"faceDetectionRegion"),d(this,"faceDetectionModelLocation"),d(this,"_realtimeEstimationConfig"),d(this,"vsStatus","idle"),d(this,"_faceDetectionResult"),d(this,"faceDetectionTimer"),d(this,"faceDetectionFunction"),d(this,"camera",null),d(this,"cameraStartTime"),d(this,"videoFrameInfo",null),d(this,"videoFrame"),d(this,"healthResult"),d(this,"video",null),d(this,"transform","none"),d(this,"_videoSettings"),d(this,"cameraFps",new ri("camera")),d(this,"faceDetectionFps",new ri("face detection")),d(this,"activateAfterBound",!1),d(this,"boundingBox"),d(this,"faceMesh"),d(this,"faceDetectionSamplingInterval"),d(this,"vitalSignEngine"),d(this,"faceDetector"),d(this,"roiExtractor"),d(this,"ageEstimator"),d(this,"beautyAnalyzer"),d(this,"realtimeEstimator"),d(this,"conditionChecker"),d(this,"frameGrabber"),d(this,"precisionModeChecker",new Qa(this)),d(this,"cameraDevices"),d(this,"onVideoFrameProcessed"),d(this,"onTransformUpdated"),d(this,"onVideoSettingsUpdated"),d(this,"onCameraDevicesUpdated"),d(this,"onInitialized"),d(this,"onPrecisionModeUpdated"),d(this,"onPrecisionModeWillUpdate"),d(this,"onError");var t;window.__vital_sign_camera_impl__=this,console.log(`[VitalSignCamera] Welcome to VitalSignCamera ${Et}`),console.log("[VitalSignCamera] Initializing with props...",e);let s=new Date;this._isActive=!1,this.activateAfterBound=e.isActive,this._config=e.config||{},this._device=e.device,this.preferredCamera=e.preferredCamera,this._userInfo=e.userInfo,this._visualizationOptions=e.visualizationOptions,this.faceDetectionRegion=e.faceDetectionRegion,this.faceDetectionSamplingInterval=e.faceDetectionSamplingInterval,this._realtimeEstimationConfig=e.realtimeEstimationConfig,te.isMobile?Xe?this._presetFormat=De.sd480x360:this._presetFormat=De.hd1280x720:this._presetFormat=De.hd1920x1080,e.customConditionRange!==void 0&&(this.customConditionRange=e.customConditionRange),e.checkBrightness!==void 0?this.checkBrightness=e.checkBrightness:(te.isAndroid&&(console.log("[VitalSignCamera] Android detected. Turn off brightness check."),this.checkBrightness=!1),e.faceDetectorType===se.Dummy&&(console.log("[VitalSignCamera] Dummy face detector being used. Turn off brightness check."),this.checkBrightness=!1)),e.faceDetectorType!==void 0?(console.log(`[VitalSignCamera] Setting face detector type ${e.faceDetectorType}...`),this.faceDetectorType=e.faceDetectorType):(console.log("[VitalSignCamera] Auto setting face detector type..."),te.isAndroid?(console.log("[VitalSignCamera] Android detected"),console.log("[VitalSignCamera] Setting new MediaPipe face detector"),this.faceDetectorType=se.MPFaceMesh):te.isIOS&&He(te.browserVersion,"18.0")<0?(console.log("[VitalSignCamera] Setting new MediaPipe facemesh detector"),this.faceDetectorType=se.MPFaceMesh):(console.log("[VitalSignCamera] Setting new MediaPipe facemesh threaded detector"),this.faceDetectorType=se.MPFaceMeshThreaded)),e.presetFormat!==void 0&&(this._presetFormat=e.presetFormat),e.maxFps!==void 0?(console.log(`[VitalSignCamera] Setting max camera fps to ${e.maxFps}`),this.maxFps=e.maxFps):(this.maxFps=Xe?30:60,console.log(`[VitalSignCamera] Auto setting max camera fps to ${this.maxFps}`)),e.maxFaceDetectionFps!==void 0?(console.log(`[VitalSignCamera] Setting max face detection fps to ${e.maxFaceDetectionFps}`),this.maxFaceDetectionFps=e.maxFaceDetectionFps):Xe||te.isAndroid?(this.maxFaceDetectionFps=2,console.log(`[VitalSignCamera] Mobile phone or Android detected, auto setting max face detection fps to ${this.maxFaceDetectionFps}`)):(this.maxFaceDetectionFps=5,console.log(`[VitalSignCamera] Auto setting max face detection fps to ${this.maxFaceDetectionFps}`)),((t=e.config)==null?void 0:t.blinkDetectorType)===We.default&&(console.log("[VitalSignCamera] Blink detector enabled, forcing face detection fps to 15"),this.maxFaceDetectionFps=Math.max(15,this.maxFaceDetectionFps)),e.disableAgeEstimation!==void 0?(console.log(`[VitalSignCamera] Setting age estimation: ${!e.disableAgeEstimation}`),this.disableAgeEstimation=e.disableAgeEstimation):(console.log("[VitalSignCamera] Auto setting age estimation..."),Xe?(console.log("[VitalSignCamera] is phone -> ageEstimation = false"),this.disableAgeEstimation=!0):(console.log("[VitalSignCamera] Not phone -> ageEstimation = true"),this.disableAgeEstimation=!1)),e.enableBeautyAnalysis!==void 0?(console.log(`[VitalSignCamera] Setting beauty analysis: ${e.enableBeautyAnalysis}`),this.enableBeautyAnalysis=e.enableBeautyAnalysis,this.enableBeautyAnalysis&&this.disableAgeEstimation&&(console.log("[VitalSignCamera] Beauty analysis ON -> Forcing ageEstimation = true"),this.disableAgeEstimation=!1)):this.enableBeautyAnalysis=!1,e.frameGrabberConfig!==void 0&&(this.frameGrabber=Ja(),this.frameGrabber.configure(e.frameGrabberConfig));const r=this.disableAgeEstimation,c=this.enableBeautyAnalysis;this.onVideoFrameProcessed=e.onVideoFrameProcessed,this.onVideoSettingsUpdated=e.onVideoSettingsUpdated,this.onCameraDevicesUpdated=e.onCameraDevicesUpdated,this.onInitialized=e.onInitialized,this.onPrecisionModeUpdated=e.onPrecisionModeUpdated,this.onPrecisionModeWillUpdate=e.onPrecisionModeWillUpdate,this.onError=e.onError,this.vitalSignEngine=ia(),this.roiExtractor=gi(this.faceDetectionSamplingInterval,this.config),this.sdkCredentials=e.sdkCredentials,this.conditionChecker=Ea(this.vitalSignEngine,e.conditionCheckerConfig,this.customConditionRange),e.precisionMode!==void 0&&(this.precisionMode=e.precisionMode),this.cameraDevices=new Ra(this,h=>{this.onCameraDevicesUpdated&&this.onCameraDevicesUpdated({devices:h,selected:this.device})}),this.cameraDevices.start(),(async()=>{var h;try{r||(this.ageEstimator=await Ma(e.faceApiModelPath),this.ageEstimator.configure(e.ageEstimationConfig)),c&&(this.beautyAnalyzer=await $a({apiKey:(h=e.config)==null?void 0:h.apiKey})),this._realtimeEstimationConfig&&(this.realtimeEstimator=await Pa(this._realtimeEstimationConfig)),this.faceDetector=await this.createFaceDetector(e.faceDetectionModelLocation),this.onInitialized&&this.onInitialized();const l=(new Date().getTime()-s.getTime())/1e3;console.log(`[VitalSignCamera] initialized. Loading time ${l}s.`)}catch(l){console.error(l),console.log("[VitalSignCamera] initialization failed."),this.onError&&this.onError(l),this.camera&&this.cameraStartTime&&this.stopCamera()}})()}async createFaceDetector(e){try{console.log("[VitalSignCamera] Model loading location: ",e);let t=await li(this.faceDetectorType);return await t.loadModels(e),t}catch(t){if(this.faceDetectorType==se.MPFaceMeshThreaded)return console.warn("[VitalSignCamera] Failed to initialize MediaPipe FaceMesh threaded detector. Falling back to non-threaded version."),this.faceDetectorType=se.MPFaceMesh,await this.createFaceDetector(e);throw t}}bind(e){this.video=e,this.video.setAttribute("autoplay","true"),this.video.setAttribute("playsinline",""),this.config&&(this.vitalSignEngine.configure(this.config),this.vitalSignEngine.isReady()),this.faceDetectorType===se.TFMediaPipe&&this.vitalSignEngine.configure({blinkDetectorType:We.default}),this.isActive=this.activateAfterBound}set device(e){const t=this.isActive;this._device&&this._device.length>0&&this._device!==e&&this.stopCamera(),this._device=e,e?t&&this.startCamera():this.stopCamera()}get device(){return this._device}set isActive(e){e?this.startCamera():this.stopCamera()}get isActive(){return this._isActive}set presetFormat(e){if(this._presetFormat===e)return;const t=this.isActive;this.stopCamera(),this._presetFormat=e,t&&this.startCamera()}get presetFormat(){return this._presetFormat}set config(e){this._config={...this._config},Object.keys(e).forEach(t=>{const s=t;e[s]!==void 0&&(this._config[s]=e[s])}),this.config&&(this.vitalSignEngine.configure(this.config),this.roiExtractor=gi(this.faceDetectionSamplingInterval,this.config))}get config(){let e={...this._config};const t=new URLSearchParams(location.search).get("PANOPTIC_API_KEY");return t&&(e.apiKey=t),e}set userInfo(e){this._userInfo={...this._userInfo},Object.keys(e).forEach(t=>{const s=t;e[s]!==void 0&&(this._userInfo[s]=e[s])})}get userInfo(){let e={...this._userInfo};const t=new URLSearchParams(location.search).get("PANOPTIC_USER_ID");return t&&(e.userId=t),e}get sdkCredentials(){if(!(!this.config.apiKey&&!this.userInfo.userId))return{apiKey:this.config.apiKey,userId:this.userInfo.userId}}set sdkCredentials(e){e!=null&&e.apiKey&&(this.config={apiKey:e?.apiKey}),e!=null&&e.userId&&(this.userInfo={userId:e?.userId})}get precisionMode(){return this._precisionMode}set precisionMode(e){if(!e)return;this._precisionMode!==e&&(this.onPrecisionModeUpdated&&this.onPrecisionModeUpdated({previousMode:this._precisionMode,currentMode:e,reason:"manual"}),this.precisionModeChecker.reset()),this._precisionMode=e;const t=Ii(e);this.config=t.engineConfig,this.vitalSignEngine.configure(this.config),t.conditionCheckerConfig&&this.conditionChecker.configure(t.conditionCheckerConfig),t.presetFormat&&(this.presetFormat=t.presetFormat),t.maxFaceDetectionFps!==void 0&&(this.maxFaceDetectionFps=t.maxFaceDetectionFps,this.faceDetectionFunction&&this.startFaceDetection())}set faceDetectionResult(e){var t,s,r,c;this._faceDetectionResult=e,(t=this.faceDetectionResult)!=null&&t.videoFrame.width&&(s=this.faceDetectionResult)!=null&&s.videoFrame.height&&(this.videoFrameInfo={timestamp:performance.now(),width:(r=this.faceDetectionResult)==null?void 0:r.videoFrame.width,height:(c=this.faceDetectionResult)==null?void 0:c.videoFrame.height})}get faceDetectionResult(){return this._faceDetectionResult}get videoSettings(){return this._videoSettings}set videoSettings(e){if(this._videoSettings=e,e&&this.video){if(!this.onVideoSettingsUpdated)return;this.onVideoSettingsUpdated({video:this.video,settings:e})}}get visualizationOptions(){return this._visualizationOptions}set visualizationOptions(e){var t,s;if(this._visualizationOptions=e,!this.isActive)return;const r=e?.boundingBox&&e.boundingBox.enabled!==!1;r&&!this.boundingBox&&this.video&&(this.boundingBox=new di(this.video,(t=this._visualizationOptions)==null?void 0:t.boundingBox)),!r&&this.boundingBox&&(this.boundingBox.enabled=!1,this.boundingBox=void 0),this.boundingBox&&e!=null&&e.boundingBox&&this.boundingBox.updateOptions(e?.boundingBox);const c=e?.faceMesh&&e.faceMesh.enabled!==!1;c&&!this.faceMesh&&this.video&&(this.faceMesh=new ui(this.video,(s=this._visualizationOptions)==null?void 0:s.faceMesh)),!c&&this.faceMesh&&(this.faceMesh.destroy(),this.faceMesh=void 0),this.faceMesh&&e!=null&&e.faceMesh&&this.faceMesh.updateOptions(e?.faceMesh)}get faceMeshElement(){var e;return(e=this.faceMesh)==null?void 0:e.faceMesh}get boundingBoxElement(){var e;return(e=this.boundingBox)==null?void 0:e.boundingBox}get grabbedFrames(){var e;return(e=this.frameGrabber)==null?void 0:e.grabbedFrames}get realtimeEstimationConfig(){return this._realtimeEstimationConfig}set realtimeEstimationConfig(e){this._realtimeEstimationConfig=e,this.realtimeEstimator&&this.realtimeEstimator.configure(e)}get faceDetectionRegionAbs(){if(!this.faceDetectionRegion||!this.videoSettings)return;const{x:e,y:t,width:s,height:r}=this.faceDetectionRegion,c=this.videoSettings.width,h=this.videoSettings.height;return{x:typeof e=="string"?parseFloat(e)/100*c:e,y:typeof t=="string"?parseFloat(t)/100*h:t,width:typeof s=="string"?parseFloat(s)/100*c:s,height:typeof r=="string"?parseFloat(r)/100*h:r}}get processedFrame(){var e,t,s,r,c,h,l,m,y;if(this.videoFrameInfo===null||!this.videoFrame)return;const E=this.healthResult;return E!=null&&E.health&&(E.health.beautyAnalysis=(e=this.beautyAnalyzer)==null?void 0:e.result,E.health.vitalSigns={...E.health.vitalSigns,facialSkinAge:((s=(t=this.beautyAnalyzer)==null?void 0:t.result)==null?void 0:s.skinAge)||((c=(r=this.ageEstimator)==null?void 0:r.estimation)==null?void 0:c.age)}),{videoFrameInfo:this.videoFrameInfo,videoFrame:this.videoFrame,facebox:(h=this.faceDetectionResult)==null?void 0:h.faceBox,healthResult:E,scanConditions:this.conditionChecker.conditions,landmarks:(l=this.faceDetectionResult)==null?void 0:l.landmarks,realtimeEstimation:((m=this.realtimeEstimator)==null?void 0:m.estimation)||null,signalData:((y=this.realtimeEstimator)==null?void 0:y.signalData)||null}}updateVideoSettings(e){if(!e||!e.srcObject)return this.videoSettings=void 0,"not-ready";const t=e.srcObject.id,s=e.srcObject.getVideoTracks()[0].getSettings(),{width:r,height:c,frameRate:h}=s;return r===void 0||c===void 0?"undefined":(console.log(`[VitalSignCamera] Video Settings in ${te.browserName}: ${r}x${c} @ ${h} fps`),this.transform=pa(e),e.style.transform=this.transform,this.onTransformUpdated&&this.onTransformUpdated(this.transform),this.videoSettings={videoId:t,width:e.videoWidth||r,height:e.videoHeight||c,transformX:this.transform},"ok")}startCamera(){var e,t;this._isActive||(this._isActive=!0,this.processVideoFrame(),(e=this.visualizationOptions)!=null&&e.boundingBox&&this.visualizationOptions.boundingBox.enabled!==!1&&!this.boundingBox&&this.video&&(this.boundingBox=new di(this.video,this.visualizationOptions.boundingBox)),(t=this.visualizationOptions)!=null&&t.faceMesh&&this.visualizationOptions.faceMesh.enabled!==!1&&!this.faceMesh&&this.video&&(this.faceMesh=new ui(this.video,this.visualizationOptions.faceMesh)))}async stopCamera(){var e,t;this._isActive&&(this._isActive=!1,this.vitalSignEngine.stop(),(e=this.boundingBox)==null||e.update(void 0),(t=this.faceMesh)==null||t.update(void 0),this.faceDetectionResult=void 0,this.videoFrame=void 0,this.boundingBox&&(this.boundingBox.enabled=!1,this.boundingBox=void 0),this.faceMesh&&(this.faceMesh.destroy(),this.faceMesh=void 0),this.video&&this.stopVideo(),this.conditionChecker.reset(),this.camera&&(await this.camera.stop(),this.cameraStartTime=void 0))}async waitCameraToStop(e){return this.camera?await this.camera.waitUntilStopped(e):!0}async stopVideo(){const e=this.video;e.srcObject&&e.srcObject.getVideoTracks().forEach(t=>t.stop()),this.vitalSignEngine.stop(),clearInterval(this.faceDetectionTimer),this.faceDetectionTimer=void 0,this.faceDetectionFunction=void 0,console.log("[VitalSignCamera] stop Camera")}startScanning(){var e,t;console.log("[VitalSignCamera] start scanning..."),this.vsStatus="measuring",(e=this.frameGrabber)==null||e.reset(),(t=this.realtimeEstimator)==null||t.reset(),this.vitalSignEngine.start()}stopScanning(){console.log("[VitalSignCamera] stop scanning..."),this.vitalSignEngine.stop()}convertFaceBox(e){if(e===void 0)return;if(!this.videoSettings||!this.faceDetectionRegionAbs)return e;const t=(e.xCenter*this.faceDetectionRegionAbs.width+this.faceDetectionRegionAbs.x)/this.videoSettings.width,s=(e.yCenter*this.faceDetectionRegionAbs.height+this.faceDetectionRegionAbs.y)/this.videoSettings.height,r=e.width*this.faceDetectionRegionAbs.width/this.videoSettings.width,c=e.height*this.faceDetectionRegionAbs.height/this.videoSettings.height;return{xCenter:t,yCenter:s,width:r,height:c}}convertLandmarks(e){if(e===void 0)return;if(this.videoSettings===void 0||!this.faceDetectionRegionAbs)return e;const t=this.videoSettings,s=this.faceDetectionRegionAbs;return e.map(r=>{const c=(r.x*s.width+s.x)/t.width,h=(r.y*s.height+s.y)/t.height,l=r.z;return{x:c,y:h,z:l}})}startFaceDetection(){this.faceDetectionFunction!==void 0&&(this.faceDetectionTimer&&(clearInterval(this.faceDetectionTimer),this.faceDetectionTimer=void 0),this.faceDetectionTimer=setInterval(this.faceDetectionFunction,1e3/this.maxFaceDetectionFps))}async processVideoFrame(){const e=this.video,{width:t,height:s}=sa(this.presetFormat||De.hd1920x1080);this.precisionModeChecker.reset();const r=new ca(e,{width:t,height:s,deviceId:this.device,preferredCamera:this.preferredCamera,callbackFrameRate:this.maxFps,handleIOS17Bug:te.isIOS&&He(te.browserVersion,"17")>=0,handleIOS17ObjectFitBug:te.isIOS&&He(te.browserVersion,"17.2")>=0,onFrame:y=>{var E,T,w,b,p,u,g,k,D,x,R,A,P,M,F,Y;if(r.croppingRegion=this.faceDetectionRegionAbs,this.cameraStartTime===void 0)return;const $=new Date().getTime()-this.cameraStartTime.getTime();if((((E=this.videoSettings)==null?void 0:E.width)!=e.videoWidth||((T=this.videoSettings)==null?void 0:T.height)!=e.videoHeight)&&this.updateVideoSettings(e)!=="ok"&&$>5e3){console.error("[VitalSignCamera] Could not get camera settings."),r.stop(),this.onError&&this.onError(new Error("undefined camera dimension"));return}if(this.cameraFps.tick(),this.faceDetectionResult==null)return;this.conditionChecker.processFrame(this.faceDetectionResult.videoFrame,(w=this.faceDetectionResult)==null?void 0:w.faceBox,this.vsStatus==="idle"?this.checkBrightness:!1,this.cameraFps.average,this.vsStatus),this.precisionModeChecker.process(this.cameraFps.average,this.vsStatus);const{images:j}=this.roiExtractor.processFrame(y,this.faceDetectionResult,this.vsStatus);this.videoFrame=y;const K=this.faceDetectionResult.faceBox,Z={faceBox:K,landmarks:this.faceDetectionResult.landmarks,videoFrameInfo:y,images:j,userInfo:this.userInfo},W=this.vitalSignEngine.getHealth(Z);if(this.healthResult=W,this.vsStatus==="measuring"&&(W.stage===z.Idle&&(this.vsStatus="idle",this.vitalSignEngine.stop(),W.error&&this.onError&&this.onError(W.error)),(p=(b=W.health)==null?void 0:b.vitalSigns)!=null&&p.heartRate&&((k=this.realtimeEstimator)==null||k.updateWithServerResult(W.health.vitalSigns.heartRate,(u=W.health.scanParameters)==null?void 0:u.snr,(g=W.health.scanParameters)==null?void 0:g.signalQuality)),(D=this.ageEstimator)==null||D.processFrame(y,W.stage,W.remainingTime),(x=this.realtimeEstimator)==null||x.processFrame(y,W.stage,W.remainingTime,j),(P=this.beautyAnalyzer)==null||P.processFrame(y,K,(A=(R=this.ageEstimator)==null?void 0:R.estimation)==null?void 0:A.age,W.stage,W.remainingTime),(M=this.frameGrabber)==null||M.processFrame(y,W.stage,W.remainingTime)),this.boundingBox){const X=this.convertFaceBox((F=this.faceDetectionResult)==null?void 0:F.faceBox);this.boundingBox.update(X)}if(this.faceMesh){const X=this.convertLandmarks((Y=this.faceDetectionResult)==null?void 0:Y.landmarks);this.faceMesh.update(X)}this.processedFrame&&this.onVideoFrameProcessed&&this.onVideoFrameProcessed(this.processedFrame)}});try{r.croppingRegion=this.faceDetectionRegionAbs,await r.start(),this.updateVideoSettings(e),this._device=r.deviceId,this.cameraStartTime=new Date}catch(y){console.error("[VitalSignCamera] Could not start camera: ",y),this.onError&&this.onError(y);return}let c=!1;const h=3;let l=0;const m=document.createElement("canvas");this.faceDetectionFunction=async()=>{if(this.faceDetector===void 0||!this.faceDetectionTimer||this.cameraFps.frameCount==0||c||!e.srcObject||this.videoSettings===void 0)return;const y=this.videoSettings;c=!0;const E=this.faceDetectionRegionAbs||{x:0,y:0,width:y.width,height:y.height},T=E.width/E.height;if(m.width=T>1?320:320*T,m.height=m.width/T,this.faceDetectorType!==se.Dummy){let w=m.getContext("2d",{willReadFrequently:!0});w?.drawImage(e,E.x,E.y,E.width,E.height,0,0,m.width,m.height)}try{this.faceDetector.detect({image:m}).then(w=>{this.faceDetectionFps.tick(),this.faceDetectionResult={...w,faceDetectionRegion:E}})}catch(w){l++,console.error(`Face detector crashed: ${w}`),console.log(`Face detector crash count: ${l}`),l>h&&(console.log(`Face detector crashed ${l} times, falling back to dummy detector.`),this.faceDetectorType=se.Dummy,this.faceDetector=await li(this.faceDetectorType))}c=!1},this.startFaceDetection(),this.camera=r}}function er(n){return new Za(n)}var Ie=(n=>(n.OK="ok",n.TooFar="tooFar",n.TooClose="tooClose",n))(Ie||{}),ve=(n=>(n.Centered="centered",n.TooHigh="tooHigh",n.TooLow="tooLow",n.TooLeft="tooLeft",n.TooRight="tooRight",n.Unknown="unknown",n))(ve||{}),Re=(n=>(n.relaxed="relaxed",n.strict="strict",n))(Re||{});function tr(n){return typeof n=="boolean"?n?"Yes":"No":typeof n=="string"?n:typeof n=="number"?n.toFixed(1):n===void 0?"undefined":n===null?"null":"unknown type"}function ir(n){switch(n){case Je.Poor:return"Poor";case Je.Good:return"Good";case Je.Excellent:return"Excellent";case void 0:return"undefined";case null:return"null";default:return"Unknown"}}function I(n,e){return e===null?`<!-- ${n} is null -->`:e===void 0?`<!-- ${n} is undefined -->`:`<!-- ${n}: ${typeof e} --><li>${n}: ${tr(e)}</li>`}function nr(n,e){const t=e.healthResult?.health;if(t)if(t){const s=t.scanParameters?.conditions?.[0]!==void 0?t.scanParameters?.conditions?.[0]:t.scanParameters?.signalConditions?.hrSteadiness,r=t.scanParameters?.conditions?.[1]!==void 0?t.scanParameters?.conditions?.[1]:t.scanParameters?.signalConditions?.goodSnr,c=t.scanParameters?.conditions?.[2]!==void 0?t.scanParameters?.conditions?.[2]:t.scanParameters?.signalConditions?.noSpeedJitter,h=t.scanParameters?.conditions?.[3]!==void 0?t.scanParameters?.conditions?.[3]:t.scanParameters?.signalConditions?.goodAverageSpeed,l=t.scanParameters?.conditions?.[4]!==void 0?t.scanParameters?.conditions?.[4]:t.scanParameters?.signalConditions?.signalSteadiness;n.innerHTML=`
    <hr/>
    <fieldset>
      <legend>Vital Signs</legend>
      <ul>
      ${I("Heart Rate",t.vitalSigns?.heartRate)}
      ${I("SPO2",t.vitalSigns?.spo2)}
      ${I("Respiratory Rate",t.vitalSigns?.respiratoryRate)}
      ${I("HRV SDNN",t.vitalSigns?.hrvSdnn)}
      ${I("HRV RMSSD",t.vitalSigns?.hrvRmssd)}
      ${I("Temperature",t.vitalSigns?.temperature)}
      ${I("Blood Pressure",t.vitalSigns?.bloodPressure)}
      ${I("Blood Pressure Systolic",t.vitalSigns?.bloodPressureSystolic)}
      ${I("Blood Pressure Diastolic",t.vitalSigns?.bloodPressureDiastolic)}
      ${I("Blood Alcohol",t.vitalSigns?.bloodAlcohol)}
      ${I("Blood Sugar",t.vitalSigns?.bloodSugar)}
      ${I("Facial Skin Age",t.vitalSigns?.facialSkinAge)}
      </ul>
    </fieldset>
    <fieldset>
      <legend>Cardiovascular Risk</legend>
      <ul>
      ${I("General Risk",t.risks?.cardiovascularRisks?.generalRisk)}
      ${I("Coronary Heart Disease",t.risks?.cardiovascularRisks?.coronaryHeartDisease)}
      ${I("Congestive Heart Failure",t.risks?.cardiovascularRisks?.congestiveHeartFailure)}
      ${I("Intermittent Claudication",t.risks?.cardiovascularRisks?.intermittentClaudication)}
      ${I("Stroke",t.risks?.cardiovascularRisks?.stroke)}
      </ul>
    </fieldset>
    <fieldset>
      <legend>Holistic Health</legend>
      <ul>
      ${I("General Wellness",t.holisticHealth?.generalWellness)}
      ${I("BMI",t.holisticHealth?.bmi)}
      ${I("ABSI",t.holisticHealth?.absi)}
      ${I("ABSIZ",t.holisticHealth?.absiz)}
      ${I("Cardiac Workload",t.holisticHealth?.cardiacWorkload)}
      ${I("Pulse Respiratory Quotient",t.holisticHealth?.pulseRespiratoryQuotient)}
      ${I("Waist To Height Ratio",t.holisticHealth?.waistToHeightRatio)}
      ${I("Cardiovascular System Wellness",t.holisticHealth?.cardiovascularSystemWellness)}
      ${I("Mental Wellness",t.holisticHealth?.mentalWellness)}
      ${I("Physical Wellness",t.holisticHealth?.physicalWellness)}
      ${I("Respiratory System Wellness",t.holisticHealth?.respiratorySystemWellness)}
      </ul>
    </fieldset>

    <fieldset>
      <legend>Health Risks</legend>
      <ul>
      ${I("Covid Risk",t.risks?.covidRisk?.covidRisk)}
      ${I("Diabetes Risk",t.risks?.diabetesRisk)}
      ${I("Hypertension Risk",t.risks?.hypertensionRisk)}
      </ul>
    </fieldset>

    <fieldset>
      <legend>Scan Parameters</legend>
      <ul>
      ${I("Signal Quality",t.scanParameters?.signalQuality)}
      ${I("Warning",t.scanParameters?.warning)}
      ${I("HR Steadiness",s)}
      ${I("Good SNR",r)}
      ${I("No Speed Jitter",c)}
      ${I("Good Average Speed",h)}
      ${I("Signal Steadiness",l)}
      ${I("Fixed Head Position",t.scanParameters?.signalConditions?.fixedHeadPosition)}
      ${I("No Head turning",t.scanParameters?.signalConditions?.noHeadTurning)}
      ${I("Adequate Brightness",t.scanParameters?.signalConditions?.adequateBrightness)}
      ${I("Even Lighting On Face",t.scanParameters?.signalConditions?.evenLightingOnFace)}
      ${I("Good Signal Percentage",ir(t.scanParameters?.signalConditions?.goodSignalPercentage))}
      ${I("HR Signal Quality",t.scanParameters?.signalConditions?.hrSignalQuality)}
      ${I("RR Signal Quality",t.scanParameters?.signalConditions?.rrSignalQuality)}
      ${I("BP Signal Quality",t.scanParameters?.signalConditions?.bpSignalQuality)}
      ${I("Invalid Pixel Percentage",t.scanParameters?.invalidPixelPercentage)}
      ${I("Signal Duration",t.scanParameters?.signalDuration)}
      ${I("SNR",t.scanParameters?.snr)}
      </ul>
    </fieldset>
    `}else Fi(n)}function Fi(n){n.innerHTML=""}function sr(n){return n===!1?"Improve lighting":null}function ar(n,e){if(n===!1)switch(e){case ve.TooLeft:return"Move right";case ve.TooRight:return"Move left";case ve.TooHigh:return"Move down";case ve.TooLow:return"Move up";case ve.Unknown:return"Center face";default:return"Center face"}return null}function rr(n){return n===!1?"Hold still":null}function or(n,e){if(n===!1)switch(e){case Ie.TooFar:return"Move closer";case Ie.TooClose:return"Move back";default:return"Adjust distance"}return null}function lr(n){return n===!1?"Low frame rate":null}function cr(n){return n===!1?"Server not ready":null}function hr(n){return!(n===void 0||!n.lighting||!n.centered||!n.movement||!n.distance||!n.frameRate||!n.serverReady)}function dr(n,e){const t=[],s=sr(e.scanConditions?.lighting);s&&t.push(s);const r=ar(e.scanConditions?.centered,e.scanConditions?.facePositionCondition);r&&t.push(r);const c=rr(e.scanConditions?.movement);c&&t.push(c);const h=or(e.scanConditions?.distance,e.scanConditions?.distanceCondition);h&&t.push(h);const l=lr(e.scanConditions?.frameRate);l&&t.push(l);const m=cr(e.scanConditions?.serverReady);if(m&&t.push(m),t.length===0)n.innerHTML='<div style="color: var(--success); text-align: center;"><i class="fas fa-check-circle"></i> Ready to Scan</div>';else{const y=t.join(" & ");n.innerHTML=`
      <ul style="list-style: none; padding: 0; margin: 0; width: 100%; display: flex; justify-content: center;">
        <li style="color: var(--warning); margin-bottom: 4px; display: flex; align-items: center; gap: 8px; text-align: center;">
            <i class="fas fa-exclamation-triangle"></i> ${y}
        </li>
      </ul>
    `}}var pt;function _i(n,e){pt=e,pt?(n.innerHTML=`${pt}`,n.style.display="inline-block"):(n.innerHTML="",n.style.display="none")}function ur(n){_i(n,void 0)}function fr(n,e,t){n.innerHTML=e.map(s=>{const r=t.device===s.id?"selected":"";return`<option value="${s.id}" ${r}>${s.label}</option>`}).join(`
`)}async function gr(n,e){const t=document.getElementById("cameraBtn"),s=document.getElementById("cameraDropdown");t?.addEventListener("click",r=>{r.stopPropagation();const c=s.style.display==="block";s.style.display=c?"none":"block"}),document.addEventListener("click",r=>{!t?.contains(r.target)&&!s?.contains(r.target)&&(s.style.display="none")}),e.onCameraDevicesUpdated=r=>{fr(n,r.devices,e),r.devices.length>1&&n.removeAttribute("disabled")},n.addEventListener("change",()=>{e.device=n.value,s.style.display="none"})}function mr(n,e){e.healthResult?.stage!==z.Idle?n.setAttribute("hidden",""):n.removeAttribute("hidden")}let Fe=!1,it=!1;function pr(n,e,t,s,r,c,h,l){n.addEventListener("click",()=>{if(Fe)e.stopScanning(),n.innerHTML='<i class="fas fa-play"></i> Start Scan',n.removeAttribute("disabled"),n.classList.remove("scanning"),document.body.classList.remove("scanning-active"),Fe=!1,it=!1,r("Scan cancelled");else{h(t),l(s),it=!1;const m=document.querySelector("#pulseValue"),y=document.querySelector("#qualityValue"),E=document.querySelector("#snrValue"),T=document.querySelector("#confidenceValue"),w=document.querySelector("#qualityScore");m.textContent="--",y.textContent="--",E.textContent="--",T.textContent="--",w.textContent="--",c(),n.innerHTML='<i class="fas fa-spinner fa-spin"></i> Scanning...',n.classList.add("scanning"),document.body.classList.add("scanning-active"),Fe=!0,e.startScanning()}})}function vr(n,e){if(!Fe)return;let t="";switch(e.healthResult?.stage){case z.CollectingData:t=`Scanning... ${(e.healthResult?.remainingTime||0).toFixed(0)}s`;break;case z.AnalyzingData:t=`Analyzing... ${(e.healthResult?.remainingTime||0).toFixed(0)}s`;break;default:return}t&&(n.innerHTML=`<i class="fas fa-spinner fa-spin"></i> ${t}`)}function wr(n,e){it||(it=!0,n.innerHTML='<i class="fas fa-play"></i> Start Scan',n.classList.remove("scanning"),document.body.classList.remove("scanning-active"),Fe=!1,e("Vital signs scan completed successfully!"))}function yr(n){const e="325168";let t="";const s=document.querySelector("#passwordScreen"),r=document.querySelectorAll(".num-btn"),c=document.querySelector("#resetBtn"),h=document.querySelector("#bellBtn");r.forEach(l=>{l.addEventListener("click",()=>{t+=l.getAttribute("data-num"),l.classList.add("pressed"),setTimeout(()=>l.classList.remove("pressed"),200)})}),c.addEventListener("click",()=>{t="",c.classList.add("pressed"),setTimeout(()=>c.classList.remove("pressed"),200)}),h.addEventListener("click",()=>{t===e?(s.style.display="none",n()):t="",h.classList.add("pressed"),setTimeout(()=>h.classList.remove("pressed"),200)}),document.addEventListener("keydown",l=>{if(s.style.display!=="none"){const m=l.key;let y=null;m>="0"&&m<="9"?(t+=m,y=document.querySelector(`.num-btn[data-num="${m}"]`),l.preventDefault()):m==="Backspace"?(t=t.slice(0,-1),y=document.querySelector("#resetBtn"),l.preventDefault()):m==="Enter"?(t===e?(s.style.display="none",n()):t="",y=document.querySelector("#bellBtn"),l.preventDefault()):m==="Escape"&&(t="",y=document.querySelector("#resetBtn"),l.preventDefault()),y&&(y.classList.add("pressed"),setTimeout(()=>y.classList.remove("pressed"),200))}})}window.onload=()=>{yr(()=>{const n=document.querySelector("#mainContainer");n.style.display="block";const e={apiKey:"3AQMwZWvDf566xPwuMfvd5FLjPEw3j6G3Q3SPpAC",userId:"07a51b41-e1a4-4570-94a7-04ef371cc4f3"},t={age:30,gender:pi.Male,weight:60,height:170},s=document.querySelector("#startScanBtn"),r=document.querySelector("#scanConditions"),c=document.querySelector("#report"),h=document.querySelector("video"),l=document.querySelector("#error"),m=document.querySelector("#cameraPicker"),y=document.querySelector("#pulseValue"),E=document.querySelector("#qualityValue"),T=document.querySelector("#snrValue"),w=document.querySelector("#confidenceValue"),b=document.querySelector("#heartbeatContainer"),p=document.querySelector("#heartbeatIcon"),u=document.querySelector("#signalVisualizerContainer"),g=document.querySelector("#settingsBtn"),k=er({precisionMode:Re.relaxed,isActive:!0,sdkCredentials:e,userInfo:t,visualizationOptions:{boundingBox:{enabled:!0}},realtimeEstimationConfig:{earlyEstimation:!0,minDuration:5,minConfidence:.3}});k.onError=M=>_i(l,M),k.bind(h),gr(m,k);let D=null,x="PPG";function R(M,F=!0){if(M&&M>0&&F){b.classList.add("active");const Y=60/M;p.style.animationDuration=`${Y}s`}else b.classList.remove("active")}function A(M=x){x=M,D&&(D.destroy(),D=null),D=new Aa(u,{width:300,height:100,maxPoints:200,lineColor:"#00ff00",backgroundColor:"transparent",visualizationType:M})}k.onVideoFrameProcessed=M=>{dr(r,M),mr(m,M),nr(c,M),vr(s,M);const F=document.querySelector(".history-section"),Y=document.querySelector(".scanner-actions");if(Fe?(Y.style.display="block",F.style.display="none"):hr(M.scanConditions)?(s.removeAttribute("disabled"),Y.style.display="block",F.style.display="none"):(s.setAttribute("disabled","true"),Y.style.display="none",F.style.display="block"),M.realtimeEstimation){const $=M.realtimeEstimation;if($.heartRate?(y.textContent=Math.round($.heartRate).toString(),R($.heartRate,Fe)):R(0,Fe),$.signalQuality!==void 0&&$.signalQuality!==null){const j=Math.round($.signalQuality/100*5),K="★".repeat(j),Z="☆".repeat(5-j);E.textContent=K+Z;const W=document.querySelector("#qualityScore");W.textContent=`${Math.round($.signalQuality)}%`}$.snr!==void 0&&$.snr!==null&&(T.textContent=$.snr.toFixed(1)),w.textContent=Math.round($.confidence*100).toString()}if(D&&M.signalData){const $={...M.signalData,values:M.signalData.values.slice(-200),timestamps:M.signalData.timestamps.slice(-200)};D.updateSignal($,M.realtimeEstimation||null,M.healthResult?.stage)}M.healthResult&&M.healthResult.health&&wr(s,P)},pr(s,k,c,l,P,A,Fi,ur),g.addEventListener("click",()=>{x=x==="PPG"?"ECG":"PPG",A(x),P(`Visualization type changed to ${x}`)});function P(M){const F=document.createElement("div");F.className="toast",F.textContent=M,document.body.appendChild(F),setTimeout(()=>{F.classList.add("show")},10),setTimeout(()=>{F.classList.remove("show"),setTimeout(()=>{document.body.removeChild(F)},300)},3e3)}})};export{z as $,rt as a,br as b,xr as c,Dr as d,da as f,fa as g,Sr as h,kr as l,na as n,oi as r,as as s};

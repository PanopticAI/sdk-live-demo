const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DEdy4J9V-D6piMvdV.js","assets/bF2cz1Qs-BMDusl2d.js","assets/Bdj9Tq7i-BJGUu9Dc.js","assets/B2pE3kkM-CnWq1Yl8.js","assets/pXzK94C6-BNLc0F0b.js","assets/B6uo8tXT-Di8G4Yrv.js","assets/DNiMR7Uc-BXvHAZ5J.js","assets/BVXsNi4l-BrzH9TFv.js","assets/wpGhV2Ip-0aQdXty7.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function t(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(a){if(a.ep)return;a.ep=!0;const l=t(a);fetch(a.href,l)}})();const Ps="modulepreload",Fs=function(s){return"/sdk-live-demo/realtime-demo/"+s},At={},Ce=function(e,t,n){let a=Promise.resolve();if(t&&t.length>0){let f=function(p){return Promise.all(p.map(x=>Promise.resolve(x).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),o=h?.nonce||h?.getAttribute("nonce");a=f(t.map(p=>{if(p=Fs(p),p in At)return;At[p]=!0;const x=p.endsWith(".css"),S=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${S}`))return;const y=document.createElement("link");if(y.rel=x?"stylesheet":Ps,x||(y.as="script"),y.crossOrigin="",y.href=p,o&&y.setAttribute("nonce",o),document.head.appendChild(y),x)return new Promise((w,b)=>{y.addEventListener("load",w),y.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${p}`)))})}))}function l(h){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=h,window.dispatchEvent(o),!o.defaultPrevented)throw h}return a.then(h=>{for(const o of h||[])o.status==="rejected"&&l(o.reason);return e().catch(l)})};var As=Object.defineProperty,Is=(s,e,t)=>e in s?As(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,d=(s,e,t)=>Is(s,typeof e!="symbol"?e+"":e,t),pi=(s=>(s[s.Male=0]="Male",s[s.Female=1]="Female",s))(pi||{}),Ze=(s=>(s[s.Poor=0]="Poor",s[s.Good=1]="Good",s[s.Excellent=2]="Excellent",s))(Ze||{}),ie=(s=>(s[s.Local=0]="Local",s[s.LocalV2=101]="LocalV2",s[s.RemoteDev=1]="RemoteDev",s[s.RemoteProd=2]="RemoteProd",s[s.AwsDev=3]="AwsDev",s[s.AwsProd=4]="AwsProd",s[s.RemoteProdEnterprise=5]="RemoteProdEnterprise",s[s.AwsFirebaseEnterpriseProd=5]="AwsFirebaseEnterpriseProd",s[s.AwsProdEnterprise=6]="AwsProdEnterprise",s[s.AwsEnterpriseProd=6]="AwsEnterpriseProd",s[s.AwsDevEnterprise=7]="AwsDevEnterprise",s[s.AwsEnterpriseDev=7]="AwsEnterpriseDev",s[s.FdaDev=8]="FdaDev",s[s.FdaProd=9]="FdaProd",s[s.Schema2Dev=10]="Schema2Dev",s[s.Schema2Prod=11]="Schema2Prod",s))(ie||{}),Ne=(s=>(s[s.default=0]="default",s[s.dummy=1]="dummy",s))(Ne||{}),q=(s=>(s[s.WaitingData=0]="WaitingData",s[s.CollectingData=1]="CollectingData",s[s.AnalyzingData=2]="AnalyzingData",s[s.Idle=3]="Idle",s))(q||{});async function Bs(s,e){return new Promise(t=>{setTimeout(()=>{t(e)},s*1e3)})}function K(...s){console.log("[VSE Plugin]",...s)}function _s(s){let e="";const t=(s.length-s.length*.8)/2;for(let n=0;n<s.length;n++)n>=t&&n<s.length-t?e+="#":e+=s[n];return e}let Qe;const Os=new Uint8Array(16);function Ls(){if(!Qe&&(Qe=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Qe))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Qe(Os)}const ae=[];for(let s=0;s<256;++s)ae.push((s+256).toString(16).slice(1));function $s(s,e=0){return ae[s[e+0]]+ae[s[e+1]]+ae[s[e+2]]+ae[s[e+3]]+"-"+ae[s[e+4]]+ae[s[e+5]]+"-"+ae[s[e+6]]+ae[s[e+7]]+"-"+ae[s[e+8]]+ae[s[e+9]]+"-"+ae[s[e+10]]+ae[s[e+11]]+ae[s[e+12]]+ae[s[e+13]]+ae[s[e+14]]+ae[s[e+15]]}const Us=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),It={randomUUID:Us};function Rt(s,e,t){if(It.randomUUID&&!s)return It.randomUUID();s=s||{};const n=s.random||(s.rng||Ls)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,$s(n)}function Bt(s,e){return(e.getTime()-s.getTime())/1e3}function Vs(s,e){if(s.length!=e.length)return!1;for(let t=0;t<s.length;t++)if(s[t].x!=e[t].x||s[t].y!=e[t].y)return!1;return!0}function vt(s,e){return Math.sqrt((e.x-s.x)*(e.x-s.x)+(e.y-s.y)*(e.y-s.y))}function Hs(s,e,t=20){let n="|";for(let a=0;a<t;a++)a/t>e?n+=" ":n+="█";return n+=`| ${e.toFixed(2)}`,`${s}: ${n}`}function de(...s){console.log("[Blink Detector]",...s)}let vi=class{constructor(s="",e=!1){d(this,"frameCount",0),d(this,"start",new Date),d(this,"name","noname"),d(this,"enableLog",!1),d(this,"lastLogTime",new Date),d(this,"logInterval",10),this.name=s,this.enableLog=e}get averageFps(){if(this.frameCount===0&&(this.start=new Date),!(this.elapsed<.5))return this.frameCount/this.elapsed}get elapsed(){return(new Date().getTime()-this.start.getTime())/1e3}tick(){this.frameCount=this.frameCount+1}reset(){this.frameCount=0,this.start=new Date,this.lastLogTime=new Date}log(){if(this.averageFps==null||(new Date().getTime()-this.lastLogTime.getTime())/1e3<this.logInterval)return;const s=this.averageFps.toFixed(2);this.enableLog&&(console.log(`[FPS ${this.name}] (${this.frameCount}/${this.elapsed})) ${s}fps`),this.lastLogTime=new Date)}};class st{constructor(e,t){d(this,"duration"),d(this,"name"),d(this,"observers",[]),d(this,"startTime",new Date),d(this,"fps"),d(this,"signals",[]),this.name=e,this.fps=new vi(e),this.duration=t}get size(){return this.fps.averageFps===void 0?10:this.fps.averageFps*this.duration}clear(){this.signals=[],this.fps.reset(),this.startTime=new Date}add(e){if(this.fps.tick(),this.observers.forEach(t=>{var n;return(n=t.willAdd)==null?void 0:n.call(t,e)}),this.signals.length<this.size)this.signals.push({timestamp:new Date,value:e});else{for(;this.signals.length>this.size;)this.signals.shift();this.signals.push({timestamp:new Date,value:e})}this.observers.forEach(t=>{var n;return(n=t.onAdded)==null?void 0:n.call(t,e)})}get max(){return this.signals.length===0?0:Math.max(...this.signals.map(e=>e.value))}get lastEntry(){if(this.signals.length!==0)return this.signals[this.signals.length-1]}get last(){if(this.signals.length!=0)return this.signals[this.signals.length-1].value}visualize(e=0,t=1,n=20){const a=this.lastEntry||{timestamp:new Date,value:0};let l="|";for(let h=0;h<n;h++){const o=e+h/n*(t-e);o>=0?o>a.value?l+=" ":l+="█":o<a.value?l+=" ":l+="█"}return l+=`| ${a.value.toFixed(2)}`,`${((a.timestamp.getTime()-this.startTime.getTime())/1e3).toFixed(2)}s ${this.name}: ${l}`}derivative(){const e=new st(`${this.name}'`,this.size),t=this;return this.observers.push({willAdd(n){t.last!==void 0&&e.add(n-t.last)}}),e}detectPeak(e,t){if(this.fps.averageFps===void 0)return!1;const n=Math.min(Math.floor(this.fps.averageFps*e),this.signals.length);if(n<2||this.signals.length<2)return!1;const a=this.signals[this.signals.length-1].value,l=this.signals.slice(this.signals.length-1-n,this.signals.length-2).map(o=>o.value),h=Ws(l);return a-h>h*t}}function Ws(s){return s.reduce((e,t)=>e+t,0)/s.length}const Ns=.2,zs=1/20,js=.5,qs=2,Gs=2;class Qs{constructor(e="No name"){d(this,"name"),d(this,"movement",0),d(this,"debug",!1),d(this,"config",{movementThreshold:Ns,startMovementDurationThreshold:zs,stopMovementDurationThreshold:js,freezedTheshold:qs,movementDurationThreshold:Gs,normalizeValue:.02}),d(this,"lastPosition"),d(this,"startMoveTime"),d(this,"startStayTime"),d(this,"lastZeroMovementTime"),d(this,"_isMoving",!1),d(this,"_lastStateChagneTime"),this.name=e}configure(e){e.stopMovementDurationThreshold!==void 0&&(de("Configure Movement Detector stopMovementDurationThreshold: ",e.stopMovementDurationThreshold),this.config.stopMovementDurationThreshold=e.stopMovementDurationThreshold),e.startMovementDurationThreshold!==void 0&&(de("Configure Movement Detector startMovementDurationThreshold: ",e.startMovementDurationThreshold),this.config.startMovementDurationThreshold=e.startMovementDurationThreshold),e.movementThreshold!==void 0&&(de("Configure Movement Detector movementThreshold: ",e.movementThreshold),this.config.movementThreshold=e.movementThreshold),e.freezedTheshold!==void 0&&(de("Configure Movement Detector freezedTheshold: ",e.freezedTheshold),this.config.freezedTheshold=e.freezedTheshold),e.unstableDurationThreshold!==void 0&&(de("Configure Movement Detector unstableDurationThreshold: ",e.unstableDurationThreshold),this.config.movementDurationThreshold=e.unstableDurationThreshold)}reset(){this.lastPosition=void 0,this.startMoveTime=void 0,this.startStayTime=void 0,this.lastZeroMovementTime=void 0,this._lastStateChagneTime=void 0,this._isMoving=!1}get movedLongEnough(){return this.startMoveTime===void 0?!1:Bt(this.startMoveTime,new Date)>this.config.startMovementDurationThreshold}get stayStillLongEnough(){return this.startStayTime===void 0?!1:Bt(this.startStayTime,new Date)>this.config.stopMovementDurationThreshold}update(e){if(this.lastPosition===void 0){this.lastPosition=e;return}this.movement=vt(e,this.lastPosition)/this.config.normalizeValue,this.lastPosition=e,this.movement>this.config.movementThreshold?(this.startStayTime=void 0,this.startMoveTime===void 0&&(this.startMoveTime=new Date),this.movedLongEnough&&(this.isMoving=!0)):(this.startMoveTime=void 0,this.startStayTime===void 0&&(this.startStayTime=new Date),this.stayStillLongEnough&&(this.isMoving=!1)),this.debugLog(Hs("Movement",this.movement)),this.movement===0?this.lastZeroMovementTime===void 0&&(this.lastZeroMovementTime=new Date):this.lastZeroMovementTime=void 0}get isDead(){return this.lastZeroMovementTime===void 0?!1:(new Date().getTime()-this.lastZeroMovementTime.getTime())/1e3>this.config.freezedTheshold}get unstable(){return this._lastStateChagneTime===void 0||!this.isMoving?!1:(new Date().getTime()-this._lastStateChagneTime.getTime())/1e3>this.config.movementDurationThreshold}get isMoving(){return this._isMoving}set isMoving(e){this._isMoving!==e&&(this._isMoving=e,this._lastStateChagneTime=new Date,this._isMoving?this.debugLog(`${this.name} is moving.`):this.debugLog(`${this.name} is not moving`))}debugLog(...e){this.debug&&de(...e)}}class wi{constructor(e,t){d(this,"landmarks",[]),d(this,"ltrb"),d(this,"name"),d(this,"fps"),d(this,"ears"),d(this,"movementDetector"),this.ltrb=e,this.name=t,this.fps=new vi(t),this.movementDetector=new Qs(t),this.ears=new st(`${t} EAR`,2)}reset(){this.movementDetector.reset(),this.fps.reset(),this.ears.clear()}update(e){Vs(this.landmarks,e)||this.fps.tick(),this.fps.log(),this.landmarks=e,this.ears.add(this.aspectRatio),this.movementDetector.update(this.midPoint)}get maxEar(){return this.ears.max}get normalizedEar(){return this.aspectRatio/this.maxEar}get averageFps(){return this.fps.averageFps}get movement(){return this.movementDetector.movement}get isMoving(){return this.movementDetector.isMoving}get detectionLost(){return this.movementDetector.isDead}get unstable(){return this.movementDetector.unstable}get leftPoint(){return{x:this.landmarks[this.ltrb.left].x,y:this.landmarks[this.ltrb.left].y}}get rightPoint(){return{x:this.landmarks[this.ltrb.right].x,y:this.landmarks[this.ltrb.right].y}}get topPoint(){return{x:this.landmarks[this.ltrb.top].x,y:this.landmarks[this.ltrb.top].y}}get bottomPoint(){return{x:this.landmarks[this.ltrb.bottom].x,y:this.landmarks[this.ltrb.bottom].y}}get width(){return vt(this.leftPoint,this.rightPoint)}get height(){return vt(this.topPoint,this.bottomPoint)}get aspectRatio(){return this.height/this.width}get midPoint(){return{x:(this.leftPoint.x+this.rightPoint.x)/2,y:(this.leftPoint.y+this.rightPoint.y)/2}}}const Ye=[[263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]],Ke=[[33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]],Ys={left:Ye[0][0],top:Ye[11][1],right:Ye[15][1],bottom:Ye[4][0]},Ks={left:Ke[0][0],top:Ke[11][1],right:Ke[15][1],bottom:Ke[4][0]};class Xs extends wi{constructor(){super(Ys,"Left Eye")}}class Zs extends wi{constructor(){super(Ks,"Right Eye")}}class Js{constructor(){d(this,"fps",15),d(this,"blinkCount",5),d(this,"noEyes",!1),d(this,"unstable",!1)}configure(e){}reset(){}detect(e){return!0}}const en=.15,tn=10;class sn{constructor(){d(this,"leftEye",new Xs),d(this,"rightEye",new Zs),d(this,"avgEars"),d(this,"dEars"),d(this,"debug",!1),d(this,"_blinkCount",0),d(this,"_isReset",!1),d(this,"config",{enableBlinkDetector:!0,minFps:tn,earDiffThreshold:en,enableMovementDetection:!0}),de("Blink detector created"),this.avgEars=new st("EAR",this.leftEye.ears.duration),this.dEars=this.avgEars.derivative()}configure(e){e.earDiffThreshold!==void 0&&(de("Configure Blink Detector earDiffThreshold: ",e.earDiffThreshold),this.config.earDiffThreshold=e.earDiffThreshold),e.minFps!==void 0&&(de("Configure Blink Detector minFps: ",e.minFps),this.config.minFps=e.minFps),e.enableMovementDetection&&(de("Configure Blink Detector enableMovementDetection: ",e.enableMovementDetection),this.config.enableMovementDetection=e.enableMovementDetection),this.leftEye.movementDetector.configure(e),this.rightEye.movementDetector.configure(e)}get noEyes(){return this.leftEye.detectionLost||this.rightEye.detectionLost}get unstable(){return this.leftEye.unstable||this.rightEye.unstable}get fps(){return((this.leftEye.averageFps||0)+(this.rightEye.averageFps||0))/2}reset(){this._isReset=!0,this._blinkCount=0,this.leftEye.reset(),this.rightEye.reset(),this.avgEars.clear(),this.dEars.clear()}get blinkCount(){return this.leftEye.averageFps!==void 0&&this.rightEye.averageFps!==void 0&&this.leftEye.averageFps<this.config.minFps&&this.rightEye.averageFps<this.config.minFps?(de(`FPS < ${this.config.minFps}, blink detection is unreliable. Always return blink count 1.`),1):this._blinkCount}detect(e){if(this._isReset||this.reset(),this.leftEye.update(e),this.rightEye.update(e),this.config.enableMovementDetection){if(this.unstable)return de("Error: unstable eyes"),!1;if(this.leftEye.isMoving||this.rightEye.isMoving)return!1;if(this.noEyes)return de("Error: no eyes"),!1}this.avgEars.add(1-(this.leftEye.normalizedEar+this.rightEye.normalizedEar)/2);const t=this.dEars.last||0,n=t>this.config.earDiffThreshold;if(this.debug&&de(this.dEars.visualize(-1,1,30)),n){this._blinkCount++;const a=((this.leftEye.averageFps||0)+(this.rightEye.averageFps||0))/2;de(`Blink Detected ${this._blinkCount}. EAR_DIFF=${t.toFixed(2)} FPS=${a.toFixed(1)}`)}return n}}function _t(s){switch(s){case Ne.default:return new sn;case Ne.dummy:return new Js}}const yi=class bi{constructor(){d(this,"endpoint","https://aws-backend.panoptic.ai/s3/"),d(this,"s3ApiKey","TJ3CJ2ebRs0YK3HIwopu529q92qAZ1waBI5mWIq5")}async getDataFromS3(e,t){try{const n={type:"get-json",params:{bucket:e,objectKey:t}},a={"Content-Type":"application/json","X-Api-Key":this.s3ApiKey},l=await fetch(this.endpoint,{method:"POST",headers:a,body:JSON.stringify(n)});if(l.status!=200)throw new Error(l.statusText);return await l.json()}catch(n){throw console.error(`${bi.TAG}: Error fetching data from S3:`,n),n}}};d(yi,"TAG","AWS S3 Client");let nn=yi;var Sa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function rn(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function Da(s){if(Object.prototype.hasOwnProperty.call(s,"__esModule"))return s;var e=s.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(n){var a=Object.getOwnPropertyDescriptor(s,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return s[n]}})}),t}var Ot={},je={},Lt;function an(){if(Lt)return je;Lt=1,je.byteLength=o,je.toByteArray=p,je.fromByteArray=y;for(var s=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,l=n.length;a<l;++a)s[a]=n[a],e[n.charCodeAt(a)]=a;e[45]=62,e[95]=63;function h(w){var b=w.length;if(b%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var u=w.indexOf("=");u===-1&&(u=b);var g=u===b?0:4-u%4;return[u,g]}function o(w){var b=h(w),u=b[0],g=b[1];return(u+g)*3/4-g}function f(w,b,u){return(b+u)*3/4-u}function p(w){var b,u=h(w),g=u[0],D=u[1],E=new t(f(w,g,D)),v=0,M=D>0?g-4:g,F;for(F=0;F<M;F+=4)b=e[w.charCodeAt(F)]<<18|e[w.charCodeAt(F+1)]<<12|e[w.charCodeAt(F+2)]<<6|e[w.charCodeAt(F+3)],E[v++]=b>>16&255,E[v++]=b>>8&255,E[v++]=b&255;return D===2&&(b=e[w.charCodeAt(F)]<<2|e[w.charCodeAt(F+1)]>>4,E[v++]=b&255),D===1&&(b=e[w.charCodeAt(F)]<<10|e[w.charCodeAt(F+1)]<<4|e[w.charCodeAt(F+2)]>>2,E[v++]=b>>8&255,E[v++]=b&255),E}function x(w){return s[w>>18&63]+s[w>>12&63]+s[w>>6&63]+s[w&63]}function S(w,b,u){for(var g,D=[],E=b;E<u;E+=3)g=(w[E]<<16&16711680)+(w[E+1]<<8&65280)+(w[E+2]&255),D.push(x(g));return D.join("")}function y(w){for(var b,u=w.length,g=u%3,D=[],E=16383,v=0,M=u-g;v<M;v+=E)D.push(S(w,v,v+E>M?M:v+E));return g===1?(b=w[u-1],D.push(s[b>>2]+s[b<<4&63]+"==")):g===2&&(b=(w[u-2]<<8)+w[u-1],D.push(s[b>>10]+s[b>>4&63]+s[b<<2&63]+"=")),D.join("")}return je}var ot={};var $t;function on(){return $t||($t=1,ot.read=function(s,e,t,n,a){var l,h,o=a*8-n-1,f=(1<<o)-1,p=f>>1,x=-7,S=t?a-1:0,y=t?-1:1,w=s[e+S];for(S+=y,l=w&(1<<-x)-1,w>>=-x,x+=o;x>0;l=l*256+s[e+S],S+=y,x-=8);for(h=l&(1<<-x)-1,l>>=-x,x+=n;x>0;h=h*256+s[e+S],S+=y,x-=8);if(l===0)l=1-p;else{if(l===f)return h?NaN:(w?-1:1)*(1/0);h=h+Math.pow(2,n),l=l-p}return(w?-1:1)*h*Math.pow(2,l-n)},ot.write=function(s,e,t,n,a,l){var h,o,f,p=l*8-a-1,x=(1<<p)-1,S=x>>1,y=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,w=n?0:l-1,b=n?1:-1,u=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,h=x):(h=Math.floor(Math.log(e)/Math.LN2),e*(f=Math.pow(2,-h))<1&&(h--,f*=2),h+S>=1?e+=y/f:e+=y*Math.pow(2,1-S),e*f>=2&&(h++,f/=2),h+S>=x?(o=0,h=x):h+S>=1?(o=(e*f-1)*Math.pow(2,a),h=h+S):(o=e*Math.pow(2,S-1)*Math.pow(2,a),h=0));a>=8;s[t+w]=o&255,w+=b,o/=256,a-=8);for(h=h<<a|o,p+=a;p>0;s[t+w]=h&255,w+=b,h/=256,p-=8);s[t+w-b]|=u*128}),ot}var Ut;function ln(){return Ut||(Ut=1,(function(s){const e=an(),t=on(),n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;s.Buffer=o,s.SlowBuffer=E,s.INSPECT_MAX_BYTES=50;const a=2147483647;s.kMaxLength=a,o.TYPED_ARRAY_SUPPORT=l(),!o.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function l(){try{const i=new Uint8Array(1),r={foo:function(){return 42}};return Object.setPrototypeOf(r,Uint8Array.prototype),Object.setPrototypeOf(i,r),i.foo()===42}catch{return!1}}Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}});function h(i){if(i>a)throw new RangeError('The value "'+i+'" is invalid for option "size"');const r=new Uint8Array(i);return Object.setPrototypeOf(r,o.prototype),r}function o(i,r,c){if(typeof i=="number"){if(typeof r=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return S(i)}return f(i,r,c)}o.poolSize=8192;function f(i,r,c){if(typeof i=="string")return y(i,r);if(ArrayBuffer.isView(i))return b(i);if(i==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i);if(he(i,ArrayBuffer)||i&&he(i.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(he(i,SharedArrayBuffer)||i&&he(i.buffer,SharedArrayBuffer)))return u(i,r,c);if(typeof i=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const m=i.valueOf&&i.valueOf();if(m!=null&&m!==i)return o.from(m,r,c);const k=g(i);if(k)return k;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof i[Symbol.toPrimitive]=="function")return o.from(i[Symbol.toPrimitive]("string"),r,c);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i)}o.from=function(i,r,c){return f(i,r,c)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array);function p(i){if(typeof i!="number")throw new TypeError('"size" argument must be of type number');if(i<0)throw new RangeError('The value "'+i+'" is invalid for option "size"')}function x(i,r,c){return p(i),i<=0?h(i):r!==void 0?typeof c=="string"?h(i).fill(r,c):h(i).fill(r):h(i)}o.alloc=function(i,r,c){return x(i,r,c)};function S(i){return p(i),h(i<0?0:D(i)|0)}o.allocUnsafe=function(i){return S(i)},o.allocUnsafeSlow=function(i){return S(i)};function y(i,r){if((typeof r!="string"||r==="")&&(r="utf8"),!o.isEncoding(r))throw new TypeError("Unknown encoding: "+r);const c=v(i,r)|0;let m=h(c);const k=m.write(i,r);return k!==c&&(m=m.slice(0,k)),m}function w(i){const r=i.length<0?0:D(i.length)|0,c=h(r);for(let m=0;m<r;m+=1)c[m]=i[m]&255;return c}function b(i){if(he(i,Uint8Array)){const r=new Uint8Array(i);return u(r.buffer,r.byteOffset,r.byteLength)}return w(i)}function u(i,r,c){if(r<0||i.byteLength<r)throw new RangeError('"offset" is outside of buffer bounds');if(i.byteLength<r+(c||0))throw new RangeError('"length" is outside of buffer bounds');let m;return r===void 0&&c===void 0?m=new Uint8Array(i):c===void 0?m=new Uint8Array(i,r):m=new Uint8Array(i,r,c),Object.setPrototypeOf(m,o.prototype),m}function g(i){if(o.isBuffer(i)){const r=D(i.length)|0,c=h(r);return c.length===0||i.copy(c,0,0,r),c}if(i.length!==void 0)return typeof i.length!="number"||re(i.length)?h(0):w(i);if(i.type==="Buffer"&&Array.isArray(i.data))return w(i.data)}function D(i){if(i>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return i|0}function E(i){return+i!=i&&(i=0),o.alloc(+i)}o.isBuffer=function(i){return i!=null&&i._isBuffer===!0&&i!==o.prototype},o.compare=function(i,r){if(he(i,Uint8Array)&&(i=o.from(i,i.offset,i.byteLength)),he(r,Uint8Array)&&(r=o.from(r,r.offset,r.byteLength)),!o.isBuffer(i)||!o.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(i===r)return 0;let c=i.length,m=r.length;for(let k=0,R=Math.min(c,m);k<R;++k)if(i[k]!==r[k]){c=i[k],m=r[k];break}return c<m?-1:m<c?1:0},o.isEncoding=function(i){switch(String(i).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(i,r){if(!Array.isArray(i))throw new TypeError('"list" argument must be an Array of Buffers');if(i.length===0)return o.alloc(0);let c;if(r===void 0)for(r=0,c=0;c<i.length;++c)r+=i[c].length;const m=o.allocUnsafe(r);let k=0;for(c=0;c<i.length;++c){let R=i[c];if(he(R,Uint8Array))k+R.length>m.length?(o.isBuffer(R)||(R=o.from(R)),R.copy(m,k)):Uint8Array.prototype.set.call(m,R,k);else if(o.isBuffer(R))R.copy(m,k);else throw new TypeError('"list" argument must be an Array of Buffers');k+=R.length}return m};function v(i,r){if(o.isBuffer(i))return i.length;if(ArrayBuffer.isView(i)||he(i,ArrayBuffer))return i.byteLength;if(typeof i!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof i);const c=i.length,m=arguments.length>2&&arguments[2]===!0;if(!m&&c===0)return 0;let k=!1;for(;;)switch(r){case"ascii":case"latin1":case"binary":return c;case"utf8":case"utf-8":return De(i).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c*2;case"hex":return c>>>1;case"base64":return Ue(i).length;default:if(k)return m?-1:De(i).length;r=(""+r).toLowerCase(),k=!0}}o.byteLength=v;function M(i,r,c){let m=!1;if((r===void 0||r<0)&&(r=0),r>this.length||((c===void 0||c>this.length)&&(c=this.length),c<=0)||(c>>>=0,r>>>=0,c<=r))return"";for(i||(i="utf8");;)switch(i){case"hex":return N(this,r,c);case"utf8":case"utf-8":return W(this,r,c);case"ascii":return ge(this,r,c);case"latin1":case"binary":return V(this,r,c);case"base64":return X(this,r,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,r,c);default:if(m)throw new TypeError("Unknown encoding: "+i);i=(i+"").toLowerCase(),m=!0}}o.prototype._isBuffer=!0;function F(i,r,c){const m=i[r];i[r]=i[c],i[c]=m}o.prototype.swap16=function(){const i=this.length;if(i%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let r=0;r<i;r+=2)F(this,r,r+1);return this},o.prototype.swap32=function(){const i=this.length;if(i%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let r=0;r<i;r+=4)F(this,r,r+3),F(this,r+1,r+2);return this},o.prototype.swap64=function(){const i=this.length;if(i%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let r=0;r<i;r+=8)F(this,r,r+7),F(this,r+1,r+6),F(this,r+2,r+5),F(this,r+3,r+4);return this},o.prototype.toString=function(){const i=this.length;return i===0?"":arguments.length===0?W(this,0,i):M.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(i){if(!o.isBuffer(i))throw new TypeError("Argument must be a Buffer");return this===i?!0:o.compare(this,i)===0},o.prototype.inspect=function(){let i="";const r=s.INSPECT_MAX_BYTES;return i=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(i+=" ... "),"<Buffer "+i+">"},n&&(o.prototype[n]=o.prototype.inspect),o.prototype.compare=function(i,r,c,m,k){if(he(i,Uint8Array)&&(i=o.from(i,i.offset,i.byteLength)),!o.isBuffer(i))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof i);if(r===void 0&&(r=0),c===void 0&&(c=i?i.length:0),m===void 0&&(m=0),k===void 0&&(k=this.length),r<0||c>i.length||m<0||k>this.length)throw new RangeError("out of range index");if(m>=k&&r>=c)return 0;if(m>=k)return-1;if(r>=c)return 1;if(r>>>=0,c>>>=0,m>>>=0,k>>>=0,this===i)return 0;let R=k-m,C=c-r;const $=Math.min(R,C),J=this.slice(m,k),Q=i.slice(r,c);for(let Y=0;Y<$;++Y)if(J[Y]!==Q[Y]){R=J[Y],C=Q[Y];break}return R<C?-1:C<R?1:0};function T(i,r,c,m,k){if(i.length===0)return-1;if(typeof c=="string"?(m=c,c=0):c>2147483647?c=2147483647:c<-2147483648&&(c=-2147483648),c=+c,re(c)&&(c=k?0:i.length-1),c<0&&(c=i.length+c),c>=i.length){if(k)return-1;c=i.length-1}else if(c<0)if(k)c=0;else return-1;if(typeof r=="string"&&(r=o.from(r,m)),o.isBuffer(r))return r.length===0?-1:P(i,r,c,m,k);if(typeof r=="number")return r=r&255,typeof Uint8Array.prototype.indexOf=="function"?k?Uint8Array.prototype.indexOf.call(i,r,c):Uint8Array.prototype.lastIndexOf.call(i,r,c):P(i,[r],c,m,k);throw new TypeError("val must be string, number or Buffer")}function P(i,r,c,m,k){let R=1,C=i.length,$=r.length;if(m!==void 0&&(m=String(m).toLowerCase(),m==="ucs2"||m==="ucs-2"||m==="utf16le"||m==="utf-16le")){if(i.length<2||r.length<2)return-1;R=2,C/=2,$/=2,c/=2}function J(Y,ee){return R===1?Y[ee]:Y.readUInt16BE(ee*R)}let Q;if(k){let Y=-1;for(Q=c;Q<C;Q++)if(J(i,Q)===J(r,Y===-1?0:Q-Y)){if(Y===-1&&(Y=Q),Q-Y+1===$)return Y*R}else Y!==-1&&(Q-=Q-Y),Y=-1}else for(c+$>C&&(c=C-$),Q=c;Q>=0;Q--){let Y=!0;for(let ee=0;ee<$;ee++)if(J(i,Q+ee)!==J(r,ee)){Y=!1;break}if(Y)return Q}return-1}o.prototype.includes=function(i,r,c){return this.indexOf(i,r,c)!==-1},o.prototype.indexOf=function(i,r,c){return T(this,i,r,c,!0)},o.prototype.lastIndexOf=function(i,r,c){return T(this,i,r,c,!1)};function A(i,r,c,m){c=Number(c)||0;const k=i.length-c;m?(m=Number(m),m>k&&(m=k)):m=k;const R=r.length;m>R/2&&(m=R/2);let C;for(C=0;C<m;++C){const $=parseInt(r.substr(C*2,2),16);if(re($))return C;i[c+C]=$}return C}function j(i,r,c,m){return Re(De(r,i.length-c),i,c,m)}function U(i,r,c,m){return Re(Ee(r),i,c,m)}function H(i,r,c,m){return Re(Ue(r),i,c,m)}function G(i,r,c,m){return Re(Pe(r,i.length-c),i,c,m)}o.prototype.write=function(i,r,c,m){if(r===void 0)m="utf8",c=this.length,r=0;else if(c===void 0&&typeof r=="string")m=r,c=this.length,r=0;else if(isFinite(r))r=r>>>0,isFinite(c)?(c=c>>>0,m===void 0&&(m="utf8")):(m=c,c=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const k=this.length-r;if((c===void 0||c>k)&&(c=k),i.length>0&&(c<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");m||(m="utf8");let R=!1;for(;;)switch(m){case"hex":return A(this,i,r,c);case"utf8":case"utf-8":return j(this,i,r,c);case"ascii":case"latin1":case"binary":return U(this,i,r,c);case"base64":return H(this,i,r,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return G(this,i,r,c);default:if(R)throw new TypeError("Unknown encoding: "+m);m=(""+m).toLowerCase(),R=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function X(i,r,c){return r===0&&c===i.length?e.fromByteArray(i):e.fromByteArray(i.slice(r,c))}function W(i,r,c){c=Math.min(i.length,c);const m=[];let k=r;for(;k<c;){const R=i[k];let C=null,$=R>239?4:R>223?3:R>191?2:1;if(k+$<=c){let J,Q,Y,ee;switch($){case 1:R<128&&(C=R);break;case 2:J=i[k+1],(J&192)===128&&(ee=(R&31)<<6|J&63,ee>127&&(C=ee));break;case 3:J=i[k+1],Q=i[k+2],(J&192)===128&&(Q&192)===128&&(ee=(R&15)<<12|(J&63)<<6|Q&63,ee>2047&&(ee<55296||ee>57343)&&(C=ee));break;case 4:J=i[k+1],Q=i[k+2],Y=i[k+3],(J&192)===128&&(Q&192)===128&&(Y&192)===128&&(ee=(R&15)<<18|(J&63)<<12|(Q&63)<<6|Y&63,ee>65535&&ee<1114112&&(C=ee))}}C===null?(C=65533,$=1):C>65535&&(C-=65536,m.push(C>>>10&1023|55296),C=56320|C&1023),m.push(C),k+=$}return ue(m)}const Z=4096;function ue(i){const r=i.length;if(r<=Z)return String.fromCharCode.apply(String,i);let c="",m=0;for(;m<r;)c+=String.fromCharCode.apply(String,i.slice(m,m+=Z));return c}function ge(i,r,c){let m="";c=Math.min(i.length,c);for(let k=r;k<c;++k)m+=String.fromCharCode(i[k]&127);return m}function V(i,r,c){let m="";c=Math.min(i.length,c);for(let k=r;k<c;++k)m+=String.fromCharCode(i[k]);return m}function N(i,r,c){const m=i.length;(!r||r<0)&&(r=0),(!c||c<0||c>m)&&(c=m);let k="";for(let R=r;R<c;++R)k+=xe[i[R]];return k}function L(i,r,c){const m=i.slice(r,c);let k="";for(let R=0;R<m.length-1;R+=2)k+=String.fromCharCode(m[R]+m[R+1]*256);return k}o.prototype.slice=function(i,r){const c=this.length;i=~~i,r=r===void 0?c:~~r,i<0?(i+=c,i<0&&(i=0)):i>c&&(i=c),r<0?(r+=c,r<0&&(r=0)):r>c&&(r=c),r<i&&(r=i);const m=this.subarray(i,r);return Object.setPrototypeOf(m,o.prototype),m};function B(i,r,c){if(i%1!==0||i<0)throw new RangeError("offset is not uint");if(i+r>c)throw new RangeError("Trying to access beyond buffer length")}o.prototype.readUintLE=o.prototype.readUIntLE=function(i,r,c){i=i>>>0,r=r>>>0,c||B(i,r,this.length);let m=this[i],k=1,R=0;for(;++R<r&&(k*=256);)m+=this[i+R]*k;return m},o.prototype.readUintBE=o.prototype.readUIntBE=function(i,r,c){i=i>>>0,r=r>>>0,c||B(i,r,this.length);let m=this[i+--r],k=1;for(;r>0&&(k*=256);)m+=this[i+--r]*k;return m},o.prototype.readUint8=o.prototype.readUInt8=function(i,r){return i=i>>>0,r||B(i,1,this.length),this[i]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(i,r){return i=i>>>0,r||B(i,2,this.length),this[i]|this[i+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(i,r){return i=i>>>0,r||B(i,2,this.length),this[i]<<8|this[i+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(i,r){return i=i>>>0,r||B(i,4,this.length),(this[i]|this[i+1]<<8|this[i+2]<<16)+this[i+3]*16777216},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(i,r){return i=i>>>0,r||B(i,4,this.length),this[i]*16777216+(this[i+1]<<16|this[i+2]<<8|this[i+3])},o.prototype.readBigUInt64LE=oe(function(i){i=i>>>0,pe(i,"offset");const r=this[i],c=this[i+7];(r===void 0||c===void 0)&&ye(i,this.length-8);const m=r+this[++i]*2**8+this[++i]*2**16+this[++i]*2**24,k=this[++i]+this[++i]*2**8+this[++i]*2**16+c*2**24;return BigInt(m)+(BigInt(k)<<BigInt(32))}),o.prototype.readBigUInt64BE=oe(function(i){i=i>>>0,pe(i,"offset");const r=this[i],c=this[i+7];(r===void 0||c===void 0)&&ye(i,this.length-8);const m=r*2**24+this[++i]*2**16+this[++i]*2**8+this[++i],k=this[++i]*2**24+this[++i]*2**16+this[++i]*2**8+c;return(BigInt(m)<<BigInt(32))+BigInt(k)}),o.prototype.readIntLE=function(i,r,c){i=i>>>0,r=r>>>0,c||B(i,r,this.length);let m=this[i],k=1,R=0;for(;++R<r&&(k*=256);)m+=this[i+R]*k;return k*=128,m>=k&&(m-=Math.pow(2,8*r)),m},o.prototype.readIntBE=function(i,r,c){i=i>>>0,r=r>>>0,c||B(i,r,this.length);let m=r,k=1,R=this[i+--m];for(;m>0&&(k*=256);)R+=this[i+--m]*k;return k*=128,R>=k&&(R-=Math.pow(2,8*r)),R},o.prototype.readInt8=function(i,r){return i=i>>>0,r||B(i,1,this.length),this[i]&128?(255-this[i]+1)*-1:this[i]},o.prototype.readInt16LE=function(i,r){i=i>>>0,r||B(i,2,this.length);const c=this[i]|this[i+1]<<8;return c&32768?c|4294901760:c},o.prototype.readInt16BE=function(i,r){i=i>>>0,r||B(i,2,this.length);const c=this[i+1]|this[i]<<8;return c&32768?c|4294901760:c},o.prototype.readInt32LE=function(i,r){return i=i>>>0,r||B(i,4,this.length),this[i]|this[i+1]<<8|this[i+2]<<16|this[i+3]<<24},o.prototype.readInt32BE=function(i,r){return i=i>>>0,r||B(i,4,this.length),this[i]<<24|this[i+1]<<16|this[i+2]<<8|this[i+3]},o.prototype.readBigInt64LE=oe(function(i){i=i>>>0,pe(i,"offset");const r=this[i],c=this[i+7];(r===void 0||c===void 0)&&ye(i,this.length-8);const m=this[i+4]+this[i+5]*2**8+this[i+6]*2**16+(c<<24);return(BigInt(m)<<BigInt(32))+BigInt(r+this[++i]*2**8+this[++i]*2**16+this[++i]*2**24)}),o.prototype.readBigInt64BE=oe(function(i){i=i>>>0,pe(i,"offset");const r=this[i],c=this[i+7];(r===void 0||c===void 0)&&ye(i,this.length-8);const m=(r<<24)+this[++i]*2**16+this[++i]*2**8+this[++i];return(BigInt(m)<<BigInt(32))+BigInt(this[++i]*2**24+this[++i]*2**16+this[++i]*2**8+c)}),o.prototype.readFloatLE=function(i,r){return i=i>>>0,r||B(i,4,this.length),t.read(this,i,!0,23,4)},o.prototype.readFloatBE=function(i,r){return i=i>>>0,r||B(i,4,this.length),t.read(this,i,!1,23,4)},o.prototype.readDoubleLE=function(i,r){return i=i>>>0,r||B(i,8,this.length),t.read(this,i,!0,52,8)},o.prototype.readDoubleBE=function(i,r){return i=i>>>0,r||B(i,8,this.length),t.read(this,i,!1,52,8)};function _(i,r,c,m,k,R){if(!o.isBuffer(i))throw new TypeError('"buffer" argument must be a Buffer instance');if(r>k||r<R)throw new RangeError('"value" argument is out of bounds');if(c+m>i.length)throw new RangeError("Index out of range")}o.prototype.writeUintLE=o.prototype.writeUIntLE=function(i,r,c,m){if(i=+i,r=r>>>0,c=c>>>0,!m){const C=Math.pow(2,8*c)-1;_(this,i,r,c,C,0)}let k=1,R=0;for(this[r]=i&255;++R<c&&(k*=256);)this[r+R]=i/k&255;return r+c},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(i,r,c,m){if(i=+i,r=r>>>0,c=c>>>0,!m){const C=Math.pow(2,8*c)-1;_(this,i,r,c,C,0)}let k=c-1,R=1;for(this[r+k]=i&255;--k>=0&&(R*=256);)this[r+k]=i/R&255;return r+c},o.prototype.writeUint8=o.prototype.writeUInt8=function(i,r,c){return i=+i,r=r>>>0,c||_(this,i,r,1,255,0),this[r]=i&255,r+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(i,r,c){return i=+i,r=r>>>0,c||_(this,i,r,2,65535,0),this[r]=i&255,this[r+1]=i>>>8,r+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(i,r,c){return i=+i,r=r>>>0,c||_(this,i,r,2,65535,0),this[r]=i>>>8,this[r+1]=i&255,r+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(i,r,c){return i=+i,r=r>>>0,c||_(this,i,r,4,4294967295,0),this[r+3]=i>>>24,this[r+2]=i>>>16,this[r+1]=i>>>8,this[r]=i&255,r+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(i,r,c){return i=+i,r=r>>>0,c||_(this,i,r,4,4294967295,0),this[r]=i>>>24,this[r+1]=i>>>16,this[r+2]=i>>>8,this[r+3]=i&255,r+4};function le(i,r,c,m,k){_e(r,m,k,i,c,7);let R=Number(r&BigInt(4294967295));i[c++]=R,R=R>>8,i[c++]=R,R=R>>8,i[c++]=R,R=R>>8,i[c++]=R;let C=Number(r>>BigInt(32)&BigInt(4294967295));return i[c++]=C,C=C>>8,i[c++]=C,C=C>>8,i[c++]=C,C=C>>8,i[c++]=C,c}function z(i,r,c,m,k){_e(r,m,k,i,c,7);let R=Number(r&BigInt(4294967295));i[c+7]=R,R=R>>8,i[c+6]=R,R=R>>8,i[c+5]=R,R=R>>8,i[c+4]=R;let C=Number(r>>BigInt(32)&BigInt(4294967295));return i[c+3]=C,C=C>>8,i[c+2]=C,C=C>>8,i[c+1]=C,C=C>>8,i[c]=C,c+8}o.prototype.writeBigUInt64LE=oe(function(i,r=0){return le(this,i,r,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeBigUInt64BE=oe(function(i,r=0){return z(this,i,r,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeIntLE=function(i,r,c,m){if(i=+i,r=r>>>0,!m){const $=Math.pow(2,8*c-1);_(this,i,r,c,$-1,-$)}let k=0,R=1,C=0;for(this[r]=i&255;++k<c&&(R*=256);)i<0&&C===0&&this[r+k-1]!==0&&(C=1),this[r+k]=(i/R>>0)-C&255;return r+c},o.prototype.writeIntBE=function(i,r,c,m){if(i=+i,r=r>>>0,!m){const $=Math.pow(2,8*c-1);_(this,i,r,c,$-1,-$)}let k=c-1,R=1,C=0;for(this[r+k]=i&255;--k>=0&&(R*=256);)i<0&&C===0&&this[r+k+1]!==0&&(C=1),this[r+k]=(i/R>>0)-C&255;return r+c},o.prototype.writeInt8=function(i,r,c){return i=+i,r=r>>>0,c||_(this,i,r,1,127,-128),i<0&&(i=255+i+1),this[r]=i&255,r+1},o.prototype.writeInt16LE=function(i,r,c){return i=+i,r=r>>>0,c||_(this,i,r,2,32767,-32768),this[r]=i&255,this[r+1]=i>>>8,r+2},o.prototype.writeInt16BE=function(i,r,c){return i=+i,r=r>>>0,c||_(this,i,r,2,32767,-32768),this[r]=i>>>8,this[r+1]=i&255,r+2},o.prototype.writeInt32LE=function(i,r,c){return i=+i,r=r>>>0,c||_(this,i,r,4,2147483647,-2147483648),this[r]=i&255,this[r+1]=i>>>8,this[r+2]=i>>>16,this[r+3]=i>>>24,r+4},o.prototype.writeInt32BE=function(i,r,c){return i=+i,r=r>>>0,c||_(this,i,r,4,2147483647,-2147483648),i<0&&(i=4294967295+i+1),this[r]=i>>>24,this[r+1]=i>>>16,this[r+2]=i>>>8,this[r+3]=i&255,r+4},o.prototype.writeBigInt64LE=oe(function(i,r=0){return le(this,i,r,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),o.prototype.writeBigInt64BE=oe(function(i,r=0){return z(this,i,r,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ce(i,r,c,m,k,R){if(c+m>i.length)throw new RangeError("Index out of range");if(c<0)throw new RangeError("Index out of range")}function se(i,r,c,m,k){return r=+r,c=c>>>0,k||ce(i,r,c,4),t.write(i,r,c,m,23,4),c+4}o.prototype.writeFloatLE=function(i,r,c){return se(this,i,r,!0,c)},o.prototype.writeFloatBE=function(i,r,c){return se(this,i,r,!1,c)};function we(i,r,c,m,k){return r=+r,c=c>>>0,k||ce(i,r,c,8),t.write(i,r,c,m,52,8),c+8}o.prototype.writeDoubleLE=function(i,r,c){return we(this,i,r,!0,c)},o.prototype.writeDoubleBE=function(i,r,c){return we(this,i,r,!1,c)},o.prototype.copy=function(i,r,c,m){if(!o.isBuffer(i))throw new TypeError("argument should be a Buffer");if(c||(c=0),!m&&m!==0&&(m=this.length),r>=i.length&&(r=i.length),r||(r=0),m>0&&m<c&&(m=c),m===c||i.length===0||this.length===0)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(c<0||c>=this.length)throw new RangeError("Index out of range");if(m<0)throw new RangeError("sourceEnd out of bounds");m>this.length&&(m=this.length),i.length-r<m-c&&(m=i.length-r+c);const k=m-c;return this===i&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(r,c,m):Uint8Array.prototype.set.call(i,this.subarray(c,m),r),k},o.prototype.fill=function(i,r,c,m){if(typeof i=="string"){if(typeof r=="string"?(m=r,r=0,c=this.length):typeof c=="string"&&(m=c,c=this.length),m!==void 0&&typeof m!="string")throw new TypeError("encoding must be a string");if(typeof m=="string"&&!o.isEncoding(m))throw new TypeError("Unknown encoding: "+m);if(i.length===1){const R=i.charCodeAt(0);(m==="utf8"&&R<128||m==="latin1")&&(i=R)}}else typeof i=="number"?i=i&255:typeof i=="boolean"&&(i=Number(i));if(r<0||this.length<r||this.length<c)throw new RangeError("Out of range index");if(c<=r)return this;r=r>>>0,c=c===void 0?this.length:c>>>0,i||(i=0);let k;if(typeof i=="number")for(k=r;k<c;++k)this[k]=i;else{const R=o.isBuffer(i)?i:o.from(i,m),C=R.length;if(C===0)throw new TypeError('The value "'+i+'" is invalid for argument "value"');for(k=0;k<c-r;++k)this[k+r]=R[k%C]}return this};const fe={};function Te(i,r,c){fe[i]=class extends c{constructor(){super(),Object.defineProperty(this,"message",{value:r.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${i}]`,this.stack,delete this.name}get code(){return i}set code(m){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:m,writable:!0})}toString(){return`${this.name} [${i}]: ${this.message}`}}}Te("ERR_BUFFER_OUT_OF_BOUNDS",function(i){return i?`${i} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Te("ERR_INVALID_ARG_TYPE",function(i,r){return`The "${i}" argument must be of type number. Received type ${typeof r}`},TypeError),Te("ERR_OUT_OF_RANGE",function(i,r,c){let m=`The value of "${i}" is out of range.`,k=c;return Number.isInteger(c)&&Math.abs(c)>2**32?k=Be(String(c)):typeof c=="bigint"&&(k=String(c),(c>BigInt(2)**BigInt(32)||c<-(BigInt(2)**BigInt(32)))&&(k=Be(k)),k+="n"),m+=` It must be ${r}. Received ${k}`,m},RangeError);function Be(i){let r="",c=i.length;const m=i[0]==="-"?1:0;for(;c>=m+4;c-=3)r=`_${i.slice(c-3,c)}${r}`;return`${i.slice(0,c)}${r}`}function $e(i,r,c){pe(r,"offset"),(i[r]===void 0||i[r+c]===void 0)&&ye(r,i.length-(c+1))}function _e(i,r,c,m,k,R){if(i>c||i<r){const C=typeof r=="bigint"?"n":"";let $;throw r===0||r===BigInt(0)?$=`>= 0${C} and < 2${C} ** ${(R+1)*8}${C}`:$=`>= -(2${C} ** ${(R+1)*8-1}${C}) and < 2 ** ${(R+1)*8-1}${C}`,new fe.ERR_OUT_OF_RANGE("value",$,i)}$e(m,k,R)}function pe(i,r){if(typeof i!="number")throw new fe.ERR_INVALID_ARG_TYPE(r,"number",i)}function ye(i,r,c){throw Math.floor(i)!==i?(pe(i,c),new fe.ERR_OUT_OF_RANGE("offset","an integer",i)):r<0?new fe.ERR_BUFFER_OUT_OF_BOUNDS:new fe.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${r}`,i)}const be=/[^+/0-9A-Za-z-_]/g;function ze(i){if(i=i.split("=")[0],i=i.trim().replace(be,""),i.length<2)return"";for(;i.length%4!==0;)i=i+"=";return i}function De(i,r){r=r||1/0;let c;const m=i.length;let k=null;const R=[];for(let C=0;C<m;++C){if(c=i.charCodeAt(C),c>55295&&c<57344){if(!k){if(c>56319){(r-=3)>-1&&R.push(239,191,189);continue}else if(C+1===m){(r-=3)>-1&&R.push(239,191,189);continue}k=c;continue}if(c<56320){(r-=3)>-1&&R.push(239,191,189),k=c;continue}c=(k-55296<<10|c-56320)+65536}else k&&(r-=3)>-1&&R.push(239,191,189);if(k=null,c<128){if((r-=1)<0)break;R.push(c)}else if(c<2048){if((r-=2)<0)break;R.push(c>>6|192,c&63|128)}else if(c<65536){if((r-=3)<0)break;R.push(c>>12|224,c>>6&63|128,c&63|128)}else if(c<1114112){if((r-=4)<0)break;R.push(c>>18|240,c>>12&63|128,c>>6&63|128,c&63|128)}else throw new Error("Invalid code point")}return R}function Ee(i){const r=[];for(let c=0;c<i.length;++c)r.push(i.charCodeAt(c)&255);return r}function Pe(i,r){let c,m,k;const R=[];for(let C=0;C<i.length&&!((r-=2)<0);++C)c=i.charCodeAt(C),m=c>>8,k=c%256,R.push(k),R.push(m);return R}function Ue(i){return e.toByteArray(ze(i))}function Re(i,r,c,m){let k;for(k=0;k<m&&!(k+c>=r.length||k>=i.length);++k)r[k+c]=i[k];return k}function he(i,r){return i instanceof r||i!=null&&i.constructor!=null&&i.constructor.name!=null&&i.constructor.name===r.name}function re(i){return i!==i}const xe=(function(){const i="0123456789abcdef",r=new Array(256);for(let c=0;c<16;++c){const m=c*16;for(let k=0;k<16;++k)r[m+k]=i[c]+i[k]}return r})();function oe(i){return typeof BigInt>"u"?O:i}function O(){throw new Error("BigInt not supported")}})(Ot)),Ot}var lt=ln();const xi=class Je{constructor(){d(this,"key",null),d(this,"awsS3Service",new nn)}async encrypt(e){const t=JSON.stringify(e),n=await this.getKey(),a=window.crypto.getRandomValues(new Uint8Array(Je.GCM_IV_LENGTH)),l=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a},n,new TextEncoder().encode(t)),h=new Uint8Array([...a,...new Uint8Array(l)]);return lt.Buffer.from(h).toString("base64")}async decrypt(e){try{const t=await this.getKey(),n=new Uint8Array(lt.Buffer.from(e,"base64")),a=n.slice(0,Je.GCM_IV_LENGTH),l=n.slice(Je.GCM_IV_LENGTH),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:a},t,l);return new TextDecoder().decode(h)}catch(t){return console.error("Decryption error:",t),null}}async getKey(){if(!this.key)try{const e=await this.awsS3Service.getDataFromS3("fda-app-secure-store","aesKey.json"),t=lt.Buffer.from(e.key,"base64");this.key=await window.crypto.subtle.importKey("raw",t,{name:"AES-GCM"},!1,["encrypt","decrypt"])}catch(e){throw new Error(`Key retrieval failed: ${e}`)}return this.key}};d(xi,"GCM_IV_LENGTH",12);let wt=xi;const cn=15,hn={development:!0,serverHost:"http://localhost:5000",endPoints:{getHealth:"/api/v2/get_health",sendHealthReport:void 0},coldStartDuration:0,schemaVersion:"1.4",encrypted:!1},dn={development:!0,serverHost:"http://localhost:5000",endPoints:{getHealth:"/vitals-v2/get-health",sendHealthReport:void 0},coldStartDuration:0,schemaVersion:"2.1",encrypted:!0},un={development:!0,serverHost:"https://backend.panoptic.ai",endPoints:{getHealth:"/v2/dev/get-health",sendHealthReport:"/email/dev"},coldStartDuration:25,schemaVersion:"1.2",encrypted:!1},gn={development:!1,serverHost:"https://backend.panoptic.ai",endPoints:{getHealth:"/v2/get-health",sendHealthReport:"/email"},coldStartDuration:25,schemaVersion:"1.2",encrypted:!1},fn={development:!0,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/v2/dev/get-health",sendHealthReport:"/email/dev"},coldStartDuration:25,schemaVersion:"1.4",encrypted:!1},ki={development:!1,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/v2/get-health",sendHealthReport:"/email"},coldStartDuration:25,schemaVersion:"1.4",encrypted:!1},mn={development:!1,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/v2/get-health-company",sendHealthReport:"/email"},coldStartDuration:25,schemaVersion:"1.2",encrypted:!1},pn={development:!0,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/v2/dev/get-health-company",sendHealthReport:"/email/dev"},coldStartDuration:25,schemaVersion:"1.5",encrypted:!1},vn={development:!1,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/v2/get-health-company",sendHealthReport:"/email"},coldStartDuration:25,schemaVersion:"1.5",encrypted:!1},wn={development:!0,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/vitals-v2-dev/get-health",sendHealthReport:void 0},coldStartDuration:25,schemaVersion:"2.2",encrypted:!0},yn={development:!1,serverHost:"https://aws-backend.panoptic.ai",endPoints:{getHealth:"/vitals-v2/get-health",sendHealthReport:void 0},coldStartDuration:25,schemaVersion:"2.2",encrypted:!0};class Vt{constructor(e){d(this,"windowDuration",cn),d(this,"deviceId",Rt()),d(this,"config",ki),d(this,"apiKey"),d(this,"aesCryptor"),d(this,"httpCall",(...t)=>fetch(...t)),this.config=e}setServerUrl(e){this.config.serverHost=e}getUrl(){return this.config.serverHost+this.config.endPoints.getHealth}get httpHeaders(){const e={"Content-Type":"application/json"};return this.apiKey&&(e["X-Api-Key"]=this.apiKey),e}async wakeUpServer(){const e=this.getUrl();this.aesCryptor=new wt;let t={isAlive:!0};this.config.encrypted&&(t={data:await this.aesCryptor.encrypt(t)}),await this.httpCall(e,{method:"POST",headers:this.httpHeaders,body:JSON.stringify(t)})}async callAPI(e,t){this.aesCryptor=new wt;let n=t;this.config.encrypted&&(n={data:await this.aesCryptor.encrypt(t)});const a=await this.httpCall(e,{method:"POST",headers:this.httpHeaders,body:JSON.stringify(n)});if(a.status!=200){const h=await a.text();throw new Error(`Error: ${a.status} ${h}`)}let l=await a.json();if(this.config.encrypted){const h=await this.aesCryptor.decrypt(l.data);h&&(l=JSON.parse(h))}return l}getUrlSES(){return this.config.serverHost+this.config.endPoints.sendHealthReport}async sendHealthReport(e,t,n,a){const l=this.getUrlSES(),h={type:"attachment",params:{Recipients:e,EmailContent:n.emailContent,EmailSubject:n.emailSubject,FileName:n.fileName,Attachments:t,Source:a}},o=await this.httpCall(l,{method:"POST",headers:this.httpHeaders,body:JSON.stringify(h)});if(o.status!=200)throw new Error(o.statusText);return o.json()}}var et={exports:{}},bn=et.exports,Ht;function xn(){return Ht||(Ht=1,(function(s,e){(function(t,n){var a="1.0.39",l="",h="?",o="function",f="undefined",p="object",x="string",S="major",y="model",w="name",b="type",u="vendor",g="version",D="architecture",E="console",v="mobile",M="tablet",F="smarttv",T="wearable",P="embedded",A=500,j="Amazon",U="Apple",H="ASUS",G="BlackBerry",X="Browser",W="Chrome",Z="Edge",ue="Firefox",ge="Google",V="Huawei",N="LG",L="Microsoft",B="Motorola",_="Opera",le="Samsung",z="Sharp",ce="Sony",se="Xiaomi",we="Zebra",fe="Facebook",Te="Chromium OS",Be="Mac OS",$e=" Browser",_e=function(O,i){var r={};for(var c in O)i[c]&&i[c].length%2===0?r[c]=i[c].concat(O[c]):r[c]=O[c];return r},pe=function(O){for(var i={},r=0;r<O.length;r++)i[O[r].toUpperCase()]=O[r];return i},ye=function(O,i){return typeof O===x?be(i).indexOf(be(O))!==-1:!1},be=function(O){return O.toLowerCase()},ze=function(O){return typeof O===x?O.replace(/[^\d\.]/g,l).split(".")[0]:n},De=function(O,i){if(typeof O===x)return O=O.replace(/^\s\s*/,l),typeof i===f?O:O.substring(0,A)},Ee=function(O,i){for(var r=0,c,m,k,R,C,$;r<i.length&&!C;){var J=i[r],Q=i[r+1];for(c=m=0;c<J.length&&!C&&J[c];)if(C=J[c++].exec(O),C)for(k=0;k<Q.length;k++)$=C[++m],R=Q[k],typeof R===p&&R.length>0?R.length===2?typeof R[1]==o?this[R[0]]=R[1].call(this,$):this[R[0]]=R[1]:R.length===3?typeof R[1]===o&&!(R[1].exec&&R[1].test)?this[R[0]]=$?R[1].call(this,$,R[2]):n:this[R[0]]=$?$.replace(R[1],R[2]):n:R.length===4&&(this[R[0]]=$?R[3].call(this,$.replace(R[1],R[2])):n):this[R]=$||n;r+=2}},Pe=function(O,i){for(var r in i)if(typeof i[r]===p&&i[r].length>0){for(var c=0;c<i[r].length;c++)if(ye(i[r][c],O))return r===h?n:r}else if(ye(i[r],O))return r===h?n:r;return i.hasOwnProperty("*")?i["*"]:O},Ue={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},Re={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},he={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[w,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[w,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[w,g],[/opios[\/ ]+([\w\.]+)/i],[g,[w,_+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[g,[w,_+" GX"]],[/\bopr\/([\w\.]+)/i],[g,[w,_]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[g,[w,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[w,g],[/quark(?:pc)?\/([-\w\.]+)/i],[g,[w,"Quark"]],[/\bddg\/([\w\.]+)/i],[g,[w,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[w,"UC"+X]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[g,[w,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[w,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[w,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[g,[w,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[g,[w,"Smart Lenovo "+X]],[/(avast|avg)\/([\w\.]+)/i],[[w,/(.+)/,"$1 Secure "+X],g],[/\bfocus\/([\w\.]+)/i],[g,[w,ue+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[w,_+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[w,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[w,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[w,_+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[w,"MIUI "+X]],[/fxios\/([-\w\.]+)/i],[g,[w,ue]],[/\bqihu|(qi?ho?o?|360)browser/i],[[w,"360"+$e]],[/\b(qq)\/([\w\.]+)/i],[[w,/(.+)/,"$1Browser"],g],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[w,/(.+)/,"$1"+$e],g],[/samsungbrowser\/([\w\.]+)/i],[g,[w,le+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[w,/_/g," "],g],[/metasr[\/ ]?([\d\.]+)/i],[g,[w,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[w,"Sogou Mobile"],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[w,g],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[w],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[w,fe],g],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[w,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[w,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[g,[w,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[w,W+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[w,W+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[w,"Android "+X]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[w,g],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[g,[w,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[g,w],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[w,[g,Pe,Ue]],[/(webkit|khtml)\/([\w\.]+)/i],[w,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[w,"Netscape"],g],[/(wolvic)\/([\w\.]+)/i],[w,g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[w,ue+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[w,[g,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[w,[g,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[D,"amd64"]],[/(ia32(?=;))/i],[[D,be]],[/((?:i[346]|x)86)[;\)]/i],[[D,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[D,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[D,"armhf"]],[/windows (ce|mobile); ppc;/i],[[D,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[D,/ower/,l,be]],[/(sun4\w)[;\)]/i],[[D,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[D,be]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[y,[u,le],[b,M]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[y,[u,le],[b,v]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[y,[u,U],[b,v]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[y,[u,U],[b,M]],[/(macintosh);/i],[y,[u,U]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[y,[u,z],[b,v]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[y,[u,V],[b,M]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[y,[u,V],[b,v]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[y,/_/g," "],[u,se],[b,v]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[y,/_/g," "],[u,se],[b,M]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[y,[u,"OPPO"],[b,v]],[/\b(opd2\d{3}a?) bui/i],[y,[u,"OPPO"],[b,M]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[y,[u,"Vivo"],[b,v]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[y,[u,"Realme"],[b,v]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[y,[u,B],[b,v]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[y,[u,B],[b,M]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[y,[u,N],[b,M]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[y,[u,N],[b,v]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[y,[u,"Lenovo"],[b,M]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[y,/_/g," "],[u,"Nokia"],[b,v]],[/(pixel c)\b/i],[y,[u,ge],[b,M]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[y,[u,ge],[b,v]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[y,[u,ce],[b,v]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[y,"Xperia Tablet"],[u,ce],[b,M]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[y,[u,"OnePlus"],[b,v]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[y,[u,j],[b,M]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[y,/(.+)/g,"Fire Phone $1"],[u,j],[b,v]],[/(playbook);[-\w\),; ]+(rim)/i],[y,u,[b,M]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[y,[u,G],[b,v]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[y,[u,H],[b,M]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[y,[u,H],[b,v]],[/(nexus 9)/i],[y,[u,"HTC"],[b,M]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[u,[y,/_/g," "],[b,v]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[y,[u,"TCL"],[b,M]],[/(itel) ((\w+))/i],[[u,be],y,[b,Pe,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[y,[u,"Acer"],[b,M]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[y,[u,"Meizu"],[b,v]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[y,[u,"Ulefone"],[b,v]],[/droid.+; (a(?:015|06[35]|142p?))/i],[y,[u,"Nothing"],[b,v]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[u,y,[b,v]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[u,y,[b,M]],[/(surface duo)/i],[y,[u,L],[b,M]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[y,[u,"Fairphone"],[b,v]],[/(u304aa)/i],[y,[u,"AT&T"],[b,v]],[/\bsie-(\w*)/i],[y,[u,"Siemens"],[b,v]],[/\b(rct\w+) b/i],[y,[u,"RCA"],[b,M]],[/\b(venue[\d ]{2,7}) b/i],[y,[u,"Dell"],[b,M]],[/\b(q(?:mv|ta)\w+) b/i],[y,[u,"Verizon"],[b,M]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[y,[u,"Barnes & Noble"],[b,M]],[/\b(tm\d{3}\w+) b/i],[y,[u,"NuVision"],[b,M]],[/\b(k88) b/i],[y,[u,"ZTE"],[b,M]],[/\b(nx\d{3}j) b/i],[y,[u,"ZTE"],[b,v]],[/\b(gen\d{3}) b.+49h/i],[y,[u,"Swiss"],[b,v]],[/\b(zur\d{3}) b/i],[y,[u,"Swiss"],[b,M]],[/\b((zeki)?tb.*\b) b/i],[y,[u,"Zeki"],[b,M]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[u,"Dragon Touch"],y,[b,M]],[/\b(ns-?\w{0,9}) b/i],[y,[u,"Insignia"],[b,M]],[/\b((nxa|next)-?\w{0,9}) b/i],[y,[u,"NextBook"],[b,M]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[u,"Voice"],y,[b,v]],[/\b(lvtel\-)?(v1[12]) b/i],[[u,"LvTel"],y,[b,v]],[/\b(ph-1) /i],[y,[u,"Essential"],[b,v]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[y,[u,"Envizen"],[b,M]],[/\b(trio[-\w\. ]+) b/i],[y,[u,"MachSpeed"],[b,M]],[/\btu_(1491) b/i],[y,[u,"Rotor"],[b,M]],[/(shield[\w ]+) b/i],[y,[u,"Nvidia"],[b,M]],[/(sprint) (\w+)/i],[u,y,[b,v]],[/(kin\.[onetw]{3})/i],[[y,/\./g," "],[u,L],[b,v]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[y,[u,we],[b,M]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[y,[u,we],[b,v]],[/smart-tv.+(samsung)/i],[u,[b,F]],[/hbbtv.+maple;(\d+)/i],[[y,/^/,"SmartTV"],[u,le],[b,F]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[u,N],[b,F]],[/(apple) ?tv/i],[u,[y,U+" TV"],[b,F]],[/crkey/i],[[y,W+"cast"],[u,ge],[b,F]],[/droid.+aft(\w+)( bui|\))/i],[y,[u,j],[b,F]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[y,[u,z],[b,F]],[/(bravia[\w ]+)( bui|\))/i],[y,[u,ce],[b,F]],[/(mitv-\w{5}) bui/i],[y,[u,se],[b,F]],[/Hbbtv.*(technisat) (.*);/i],[u,y,[b,F]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[u,De],[y,De],[b,F]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[b,F]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[u,y,[b,E]],[/droid.+; (shield) bui/i],[y,[u,"Nvidia"],[b,E]],[/(playstation [345portablevi]+)/i],[y,[u,ce],[b,E]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[y,[u,L],[b,E]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[y,[u,le],[b,T]],[/((pebble))app/i],[u,y,[b,T]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[y,[u,U],[b,T]],[/droid.+; (glass) \d/i],[y,[u,ge],[b,T]],[/droid.+; (wt63?0{2,3})\)/i],[y,[u,we],[b,T]],[/(quest( \d| pro)?)/i],[y,[u,fe],[b,T]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[u,[b,P]],[/(aeobc)\b/i],[y,[u,j],[b,P]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[y,[b,v]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[y,[b,M]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[b,M]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[b,v]],[/(android[-\w\. ]{0,9});.+buil/i],[y,[u,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[w,Z+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[w,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[w,g],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,w]],os:[[/microsoft (windows) (vista|xp)/i],[w,g],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[w,[g,Pe,Re]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[g,Pe,Re],[w,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[w,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[w,Be],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[g,w],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[w,g],[/\(bb(10);/i],[g,[w,G]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[g,[w,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[w,ue+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[w,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[g,[w,"watchOS"]],[/crkey\/([\d\.]+)/i],[g,[w,W+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[w,Te],g],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[w,g],[/(sunos) ?([\w\.\d]*)/i],[[w,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[w,g]]},re=function(O,i){if(typeof O===p&&(i=O,O=n),!(this instanceof re))return new re(O,i).getResult();var r=typeof t!==f&&t.navigator?t.navigator:n,c=O||(r&&r.userAgent?r.userAgent:l),m=r&&r.userAgentData?r.userAgentData:n,k=i?_e(he,i):he,R=r&&r.userAgent==c;return this.getBrowser=function(){var C={};return C[w]=n,C[g]=n,Ee.call(C,c,k.browser),C[S]=ze(C[g]),R&&r&&r.brave&&typeof r.brave.isBrave==o&&(C[w]="Brave"),C},this.getCPU=function(){var C={};return C[D]=n,Ee.call(C,c,k.cpu),C},this.getDevice=function(){var C={};return C[u]=n,C[y]=n,C[b]=n,Ee.call(C,c,k.device),R&&!C[b]&&m&&m.mobile&&(C[b]=v),R&&C[y]=="Macintosh"&&r&&typeof r.standalone!==f&&r.maxTouchPoints&&r.maxTouchPoints>2&&(C[y]="iPad",C[b]=M),C},this.getEngine=function(){var C={};return C[w]=n,C[g]=n,Ee.call(C,c,k.engine),C},this.getOS=function(){var C={};return C[w]=n,C[g]=n,Ee.call(C,c,k.os),R&&!C[w]&&m&&m.platform&&m.platform!="Unknown"&&(C[w]=m.platform.replace(/chrome os/i,Te).replace(/macos/i,Be)),C},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return c},this.setUA=function(C){return c=typeof C===x&&C.length>A?De(C,A):C,this},this.setUA(c),this};re.VERSION=a,re.BROWSER=pe([w,g,S]),re.CPU=pe([D]),re.DEVICE=pe([y,u,b,E,v,F,M,T,P]),re.ENGINE=re.OS=pe([w,g]),s.exports&&(e=s.exports=re),e.UAParser=re;var xe=typeof t!==f&&(t.jQuery||t.Zepto);if(xe&&!xe.ua){var oe=new re;xe.ua=oe.getResult(),xe.ua.get=function(){return oe.getUA()},xe.ua.set=function(O){oe.setUA(O);var i=oe.getResult();for(var r in i)xe.ua[r]=i[r]}}})(typeof window=="object"?window:bn)})(et,et.exports)),et.exports}var kn=xn();const yt=(s,e)=>e.some(t=>s instanceof t);let Wt,Nt;function Sn(){return Wt||(Wt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Dn(){return Nt||(Nt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const bt=new WeakMap,ct=new WeakMap,nt=new WeakMap;function En(s){const e=new Promise((t,n)=>{const a=()=>{s.removeEventListener("success",l),s.removeEventListener("error",h)},l=()=>{t(Le(s.result)),a()},h=()=>{n(s.error),a()};s.addEventListener("success",l),s.addEventListener("error",h)});return nt.set(e,s),e}function Rn(s){if(bt.has(s))return;const e=new Promise((t,n)=>{const a=()=>{s.removeEventListener("complete",l),s.removeEventListener("error",h),s.removeEventListener("abort",h)},l=()=>{t(),a()},h=()=>{n(s.error||new DOMException("AbortError","AbortError")),a()};s.addEventListener("complete",l),s.addEventListener("error",h),s.addEventListener("abort",h)});bt.set(s,e)}let xt={get(s,e,t){if(s instanceof IDBTransaction){if(e==="done")return bt.get(s);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Le(s[e])},set(s,e,t){return s[e]=t,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function Si(s){xt=s(xt)}function Cn(s){return Dn().includes(s)?function(...e){return s.apply(kt(this),e),Le(this.request)}:function(...e){return Le(s.apply(kt(this),e))}}function Mn(s){return typeof s=="function"?Cn(s):(s instanceof IDBTransaction&&Rn(s),yt(s,Sn())?new Proxy(s,xt):s)}function Le(s){if(s instanceof IDBRequest)return En(s);if(ct.has(s))return ct.get(s);const e=Mn(s);return e!==s&&(ct.set(s,e),nt.set(e,s)),e}const kt=s=>nt.get(s);function Tn(s,e,{blocked:t,upgrade:n,blocking:a,terminated:l}={}){const h=indexedDB.open(s,e),o=Le(h);return n&&h.addEventListener("upgradeneeded",f=>{n(Le(h.result),f.oldVersion,f.newVersion,Le(h.transaction),f)}),t&&h.addEventListener("blocked",f=>t(f.oldVersion,f.newVersion,f)),o.then(f=>{l&&f.addEventListener("close",()=>l()),a&&f.addEventListener("versionchange",p=>a(p.oldVersion,p.newVersion,p))}).catch(()=>{}),o}const Pn=["get","getKey","getAll","getAllKeys","count"],Fn=["put","add","delete","clear"],ht=new Map;function zt(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(ht.get(e))return ht.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,a=Fn.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(a||Pn.includes(t)))return;const l=async function(h,...o){const f=this.transaction(h,a?"readwrite":"readonly");let p=f.store;return n&&(p=p.index(o.shift())),(await Promise.all([p[t](...o),a&&f.done]))[0]};return ht.set(e,l),l}Si(s=>({...s,get:(e,t,n)=>zt(e,t)||s.get(e,t,n),has:(e,t)=>!!zt(e,t)||s.has(e,t)}));const An=["continue","continuePrimaryKey","advance"],jt={},St=new WeakMap,Di=new WeakMap,In={get(s,e){if(!An.includes(e))return s[e];let t=jt[e];return t||(t=jt[e]=function(...n){St.set(this,Di.get(this)[e](...n))}),t}};async function*Bn(...s){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...s)),!e)return;e=e;const t=new Proxy(e,In);for(Di.set(t,e),nt.set(t,kt(e));e;)yield t,e=await(St.get(t)||e.continue()),St.delete(t)}function qt(s,e){return e===Symbol.asyncIterator&&yt(s,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&yt(s,[IDBIndex,IDBObjectStore])}Si(s=>({...s,get(e,t,n){return qt(e,t)?Bn:s.get(e,t,n)},has(e,t){return qt(e,t)||s.has(e,t)}}));async function _n(s){const e=JSON.parse(s);if(!e)return;if(e.userInfo)return e;if(!e.data)return;const t=await new wt().decrypt(e.data);if(!t)return;const n=JSON.parse(t);if(!(!n||!n.userInfo))return n}async function On(s,e){const t=e?.body;if(typeof t!="string")return!1;const n=await _n(t);return n?(console.log("[Request Saver] Saving request",n),(await Tn("ai.panoptic.request")).transaction("requests","readwrite").objectStore("requests").put({id:1,url:s,request:e}),!0):!1}function Ln(s=fetch){return async(e,t)=>{try{await On(e,t)}catch(n){console.error("[Request Saver] ",n)}return s(e,t)}}function Ei(s){let e=0,t=0,n=0,a=0;for(let f=0;f<s.height;f++)for(let p=0;p<s.width;p++){let x=p*f*4,S=s.data[x],y=s.data[x+1],w=s.data[x+2];(S!==0||y!==0||w!==0)&&(e+=S,t+=y,n+=w,a++)}if(a===0)return;const l=e/a,h=t/a,o=n/a;if(!(isNaN(l)||isNaN(h)||isNaN(o)))return[l,h,o]}function $n(s,e){if(s===void 0)return;const{data:t,width:n,height:a}=s,l=[],h=[];for(let o=0;o<e;o++)for(let f=0;f<e;f++){const p=Math.floor(f*n/e),x=Math.min(Math.floor((f+1)*n/e),n),S=Math.floor(o*a/e),y=Math.min(Math.floor((o+1)*a/e),a);h.push({startX:p,endX:x,startY:S,endY:y})}for(const o of h){const{startX:f,endX:p,startY:x,endY:S}=o,y=p-f,w=S-x,b=y*w;if(b===0){const F=(x*n+f)*4;l.push([t[F],t[F+1],t[F+2]]);continue}let u=0,g=0,D=0;for(let F=x;F<S;F++){const T=(F*n+f)*4,P=(F*n+p)*4;for(let A=T;A<P;A+=4)u+=t[A],g+=t[A+1],D+=t[A+2]}const E=u/b,v=g/b,M=D/b;l.push([E,v,M])}return l}function Un(s,e){if(s===void 0)return;const{data:t,width:n,height:a}=s,l=[],h=[];for(let o=0;o<e;o++)for(let f=0;f<e;f++){const p=Math.floor(f*n/e),x=Math.min(Math.floor((f+1)*n/e),n),S=Math.floor(o*a/e),y=Math.min(Math.floor((o+1)*a/e),a);h.push({startX:p,endX:x,startY:S,endY:y})}for(const o of h){const{startX:f,endX:p,startY:x,endY:S}=o,y=p-f,w=S-x,b=y*w;if(b===0){const F=(x*n+f)*4,T=t[F],P=t[F+1],A=t[F+2],[j,U,H]=Gt(T,P,A);l.push([j,U,H]);continue}let u=0,g=0,D=0;for(let F=x;F<S;F++)for(let T=f;T<p;T++){const P=(F*n+T)*4,A=t[P],j=t[P+1],U=t[P+2],[H,G,X]=Gt(A,j,U);u+=H,g+=G,D+=X}const E=u/b,v=g/b,M=D/b;l.push([E,v,M])}return l}function Gt(s,e,t){const n=.299*s+.587*e+.114*t,a=-.14713*s-.28886*e+.436*t,l=.615*s-.51499*e-.10001*t;return[n,a,l]}async function Qt(s){return Promise.all(s.map(Vn))}async function Vn(s){const e={};for(const t in s.pixels)e[t]={type:s.pixels[t].type,pixels:await s.pixels[t].pixels};return{...s,pixels:e}}const Hn=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,Yt=s=>{if(typeof s!="string")throw new TypeError("Invalid argument expected string");const e=s.match(Hn);if(!e)throw new Error(`Invalid argument not valid semver ('${s}' received)`);return e.shift(),e},Kt=s=>s==="*"||s==="x"||s==="X",Xt=s=>{const e=parseInt(s,10);return isNaN(e)?s:e},Wn=(s,e)=>typeof s!=typeof e?[String(s),String(e)]:[s,e],Nn=(s,e)=>{if(Kt(s)||Kt(e))return 0;const[t,n]=Wn(Xt(s),Xt(e));return t>n?1:t<n?-1:0},Zt=(s,e)=>{for(let t=0;t<Math.max(s.length,e.length);t++){const n=Nn(s[t]||"0",e[t]||"0");if(n!==0)return n}return 0},We=(s,e)=>{const t=Yt(s),n=Yt(e),a=t.pop(),l=n.pop(),h=Zt(t,n);return h!==0?h:a&&l?Zt(a.split("."),l.split(".")):a||l?a?-1:1:0},Ri=15,Dt=new Map([[ie.Local,hn],[ie.LocalV2,dn],[ie.RemoteDev,un],[ie.RemoteProd,gn],[ie.AwsDev,fn],[ie.AwsProd,ki],[ie.RemoteProdEnterprise,mn],[ie.AwsDevEnterprise,pn],[ie.AwsProdEnterprise,vn],[ie.Schema2Dev,wn],[ie.Schema2Prod,yn]]);class Jt{constructor(e){d(this,"wakeUpRequestTime"),d(this,"serverAwaken",!1),d(this,"scanId"),d(this,"client"),d(this,"cfg",{serverId:ie.RemoteProd,dataWindowDuration:Ri}),this.client=new Vt(Dt.get(ie.AwsProd)),e.dataWindowDuration&&(K("Configure dataWindowDuration: "+e.dataWindowDuration),this.client.windowDuration=e.dataWindowDuration),e.serverId!==void 0&&(K("Configure serverId: "+e.serverId),this.client=new Vt(Dt.get(e.serverId)),this.client.apiKey=this.cfg.apiKey),e.serverUrl&&(K("Configure serverUrl: "+e.serverUrl),this.client.setServerUrl(e.serverUrl)),e.apiKey&&(K("Configure apiKey: "+_s(e.apiKey)),this.cfg.apiKey=e.apiKey,this.client.apiKey=this.cfg.apiKey),e.httpCall&&(K("Configure httpCall"),this.client.httpCall=e.httpCall),e.enableSavingRequest&&(K("Configure enableSavingRequest"),this.client.httpCall=Ln(this.client.httpCall)),e.landmarksSampleRate!==void 0&&(K("Configure landmarksSampleRate: "+e.landmarksSampleRate),this.cfg.landmarksSampleRate=e.landmarksSampleRate)}get readyTime(){return this.client.config.coldStartDuration-this.client.windowDuration}get _isReady(){return this.wakeUpRequestTime===void 0?!1:this.serverAwaken?!0:(new Date().getTime()-this.wakeUpRequestTime)/1e3>this.readyTime}userInfo(e){const t={},n=e;return Object.keys(n).forEach(a=>{n[a]!==void 0&&(t[a]=n[a])}),t}async _wakeUpServer(){let e=new Date().getTime();return this.serverAwaken=!1,this.wakeUpRequestTime=new Date().getTime(),K("Wake up server now..."),new Promise((t,n)=>{this.client.wakeUpServer().then(()=>{this.serverAwaken=!0,t()}).catch(a=>{this.serverAwaken=!1,n(a)}).finally(()=>{let a=new Date().getTime()-e;K("Wake up time: ",a)})})}async wakeUpServer(){return this.wakeUpRequestTime!==void 0?this._waitUntilReady():this._wakeUpServer()}isReadySync(){return this._isReady}async isReady(){if(this._isReady)return!0;let e=Bs(.5,"timeout");return Promise.race([e,this.waitUntilReady()]).then(t=>t!=="timeout")}async _waitUntilReady(){return new Promise(e=>{let t=setInterval(()=>{this._isReady&&(clearInterval(t),e())},200)})}async waitUntilReady(){return this.wakeUpRequestTime==null&&this.wakeUpServer(),this._waitUntilReady()}begin(){return this.scanId=Rt(),this._wakeUpServer().catch(e=>console.log(e)),Promise.resolve()}async analyze(e,t,n){var a;const l=(a=e[0].pixels.face)==null?void 0:a.type;if(We(this.client.config.schemaVersion,"2")>0)var h=await this.getHealthV2(e,t,n);else if(l=="rgb1x1")h=await this.getHealthRgb1x1(await Qt(e),t);else throw new Error("Unsupported pixel Size");return this.parseHealthFromJson(h)}async getHealthRgb1x1(e,t){const n=this.client.getUrl(),a=e.filter(x=>{var S;return(S=x.pixels.face)==null?void 0:S.pixels}).map(x=>{var S;return(S=x.pixels.face)==null?void 0:S.pixels[0][0]}),l=e.filter(x=>{var S;return(S=x.pixels.face)==null?void 0:S.pixels}).map(x=>{var S;return(S=x.pixels.face)==null?void 0:S.pixels[0][1]}),h=e.filter(x=>{var S;return(S=x.pixels.face)==null?void 0:S.pixels}).map(x=>{var S;return(S=x.pixels.face)==null?void 0:S.pixels[0][2]}),o=e.map(x=>x.timestamp),f=e.filter(x=>{var S;return(S=x.pixels.chest)==null?void 0:S.pixels}).map(x=>{var S;return(S=x.pixels.chest)==null?void 0:S.pixels[0][0]}),p={r:a,g:l,b:h,timestamp:o,userInfo:this.userInfo(t),deviceId:this.client.deviceId,windowDuration:this.client.windowDuration,deviceType:"web"};return f!==void 0&&f.length>0?f.length>=l.length?(p.respPixels=f,p.version="1.3"):console.warn("[HttpEndpointsClient] Too few respiratory pixels. Falling back to schema 1.2."):console.warn("[HttpEndpointsClient] No respiratory pixels. Falling back to schema 1.2."),this.scanId!==void 0&&(p.scanId=this.scanId),await this.client.callAPI(n,p)}async getHealthV2(e,t,n){var a;const l=this.client.getUrl(),h=this.prepareDataV2(await Qt(e)),o=this.prepareDeviceInfo(),f={...h,pixelsFormat:(a=e[0].pixels.face)==null?void 0:a.type,userInfo:this.userInfo(t),deviceInfo:o,measurementMode:"Resting",faceDetectorOption:"mp-face-mesh",metadata:{requestTime:Date.now(),dev:this.client.config.development},videoFrameInfo:n};return this.scanId!==void 0&&(f.deviceInfo.scanId=this.scanId),await this.client.callAPI(l,f)}prepareDataV2(e){const t=[],n=[],a=[];let l="2.1";if(e.map(h=>{var o,f,p,x,S,y,w,b,u,g;const D=(o=h.pixels.face)==null?void 0:o.pixels;if(D){const M={values:D,timestamp:h.timestamp};(f=h.pixels.chin)!=null&&f.pixels&&(l="2.2",M.chin=(p=h.pixels.chin)==null?void 0:p.pixels),(x=h.pixels.leftCheek)!=null&&x.pixels&&(l="2.2",M.leftCheek=(S=h.pixels.leftCheek)==null?void 0:S.pixels),(y=h.pixels.rightCheek)!=null&&y.pixels&&(l="2.2",M.rightCheek=(w=h.pixels.rightCheek)==null?void 0:w.pixels),(b=h.pixels.glabella)!=null&&b.pixels&&(l="2.2",M.glabella=(u=h.pixels.glabella)==null?void 0:u.pixels),t.push(M)}const E=(g=h.pixels.chest)==null?void 0:g.pixels;E&&(E[0].length===1?n.push(this.mean(E)[0]):(l="2.3",E.length==1?n.push(E[0]):n.push(E)));const v=this.getLandmarksV2(h.landmarks);if(v){const M=h.facebox,F={bbox:[M.xCenter-M.width/2,M.yCenter-M.height/2,M.xCenter+M.width/2,M.yCenter+M.height/2],landmarks:v,timestamp:h.timestamp};a.push(F)}}),a.length>1&&this.cfg.landmarksSampleRate!==void 0){const h=this.cfg.landmarksSampleRate,o=a[a.length-1].timestamp-a[0].timestamp;if(a.length/o>h){const f=1/h,p=[];let x=a[0].timestamp;p.push(a[0]);for(let S=1;S<a.length;S++)a[S].timestamp-x>=f&&(p.push(a[S]),x=a[S].timestamp);a.length=0,a.push(...p)}}return{version:l,pixels:t,respPixels:n,facialMarkers:a.length==0?null:a}}getLandmarksV2(e){if(!e||e.length==0)return null;const t={};return[4,10,11,14,34,136,152,168,205,264,365,425].map(n=>{t[n]=[e[n].x,e[n].y],e[n].z!==void 0&&t[n].push(e[n].z)}),t}prepareDeviceInfo(){const{device:e}=kn.UAParser(navigator.userAgent);return{deviceId:this.client.deviceId,deviceBrand:e!=null&&e.vendor?e.vendor:"unknown",deviceModel:e!=null&&e.model?e.model:"unknown",deviceType:"web"}}mean(e){if(e.length===0)return[0,0,0];const t=e[0].length;return e.reduce((n,a)=>{for(let l=0;l<t;l++)n[l]+=a[l];return n},Array(t).fill(0)).map(n=>n/e.length)}end(){throw new Error("Method not implemented.")}reset(){this.serverAwaken=!1,this.wakeUpRequestTime=void 0,this.scanId=void 0}parseHealthFromJson(e){return K(e),We(this.client.config.schemaVersion,"2")>0?this.parseHealthV2(e):this.parseHealthV1(e)}parseHealthV1(e){let t=e.vital_signs,n=e.health_risks,a=e.holistic_health,l={datetime:new Date};if(a&&(l.holisticHealth={},a.general_wellness!==void 0&&(l.holisticHealth.generalWellness=a.general_wellness),a.bmi!==void 0&&(l.holisticHealth.bmi=a.bmi),a.hhe_version!==void 0&&(l.holisticHealth.version=a.hhe_version),a.absi!==void 0&&(l.holisticHealth.absi=a.absi),a.cardiac_workload!==void 0&&(l.holisticHealth.cardiacWorkload=a.cardiac_workload),a.pulse_respiratory_quotient!==void 0&&(l.holisticHealth.pulseRespiratoryQuotient=a.pulse_respiratory_quotient),a.waist_to_height_ratio!==void 0&&(l.holisticHealth.waistToHeightRatio=a.waist_to_height_ratio)),t["0_server"].scan_parameters!==void 0){let h=t["0_server"].scan_parameters,o={conditions:h.conditions!==void 0?h.conditions:void 0,invalidPixelPercentage:h.invalid_pixel_percentage!==void 0?h.invalid_pixel_percentage:void 0,signalDuration:h.signal_duration!==void 0?h.signal_duration:void 0,signalQuality:h.signal_quality!==void 0?h.signal_quality:void 0,snr:h.snr!==void 0?h.snr:void 0};l.scanParameters=o}return t&&(l.vitalSigns={heartRate:t.heart_rate,spo2:t.spo2,ibi:t.hrv_ibi},t.respiratory_rate!==void 0&&(l.vitalSigns.respiratoryRate=t.respiratory_rate),t.stress!==void 0&&(l.vitalSigns.stress=t.stress),t.stress_score!==void 0&&(l.vitalSigns.stressScore=t.stress_score),t.hrv_sdnn!==void 0&&(l.vitalSigns.hrvSdnn=t.hrv_sdnn),t.hrv_rmssd!==void 0&&(l.vitalSigns.hrvRmssd=t.hrv_rmssd),t.temperature!==void 0&&(l.vitalSigns.temperature=t.temperature),t.blood_pressure!==void 0&&(l.vitalSigns.bloodPressure=t.blood_pressure),t.blood_pressure_systolic!==void 0&&(l.vitalSigns.bloodPressureSystolic=t.blood_pressure_systolic),t.blood_pressure_diastolic!==void 0&&(l.vitalSigns.bloodPressureDiastolic=t.blood_pressure_diastolic),t.facial_skin_age!==void 0&&(l.vitalSigns.facialSkinAge=t.facial_skin_age),t.blood_alcohol!==void 0&&(l.vitalSigns.bloodAlcohol=t.blood_alcohol),t.blood_sugar!==void 0&&(l.vitalSigns.bloodSugar=t.blood_sugar),t["0_server"].version!==void 0&&(l.vitalSigns.version=t["0_server"].version)),n.cvd_risk_general!==void 0&&(l.risks==null&&(l.risks={}),l.risks.cardiovascularRisks={generalRisk:n.cvd_risk_general,coronaryHeartDisease:n.cvd_risk_CHD,congestiveHeartFailure:n.cvd_risk_CHF,intermittentClaudication:n.cvd_risk_IC,stroke:n.cvd_risk_Stroke}),n.covid_risk!==void 0&&(l.risks==null&&(l.risks={}),l.risks.covidRisk={covidRisk:n.covid_risk}),n.diabetesRisk!==void 0&&(l.risks==null&&(l.risks={}),l.risks.diabetesRisk=n.diabetesRisk),n.hypertensionRisk!==void 0&&(l.risks==null&&(l.risks={}),l.risks.hypertensionRisk=n.hypertensionRisk),n.cholesterolRisk!==void 0&&(l.risks==null&&(l.risks={}),l.risks.cholesterolRisk=n.cholesterolRisk),n.hre_version!==void 0&&l.risks&&(l.risks.version=n.hre_version),l}parseHealthV2(e){let t=e.vitalSigns,n=e.healthRisks,a=e.wellness,l=e.signalAnalysis,h=e.serverInfo,o={datetime:new Date};if(a&&(o.holisticHealth={},a.generalWellness!==void 0&&(o.holisticHealth.generalWellness=a.generalWellness),a.bmi!==void 0&&(o.holisticHealth.bmi=a.bmi),a.absi!==void 0&&(o.holisticHealth.absi=a.absi),a.absiz!==void 0&&(o.holisticHealth.absiz=a.absiz),a.cardiacWorkload!==void 0&&(o.holisticHealth.cardiacWorkload=a.cardiacWorkload),a.pulseRespiratoryQuotient!==void 0&&(o.holisticHealth.pulseRespiratoryQuotient=a.pulseRespiratoryQuotient),a.waistToHeightRatio!==void 0&&(o.holisticHealth.waistToHeightRatio=a.waistToHeightRatio),a.cardiovascularSystemWellness!==void 0&&(o.holisticHealth.cardiovascularSystemWellness=a.cardiovascularSystemWellness),a.mentalWellness!==void 0&&(o.holisticHealth.mentalWellness=a.mentalWellness),a.physicalWellness!==void 0&&(o.holisticHealth.physicalWellness=a.physicalWellness),a.respiratorySystemWellness!==void 0&&(o.holisticHealth.respiratorySystemWellness=a.respiratorySystemWellness)),t&&(o.vitalSigns={},t.heartRate!==void 0&&(o.vitalSigns.heartRate=t.heartRate),t.spo2!==void 0&&(o.vitalSigns.spo2=t.spo2),t.hrvIbi!==void 0&&(o.vitalSigns.ibi=t.hrvIbi),t.respiratoryRate!==void 0&&(o.vitalSigns.respiratoryRate=t.respiratoryRate),t.stress!==void 0&&(o.vitalSigns.stress=t.stress),t.stressScore!==void 0&&(o.vitalSigns.stressScore=t.stressScore),t.hrvSdnn!==void 0&&(o.vitalSigns.hrvSdnn=t.hrvSdnn),t.hrvRmssd!==void 0&&(o.vitalSigns.hrvRmssd=t.hrvRmssd),t.bloodPressure!==void 0&&(o.vitalSigns.bloodPressure=t.bloodPressure),t.bloodPressureSystolic!==void 0&&(o.vitalSigns.bloodPressureSystolic=t.bloodPressureSystolic),t.bloodPressureDiastolic!==void 0&&(o.vitalSigns.bloodPressureDiastolic=t.bloodPressureDiastolic),t.facialSkinAge!==void 0&&(o.vitalSigns.facialSkinAge=t.facialSkinAge)),n&&(o.risks={},n.cvdRiskGeneral!==void 0&&(o.risks.cardiovascularRisks={generalRisk:n.cvdRiskGeneral,coronaryHeartDisease:n.cvdRiskCHD,congestiveHeartFailure:n.cvdRiskCHF,intermittentClaudication:n.cvdRiskIC,stroke:n.cvdRiskStroke}),n.covidRisk!==void 0&&(o.risks.covidRisk={covidRisk:n.covidRisk}),n.diabetesRisk!==void 0&&(o.risks.diabetesRisk=n.diabetesRisk),n.hypertensionRisk!==void 0&&(o.risks.hypertensionRisk=n.hypertensionRisk),n.cholesterolRisk!==void 0&&(o.risks.cholesterolRisk=n.cholesterolRisk)),l){if(o.scanParameters={},l.signalConditions!==void 0){const f=l.signalConditions;o.scanParameters.signalConditions={noSpeedJitter:f.noSpeedJitter,goodAverageSpeed:f.goodAverageSpeed,fixedHeadPosition:f.fixedHeadPosition,noHeadTurning:f.noHeadTurning,adequateBrightness:f.adequateBrightness,evenLightingOnFace:f.evenLightingOnFace,goodSnr:f.goodSnr,signalSteadiness:f.signalSteadiness,goodSignalPercentage:f.goodSignalPercentage,hrSteadiness:f.hrSteadiness,hrSignalQuality:f.hrSignalQuality,rrSignalQuality:f.rrSignalQuality,bpSignalQuality:f.bpSignalQuality}}l.signalDuration!==void 0&&(o.scanParameters.signalDuration=l.signalDuration),l.signalQuality!==void 0&&(o.scanParameters.signalQuality=l.signalQuality),l.snr!==void 0&&(o.scanParameters.snr=l.snr),l.warning!==void 0&&(o.scanParameters.warning=l.warning)}return h&&(o.serverInfo={userPlan:h.userPlan,userId:h.userId},h.datetime!==void 0&&(o.serverInfo.datetime=h.datetime),h.datetimeStr!==void 0&&(o.serverInfo.datetimeStr=h.datetimeStr),h.elapse!==void 0&&(o.serverInfo.elapse=h.elapse),h.version!==void 0&&(o.serverInfo.version=h.version),h.errorCode!==void 0&&(o.serverInfo.errorCode=h.datetime)),o}}class zn{constructor(e,t,n,a,l=navigator.hardwareConcurrency*2,h){d(this,"workerManagers",[]),d(this,"createWorker"),d(this,"workerName"),d(this,"timeout"),d(this,"workerCount"),d(this,"onCreated"),d(this,"workerFunction"),d(this,"isEnabled",!0),this.onCreated=h,this.createWorker=e,this.workerName=n,this.timeout=a,this.workerCount=l,this.workerFunction=t,this.onCreated=h,this.isEnabled&&this.newWorker()}async newWorker(){const e=this.createWorker(),t=new jn(e,this.workerName,this.timeout);return this.onCreated&&await this.onCreated(t),this.workerManagers.push(t),t}async callWorker(e,t){if(!this.isEnabled&&this.workerFunction)return this.workerFunction(e);const n=this.workerManagers.find(a=>!a.isBusy);return n?n.callWorker(e,t):this.workerManagers.length<this.workerCount?(await this.newWorker()).callWorker(e,t):Promise.reject(new Error(`${this.workerName}: All ${this.workerCount} workers are busy`))}get hasAvailableWorker(){return this.workerManagers.some(e=>!e.isBusy)||this.workerManagers.length<this.workerCount}terminateAll(){this.workerManagers.forEach(e=>e.terminate()),this.workerManagers=[]}}class jn{constructor(e,t,n){d(this,"timeout"),d(this,"worker"),d(this,"workerName"),d(this,"pendingPromises",{}),this.timeout=n||1e3,this.worker=e,this.workerName=t||"Worker",this.worker.onmessage=a=>{const{result:l,hash:h,error:o}=a.data,f=this.pendingPromises[h];f&&(clearTimeout(f.timer),o?f.reject(new Error(`Worker ${this.workerName} Error: ${o}`)):f.resolve(l),delete this.pendingPromises[h])},this.worker.onerror=a=>{for(const l in this.pendingPromises)clearTimeout(this.pendingPromises[l].timer),this.pendingPromises[l].reject(new Error(`Worker ${this.workerName} Error: ${a.message}`)),delete this.pendingPromises[l];console.error(`Worker ${t} error: ${a.message}`)}}get isBusy(){return Object.keys(this.pendingPromises).length>2}callWorker(e,t){const n=crypto.randomUUID();return new Promise((a,l)=>{const h=setTimeout(()=>{if(this.pendingPromises[n]){const p=Object.keys(this.pendingPromises).length;this.pendingPromises[n].reject(new Error(`Worker ${this.workerName} Timeout. ${p>1?`${p} pending promises.`:""}`))}delete this.pendingPromises[n]},this.timeout);this.pendingPromises[n]&&(clearTimeout(this.pendingPromises[n].timer),this.pendingPromises[n].reject(new Error(`Worker ${this.workerName} Duplicate hash: ${n}`)),delete this.pendingPromises[n]),this.pendingPromises[n]={resolve:a,reject:l,timer:h};const o=performance.now();this.worker.postMessage({inputData:e,hash:n},t);const f=performance.now()-o;f>5&&console.warn(`Worker ${this.workerName} postMessage took ${f} ms, which may cause frame drops.`)})}terminate(){this.worker.terminate();for(const e in this.pendingPromises)clearTimeout(this.pendingPromises[e].timer),this.pendingPromises[e].reject(new Error(`Worker ${this.workerName} terminated.`)),delete this.pendingPromises[e]}}const dt={};function me(s,e,t,n,a,l){return dt[t]||(dt[t]=new zn(s,e,t,n,a,l)),dt[t]}function rt(s){return Ei(s)}self.onmessage=s=>{const{inputData:e,hash:t}=s.data,n=rt(e);self.postMessage({result:n,hash:t})};class ut{constructor(){d(this,"dataType","ggg1x1"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/B5lsALhE-ppZ36LXi.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,rt,"Ggg1x1WorkerPool"))}async extract(e){const t=await e;if(!t)return;const n=await this.workerPool.callWorker(t);if(!(!n||n[1]===void 0))return[[n[1]]]}}function Ci(s){const e=Ei(s);if(!e)return null;const[t,n,a]=e,l=.299*t+.587*n+.114*a,h=-.14713*t-.28886*n+.436*a,o=.615*t-.51499*n-.10001*a;return[l,h,o]}self.onmessage=s=>{const{inputData:e,hash:t}=s.data,n=Ci(e);self.postMessage({result:n,hash:t})};class qn{constructor(){d(this,"dataType","yyy1x1"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/CXHLiYOT-BPLMuNyk.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Ci,"Yuv1x1WorkerPool"))}async extract(e){const t=await e;if(!t)return;const n=await this.workerPool.callWorker(t);if(n)return[[n[0]]]}}class gt{constructor(){d(this,"dataType","rgb1x1"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/B5lsALhE-ppZ36LXi.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,rt,"Rgb1x1WorkerPool"))}async extract(e){const t=await e;if(!t)return;const n=await this.workerPool.callWorker(t);if(n)return[n]}}function Ct(s){const{imageData:e,size:t}=s;return $n(e,t)}self.onmessage=s=>{const{inputData:e,hash:t}=s.data,n=Ct(e);self.postMessage({result:n,hash:t})};class Gn{constructor(){d(this,"dataType","rgb8x8"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BJ8tLFkU-CydYnlpG.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Ct,"Rgb8x8WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:8})}}class Qn{constructor(){d(this,"dataType","rgb32x32"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BJ8tLFkU-CydYnlpG.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Ct,"Rgb32x32WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:32})}}function qe(s){const{imageData:e,size:t}=s;return Un(e,t)}self.onmessage=s=>{const{inputData:e,hash:t}=s.data,n=qe(e);self.postMessage({result:n,hash:t})};class Yn{constructor(){d(this,"dataType","yuv8x8"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BQisuE9N-gDDR2tiQ.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,qe,"Yuv8x8WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:8})}}class Kn{constructor(){d(this,"dataType","yuv32x32"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BQisuE9N-gDDR2tiQ.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,qe,"Yuv32x32WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:32})}}class Xn{constructor(){d(this,"dataType","yuv64x64"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BQisuE9N-gDDR2tiQ.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,qe,"Yuv64x64WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:64})}}class Zn{constructor(){d(this,"dataType","yuv1x1"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BQisuE9N-gDDR2tiQ.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,qe,"Yuv1x1WorkerPool"))}async extract(e){const t=await e;if(t)return await this.workerPool.callWorker({imageData:t,size:1})}}class Jn{constructor(){d(this,"dataType","meanRgb1x1"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/B5lsALhE-ppZ36LXi.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,rt,"ChestMeanRgb1x1WorkerPool"))}async extract(e){const t=await e;if(!t)return;const n=await this.workerPool.callWorker(t);if(n)return[n]}}function ft(s,e="rgb1x1"){if(s==="face")switch(e){case"rgb1x1":return new gt;case"rgb8x8":return new Gn;case"rgb32x32":return new Qn;case"yuv1x1":return new Zn;case"yuv8x8":return new Yn;case"yuv32x32":return new Kn;case"yuv64x64":return new Xn;case"ggg1x1":return new ut;default:return new gt}else if(s==="chest")switch(e){case"ggg1x1":return new ut;case"yyy1x1":return new qn;case"meanRgb1x1":return new Jn;default:return new ut}else return new gt}function mt(s){const e=s?.pixelDataType??"rgb1x1",t=s?.chestPixelDataType??"ggg1x1";return(s?.enabledROIs??["face","chest"]).reduce((n,a)=>(a==="face"?n.face=ft(a,e):a==="chest"?n.chest=ft(a,t):n[a]=ft(a,e),n),{})}const Et="2.1.0-b2";class er{constructor(){d(this,"threshold",1),d(this,"lastOKTime",0),d(this,"lastPixels"),d(this,"detected",!1)}reset(){this.lastOKTime=0,this.lastPixels=void 0,this.detected=!1}diff(e,t){let n=0;for(let a=0;a<e.length;a++){const l=e[a],h=t[a];for(let o=0;o<l.length;o++)n+=h[o]-l[o]}return n}detect(e,t){if(e){if(this.lastPixels!==void 0){if(this.diff(e,this.lastPixels)!==0)this.lastOKTime=t;else if(t-this.lastOKTime>this.threshold)return this.detected=!0,!0}return this.lastPixels=e,!1}}}const ei=25,ti=5,ii=1/6,si=1;class tr{constructor(){d(this,"instanceId"),d(this,"stage",q.Idle),d(this,"startTime",new Date),d(this,"health"),d(this,"firstDataTime"),d(this,"frameData",[]),d(this,"lastSendTime"),d(this,"sendingData",!1),d(this,"error"),d(this,"cfg",{serverId:ie.RemoteProd,dataCollectionDuration:ei,dataSendingRate:ii,dataSendingDuration:ti,dataWindowDuration:Ri,faceLostTimeout:si}),d(this,"blinkDetector",_t(Ne.dummy)),d(this,"healthAnalyzer"),d(this,"pixelsExtractors"),d(this,"duplicatedPixelDetector",new er),window.__vital_sign_engine_plugin__=this,this.instanceId=Rt(),K(`VitalSignEngine Plugin InstanceId: ${this.instanceId}`),K(`VitalSignEngine Plugin (TSVitalSignCamera-${Et})`),this.healthAnalyzer=new Jt({serverId:ie.AwsProd}),this.pixelsExtractors=mt(),this.configure({serverId:ie.AwsEnterpriseProd})}configure(e){K("Configuring. Instance Id = ",this.instanceId),this.healthAnalyzer=new Jt(e),e.pixelDataType&&(K("Configure pixelDataType: "+e.pixelDataType),this.cfg.pixelDataType=e.pixelDataType,this.pixelsExtractors=mt(e)),e.chestPixelDataType&&(K("Configure chestPixelDataType: "+e.chestPixelDataType),this.cfg.chestPixelDataType=e.chestPixelDataType,this.pixelsExtractors=mt(e)),e.dataCollectionDuration&&(K("Configure dataCollectionDuration: "+e.dataCollectionDuration),this.cfg.dataCollectionDuration=e.dataCollectionDuration),e.dataSendingDuration&&(K("Configure dataSendingDuration: "+e.dataSendingDuration),this.cfg.dataSendingDuration=e.dataSendingDuration),e.dataSendingRate&&(K("Configure dataSendingRate: "+e.dataSendingRate),this.cfg.dataSendingRate=e.dataSendingRate),e.blinkDetectorType!==void 0&&(K("Configure blink detecor type"),this.blinkDetector=_t(e.blinkDetectorType),e.blinkDetectorConfig!==void 0&&this.blinkDetector.configure(e.blinkDetectorConfig)),e.blinkDetectorConfig!==void 0&&(K("Configure blink detector"),this.blinkDetector.configure(e.blinkDetectorConfig)),e.faceLostTimeout!==void 0&&(K("Configure faceLostTimeout"),this.cfg.faceLostTimeout=e.faceLostTimeout)}get stageTime(){switch(this.stage){case q.WaitingData:return-1;case q.CollectingData:return this.cfg.dataCollectionDuration||ei;case q.AnalyzingData:return this.cfg.dataSendingDuration||ti;case q.Idle:return-1}}get elapsedTime(){return(new Date().getTime()-this.startTime.getTime())/1e3}get remainingTime(){return Math.max(this.stageTime-this.elapsedTime,0)}get nextStage(){return this.elapsedTime<=this.stageTime?!1:this.stage!==q.AnalyzingData?!0:!this.sendingData}frameDataTimestamp(e){return this.firstDataTime===void 0?0:(e-this.firstDataTime)/1e3}get healthResult(){return{stage:this.stage,remainingTime:this.remainingTime,totalTime:this.stageTime===-1?void 0:this.stageTime,health:this.health,error:this.error}}async isReady(){return this.healthAnalyzer.isReady()}async waitUntilReady(){return this.healthAnalyzer.waitUntilReady()}reset(){this.blinkDetector.reset(),this.frameData=[],this.firstDataTime=void 0,this.lastSendTime=void 0,this.sendingData=!1,this.healthAnalyzer.reset(),this.duplicatedPixelDetector.reset()}async start(){if(this.stage!==q.Idle)return Promise.reject(new Error("already started"));this.health=void 0,this.error=void 0,this.reset(),this.healthAnalyzer.begin(),this.setStage(q.WaitingData)}get stageName(){switch(this.stage){case q.Idle:return"Idle";case q.AnalyzingData:return"Analyzing";case q.CollectingData:return"Collecting";case q.WaitingData:return"Waiting"}}setStage(e){this.stage=e,this.startTime=new Date,K(this.stageName)}async stop(){this.stage!==q.Idle&&(this.setStage(q.Idle),this.reset(),this.healthAnalyzer.reset())}toIdleStage(){this.setStage(q.Idle),this.reset(),this.healthAnalyzer.reset()}faceLostError(){K("Error: face lost"),this.toIdleStage(),this.error=new Error("face lost")}duplicatedRGBError(){K("Error: duplicated RGB values"),this.toIdleStage(),this.error=new Error("duplicated rgb")}faceLost(e){if(this.frameData.length==0)return!1;const t=this.frameData[this.frameData.length-1],n=this.cfg.faceLostTimeout===void 0?si:this.cfg.faceLostTimeout;return!(this.frameDataTimestamp(e)-t.timestamp<n)}getHealth(e){var t,n;const a=e.videoFrameInfo.timestamp;if(this.stage===q.Idle)return(t=e.images)!=null&&t.face&&e.faceBox&&this.extractPixels(e.images),this.healthResult;if(this.stage==q.WaitingData)return this.faceLost(a)||this.blinkDetector.noEyes||this.blinkDetector.unstable?(this.faceLostError(),this.healthResult):(this.blinkDetector.detect(e.landmarks),this.healthAnalyzer.isReadySync()?(this.setStage(q.CollectingData),this.healthResult):(K("Waiting server to awake..."),this.healthResult));if(this.stage==q.CollectingData)return this.faceLost(a)||this.blinkDetector.noEyes||this.blinkDetector.unstable?(this.faceLostError(),this.healthResult):(this.blinkDetector.detect(e.landmarks),(n=e.images)!=null&&n.face&&e.faceBox&&(this.addData(e.images,e.faceBox,e.landmarks,a),this.duplicatedPixelDetector.detected)?(this.duplicatedRGBError(),this.healthResult):(this.nextStage&&this.setStage(q.AnalyzingData),this.healthResult));if(this.stage==q.AnalyzingData){if(this.blinkDetector.blinkCount==0)return K("Error: no blink"),this.toIdleStage(),this.error=new Error("no blink"),this.healthResult;let l=this.cfg.dataSendingRate||ii;return e.images&&e.faceBox&&this.addData(e.images,e.faceBox,e.landmarks,a),this.sendData(1/l,e.userInfo,e.videoFrameInfo),this.nextStage&&this.toIdleStage(),this.healthResult}else return this.nextStage&&this.setStage(q.Idle),this.healthResult}addData(e,t,n,a){if(e.face===void 0)return;this.firstDataTime===void 0&&(this.firstDataTime=a);let l={pixels:this.extractPixels(e),timestamp:this.frameDataTimestamp(a),facebox:t,landmarks:n};this.frameData.push(l)}extractPixels(e){var t;let n={};for(const a in this.pixelsExtractors){const l=a,h=this.pixelsExtractors[l];if(!h)continue;const o=e[l];if(!o)continue;const f=(t=this.pixelsExtractors[l])==null?void 0:t.extract(o.imageData);f&&(n[l]={type:h.dataType,pixels:f})}return n}handleError(e){K(`Error: ${e}`),this.toIdleStage(),this.error=e}sendData(e,t,n){if(this.sendingData||this.elapsedTime>=this.stageTime)return;if(this.lastSendTime===void 0){this.lastSendTime=new Date,this._sendData(t,n).catch(h=>this.handleError(h));return}let a=new Date,l=this.lastSendTime;(a.getTime()-l.getTime())/1e3<e||this._sendData(t,n).catch(h=>this.handleError(h))}async _sendData(e,t){if(this.sendingData=!0,this.frameData.length===0)throw this.sendingData=!1,new Error("no pixel data");const n=this.frameData,a=await this.healthAnalyzer.analyze(n,e,t);this.stage===q.AnalyzingData&&(this.health=a),this.lastSendTime=new Date,this.sendingData=!1}async sendHealthReport(e,t,n,a){return this.healthAnalyzer.client.sendHealthReport(e,t,n,a)}}function ir(){return new tr}var ne=(s=>(s[s.MediaPipe=0]="MediaPipe",s[s.OpenCV=1]="OpenCV",s[s.Dummy=2]="Dummy",s[s.TFMediaPipe=3]="TFMediaPipe",s[s.FaceApi=4]="FaceApi",s[s.MPFaceMesh=5]="MPFaceMesh",s[s.MPFaceDetector=6]="MPFaceDetector",s[s.MPFaceMeshThreaded=7]="MPFaceMeshThreaded",s))(ne||{}),sr=(s=>(s.SelfHosted="self-hosted",s.CDN="cdn",s))(sr||{}),Se=(s=>(s[s.cif352x288=0]="cif352x288",s[s.sd480x360=1]="sd480x360",s[s.hd1280x720=2]="hd1280x720",s[s.hd1920x1080=3]="hd1920x1080",s))(Se||{});function nr(s){switch(s){case 0:return{width:352,height:288};case 1:return{width:480,height:360};case 2:return{width:1280,height:720};case 3:return{width:1920,height:1080}}}class rr{constructor(e){d(this,"video"),d(this,"canvas"),this.video=e,this.canvas=document.createElement("canvas")}start(){if(!this.video.srcObject)throw new Error("Video element has no srcObject");return Promise.resolve()}stop(){return Promise.resolve()}captureFrame(e,t){const n=this.cropFrame(this.video,e),a=Promise.resolve(n.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,n.width,n.height));return{timestamp:t??performance.now(),width:n.width,height:n.height,getImageData:()=>a,getCanvas:()=>Promise.resolve(n)}}cropFrame(e,t){const n=this.canvas;return n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(e,t.x,t.y,t.width,t.height,0,0,n.width,n.height),n.getContext("2d").canvas}}var ni={exports:{}},ri;function ar(){return ri||(ri=1,(function(s){s.exports=(function(e){var t={};function n(a){if(t[a])return t[a].exports;var l=t[a]={i:a,l:!1,exports:{}};return e[a].call(l.exports,l,l.exports,n),l.l=!0,l.exports}return n.m=e,n.c=t,n.d=function(a,l,h){n.o(a,l)||Object.defineProperty(a,l,{configurable:!1,enumerable:!0,get:h})},n.n=function(a){var l=a&&a.__esModule?(function(){return a.default}):(function(){return a});return n.d(l,"a",l),l},n.o=function(a,l){return Object.prototype.hasOwnProperty.call(a,l)},n.p="",n(n.s=1)})([(function(e,t,n){var a={MOBILE:"mobile",TABLET:"tablet",SMART_TV:"smarttv",CONSOLE:"console",WEARABLE:"wearable",BROWSER:void 0},l={CHROME:"Chrome",FIREFOX:"Firefox",OPERA:"Opera",YANDEX:"Yandex",SAFARI:"Safari",INTERNET_EXPLORER:"Internet Explorer",EDGE:"Edge",CHROMIUM:"Chromium",IE:"IE",MOBILE_SAFARI:"Mobile Safari",EDGE_CHROMIUM:"Edge Chromium"},h={IOS:"iOS",ANDROID:"Android",WINDOWS_PHONE:"Windows Phone",WINDOWS:"Windows",MAC_OS:"Mac OS"},o={isMobile:!1,isTablet:!1,isBrowser:!1,isSmartTV:!1,isConsole:!1,isWearable:!1};e.exports={BROWSER_TYPES:l,DEVICE_TYPES:a,OS_TYPES:h,defaultData:o}}),(function(e,t,n){var a=n(2),l=n(0),h=l.BROWSER_TYPES,o=l.OS_TYPES,f=l.DEVICE_TYPES,p=n(4),x=p.checkType,S=p.broPayload,y=p.mobilePayload,w=p.wearPayload,b=p.consolePayload,u=p.stvPayload,g=p.getNavigatorInstance,D=p.isIOS13Check,E=new a,v=E.getBrowser(),M=E.getDevice(),F=E.getEngine(),T=E.getOS(),P=E.getUA(),A=h.CHROME,j=h.CHROMIUM,U=h.IE,H=h.INTERNET_EXPLORER,G=h.OPERA,X=h.FIREFOX,W=h.SAFARI,Z=h.EDGE,ue=h.YANDEX,ge=h.MOBILE_SAFARI,V=f.MOBILE,N=f.TABLET,L=f.SMART_TV,B=f.BROWSER,_=f.WEARABLE,le=f.CONSOLE,z=o.ANDROID,ce=o.WINDOWS_PHONE,se=o.IOS,we=o.WINDOWS,fe=o.MAC_OS,Te=function(){return M.type===V},Be=function(){return M.type===N},$e=function(){switch(M.type){case V:case N:return!0;default:return!1}},_e=function(){return T.name===o.WINDOWS&&T.version==="10"?typeof P=="string"&&P.indexOf("Edg/")!==-1:!1},pe=function(){return M.type===L},ye=function(){return M.type===B},be=function(){return M.type===_},ze=function(){return M.type===le},De=function(){return T.name===z},Ee=function(){return T.name===we},Pe=function(){return T.name===fe},Ue=function(){return T.name===ce},Re=function(){return T.name===se},he=function(){return v.name===A},re=function(){return v.name===X},xe=function(){return v.name===j},oe=function(){return v.name===Z},O=function(){return v.name===ue},i=function(){return v.name===W||v.name===ge},r=function(){return v.name===ge},c=function(){return v.name===G},m=function(){return v.name===H||v.name===U},k=function(){var ke=g(),Ge=ke&&ke.userAgent.toLowerCase();return typeof Ge=="string"?/electron/.test(Ge):!1},R=function(){var ke=g();return ke&&(/iPad|iPhone|iPod/.test(ke.platform)||ke.platform==="MacIntel"&&ke.maxTouchPoints>1)&&!window.MSStream},C=function(){return D("iPad")},$=function(){return D("iPhone")},J=function(){return D("iPod")},Q=function(){return v.major},Y=function(){return v.version},ee=function(){return T.version?T.version:"none"},_i=function(){return T.name?T.name:"none"},Oi=function(){return v.name},Li=function(){return M.vendor?M.vendor:"none"},$i=function(){return M.model?M.model:"none"},Ui=function(){return F.name},Vi=function(){return F.version},Hi=function(){return P},Wi=function(){return M.type},Ni=pe(),zi=ze(),ji=be(),qi=r()||C(),Gi=xe(),Qi=$e()||C(),Yi=Te(),Ki=Be()||C(),Xi=ye(),Zi=De(),Ji=Ue(),es=Re()||C(),ts=he(),is=re(),ss=i(),ns=c(),rs=m(),as=ee(),os=_i(),ls=Q(),cs=Y(),hs=Oi(),ds=Li(),us=$i(),gs=Ui(),fs=Vi(),ms=Hi(),ps=oe()||_e(),vs=O(),ws=Wi(),ys=R(),bs=C(),xs=$(),ks=J(),Ss=k(),Ds=_e(),Es=oe(),Rs=Ee(),Cs=Pe(),Oe=x(M.type);function Ms(){var ke=Oe.isBrowser,Ge=Oe.isMobile,Ts=Oe.isTablet,Tt=Oe.isSmartTV,Pt=Oe.isConsole,Ft=Oe.isWearable;if(ke)return S(ke,v,F,T,P);if(Tt)return u(Tt,F,T,P);if(Pt)return b(Pt,F,T,P);if(Ge||Ts)return y(Oe,M,T,P);if(Ft)return w(Ft,F,T,P)}e.exports={deviceDetect:Ms,isSmartTV:Ni,isConsole:zi,isWearable:ji,isMobileSafari:qi,isChromium:Gi,isMobile:Qi,isMobileOnly:Yi,isTablet:Ki,isBrowser:Xi,isAndroid:Zi,isWinPhone:Ji,isIOS:es,isChrome:ts,isFirefox:is,isSafari:ss,isOpera:ns,isIE:rs,osVersion:as,osName:os,fullBrowserVersion:ls,browserVersion:cs,browserName:hs,mobileVendor:ds,mobileModel:us,engineName:gs,engineVersion:fs,getUA:ms,isEdge:ps,isYandex:vs,deviceType:ws,isIOS13:ys,isIPad13:bs,isIPhone13:xs,isIPod13:ks,isElectron:Ss,isEdgeChromium:Ds,isLegacyEdge:Es,isWindows:Rs,isMacOs:Cs}}),(function(e,t,n){var a;(function(l,h){var o="0.7.18",f="",p="?",x="function",S="undefined",y="object",w="string",b="major",u="model",g="name",D="type",E="vendor",v="version",M="architecture",F="console",T="mobile",P="tablet",A="smarttv",j="wearable",U="embedded",H={extend:function(V,N){var L={};for(var B in V)N[B]&&N[B].length%2===0?L[B]=N[B].concat(V[B]):L[B]=V[B];return L},has:function(V,N){return typeof V=="string"?N.toLowerCase().indexOf(V.toLowerCase())!==-1:!1},lowerize:function(V){return V.toLowerCase()},major:function(V){return typeof V===w?V.replace(/[^\d\.]/g,"").split(".")[0]:h},trim:function(V){return V.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},G={rgx:function(V,N){for(var L=0,B,_,le,z,ce,se;L<N.length&&!ce;){var we=N[L],fe=N[L+1];for(B=_=0;B<we.length&&!ce;)if(ce=we[B++].exec(V),ce)for(le=0;le<fe.length;le++)se=ce[++_],z=fe[le],typeof z===y&&z.length>0?z.length==2?typeof z[1]==x?this[z[0]]=z[1].call(this,se):this[z[0]]=z[1]:z.length==3?typeof z[1]===x&&!(z[1].exec&&z[1].test)?this[z[0]]=se?z[1].call(this,se,z[2]):h:this[z[0]]=se?se.replace(z[1],z[2]):h:z.length==4&&(this[z[0]]=se?z[3].call(this,se.replace(z[1],z[2])):h):this[z]=se||h;L+=2}},str:function(V,N){for(var L in N)if(typeof N[L]===y&&N[L].length>0){for(var B=0;B<N[L].length;B++)if(H.has(N[L][B],V))return L===p?h:L}else if(H.has(N[L],V))return L===p?h:L;return V}},X={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},W={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[g,v],[/(opios)[\/\s]+([\w\.]+)/i],[[g,"Opera Mini"],v],[/\s(opr)\/([\w\.]+)/i],[[g,"Opera"],v],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark)\/([\w\.-]+)/i],[g,v],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[g,"IE"],v],[/(edge|edgios|edgea)\/((\d+)?[\w\.]+)/i],[[g,"Edge"],v],[/(yabrowser)\/([\w\.]+)/i],[[g,"Yandex"],v],[/(puffin)\/([\w\.]+)/i],[[g,"Puffin"],v],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[g,"UCBrowser"],v],[/(comodo_dragon)\/([\w\.]+)/i],[[g,/_/g," "],v],[/(micromessenger)\/([\w\.]+)/i],[[g,"WeChat"],v],[/(qqbrowserlite)\/([\w\.]+)/i],[g,v],[/(QQ)\/([\d\.]+)/i],[g,v],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[g,v],[/(BIDUBrowser)[\/\s]?([\w\.]+)/i],[g,v],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[g,v],[/(MetaSr)[\/\s]?([\w\.]+)/i],[g],[/(LBBROWSER)/i],[g],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[v,[g,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[v,[g,"Facebook"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[v,[g,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[g,/(.+)/,"$1 WebView"],v],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[g,/(.+(?:g|us))(.+)/,"$1 $2"],v],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[v,[g,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[g,v],[/(dolfin)\/([\w\.]+)/i],[[g,"Dolphin"],v],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[g,"Chrome"],v],[/(coast)\/([\w\.]+)/i],[[g,"Opera Coast"],v],[/fxios\/([\w\.-]+)/i],[v,[g,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[v,[g,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[v,g],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[g,"GSA"],v],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[g,[v,G.str,X.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[g,v],[/(navigator|netscape)\/([\w\.-]+)/i],[[g,"Netscape"],v],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[g,v]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[M,"amd64"]],[/(ia32(?=;))/i],[[M,H.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[M,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[M,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[M,/ower/,"",H.lowerize]],[/(sun4\w)[;\)]/i],[[M,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[M,H.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[u,E,[D,P]],[/applecoremedia\/[\w\.]+ \((ipad)/],[u,[E,"Apple"],[D,P]],[/(apple\s{0,1}tv)/i],[[u,"Apple TV"],[E,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[E,u,[D,P]],[/(kf[A-z]+)\sbuild\/.+silk\//i],[u,[E,"Amazon"],[D,P]],[/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i],[[u,G.str,X.device.amazon.model],[E,"Amazon"],[D,T]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[u,E,[D,T]],[/\((ip[honed|\s\w*]+);/i],[u,[E,"Apple"],[D,T]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[E,u,[D,T]],[/\(bb10;\s(\w+)/i],[u,[E,"BlackBerry"],[D,T]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[u,[E,"Asus"],[D,P]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[E,"Sony"],[u,"Xperia Tablet"],[D,P]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[u,[E,"Sony"],[D,T]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[E,u,[D,F]],[/android.+;\s(shield)\sbuild/i],[u,[E,"Nvidia"],[D,F]],[/(playstation\s[34portablevi]+)/i],[u,[E,"Sony"],[D,F]],[/(sprint\s(\w+))/i],[[E,G.str,X.device.sprint.vendor],[u,G.str,X.device.sprint.model],[D,T]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[E,u,[D,P]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[E,[u,/_/g," "],[D,T]],[/(nexus\s9)/i],[u,[E,"HTC"],[D,P]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[u,[E,"Huawei"],[D,T]],[/(microsoft);\s(lumia[\s\w]+)/i],[E,u,[D,T]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[u,[E,"Microsoft"],[D,F]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[E,"Microsoft"],[D,T]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[u,[E,"Motorola"],[D,T]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[u,[E,"Motorola"],[D,P]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[E,H.trim],[u,H.trim],[D,A]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[E,"Samsung"],[D,A]],[/\(dtv[\);].+(aquos)/i],[u,[E,"Sharp"],[D,A]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[E,"Samsung"],u,[D,P]],[/smart-tv.+(samsung)/i],[E,[D,A],u],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[E,"Samsung"],u,[D,T]],[/sie-(\w*)/i],[u,[E,"Siemens"],[D,T]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[E,"Nokia"],u,[D,T]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[u,[E,"Acer"],[D,P]],[/android.+([vl]k\-?\d{3})\s+build/i],[u,[E,"LG"],[D,P]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[E,"LG"],u,[D,P]],[/(lg) netcast\.tv/i],[E,u,[D,A]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[u,[E,"LG"],[D,T]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[u,[E,"Lenovo"],[D,P]],[/linux;.+((jolla));/i],[E,u,[D,T]],[/((pebble))app\/[\d\.]+\s/i],[E,u,[D,j]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[E,u,[D,T]],[/crkey/i],[[u,"Chromecast"],[E,"Google"]],[/android.+;\s(glass)\s\d/i],[u,[E,"Google"],[D,j]],[/android.+;\s(pixel c)\s/i],[u,[E,"Google"],[D,P]],[/android.+;\s(pixel xl|pixel)\s/i],[u,[E,"Google"],[D,T]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[u,/_/g," "],[E,"Xiaomi"],[D,T]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[u,/_/g," "],[E,"Xiaomi"],[D,P]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[u,[E,"Meizu"],[D,P]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})\s+build/i],[u,[E,"OnePlus"],[D,T]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[u,[E,"RCA"],[D,P]],[/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i],[u,[E,"Dell"],[D,P]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[u,[E,"Verizon"],[D,P]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[E,"Barnes & Noble"],u,[D,P]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[u,[E,"NuVision"],[D,P]],[/android.+;\s(k88)\sbuild/i],[u,[E,"ZTE"],[D,P]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[u,[E,"Swiss"],[D,T]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[u,[E,"Swiss"],[D,P]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[u,[E,"Zeki"],[D,P]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[E,"Dragon Touch"],u,[D,P]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[u,[E,"Insignia"],[D,P]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[u,[E,"NextBook"],[D,P]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[E,"Voice"],u,[D,T]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[E,"LvTel"],u,[D,T]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[u,[E,"Envizen"],[D,P]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[E,u,[D,P]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[u,[E,"MachSpeed"],[D,P]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[E,u,[D,P]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[u,[E,"Rotor"],[D,P]],[/android.+(KS(.+))\s+build/i],[u,[E,"Amazon"],[D,P]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[E,u,[D,P]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[D,H.lowerize],E,u],[/(android[\w\.\s\-]{0,9});.+build/i],[u,[E,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[v,[g,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[g,v],[/rv\:([\w\.]{1,9}).+(gecko)/i],[v,g]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[g,v],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[g,[v,G.str,X.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[g,"Windows"],[v,G.str,X.os.windows.version]],[/\((bb)(10);/i],[[g,"BlackBerry"],v],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]*)/i,/linux;.+(sailfish);/i],[g,v],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[g,"Symbian"],v],[/\((series40);/i],[g],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[g,"Firefox OS"],v],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[g,v],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[g,"Chromium OS"],v],[/(sunos)\s?([\w\.\d]*)/i],[[g,"Solaris"],v],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[g,v],[/(haiku)\s(\w+)/i],[g,v],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[v,/_/g,"."],[g,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[g,"Mac OS"],[v,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]*)/i],[g,v]]},Z=function(V,N){if(typeof V=="object"&&(N=V,V=h),!(this instanceof Z))return new Z(V,N).getResult();var L=V||(l&&l.navigator&&l.navigator.userAgent?l.navigator.userAgent:f),B=N?H.extend(W,N):W;return this.getBrowser=function(){var _={name:h,version:h};return G.rgx.call(_,L,B.browser),_.major=H.major(_.version),_},this.getCPU=function(){var _={architecture:h};return G.rgx.call(_,L,B.cpu),_},this.getDevice=function(){var _={vendor:h,model:h,type:h};return G.rgx.call(_,L,B.device),_},this.getEngine=function(){var _={name:h,version:h};return G.rgx.call(_,L,B.engine),_},this.getOS=function(){var _={name:h,version:h};return G.rgx.call(_,L,B.os),_},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return L},this.setUA=function(_){return L=_,this},this};Z.VERSION=o,Z.BROWSER={NAME:g,MAJOR:b,VERSION:v},Z.CPU={ARCHITECTURE:M},Z.DEVICE={MODEL:u,VENDOR:E,TYPE:D,CONSOLE:F,MOBILE:T,SMARTTV:A,TABLET:P,WEARABLE:j,EMBEDDED:U},Z.ENGINE={NAME:g,VERSION:v},Z.OS={NAME:g,VERSION:v},typeof t!==S?(typeof e!==S&&e.exports&&(t=e.exports=Z),t.UAParser=Z):n(3)?(a=(function(){return Z}).call(t,n,t,e),a!==h&&(e.exports=a)):l&&(l.UAParser=Z);var ue=l&&(l.jQuery||l.Zepto);if(typeof ue!==S){var ge=new Z;ue.ua=ge.getResult(),ue.ua.get=function(){return ge.getUA()},ue.ua.set=function(V){ge.setUA(V);var N=ge.getResult();for(var L in N)ue.ua[L]=N[L]}}})(typeof window=="object"?window:this)}),(function(e,t){(function(n){e.exports=n}).call(t,{})}),(function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(g){for(var D=1;D<arguments.length;D++){var E=arguments[D];for(var v in E)Object.prototype.hasOwnProperty.call(E,v)&&(g[v]=E[v])}return g},l=n(0),h=l.DEVICE_TYPES,o=l.defaultData,f=function(g){switch(g){case h.MOBILE:return{isMobile:!0};case h.TABLET:return{isTablet:!0};case h.SMART_TV:return{isSmartTV:!0};case h.CONSOLE:return{isConsole:!0};case h.WEARABLE:return{isWearable:!0};case h.BROWSER:return{isBrowser:!0};default:return o}},p=function(g,D,E,v,M){return{isBrowser:g,browserMajorVersion:D.major,browserFullVersion:D.version,browserName:D.name,engineName:E.name||!1,engineVersion:E.version,osName:v.name,osVersion:v.version,userAgent:M}},x=function(g,D,E,v){return a({},g,{vendor:D.vendor,model:D.model,os:E.name,osVersion:E.version,ua:v})},S=function(g,D,E,v){return{isSmartTV:g,engineName:D.name,engineVersion:D.version,osName:E.name,osVersion:E.version,userAgent:v}},y=function(g,D,E,v){return{isConsole:g,engineName:D.name,engineVersion:D.version,osName:E.name,osVersion:E.version,userAgent:v}},w=function(g,D,E,v){return{isWearable:g,engineName:D.name,engineVersion:D.version,osName:E.name,osVersion:E.version,userAgent:v}},b=t.getNavigatorInstance=function(){return typeof window<"u"&&(window.navigator||navigator)?window.navigator||navigator:!1},u=t.isIOS13Check=function(g){var D=b();return D&&D.platform&&(D.platform.indexOf(g)!==-1||D.platform==="MacIntel"&&D.maxTouchPoints>1&&!window.MSStream)};e.exports={checkType:f,broPayload:p,mobilePayload:x,stvPayload:S,consolePayload:y,wearPayload:w,getNavigatorInstance:b,isIOS13Check:u}})])})(ni)),ni.exports}var te=ar();const or=rn(te);function lr(s){return new rr(s)}class cr{constructor(e,t){d(this,"video"),d(this,"onFrame"),d(this,"croppingRegion"),d(this,"width",1920),d(this,"height",1080),d(this,"_deviceId"),d(this,"callback"),d(this,"callbackFrameRate",30),d(this,"animationId"),d(this,"handleIOS17Bug",!0),d(this,"handleIOS17ObjectFitBug",!0),d(this,"preferredCamera"),d(this,"objectFit","cover"),d(this,"lastFrameTime"),d(this,"videoFrameCapturer"),this.video=e,this.onFrame=t.onFrame,t.width&&(this.width=t.width),t.height&&(this.height=t.height),t.croppingRegion&&(this.croppingRegion=t.croppingRegion),t.deviceId&&(this._deviceId=t.deviceId),t.callbackFrameRate&&(this.callbackFrameRate=t.callbackFrameRate),t.handleIOS17Bug!==void 0&&(this.handleIOS17Bug=t.handleIOS17Bug),t.preferredCamera!==void 0&&(this.preferredCamera=t.preferredCamera),this.handleIOS17Bug&&this.preferredCamera==null&&(this.preferredCamera="Front Camera"),t.handleIOS17ObjectFitBug!==void 0&&(this.handleIOS17ObjectFitBug=t.handleIOS17ObjectFitBug),getComputedStyle(this.video).objectFit!=="cover"&&(console.warn("[Camera] Forcing the object-fit to 'cover'."),this.video.style.setProperty("object-fit",this.objectFit,"important")),this.callback=n=>{if(this.animationId=requestAnimationFrame(this.callback),this.callbackFrameRate>0&&this.lastFrameTime!==void 0&&n-this.lastFrameTime<1e3/(this.callbackFrameRate*1.1)||(this.lastFrameTime=n,!this.video.srcObject||!this.videoFrameCapturer||!this.video.videoWidth||!this.video.videoHeight||!this.onFrame))return;const a=this.croppingRegion??{x:0,y:0,width:this.video.videoWidth,height:this.video.videoHeight},l=this.videoFrameCapturer.captureFrame(a,n);this.onFrame(l)}}set deviceId(e){this._deviceId!==e&&(this._deviceId=e,console.log(`[Camera] setting device id: ${this._deviceId}`),this.initInputDevice())}async initInputDevice(){var e={ideal:"user"};(this.deviceId||this.preferredCamera)&&(e=void 0);const t=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:this.width},height:{ideal:this.height},frameRate:{ideal:60},deviceId:this.deviceId,facingMode:e}});if(this.video.srcObject=t,console.log("[Camera] Assigned video source."),t.getVideoTracks().length>0&&t.getVideoTracks()[0].getSettings().deviceId){const[n]=t.getVideoTracks(),a=n.getSettings();if(console.log("[Camera] Device settings: ",a),this._deviceId=a.deviceId,a.frameRate!==void 0){const l=a.frameRate;this.callbackFrameRate=Math.min(l,this.callbackFrameRate??l),console.log(`[Camera] Callback frame rate set to ${this.callbackFrameRate} fps`)}}}get deviceId(){return this._deviceId}async start(){if(this.handleIOS17Bug&&(console.log("[Camera] Handling iOS 17 bug..."),this.video.style.opacity="0"),this.handleIOS17ObjectFitBug){console.log("[Camera] Handling iOS 17.2 object-fit bug...");const t=getComputedStyle(this.video).objectFit;t&&t!==""&&(this.video.style.objectFit="none")}const e=!this.deviceId||this.deviceId==="";await this.initInputDevice(),this.preferredCamera&&e&&await this.selectPreferredCamera(),this.handleIOS17Bug&&setTimeout(()=>{console.log("[Camera] iOS 17 bug handled"),this.video.style.opacity="1"},1500),this.handleIOS17ObjectFitBug&&setTimeout(()=>{console.log("[Camera] iOS 17.2 object-fit bug handled"),this.video.style.objectFit=this.objectFit},500),this.video.onplaying=async()=>{this.videoFrameCapturer=lr(this.video),await this.videoFrameCapturer.start(),this.callback(performance.now())}}async selectPreferredCamera(e=10){const t=async()=>{console.log("[Camera] Enumerating devices...");let l=await navigator.mediaDevices.enumerateDevices();return console.log(`[Camera] ${l.length} devices found`),l=l.filter(h=>h.kind==="videoinput"),console.log(`[Camera] ${l.length} camera devices found`),this.preferredCamera&&(l=l.filter(h=>h.label===this.preferredCamera),console.log(`[Camera] ${l.length} preferred devices found`)),l.length>0?(this.deviceId=l[0].deviceId,!0):!1};let n=0,a=!1;do{try{console.log(`[Camera] Trying to set preferred camera "${this.preferredCamera}"...`);const l=new Promise(h=>setTimeout(h,e*1e3)).then(()=>!1);a=await Promise.race([t(),l])}catch(l){a=!1,console.log(l)}if(a){console.log(`[Camera] Successfully selected preferred camera "${this.preferredCamera}"`);break}console.log(`[Camera] No camera found. Retry after ${500/1e3} second.`),await new Promise(l=>setTimeout(l,500)),n+=500}while(!a&&n<e*1e3)}async stop(){return this.videoFrameCapturer&&(await this.videoFrameCapturer.stop(),this.videoFrameCapturer=void 0),this.video&&this.video.srcObject&&(this.video.srcObject.getVideoTracks().forEach(e=>{e.enabled=!1,e.stop()}),this.video.srcObject=null),this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=void 0),this.waitUntilStopped().then(()=>{})}async waitUntilStopped(e){return new Promise(t=>{let n=0,a=100;const l=setInterval(()=>{n+=a;try{this.video.srcObject.getVideoTracks(),e&&n>=e&&(clearInterval(l),t(!1))}catch{clearInterval(l),t(!0)}},a)})}}class ai{constructor(e){d(this,"name","noname"),d(this,"frameCount",0),d(this,"start"),d(this,"resetInterval",10),d(this,"frameTimes",[]),d(this,"lastFrameTime",0),this.name=e}reset(){this.frameCount=0,this.start=new Date}tick(){const e=Date.now();if((this.start===void 0||this.elapsed>this.resetInterval)&&(this.log(!1),this.reset()),this.lastFrameTime>0){const t=(e-this.lastFrameTime)/1e3;this.frameTimes.push(t),this.frameTimes.length>60&&this.frameTimes.shift()}this.lastFrameTime=e,this.frameCount=this.frameCount+1}get elapsed(){return this.start===void 0?0:(new Date().getTime()-this.start.getTime())/1e3}get average(){return this.frameTimes.length===0?0:1/(this.frameTimes.reduce((e,t)=>e+t)/this.frameTimes.length)}get current(){return this.average.toFixed(2)}log(e=!1){e&&console.log(`[FPS ${this.name}] ${this.current}fps`)}}function hr(s){let e=document.createElement("canvas");return e.width=s.videoWidth,e.height=s.videoHeight,e.getContext("2d").drawImage(s,0,0),e}function dr(s){if(s instanceof HTMLCanvasElement)return s;let e=document.createElement("canvas");return e.width=s.width,e.height=s.width,e.getContext("2d").drawImage(s,0,0),e}function oi(s){let e;return s.image instanceof HTMLVideoElement?e=hr(s.image):s.image instanceof HTMLImageElement?e=dr(s.image):e=s.image,e}async function Ea(){const s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAEYklEQVR4Xu3UAQkAAAwCwdm/9HI83BLIOdw5AgQIRAQWySkmAQIEzmB5AgIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw";return new Promise(e=>{const t=document.createElement("img");t.src=s,t.onload=()=>e(t)})}async function Ra(){const s=new ImageData(1,1);return s.data[0]=255,s.data[1]=255,s.data[2]=255,s.data[3]=255,s}async function ur(s){return new Promise(e=>setTimeout(e,s))}function Ca(s){let e=1,t=1,n=0,a=0;return s.forEach(l=>{e=Math.min(l.x,e),t=Math.min(l.y,t),n=Math.max(l.x,n),a=Math.max(l.y,a)}),{xCenter:e+(n-e)/2,yCenter:t+(a-t)/2,width:n-e,height:a-t}}const tt=class Fe{constructor(e){d(this,"createDetector"),d(this,"maxFps",30),this.createDetector=e}async getFaceDetector(){return Fe.faceDetector==null&&(Fe.faceDetector=this.createDetector()),Fe.faceDetector}get lastSendTime(){return Fe.lastSendTime}set lastSendTime(e){Fe.lastSendTime=e}get modelState(){return Fe.modelState}set modelState(e){Fe.modelState=e}async loadModels(e){if(this.modelState!=="loaded"){if(this.modelState===void 0){this.modelState="loading";try{await(await this.getFaceDetector()).loadModels(e)}catch(t){throw this.modelState=void 0,t}console.log("[FaceDetectorProxy] model loaded."),this.modelState="loaded";return}do await ur(500);while(this.modelState!=="loading")}}timeout(e){return new Promise((t,n)=>setTimeout(n,e))}async detect(e){if(this.modelState!=="loaded"){console.log("[FaceDetectorProxy] model not ready");const l=oi(e);return{faceBox:void 0,landmarks:[],videoFrame:l}}const t=1e3/this.maxFps,n=new Date;if(this.lastSendTime===void 0||n.getTime()-this.lastSendTime.getTime()>t)return this.lastSendTime=n,Promise.race([this.timeout(1e3),(await this.getFaceDetector()).detect(e)]);const a=oi(e);return{faceBox:void 0,landmarks:[],videoFrame:a}}};d(tt,"faceDetector"),d(tt,"modelState"),d(tt,"lastSendTime");let Ve=tt;const gr=(()=>{const s={loadModelsFromRoot:!1};return typeof window<"u"?(window.__vital_sign_camera_global_options__===void 0&&(window.__vital_sign_camera_global_options__=s),window.__vital_sign_camera_global_options__):typeof self<"u"?(self.__vital_sign_camera_global_options__===void 0&&(self.__vital_sign_camera_global_options__=s),self.__vital_sign_camera_global_options__):s})();function fr(s){return s.startsWith("http")||s.startsWith("/")||!gr.loadModelsFromRoot?s:`/${s}`}async function at(){return new Promise((s,e)=>{if(typeof FaceMeshUMD<"u"){s(FaceMeshUMD);return}const t=fr("assets/facemesh.umd.cjs");if(document.querySelector(`script[src="${t}"]`)){s(FaceMeshUMD);return}const n=document.createElement("script");n.src=t,document.head.appendChild(n),n.addEventListener("load",()=>{console.log("[VitalSignCamera] Imported FaceMeshUMD"),s(FaceMeshUMD)}),n.addEventListener("error",a=>{console.error("[VitalSignCamera] Failed to import FaceMeshUMD",a),e(a)})})}async function li(s){switch(console.log(`[VitalSignCamera] Creating face detector of type ${s}...`),s){case ne.MediaPipe:const{MediaPipeFaceDetector:e}=await Ce(async()=>{const{MediaPipeFaceDetector:p}=await import("./Dvs7n39u-HdhWiUIY.js");return{MediaPipeFaceDetector:p}},[]);return new Ve(()=>new e);case ne.OpenCV:const{OpenCVFaceDetector:t}=await Ce(async()=>{const{OpenCVFaceDetector:p}=await import("./DEdy4J9V-D6piMvdV.js");return{OpenCVFaceDetector:p}},__vite__mapDeps([0,1]));return new Ve(()=>new t);case ne.Dummy:const{DummyFaceDetector:n}=await Ce(async()=>{const{DummyFaceDetector:p}=await import("./OqNe-l6V-CuQF65zg.js");return{DummyFaceDetector:p}},[]);return new n;case ne.TFMediaPipe:const{TFMediaPipeFaceDetector:a}=await Ce(async()=>{const{TFMediaPipeFaceDetector:p}=await import("./Bdj9Tq7i-BJGUu9Dc.js");return{TFMediaPipeFaceDetector:p}},__vite__mapDeps([2,1]));return new Ve(()=>new a);case ne.FaceApi:const{FaceApiFaceDetector:l}=await Ce(async()=>{const{FaceApiFaceDetector:p}=await import("./B2pE3kkM-CnWq1Yl8.js");return{FaceApiFaceDetector:p}},__vite__mapDeps([3,4]));return new l;case ne.MPFaceMesh:const{MPVisionFaceMeshDetector:h}=await Ce(async()=>{const{MPVisionFaceMeshDetector:p}=await import("./B6uo8tXT-Di8G4Yrv.js");return{MPVisionFaceMeshDetector:p}},__vite__mapDeps([5,6]));return new Ve(()=>new h);case ne.MPFaceDetector:const{MPVisionFaceDetector:o}=await Ce(async()=>{const{MPVisionFaceDetector:p}=await import("./BVXsNi4l-BrzH9TFv.js");return{MPVisionFaceDetector:p}},__vite__mapDeps([7,6]));return new Ve(()=>new o);case ne.MPFaceMeshThreaded:const{MPVisionFaceMeshDetectorThread:f}=await at();return new Ve(()=>new f)}}function mr(s){var e;const t=(e=s.srcObject)==null?void 0:e.getVideoTracks()[0];if(t.getCapabilities!==void 0){const n=t.getCapabilities().facingMode;return n&&n[0]}else return t.getSettings().facingMode}function pr(s){const e=mr(s);return e&&e==="environment"?"none":"scaleX(-1)"}function Mi(s){const{image:e,facebox:t}=s;let n=t.width*e.width,a=t.height*e.height,l=(t.xCenter-t.width/2)*e.width,h=(t.yCenter-t.height/2)*e.height;a=a*.7;const o=new OffscreenCanvas(e.width,e.height),f=o.getContext("2d");f?.putImageData(e,0,0);const p=new OffscreenCanvas(n,a),x=p.getContext("2d");x.drawImage(o,l,h,n,a,0,0,n,a);let S=x.getImageData(0,0,p.width,p.height).data,y=0,w=0;for(let b=0;b<S.length;b+=4)y+=Math.max(S[b],S[b+1],S[b+2]),w++;return y/w}self.onmessage=s=>{const{inputData:e,hash:t}=s.data,n=Mi(e);self.postMessage({result:n,hash:t})};const vr=90,wr=[.3,.9],yr=[.4,.6],br=[.3,.7],ci=.1,xr=30,kr=te.isMobile&&!te.isTablet,Sr=10,hi=kr||te.isAndroid?Sr:15;function He(s){return Array.isArray(s)?s:[s.min,s.max]}class Dr{constructor(e,t){d(this,"MOVEMENT_ARRAY",[]),d(this,"_conditions"),d(this,"vitalSignEngine"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/DaF7aLs5-BKM5EhUa.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Mi,"CheckBrightness")),d(this,"minimumFrameRate",hi),d(this,"minimumBrightness",vr),d(this,"validXRange",yr),d(this,"validYRange",br),d(this,"validDistanceRange",wr),this.vitalSignEngine=e,t?.boundaryRangeX!==void 0&&(this.validXRange=He(t.boundaryRangeX)),t?.boundaryRangeY!==void 0&&(this.validYRange=He(t.boundaryRangeY)),t?.distanceRange!==void 0&&(this.validDistanceRange=He(t.distanceRange))}configure(e){e?.minimumFrameRate!==void 0&&(this.minimumFrameRate=e.minimumFrameRate),e?.validDistanceRange!==void 0&&(this.validDistanceRange=He(e.validDistanceRange)),e?.validXRange!==void 0&&(this.validXRange=He(e.validXRange)),e?.validYRange!==void 0&&(this.validYRange=He(e.validYRange))}get conditions(){return this._conditions}resetMovementArray(){this.MOVEMENT_ARRAY=[]}reset(){this.resetMovementArray(),this._conditions=void 0}async getBrightness(e,t){var n;const a=(n=e.getContext("2d",{willReadFrequently:!0}))==null?void 0:n.getImageData(0,0,e.width,e.height);return a?await this.workerPool.callWorker({image:a,facebox:t}):0}checkDistance(e){let t=this.validDistanceRange;return e.height>t[1]?Ae.TooClose:e.height<t[0]?Ae.TooFar:Ae.OK}checkFacePosition(e){if(e===void 0)return ve.Unknown;let t=this.validXRange,n=this.validYRange,a=ve.Centered;return e.yCenter<n[0]&&(a=ve.TooHigh),e.yCenter>n[1]&&(a=ve.TooLow),e.xCenter<t[0]&&(a=ve.TooRight),e.xCenter>t[1]&&(a=ve.TooLeft),a}async checkCondition(e,t,n){let a=!0;if(e!==void 0){let x=t?await this.getBrightness(e,t):0;a=this.minimumBrightness<=x}const l=t?this.checkDistance(t):Ae.TooFar,h=this.checkFacePosition(t);let o=!1;if(this.MOVEMENT_ARRAY.length>=xr){this.MOVEMENT_ARRAY.shift();let x=0,S=0,y=1,w=1;for(let g=0;g<this.MOVEMENT_ARRAY.length;g++)x=this.MOVEMENT_ARRAY[g][0]>x?this.MOVEMENT_ARRAY[g][0]:x,S=this.MOVEMENT_ARRAY[g][1]>S?this.MOVEMENT_ARRAY[g][1]:S,y=this.MOVEMENT_ARRAY[g][0]<y?this.MOVEMENT_ARRAY[g][0]:y,w=this.MOVEMENT_ARRAY[g][1]<w?this.MOVEMENT_ARRAY[g][1]:w;const b=x.valueOf()-y.valueOf(),u=S.valueOf()-w.valueOf();o=b<=ci&&u<=ci}t&&this.MOVEMENT_ARRAY.push([t.xCenter,t.yCenter]);let f=await this.vitalSignEngine.isReady();const p=n>=this.minimumFrameRate;return{lighting:a,distance:l===Ae.OK,centered:h===ve.Centered,movement:o,serverReady:f,frameRate:p,distanceCondition:l,facePositionCondition:h,fps:n}}async processFrame(e,t,n,a,l){l==="measuring"&&(a=Math.max(hi,a)),this._conditions=await this.checkCondition(n?e:void 0,t,a)}}function Er(s,e,t){const n=new Dr(s,t||void 0);return n.configure(e),n}async function Rr(){try{let s=await navigator.mediaDevices.enumerateDevices();return s=s.filter(e=>e.kind==="videoinput"),s.map((e,t)=>({label:e.label,id:e.deviceId,deviceIndex:t}))}catch{return[]}}function Cr(s,e){if(s.length!=e.length)return!1;for(let t=0;t<s.length;t++)if(s[t].id!==e[t].id||s[t].label!==e[t].label)return!1;return!0}class Mr{constructor(e,t){d(this,"camera"),d(this,"devices",[]),d(this,"timer"),d(this,"selectedDevice"),d(this,"onChanged"),this.camera=e,this.onChanged=t}start(){this.timer===void 0&&(this.timer=setInterval(async()=>{const e=await Rr();(!Cr(e,this.devices)||this.camera.device!==this.selectedDevice)&&(this.devices=e,this.selectedDevice=this.camera.device,this.onChanged&&this.onChanged(this.devices))},1e3))}}async function Tr(s){const{DefaultAgeEstimator:e}=await Ce(async()=>{const{DefaultAgeEstimator:t}=await import("./wpGhV2Ip-0aQdXty7.js");return{DefaultAgeEstimator:t}},__vite__mapDeps([8,4]));return new Promise(t=>{const n=new e(s,()=>{t(n)})})}class Pr{constructor(e,t={}){d(this,"canvas"),d(this,"ctx"),d(this,"config"),d(this,"ecgPhase",0),d(this,"tracePoints",[]),d(this,"tracePosition",0),d(this,"ecgAnimationStopped",!1),this.config={width:t.width||600,height:t.height||200,maxPoints:t.maxPoints||300,lineColor:t.lineColor||"#00ff00",backgroundColor:t.backgroundColor||"#000000",gridColor:t.gridColor||"#333333",visualizationType:t.visualizationType||"PPG",debug:t.debug||!1,...t},this.canvas=document.createElement("canvas"),this.canvas.width=this.config.width,this.canvas.height=this.config.height,this.canvas.style.border="1px solid #333",this.canvas.style.backgroundColor=this.config.backgroundColor,this.canvas.style.display="block",this.canvas.style.width=`${this.config.width}px`,this.canvas.style.height=`${this.config.height}px`,e.appendChild(this.canvas),this.log("Canvas created and appended");const n=this.canvas.getContext("2d");if(!n)throw new Error("Could not get 2D context from canvas");this.ctx=n,this.clear()}log(e,...t){this.config.debug&&console.log(`[Signal Visualizer] ${e}`,...t)}updateSignal(e,t,n){var a;if(this.log("updateSignal:",{hasData:!!e,valuesLength:((a=e?.values)==null?void 0:a.length)||0,sampleRate:e?.sampleRate,visualizationType:this.config.visualizationType,heartRate:t?.heartRate}),this.ctx.clearRect(0,0,this.config.width,this.config.height),this.ctx.fillStyle=this.config.backgroundColor,this.ctx.fillRect(0,0,this.config.width,this.config.height),this.config.visualizationType==="ECG"){if(n===q.Idle){this.stopECGAnimation(),this.drawNoSignal();return}this.ecgAnimationStopped=!1,this.drawECGSignal(t)}else{if(!e||e.values.length===0){this.drawNoSignal();return}this.drawGrid(),this.drawSignalArray(e.values,e.sampleRate),this.drawInfo(e)}}clear(){this.ctx.save(),this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over",this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.clearRect(0,0,this.config.width,this.config.height),this.ctx.fillStyle=this.config.backgroundColor,this.ctx.fillRect(0,0,this.config.width,this.config.height),this.ctx.restore()}stopECGAnimation(){this.ecgAnimationStopped=!0,this.tracePoints=[],this.tracePosition=0,this.ecgPhase=0,this.log("ECG animation stopped")}drawNoSignal(){this.ctx.fillStyle="#666666",this.ctx.font="16px monospace",this.ctx.textAlign="center",this.ctx.fillText("No Signal Data",this.config.width/2,this.config.height/2)}drawGrid(){this.ctx.save(),this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over",this.ctx.strokeStyle=this.config.gridColor,this.ctx.lineWidth=1,this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0;const e=this.config.width/10;for(let n=0;n<=this.config.width;n+=e)this.ctx.beginPath(),this.ctx.moveTo(n,0),this.ctx.lineTo(n,this.config.height),this.ctx.stroke();const t=this.config.height/5;for(let n=0;n<=this.config.height;n+=t)this.ctx.beginPath(),this.ctx.moveTo(0,n),this.ctx.lineTo(this.config.width,n),this.ctx.stroke();this.ctx.restore()}drawECGSignal(e){if(this.ecgAnimationStopped){this.drawNoSignal();return}this.drawGrid();const t=e?.heartRate||72,n=60/t*1e3,a=60/t*30,l=n/a;this.ecgPhase=(this.ecgPhase+l)%n;const h=this.ecgPhase/n,o=(this.generateECGWaveform(h,t)+1)*(this.config.height*.3)+this.config.height*.2;for(this.tracePoints.push({x:this.tracePosition,y:o}),this.tracePosition+=2;this.tracePoints.length>0&&this.tracePoints[0].x<-10;)this.tracePoints.shift();this.tracePosition>this.config.width+10&&(this.tracePosition=0,this.tracePoints=[]),this.drawMovingTrace(),this.drawECGInfo(t)}drawMovingTrace(){if(!(this.tracePoints.length<2)){this.ctx.shadowColor="#ff4444",this.ctx.shadowBlur=8,this.ctx.strokeStyle="#ff6b6b",this.ctx.lineWidth=4,this.ctx.beginPath(),this.ctx.moveTo(this.tracePoints[0].x,this.tracePoints[0].y);for(let e=1;e<this.tracePoints.length;e++)this.ctx.lineTo(this.tracePoints[e].x,this.tracePoints[e].y);this.ctx.stroke(),this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0}}generateECGWaveform(e,t){const n=(Math.random()-.5)*.05,a=Math.max(.08,Math.min(.2,.15*(72/t))),l=.8+(Math.random()-.5)*.3;if(e>=0&&e<=a){const h=e/a;return h<.15?h*(5+Math.random())*l*.7:h<.3?l*(.9+Math.random()*.2):h<.5?(1-(h-.3)/.2)*l*(.8+Math.random()*.4):Math.max(0,1-(h-.5)/.5)*l*(.2+Math.random()*.3)}else return n}drawSignalArray(e,t){const n=Math.min(e.length,this.config.maxPoints);if(n<2)return;const a=Math.min(...e),l=Math.max(...e)-a||1;this.ctx.save(),this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over",this.ctx.strokeStyle=this.config.lineColor,this.ctx.lineWidth=2,this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0,this.ctx.beginPath();const h=this.config.width/(n-1);for(let o=0;o<n;o++){const f=o*h,p=(e[o]-a)/l,x=this.config.height-p*(this.config.height*.8)-this.config.height*.1;o===0?this.ctx.moveTo(f,x):this.ctx.lineTo(f,x)}this.ctx.stroke(),this.ctx.restore()}drawECGInfo(e){this.ctx.fillStyle="#ffffff",this.ctx.font="12px monospace",this.ctx.textAlign="left",["ECG Animation",`Rate: ${e} BPM`,"Visual Demo Only"].forEach((t,n)=>{this.ctx.fillText(t,10,20+n*15)})}drawInfo(e){const{values:t,sampleRate:n}=e;this.ctx.fillStyle="#ffffff",this.ctx.font="12px monospace",this.ctx.textAlign="left",[`Samples: ${t.length}`,`Sample Rate: ${n.toFixed(1)} Hz`,`Duration: ${(t.length/n).toFixed(1)}s`].forEach((a,l)=>{this.ctx.fillText(a,10,20+l*15)})}destroy(){this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}}class Fr{constructor(){d(this,"a0",1),d(this,"a1",0),d(this,"a2",0),d(this,"b0",1),d(this,"b1",0),d(this,"b2",0),d(this,"x1",0),d(this,"x2",0),d(this,"y1",0),d(this,"y2",0)}bandpass(e,t,n){const a=2*Math.PI*e/n,l=e/t,h=Math.sin(a)/(2*l);this.b0=h,this.b1=0,this.b2=-h,this.a0=1+h,this.a1=-2*Math.cos(a),this.a2=1-h,this.b0/=this.a0,this.b1/=this.a0,this.b2/=this.a0,this.a1/=this.a0,this.a2/=this.a0}process(e){const t=this.b0*e+this.b1*this.x1+this.b2*this.x2-this.a1*this.y1-this.a2*this.y2;return this.x2=this.x1,this.x1=e,this.y2=this.y1,this.y1=t,t}reset(){this.x1=0,this.x2=0,this.y1=0,this.y2=0}filtfilt(e){if(e.length===0)return[];this.reset();const t=new Array(e.length);for(let a=0;a<e.length;a++)t[a]=this.process(e[a]);this.reset();const n=new Array(e.length);for(let a=e.length-1;a>=0;a--)n[a]=this.process(t[a]);return n.reverse()}}class Ar{constructor(e){d(this,"config",{earlyEstimation:!1,minDuration:10,minConfidence:.6,debug:!1}),d(this,"estimation_",null),d(this,"signalBuffer",[]),d(this,"timestamps",[]),d(this,"maxBufferSize",450),d(this,"minSamplesForEstimation",150),d(this,"currentPulseRate",0),d(this,"onPulseRateUpdate"),d(this,"timeWindow",10),d(this,"stride",1),d(this,"lb",50),d(this,"ub",140),d(this,"hrRes",1),e&&this.configure(e)}log(e,...t){this.config.debug&&console.log(`[FdaRealtimeEstimator] ${e}`,...t)}get estimation(){return this.estimation_}get signalData(){return this.signalBuffer.length===0?null:{values:[...this.signalBuffer],timestamps:[...this.timestamps],sampleRate:this.getSampleRate()}}configure(e){e&&(this.config={...this.config,...e})}processFrame(e,t,n,a){t!==q.Idle&&(!a||!a.face||this.processFrameAsync(e,a.face))}async processFrameAsync(e,t){const n=await this.extractRealPPGSignal(e,t);n!==null&&(this.signalBuffer.push(n),this.timestamps.push(Date.now()),this.signalBuffer.length>this.maxBufferSize&&(this.signalBuffer.shift(),this.timestamps.shift()),this.signalBuffer.length>=this.minSamplesForEstimation&&this.processSignal())}async extractRealPPGSignal(e,t){try{const n=await t.imageData;if(!n)return null;const a=n.data;let l=0,h=0,o=0;for(let x=0;x<a.length;x+=4)l+=a[x+1],h+=a[x+2],o++;if(o===0)return null;const f=l/o,p=h/o;return p<1?f:f/p}catch(n){return console.warn("Failed to extract PPG signal:",n),null}}getSampleRate(){if(this.timestamps.length<2)return 30;const e=this.timestamps[this.timestamps.length-1]-this.timestamps[0];return(this.timestamps.length-1)*1e3/e}processSignal(){var e;try{const t=this.getSampleRate();let n=[...this.signalBuffer];const a=n.reduce((w,b)=>w+b,0)/n.length;n=n.map(w=>w-a);const l=Math.max(...n.map(Math.abs));l>0&&(n=n.map(w=>w/l));const h=(this.lb-10)/60,o=(this.ub+10)/60,f=(h+o)/2,p=o-h,x=new Fr;x.bandpass(f,p,t);const S=x.filtfilt(n),y=this.getHeartRate(S,t);if(y&&y.heartRate>0){const w=y.heartRate,b=this.calculateSNR(S),u=Math.min(Math.max(b/10,0),1),g=u>.3;this.estimation_={heartRate:w,confidence:u,isStable:g,snr:b,signalQuality:u*100},this.currentPulseRate=w,(e=this.onPulseRateUpdate)==null||e.call(this,this.currentPulseRate),this.log(`Estimated HR: ${w.toFixed(1)} BPM, SNR: ${b.toFixed(2)}`)}}catch(t){console.warn("Failed to process signal:",t)}}getHeartRate(e,t){const n=this.timeWindow,a=this.stride,l=this.lb,h=this.ub,o=this.hrRes,f=Math.round(n*t),p=Math.round(a*t);if(e.length<f)return null;const x=[];for(let v=0;v<=e.length-f;v+=p)x.push(v);if(x.length===0)return null;const S=[];for(let v=l;v<=h;v+=o)S.push(v);const y=S.map(v=>v/60);for(let v=0;v<e.length;v++);const w=[];for(let v=0;v<y.length;v++)w.push(new Array(x.length).fill(0));for(let v=0;v<x.length;v++){const M=x[v],F=M+f;for(let T=0;T<y.length;T++){const P=y[T];let A=0,j=0;for(let H=M;H<F;H++){const G=(H+1)/t,X=-2*Math.PI*P*G,W=e[H];A+=W*Math.cos(X),j+=W*Math.sin(X)}A/=t,j/=t;const U=A*A+j*j;w[T][v]=U}}for(let v=0;v<x.length;v++){let M=0;for(let T=0;T<y.length;T++)M+=w[T][v];const F=M/y.length;if(F>0)for(let T=0;T<y.length;T++)w[T][v]/=F}const b=Math.round(6/o)+1,u=new Array(b).fill(1/b),g=[];for(let v=0;v<y.length;v++)g.push(new Array(x.length).fill(0));for(let v=0;v<x.length;v++){const M=w.map(T=>T[v]),F=this.convolve(M,u);for(let T=0;T<y.length;T++)g[T][v]=F[T]}const D=[];for(let v=0;v<x.length;v++){let M=-1,F=-1;for(let T=0;T<y.length;T++)g[T][v]>M&&(M=g[T][v],F=T);D.push(S[F])}const E=D.filter(v=>!isNaN(v));return E.length===0?null:{heartRate:E.reduce((v,M)=>v+M,0)/E.length,heartRatePerWindow:D}}convolve(e,t){const n=new Array(e.length).fill(0),a=t.length,l=Math.floor(a/2);for(let h=0;h<e.length;h++){let o=0;for(let f=0;f<a;f++){const p=h-l+f;let x=0;if(p>=0&&p<e.length)x=e[p];else{let S=p;for(;S<0||S>=e.length;)S<0&&(S=-S),S>=e.length&&(S=2*e.length-2-S);x=e[S]}o+=x*t[a-1-f]}n[h]=o}return n}calculateSNR(e){if(e.length===0)return 0;const t=e.reduce((l,h)=>l+h,0)/e.length,n=e.reduce((l,h)=>l+Math.pow(h-t,2),0)/e.length,a=Math.sqrt(n);return(Math.max(...e)-Math.min(...e))/(a+1e-4)}updateWithServerResult(e,t,n){var a;this.estimation_={heartRate:Math.round(e),confidence:1,isStable:!0,snr:t,signalQuality:n},this.currentPulseRate=Math.round(e),(a=this.onPulseRateUpdate)==null||a.call(this,this.currentPulseRate)}reset(){this.estimation_=null,this.signalBuffer=[],this.timestamps=[],this.currentPulseRate=0}}class Ir{constructor(e){d(this,"config",{earlyEstimation:!1,minDuration:10,minConfidence:.6,debug:!1}),d(this,"estimation_",null),d(this,"signalBuffer",[]),d(this,"timestamps",[]),d(this,"maxBufferSize",300),d(this,"minSamplesForEstimation",30),d(this,"currentPulseRate",0),d(this,"onPulseRateUpdate"),d(this,"heartRateHistory",[]),d(this,"maxHistorySize",10),d(this,"defaultFps",30),d(this,"earlyGuessThreshold",15),d(this,"earlyResultSampleThreshold",90),d(this,"earlyResultMaxHeartRate",150),d(this,"earlyResultMinHeartRate",50),d(this,"stableResultMaxHeartRate",130),d(this,"stableResultMinHeartRate",60),d(this,"minConfidenceForDisplay",1e-4),d(this,"effectiveMinConfidence",.3),d(this,"earlyResultMinHistoryLength",2),d(this,"muchEarlierTriggerThreshold",10),d(this,"minSignalLengthForDetrending",3),d(this,"detrendingWindowSize",50),d(this,"detrendingAmplification",10),d(this,"lowPassWindowSize",5),d(this,"maxAutocorrelationLags",150),d(this,"minAutocorrelationLength",10),d(this,"minBpmForPeakFinding",50),d(this,"maxBpmForPeakFinding",150),d(this,"minLagForPeakFinding",5),d(this,"minSignalLengthForMetrics",10),d(this,"expectedPpgAmplitude",20),d(this,"snrNormalizationFactor",5),d(this,"consistencyScoreFactor",2),d(this,"minSignalLengthForTrendStability",5),d(this,"confidenceWeights",{amplitude:.3,snr:.4,consistency:.2,stability:.1}),d(this,"signalQualityWeights",{amplitude:.4,consistency:.4,stability:.2}),d(this,"earlyGuessMinHeartRate",50),d(this,"earlyGuessMaxHeartRate",150),d(this,"earlyGuessMinLag",5),d(this,"earlyGuessConfidenceBoost",.3),d(this,"earlyGuessMinConfidence",.001),d(this,"stabilityCheckMinHistoryLength",5),d(this,"stabilityThresholdBpm",10),d(this,"defaultTimeIntervalMs",33),e&&this.configure(e)}log(e,...t){this.config.debug&&console.log(`[Realtime Estimater] ${e}`,...t)}get estimation(){return this.estimation_}get signalData(){return this.signalBuffer.length===0?null:{values:[...this.signalBuffer],timestamps:[...this.timestamps],sampleRate:this.timestamps.length>1?1e3/((this.timestamps[this.timestamps.length-1]-this.timestamps[0])/(this.timestamps.length-1)):this.defaultFps}}configure(e){e&&(this.config={...this.config,...e})}processFrame(e,t,n,a){if(this.log(`processFrame called, stage=${t}, hasROI=${!!(a!=null&&a.face)}`),t===q.Idle){this.log(`Skipping - idle stage (${t})`);return}if(!a||!a.face){this.log("Skipping - no ROI data");return}this.log(`Processing frame with ROI in stage ${t}`),this.processFrameAsync(e,a.face)}async processFrameAsync(e,t){const n=await this.extractRealPPGSignal(e,t);n!==null?(this.signalBuffer.push(n),this.timestamps.push(Date.now()),this.log(`Added to buffer - intensity: ${n.toFixed(2)}, buffer size: ${this.signalBuffer.length}`),this.signalBuffer.length>this.maxBufferSize&&(this.signalBuffer.shift(),this.timestamps.shift()),this.signalBuffer.length>=this.minSamplesForEstimation?(this.log(`Processing signal - ${this.signalBuffer.length} samples`),this.processSignal()):this.signalBuffer.length>=this.earlyGuessThreshold&&!this.estimation_?(this.log(`Attempting early guess - ${this.signalBuffer.length} samples`),this.processSignal()):this.log(`Not enough samples yet (${this.signalBuffer.length}/${this.minSamplesForEstimation})`)):this.log("Failed to extract intensity")}async extractRealPPGSignal(e,t){try{this.log("Extracting PPG signal from ROI");const n=await t.imageData;if(!n)return this.log("No imageData available"),null;const a=n.data;this.log(`ImageData length: ${a.length}`);let l=0,h=0;for(let f=0;f<a.length;f+=4)l+=a[f+1],h++;const o=h>0?l/h:null;return this.log(`Extracted intensity: ${o}`),o}catch(n){return console.warn("Failed to extract PPG signal:",n),null}}processSignal(){var e;if(this.signalBuffer.length<this.minSamplesForEstimation){this.log(`Not enough samples (${this.signalBuffer.length}/${this.minSamplesForEstimation})`);return}try{const t=this.bandpassFilter(this.signalBuffer),n=this.calculateAutocorrelation(t);this.log(`Raw signal range: [${Math.min(...this.signalBuffer).toFixed(2)}-${Math.max(...this.signalBuffer).toFixed(2)}]`),this.log(`Filtered signal range: [${Math.min(...t).toFixed(2)}-${Math.max(...t).toFixed(2)}]`),this.log(`Autocorr range: [${Math.min(...n).toFixed(4)}-${Math.max(...n).toFixed(4)}]`);const a=this.findDominantPeak(n);if(this.log(`signalLength=${this.signalBuffer.length}, filteredLength=${t.length}, autocorrLength=${n.length}, peakIndex=${a}`),a>0){const l=1e3/this.getAverageTimeInterval(),h=l/a,o=h*60;this.log(`sampleRate=${l.toFixed(1)}, peakIndex=${a}, frequency=${h.toFixed(2)}, heartRate=${o.toFixed(1)}`);const f=this.signalBuffer.length<this.earlyResultSampleThreshold,p=f?this.earlyResultMaxHeartRate:this.stableResultMaxHeartRate,x=f?this.earlyResultMinHeartRate:this.stableResultMinHeartRate;if(o>=x&&o<=p){const S=Math.round(o),y=this.calculateSignalMetrics(t),w=y.confidence,b=w>(this.config.minConfidence||.3)&&this.signalBuffer.length>=this.minSamplesForEstimation&&this.checkHeartRateStability();this.log(`confidence=${(w*100).toFixed(1)}%, snr=${y.snr.toFixed(2)}, signalQuality=${y.signalQuality.toFixed(1)}, isStable=${b}, signalLength=${this.signalBuffer.length}`);const u=this.minConfidenceForDisplay,g=this.signalBuffer.length<this.earlyResultSampleThreshold,D=g?this.minConfidenceForDisplay:this.config.minConfidence||this.effectiveMinConfidence;if(w>=u){const E=g?this.heartRateHistory.length>=this.earlyResultMinHistoryLength:this.checkHeartRateStability(),v=w>D&&E;(!this.estimation_||this.estimation_.heartRate!==S||g)&&(this.estimation_={heartRate:S,confidence:w,isStable:v,snr:y.snr,signalQuality:y.signalQuality},this.heartRateHistory.push(S),this.heartRateHistory.length>this.maxHistorySize&&this.heartRateHistory.shift(),this.currentPulseRate=S,(e=this.onPulseRateUpdate)==null||e.call(this,this.currentPulseRate),this.log(`Updated estimation - HR: ${S} BPM, Confidence: ${(w*100).toFixed(1)}%, Early: ${g}`))}else this.signalBuffer.length>=this.muchEarlierTriggerThreshold?this.provideEarlyGuess(t,n):this.log(`Confidence too low (${(w*100).toFixed(1)}%) for display`)}}}catch(t){console.warn("Failed to process PPG signal:",t)}}bandpassFilter(e){const t=[];if(e.length<this.minSignalLengthForDetrending)return t;const n=this.detrendingWindowSize;for(let h=0;h<e.length;h++){const o=Math.max(0,h-n),f=Math.min(e.length,h+n+1),p=e.slice(o,f),x=p.reduce((y,w)=>y+w,0)/p.length,S=(e[h]-x)*this.detrendingAmplification;t.push(S)}const a=[],l=this.lowPassWindowSize;for(let h=0;h<t.length;h++){const o=Math.max(0,h-l),f=Math.min(t.length,h+l+1),p=t.slice(o,f);a.push(p.reduce((x,S)=>x+S,0)/p.length)}return a}calculateAutocorrelation(e){const t=[],n=e.length,a=e.reduce((h,o)=>h+o,0)/n,l=e.reduce((h,o)=>h+Math.pow(o-a,2),0)/n;for(let h=0;h<Math.min(n-1,this.maxAutocorrelationLags);h++){let o=0,f=0;for(let x=0;x<n-h;x++)o+=(e[x]-a)*(e[x+h]-a),f++;const p=f>0?o/(f*l+1e-10):0;t.push(p)}return t}findDominantPeak(e){if(e.length<this.minAutocorrelationLength)return this.log(`Autocorr too short (${e.length})`),0;const t=1e3/this.getAverageTimeInterval(),n=Math.floor(t/(this.maxBpmForPeakFinding/60)),a=Math.floor(t/(this.minBpmForPeakFinding/60));this.log(`sampleRate=${t.toFixed(1)}, minPeriod=${n}, maxPeriod=${a}, autocorrRange=[${n+1}-${Math.min(a,e.length-1)}]`);const l=n+1,h=Math.min(a,e.length-1),o=e.slice(l,h+1);this.log(`Autocorr values [${l}-${h}]:`,o.map((x,S)=>`${l+S}:${x.toFixed(4)}`).join(", "));let f=0,p=0;for(let x=Math.max(this.minLagForPeakFinding,n);x<Math.min(a,e.length);x++)e[x]>f&&(f=e[x],p=x);return p>0?(this.log(`Found best peak at index ${p}, value=${f.toFixed(4)}`),p):(this.log("No acceptable peaks found"),0)}calculateSignalMetrics(e){if(e.length<this.minSignalLengthForMetrics)return{confidence:0,snr:0,signalQuality:0};const t=Math.max(...e)-Math.min(...e),n=e.reduce((w,b)=>w+b,0)/e.length,a=e.reduce((w,b)=>w+Math.pow(b-n,2),0)/e.length,l=Math.sqrt(a),h=Math.min(t/this.expectedPpgAmplitude,1),o=t/(l+.001),f=Math.min(o/this.snrNormalizationFactor,1),p=Math.max(0,1-l/(t+.001)*this.consistencyScoreFactor);let x=0;if(e.length>this.minSignalLengthForTrendStability){const w=e.slice(0,Math.floor(e.length/2)),b=e.slice(Math.floor(e.length/2)),u=Math.max(...w)-Math.min(...w),g=Math.max(...b)-Math.min(...b),D=(u+g)/2;x=1-Math.abs(u-g)/(D+.001)}const S=h*this.confidenceWeights.amplitude+f*this.confidenceWeights.snr+p*this.confidenceWeights.consistency+x*this.confidenceWeights.stability,y=h*this.signalQualityWeights.amplitude+p*this.signalQualityWeights.consistency+x*this.signalQualityWeights.stability;return{confidence:Math.max(0,Math.min(1,S)),snr:Math.max(0,o),signalQuality:Math.max(0,Math.min(100,y*100))}}provideEarlyGuess(e,t){var n;const a=1e3/this.getAverageTimeInterval(),l=Math.floor(a/(this.earlyGuessMaxHeartRate/60)),h=Math.floor(a/(this.earlyGuessMinHeartRate/60));let o=0,f=0;for(let p=Math.max(this.earlyGuessMinLag,l);p<Math.min(h,t.length);p++)t[p]>o&&(o=t[p],f=p);if(f>0){const p=a/f,x=Math.round(p*60);if(x>=this.earlyGuessMinHeartRate&&x<=this.earlyGuessMaxHeartRate){const S=this.calculateSignalMetrics(e),y=Math.max(S.confidence*this.earlyGuessConfidenceBoost,this.earlyGuessMinConfidence);(!this.estimation_||!0)&&(this.estimation_={heartRate:x,confidence:y,isStable:!1,snr:S.snr,signalQuality:S.signalQuality},this.currentPulseRate=x,(n=this.onPulseRateUpdate)==null||n.call(this,this.currentPulseRate),this.log(`Early guess - HR: ${x} BPM, Confidence: ${(y*100).toFixed(1)}% (BEST GUESS)`))}}}checkHeartRateStability(){if(this.heartRateHistory.length<this.stabilityCheckMinHistoryLength)return!1;const e=this.heartRateHistory.reduce((n,a)=>n+a,0)/this.heartRateHistory.length,t=this.heartRateHistory.reduce((n,a)=>n+Math.pow(a-e,2),0)/this.heartRateHistory.length;return Math.sqrt(t)<this.stabilityThresholdBpm}updateWithServerResult(e,t,n){var a;this.log(`Updating estimation with server result: ${e} BPM, SNR: ${t}, Signal Quality: ${n}`),this.estimation_={heartRate:Math.round(e),confidence:1,isStable:!0,snr:t,signalQuality:n},this.currentPulseRate=Math.round(e),(a=this.onPulseRateUpdate)==null||a.call(this,this.currentPulseRate)}reset(){this.estimation_=null,this.signalBuffer=[],this.timestamps=[],this.currentPulseRate=0,this.heartRateHistory=[]}getAverageTimeInterval(){if(this.timestamps.length<2)return this.defaultTimeIntervalMs;let e=0;for(let t=1;t<this.timestamps.length;t++)e+=this.timestamps[t]-this.timestamps[t-1];return e/(this.timestamps.length-1)}}async function Br(s){return s?.mode==="fda"?new Ar(s):new Ir(s)}function _r(s){let e=document.createElement("div"),t=document.createElement("div");return e.appendChild(t),s.after(e),e.style.pointerEvents="none",e}function Or(s,e,t){const n=e.clientWidth/e.clientHeight,a=t.videoWidth/t.videoHeight;let l,h;a>n?(l=e.clientHeight,h=l*a):(h=e.clientWidth,l=h/a);const o=(l-e.clientHeight)/2,f=(h-e.clientWidth)/2;return{left:(s.xCenter-s.width/2)*h-f,top:(s.yCenter-s.height/2)*l-o,width:s.width*h,height:s.height*l}}class di{constructor(e,t){d(this,"boundingBox"),d(this,"video"),d(this,"color"),this.video=e,this.color=t?.color||"red",this.enabled=!0}set enabled(e){var t;e&&!this.boundingBox&&(this.boundingBox=_r(this.video)),!e&&this.boundingBox&&((t=this.boundingBox.parentElement)==null||t.removeChild(this.boundingBox),this.boundingBox=void 0)}updateOptions(e){e.color&&e.color!==this.color&&(this.color=e.color)}update(e){if(!this.boundingBox)return;this.boundingBox.style.position="fixed";const{x:t,y:n,width:a,height:l}=this.video.getBoundingClientRect();this.boundingBox.style.left=`${t}px`,this.boundingBox.style.top=`${n}px`,this.boundingBox.style.width=`${a}px`,this.boundingBox.style.height=`${l}px`,this.boundingBox.style.transform=`${this.video.style.transform}`,this.boundingBox.style.overflow="clip";const h=this.boundingBox.children[0];if(e===void 0){h.style.setProperty("display","none");return}const o=Or(e,this.video,this.video);h.style.display="block",h.style.position="relative",h.style.left=`${o.left}px`,h.style.top=`${o.top}px`,h.style.width=`${o.width}px`,h.style.height=`${o.height}px`,h.style.borderStyle="solid",h.style.borderColor=this.color||"red"}}const Lr=".up-down-mask-animation{mask:linear-gradient(to bottom,transparent,black,transparent);-webkit-mask-size:100% 10%;mask-size:100% 10%;-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;animation:moveMaskUpDown var(--face-mesh-animation-duration, 2s) linear infinite}@keyframes moveMaskUpDown{0%{-webkit-mask-position:0% 0;mask-position:0% 0}50%{-webkit-mask-position:0% 100%;mask-position:0% 100%}to{-webkit-mask-position:0% 0;mask-position:0% 0}}.left-right-mask-animation{mask:linear-gradient(to right,transparent,black,transparent);-webkit-mask-size:10% 100%;mask-size:10% 100%;-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;animation:moveMaskLeftRight var(--face-mesh-animation-duration, 2s) linear infinite}@keyframes moveMaskLeftRight{0%{-webkit-mask-position:0% 0;mask-position:0% 0}50%{-webkit-mask-position:100% 0;mask-position:100% 0}to{-webkit-mask-position:0% 0;mask-position:0% 0}}.four-way-mask-animation{mask:linear-gradient(to bottom,transparent,black,transparent),linear-gradient(to right,transparent,black,transparent);-webkit-mask-size:100% 10%,10% 100%;mask-size:100% 10%,10% 100%;-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-composite:source-over;mask-composite:add;animation:moveMaskFourWay var(--face-mesh-animation-duration, 2s) linear infinite}@keyframes moveMaskFourWay{0%{-webkit-mask-position:0% 0,0% 0;mask-position:0% 0,0% 0}25%{-webkit-mask-position:0% 100%,0% 0;mask-position:0% 100%,0% 0}50%{-webkit-mask-position:0% 0%,0% 0;mask-position:0% 0%,0% 0}75%{-webkit-mask-position:0% 0%,100% 0;mask-position:0% 0%,100% 0}to{-webkit-mask-position:0% 0,0% 0;mask-position:0% 0,0% 0}}";async function $r(){const{FACEMESH_FACE_OVAL:s}=await at();return s}async function Ur(s,e,t,n){if(e===void 0||t===void 0)return;s.save();const a=s.canvas.width,l=s.canvas.height,h=n?.lineWidth||await Vr(e,a);for(var o=0;o<t.length;o++){const f=t[o];s.beginPath();const p=e[f[0]],x=e[f[1]];s.moveTo(p.x*a,p.y*l),s.lineTo(x.x*a,x.y*l),s.lineWidth=h,s.strokeStyle=n?.color||"lightgreen",s.stroke()}s.restore()}async function Vr(s,e){const t=await Hr(s)*.01*e;return console.log("lineWidth = ",t),t}async function Hr(s){const e=(await $r()).map(([t])=>s[t].x);return Math.abs(Math.max(...e)-Math.min(...e))}class ui{constructor(e,t){d(this,"faceMesh"),d(this,"canvas"),d(this,"video"),d(this,"color","lightgreen"),d(this,"lineWidth"),d(this,"animateStyle"),d(this,"animationSpeed"),d(this,"animationDelay"),d(this,"animationDirection"),this.video=e,this.color=t?.color||this.color,this.lineWidth=t?.lineWidth||this.lineWidth,this.animationSpeed=t?.animationSpeed,this.animationDelay=t?.animationDelay,this.animationDirection=t?.animationDirection,this.enabled=!0,this.animateStyle=document.createElement("style"),this.animateStyle.innerHTML=Lr,this.animate=t?.animate!==void 0?t.animate:!0}destroy(){console.log("[VitalSignCamera] Trying to destroy face mesh..."),this.faceMesh&&this.faceMesh.parentElement&&(this.faceMesh.parentElement.removeChild(this.faceMesh),console.log("[VitalSignCamera] Face mesh removed."),this.faceMesh=void 0,this.canvas=void 0),this.animateStyle.parentElement&&(this.animateStyle.parentElement.removeChild(this.animateStyle),console.log("[VitalSignCamera] Face mesh animation CSS removed."))}get animationClass(){return this.animationDirection==="vertical"?"up-down-mask-animation":this.animationDirection==="horizontal"?"left-right-mask-animation":this.animationDirection=="both"?"four-way-mask-animation":"up-down-mask-animation"}set enabled(e){var t;e&&!this.faceMesh&&(this.faceMesh=document.createElement("div"),this.canvas=document.createElement("canvas"),this.canvas.style.setProperty("--face-mesh-animation-duration",`${this.animationSpeed??8}s`),this.canvas.style.setProperty("--face-mesh-animation-delay",`${this.animationDelay??-1.5}s`),console.log("Applying animation class",this.animationDirection,this.animationSpeed),this.canvas.className=`face-mesh-canvas ${this.animationClass}`,this.faceMesh.appendChild(this.canvas),this.faceMesh.style.width="0px",this.faceMesh.style.height="0px",this.faceMesh.style.pointerEvents="none",this.faceMesh.style.overflow="clip",this.video.after(this.faceMesh),console.log("[VitalSignCamera] Face mesh inserted.")),!e&&this.faceMesh&&((t=this.faceMesh.parentElement)==null||t.removeChild(this.faceMesh),this.faceMesh=void 0,this.canvas=void 0)}set animate(e){var t;e&&!this.animate&&(document.body.append(this.animateStyle),console.log("[VitalSignCamera] Face mesh CSS inserted.")),!e&&this.animate&&((t=this.animateStyle.parentElement)==null||t.removeChild(this.animateStyle))}get animate(){return this.animateStyle.parentElement!==null}get enabled(){return this.faceMesh!==void 0}updateOptions(e){e.color!==void 0&&e.color!==this.color&&(this.color=e.color),e.lineWidth!==void 0&&e.lineWidth!==this.lineWidth&&(this.lineWidth=e.lineWidth),e.animate!==void 0&&e.animate!==this.animate&&(this.animate=e.animate),e.animationSpeed!==void 0&&e.animationSpeed!==this.animationSpeed&&(this.animationSpeed=e.animationSpeed,this.canvas&&this.canvas.style.setProperty("--face-mesh-animation-duration",`${this.animationSpeed}s`)),e.animationDelay!==void 0&&e.animationDelay!==this.animationDelay&&(this.animationDelay=e.animationDelay,this.canvas&&this.canvas.style.setProperty("--face-mesh-animation-delay",`${this.animationDelay}s`)),e.animationDirection!==void 0&&e.animationDirection!==this.animationDirection&&(this.animationDirection=e.animationDirection,this.canvas&&(this.canvas.className=`face-mesh-canvas ${this.animationClass}`))}update(e){if(!this.faceMesh||!this.canvas)return;this.faceMesh.style.position="fixed";const{x:t,y:n,width:a,height:l}=this.video.getBoundingClientRect();this.faceMesh.style.left=`${t}px`,this.faceMesh.style.top=`${n}px`,this.faceMesh.style.width=`${a}px`,this.faceMesh.style.height=`${l}px`,this.faceMesh.style.transform=`${this.video.style.transform}`,this.faceMesh.style.overflow="clip",this.redraw(e);const h=this.computeStyle(this.faceMesh);this.canvas.style.left=h.left,this.canvas.style.top=h.top,this.canvas.style.width=h.width,this.canvas.style.height=h.height,this.canvas.style.aspectRatio=h.aspectRatio,this.canvas.style.position="relative"}async redraw(e){const{FACEMESH_TESSELATION:t}=await at();if(!this.faceMesh||!this.canvas){console.warn("Undefined canvas or face mesh");return}this.canvas.width=this.video.videoWidth,this.canvas.height=this.video.videoHeight;const n=this.canvas.getContext("2d");if(n===null){console.warn("Null Context");return}if(n.save(),n.clearRect(0,0,this.canvas.width,this.canvas.height),e!==void 0&&e.length>0){const a=await this.computeLineWidth(e);n.lineTo(this.canvas.width,this.canvas.height),Ur(n,e,t,{color:this.color,lineWidth:a})}n.restore()}computeStyle(e){let t=0;const n=this.video.videoHeight,a=this.video.videoWidth;t=a&&n?a/n:0;const l={width:"",height:"",left:"0%",top:"0%",aspectRatio:`${t}`},h=e.clientWidth/e.clientHeight;return h<t?(l.left=`${(h-t)/h/2*100}%`,l.height="100%"):(l.top=`${(1/h-1/t)*h/2*100}%`,l.width="100%"),l}async computeLineWidth(e){const t=this.video.videoWidth,n=this.lineWidth===void 0?"1%":this.lineWidth,a=await Wr(e);var l;return typeof n=="string"?l=parseFloat(n)*.01*a*t:l=n,l}}async function Wr(s){const{FACEMESH_FACE_OVAL:e}=await at(),t=e.map(([n])=>s[n].x);return Math.abs(Math.max(...t)-Math.min(...t))}async function Nr(s){const{RemoteBeautyAnalyzer:e}=await Ce(async()=>{const{RemoteBeautyAnalyzer:t}=await import("./D4TylDJq-dlVlft71.js");return{RemoteBeautyAnalyzer:t}},[]);return new e(s)}function Mt(s){var e;const{videoFrame:t,rect:n}=s,{x:a,y:l,w:h,h:o}=n,f=new OffscreenCanvas(t.width,t.height);(e=f.getContext("2d"))==null||e.putImageData(t,0,0);let p=new OffscreenCanvas(h,o).getContext("2d");return p.drawImage(f,a,l,h,o,0,0,h,o),p.getImageData(0,0,h,o)}self.onmessage=s=>{const{inputData:e,hash:t}=s.data,n=Mt(e);self.postMessage({result:n,hash:t},[n.data.buffer])};class zr{constructor(e,t,n){if(d(this,"type","chest"),d(this,"boundingBox"),d(this,"imageData"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BVv6I5U7-eMazRsx3.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Mt,"ChestROIExtractorWorker")),this.boundingBox=this.chestRect({width:e.width,height:e.height},t,n),this.boundingBox===void 0){this.imageData=Promise.resolve(void 0);return}this.imageData=e.getImageData().then(a=>{if(!(!a||!this.boundingBox))return this.workerPool.callWorker({videoFrame:a,rect:this.boundingBox})})}chestRect(e,t,n){if(!t||!n)return;let a=t.width*e.width,l=t.height*e.height,h=(n.xCenter-t.width/2)*e.width,o=(t.yCenter-t.height/2)*e.height;if(o=o+l,o+l>e.height&&(l=e.height-o),!(a<=0||l<=0)&&!(l<.1*n.height*e.height))return{x:h,y:o,w:a,h:l}}}class jr{constructor(e,t,n,a="rgb1x1",l=ie.AwsEnterpriseProd){if(d(this,"type","face"),d(this,"boundingBox"),d(this,"imageData"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/BVv6I5U7-eMazRsx3.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Mt,"FaceROIExtractorWorker")),this.boundingBox=this.faceRect({width:e.width,height:e.height},t,n,a,l),this.boundingBox===void 0){this.imageData=Promise.resolve(void 0);return}this.imageData=e.getImageData().then(h=>{if(!(!h||!this.boundingBox))return this.workerPool.callWorker({videoFrame:h,rect:this.boundingBox})})}faceRect(e,t,n,a,l){var h;if(!t||!n)return;let o=1,f=t.width*e.width*o,p=t.height*e.height*o,x=(n.xCenter-t.width/2*o)*e.width,S=(n.yCenter-t.height/2*o)*e.height;if(f==0||p==0)return;let y=(h=Dt.get(l))==null?void 0:h.schemaVersion;return(a=="rgb1x1"||a=="yuv1x1"&&y&&We(y,"2.0")<0)&&(p=p*.7),{x,y:S,w:f,h:p}}}function gi(s){const e=s.map(n=>n.x),t=s.map(n=>n.y);return{min:{x:Math.min(...e),y:Math.min(...t)},max:{x:Math.max(...e),y:Math.max(...t)}}}function qr(s){const e=s.reduce((t,n)=>({x:t.x+n.x,y:t.y+n.y}),{x:0,y:0});return{x:e.x/s.length,y:e.y/s.length}}function Gr(s,e,t){const n=[s[0].x,s[0].y,s[1].x,s[1].y],a=[e[0].x,e[0].y,e[1].x,e[1].y],[l,h,o,f]=n,p=Math.sqrt(Math.pow(Math.abs(l-o),2)+Math.pow(Math.abs(h-f),2)),[x,S,y,w]=a,b=x-y,u=S-w,g=[1,0],D=[o-l,f-h],E=g[0]*D[0]+g[1]*D[1],v=Math.sqrt(g[0]*g[0]+g[1]*g[1]),M=Math.sqrt(D[0]*D[0]+D[1]*D[1]),F=Math.acos(E/(v*M)),T=Math.abs(Math.cos(F)*p/2),P=Math.abs(Math.sin(F)*p/2),A={x:t.x-b/2,y:t.y-u/2*.8},j={x:t.x-T/2,y:t.y-P/2},U={x:t.x+T/2,y:t.y+P/2},H={x:A.x+T/2,y:A.y+P/2},G={x:A.x-T/2,y:A.y-P/2};return[j,U,H,G]}function Qr(s,e){const t=gi(e),n=t.min.x,a=t.min.y,l=t.max.x,h=t.max.y,o=[(l-n)*.25,(h-a)*.25];let f,p,x,S;switch(s){case"forehead":f=e[151].x,p=e[151].y,x=o[0]*2,S=o[1]*.5;break;case"glabella":f=e[8].x,p=e[8].y,x=o[0]*.6,S=o[1]*.6;break;case"rightCheek":f=e[425].x,p=e[425].y-o[1]*.2,x=o[0]*.8,S=o[1]*.6;break;case"leftCheek":f=e[205].x,p=e[205].y-o[1]*.2,x=o[0]*.8,S=o[1]*.6;break;case"chin":f=e[200].x,p=e[200].y,x=o[0]*.8,S=o[1]*.4;break;case"neck":const g=[e[205],e[425]],D=[e[168],e[4]],E=e[152],v=Gr(g,D,E),M=gi(v),F=qr(v);f=F.x,p=F.y,x=M.max.x-M.min.x,S=M.max.y-M.min.y,p+=S,S*=2;break;case"rightLowerCheek":f=e[425].x,p=e[425].y,x=o[0],S=o[1]/2,p+=S/2;break;case"rightUpperCheek":f=e[425].x,p=e[425].y,x=o[0],S=o[1]/2,p-=S/2;break;case"leftLowerCheek":f=e[205].x,p=e[205].y,x=o[0],S=o[1]/2,p+=S/2;break;case"leftUpperCheek":f=e[205].x,p=e[205].y,x=o[0],S=o[1]/2,p-=S/2;break;default:throw new Error(`Unsupported ROI part: ${s}`)}const y=f-x/2,w=p-S/2,b=y+x,u=w+S;return[{x:y,y:w},{x:b,y:w},{x:b,y:u},{x:y,y:u}]}function Ti(s,e){if(e.length===0)return{x:0,y:0,w:0,h:0};if(e.length===1){const h=e[0];return{x:Math.floor(h.x)*s.width,y:Math.floor(h.y)*s.height,w:1,h:1}}let t=e[0].x,n=e[0].y,a=e[0].x,l=e[0].y;for(let h=1;h<e.length;h++){const o=e[h];o.x<t&&(t=o.x),o.y<n&&(n=o.y),o.x>a&&(a=o.x),o.y>l&&(l=o.y)}return{x:t*s.width,y:n*s.height,w:(a-t)*s.width,h:(l-n)*s.height}}function Pi(s){var e;const{videoFrame:t,normalizedPoints:n}=s,{x:a,y:l,w:h,h:o}=Ti(t,n),f=new OffscreenCanvas(t.width,t.height);(e=f.getContext("2d"))==null||e.putImageData(t,0,0);let p=new OffscreenCanvas(h,o).getContext("2d");p.beginPath();for(let x=0;x<n.length;x++){const S=n[x],y=(S.x-a/t.width)*(t.width/h)*h,w=(S.y-l/t.height)*(t.height/o)*o;x===0?p.moveTo(y,w):p.lineTo(y,w)}return p.closePath(),p.clip(),p.drawImage(f,a,l,h,o,0,0,h,o),p.getImageData(0,0,h,o)}self.onmessage=s=>{const{inputData:e,hash:t}=s.data,n=Pi(e);self.postMessage({result:n,hash:t},[n.data.buffer])};class Yr{constructor(e,t,n){d(this,"type"),d(this,"boundingBox"),d(this,"imageData"),d(this,"workerFactory",()=>new Worker(new URL("/sdk-live-demo/realtime-demo/assets/CDhEsE-f-CpFHRKS_.js",import.meta.url),{type:"module"})),d(this,"workerPool",me(this.workerFactory,Pi,"PolygonROIExtractorWorker",1e3,48)),this.type=t,this.boundingBox=Ti(e,n),this.imageData=e.getImageData().then(a=>{if(!(!a||!this.boundingBox))return this.workerPool.callWorker({videoFrame:a,normalizedPoints:n})})}}class Kr{constructor(e,t){d(this,"canvas"),d(this,"config"),d(this,"faceDetectionSamplingInterval"),d(this,"debug",!1),d(this,"sampledFaceDetection"),d(this,"firstFaceDetection"),this.canvas=document.createElement("canvas"),this.config=t,this.faceDetectionSamplingInterval=e,console.log("[VitalSignCamera] DefaultFaceROIExtractor initialized")}reset(){this.sampledFaceDetection=void 0,this.firstFaceDetection=void 0}processFrame(e,t,n){n==="idle"&&(this.sampledFaceDetection=void 0,this.firstFaceDetection=void 0);const a=new Date().getTime();return(!this.sampledFaceDetection||!this.faceDetectionSamplingInterval||a-this.sampledFaceDetection.timestamp>this.faceDetectionSamplingInterval)&&(this.sampledFaceDetection={timestamp:new Date().getTime(),...t}),this.firstFaceDetection===void 0&&(this.firstFaceDetection=t),{images:(this.config.enabledROIs??["face","chest"]).reduce((l,h)=>{var o,f,p,x,S,y;if(h==="face")l.face=new jr(e,(o=this.firstFaceDetection)==null?void 0:o.faceBox,(f=this.sampledFaceDetection)==null?void 0:f.faceBox,this.config.pixelDataType,this.config.serverId);else if(h==="chest")l.chest=new zr(e,(p=this.firstFaceDetection)==null?void 0:p.faceBox,(x=this.sampledFaceDetection)==null?void 0:x.faceBox);else{if(!((S=this.sampledFaceDetection)!=null&&S.landmarks)||this.sampledFaceDetection.landmarks.length===0)return l;const w=Qr(h,(y=this.sampledFaceDetection)==null?void 0:y.landmarks),b=new Yr(e,h,w);l[h]=b}return this.debug&&l[h]&&this.debugRoi(l[h]),l},{})}}cropFrame(e,t){const n=this.canvas;return n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(e,t.x,t.y,t.width,t.height,0,0,n.width,n.height),n.getContext("2d").canvas}async debugRoi(e){var t;const n=await e.imageData;if(n===void 0){console.log("[VitalSignCamera] debugRoi: imageData is undefined");return}const a=document.createElement("canvas");a.width=n.width,a.height=n.height,(t=a.getContext("2d"))==null||t.putImageData(n,0,0);const l=a.toDataURL(),h=`debug-${e.type}`,o=document.getElementById(h);if(o)o.setAttribute("src",l);else{const f=document.createElement("img");f.id=h,f.setAttribute("src",l),document.body.appendChild(f)}}}function fi(s,e){var t;return console.log(`[VitalSignCamera] createFaceROIExtractor for ${(t=e.enabledROIs)==null?void 0:t.join(", ")} ROIs`),new Kr(s,e)}const Fi=te.isMobile&&!te.isTablet,Xr=Fi?Se.sd480x360:te.isTablet?Se.hd1280x720:Se.hd1920x1080,mi={engineConfig:{serverId:ie.Schema2Prod,dataCollectionDuration:25,dataSendingDuration:5,enabledROIs:["face","chest"],pixelDataType:"rgb1x1",chestPixelDataType:"ggg1x1",landmarksSampleRate:10},conditionCheckerConfig:{minimumFrameRate:Fi||te.isAndroid?10:15},presetFormat:Xr,maxFaceDetectionFps:5},Zr={engineConfig:{serverId:ie.Schema2Prod,dataCollectionDuration:18,dataSendingDuration:10,enabledROIs:["face","chest","leftCheek","rightCheek","chin","glabella"],pixelDataType:"rgb8x8",chestPixelDataType:"meanRgb1x1",landmarksSampleRate:10},conditionCheckerConfig:{minimumFrameRate:25},presetFormat:te.isMobile?Se.hd1280x720:Se.hd1920x1080,maxFaceDetectionFps:15};function Ai(s){switch(s){case Me.relaxed:return mi;case Me.strict:return Zr;default:return mi}}class Jr{constructor(e){d(this,"lastFramerateOKTime",new Date),d(this,"requiredStableDuration",1e4),d(this,"waitingResponse",!1),this.camera=e}reset(){this.lastFramerateOKTime=new Date}process(e,t){var n;if(this.camera.precisionMode===void 0)return;const a=(n=Ai(this.camera.precisionMode).conditionCheckerConfig)==null?void 0:n.minimumFrameRate;if(!(a===void 0||(e>=a&&(this.lastFramerateOKTime=new Date),!this.lastFramerateOKTime)||this.waitingResponse)&&new Date().getTime()-this.lastFramerateOKTime.getTime()>=this.requiredStableDuration&&this.camera.precisionMode!==Me.relaxed&&t==="idle")if(this.camera.onPrecisionModeWillUpdate){this.waitingResponse=!0,this.camera.onPrecisionModeWillUpdate({currentMode:this.camera.precisionMode,newMode:Me.relaxed,reason:"lowFrameRate",response:l=>{this.waitingResponse=!1,l==="proceed"?this.updatePrecisionModeToRelaxed("response"):l==="wait"?this.reset():this.waitingResponse=!1}});return}else console.log("No onPrecisionModeWillUpdate handler, proceeding to update precision mode."),this.updatePrecisionModeToRelaxed()}updatePrecisionModeToRelaxed(e="lowFrameRate"){this.camera.precisionMode=Me.relaxed,this.camera.onPrecisionModeUpdated&&this.camera.onPrecisionModeUpdated({previousMode:Me.strict,currentMode:Me.relaxed,reason:e}),console.log(`[VitalSignCamera] Precision mode switched to relaxed after stable frame rate for ${this.requiredStableDuration} ms`)}}class ea{constructor(){d(this,"config"),d(this,"currentStage"),d(this,"currentStageStartTime"),d(this,"grabbedFrames",[]),this.config={grabbingPoints:void 0}}configure(e){this.config=e}reset(){this.currentStage=void 0,this.currentStageStartTime=void 0,this.grabbedFrames=[]}processFrame(e,t,n){if(!this.config.grabbingPoints||this.config.grabbingPoints.length===0||(this.currentStage!==t&&(this.currentStage=t,this.currentStageStartTime=Date.now()),!this.currentStageStartTime))return;const a=Date.now()-this.currentStageStartTime,l=this.config.grabbingPoints||[];for(const h of l)h.stage===t&&(this.grabbedFrames.some(o=>o.stage===h.stage&&o.offset===h.offset)||a<h.offset||(console.log(`[Frame Grabber] Grabbing frame at stage ${q[h.stage]} with offset ${h.offset} ms`),this.grabbedFrames.push({canvas:e.getCanvas(),stage:h.stage,offset:h.offset})))}}function ta(){return new ea}const Xe=te.isMobile&&!te.isTablet;class ia{constructor(e){d(this,"id",`${Math.floor(Math.random()*1e4)}`),d(this,"deviceCaps",or),d(this,"version",Et),d(this,"_isActive"),d(this,"_userInfo"),d(this,"_config"),d(this,"faceDetectorType"),d(this,"_presetFormat"),d(this,"checkBrightness",!0),d(this,"_device"),d(this,"preferredCamera"),d(this,"maxFps"),d(this,"maxFaceDetectionFps"),d(this,"_precisionMode"),d(this,"disableAgeEstimation"),d(this,"enableBeautyAnalysis"),d(this,"_visualizationOptions"),d(this,"customConditionRange"),d(this,"faceDetectionRegion"),d(this,"faceDetectionModelLocation"),d(this,"_realtimeEstimationConfig"),d(this,"vsStatus","idle"),d(this,"_faceDetectionResult"),d(this,"faceDetectionTimer"),d(this,"faceDetectionFunction"),d(this,"camera",null),d(this,"cameraStartTime"),d(this,"videoFrameInfo",null),d(this,"videoFrame"),d(this,"healthResult"),d(this,"video",null),d(this,"transform","none"),d(this,"_videoSettings"),d(this,"cameraFps",new ai("camera")),d(this,"faceDetectionFps",new ai("face detection")),d(this,"activateAfterBound",!1),d(this,"boundingBox"),d(this,"faceMesh"),d(this,"faceDetectionSamplingInterval"),d(this,"vitalSignEngine"),d(this,"faceDetector"),d(this,"roiExtractor"),d(this,"ageEstimator"),d(this,"beautyAnalyzer"),d(this,"realtimeEstimator"),d(this,"conditionChecker"),d(this,"frameGrabber"),d(this,"precisionModeChecker",new Jr(this)),d(this,"cameraDevices"),d(this,"onVideoFrameProcessed"),d(this,"onTransformUpdated"),d(this,"onVideoSettingsUpdated"),d(this,"onCameraDevicesUpdated"),d(this,"onInitialized"),d(this,"onPrecisionModeUpdated"),d(this,"onPrecisionModeWillUpdate"),d(this,"onError");var t;window.__vital_sign_camera_impl__=this,console.log(`[VitalSignCamera] Welcome to VitalSignCamera ${Et}`),console.log("[VitalSignCamera] Initializing with props...",e);let n=new Date;this._isActive=!1,this.activateAfterBound=e.isActive,this._config=e.config||{},this._device=e.device,this.preferredCamera=e.preferredCamera,this._userInfo=e.userInfo,this._visualizationOptions=e.visualizationOptions,this.faceDetectionRegion=e.faceDetectionRegion,this.faceDetectionSamplingInterval=e.faceDetectionSamplingInterval,this._realtimeEstimationConfig=e.realtimeEstimationConfig,te.isMobile?Xe?this._presetFormat=Se.sd480x360:this._presetFormat=Se.hd1280x720:this._presetFormat=Se.hd1920x1080,e.customConditionRange!==void 0&&(this.customConditionRange=e.customConditionRange),e.checkBrightness!==void 0?this.checkBrightness=e.checkBrightness:(te.isAndroid&&(console.log("[VitalSignCamera] Android detected. Turn off brightness check."),this.checkBrightness=!1),e.faceDetectorType===ne.Dummy&&(console.log("[VitalSignCamera] Dummy face detector being used. Turn off brightness check."),this.checkBrightness=!1)),e.faceDetectorType!==void 0?(console.log(`[VitalSignCamera] Setting face detector type ${e.faceDetectorType}...`),this.faceDetectorType=e.faceDetectorType):(console.log("[VitalSignCamera] Auto setting face detector type..."),te.isAndroid?(console.log("[VitalSignCamera] Android detected"),console.log("[VitalSignCamera] Setting new MediaPipe face detector"),this.faceDetectorType=ne.MPFaceMesh):te.isIOS&&We(te.browserVersion,"18.0")<0?(console.log("[VitalSignCamera] Setting new MediaPipe facemesh detector"),this.faceDetectorType=ne.MPFaceMesh):(console.log("[VitalSignCamera] Setting new MediaPipe facemesh threaded detector"),this.faceDetectorType=ne.MPFaceMeshThreaded)),e.presetFormat!==void 0&&(this._presetFormat=e.presetFormat),e.maxFps!==void 0?(console.log(`[VitalSignCamera] Setting max camera fps to ${e.maxFps}`),this.maxFps=e.maxFps):(this.maxFps=Xe?30:60,console.log(`[VitalSignCamera] Auto setting max camera fps to ${this.maxFps}`)),e.maxFaceDetectionFps!==void 0?(console.log(`[VitalSignCamera] Setting max face detection fps to ${e.maxFaceDetectionFps}`),this.maxFaceDetectionFps=e.maxFaceDetectionFps):Xe||te.isAndroid?(this.maxFaceDetectionFps=2,console.log(`[VitalSignCamera] Mobile phone or Android detected, auto setting max face detection fps to ${this.maxFaceDetectionFps}`)):(this.maxFaceDetectionFps=5,console.log(`[VitalSignCamera] Auto setting max face detection fps to ${this.maxFaceDetectionFps}`)),((t=e.config)==null?void 0:t.blinkDetectorType)===Ne.default&&(console.log("[VitalSignCamera] Blink detector enabled, forcing face detection fps to 15"),this.maxFaceDetectionFps=Math.max(15,this.maxFaceDetectionFps)),e.disableAgeEstimation!==void 0?(console.log(`[VitalSignCamera] Setting age estimation: ${!e.disableAgeEstimation}`),this.disableAgeEstimation=e.disableAgeEstimation):(console.log("[VitalSignCamera] Auto setting age estimation..."),Xe?(console.log("[VitalSignCamera] is phone -> ageEstimation = false"),this.disableAgeEstimation=!0):(console.log("[VitalSignCamera] Not phone -> ageEstimation = true"),this.disableAgeEstimation=!1)),e.enableBeautyAnalysis!==void 0?(console.log(`[VitalSignCamera] Setting beauty analysis: ${e.enableBeautyAnalysis}`),this.enableBeautyAnalysis=e.enableBeautyAnalysis,this.enableBeautyAnalysis&&this.disableAgeEstimation&&(console.log("[VitalSignCamera] Beauty analysis ON -> Forcing ageEstimation = true"),this.disableAgeEstimation=!1)):this.enableBeautyAnalysis=!1,e.frameGrabberConfig!==void 0&&(this.frameGrabber=ta(),this.frameGrabber.configure(e.frameGrabberConfig));const a=this.disableAgeEstimation,l=this.enableBeautyAnalysis;this.onVideoFrameProcessed=e.onVideoFrameProcessed,this.onVideoSettingsUpdated=e.onVideoSettingsUpdated,this.onCameraDevicesUpdated=e.onCameraDevicesUpdated,this.onInitialized=e.onInitialized,this.onPrecisionModeUpdated=e.onPrecisionModeUpdated,this.onPrecisionModeWillUpdate=e.onPrecisionModeWillUpdate,this.onError=e.onError,this.vitalSignEngine=ir(),this.roiExtractor=fi(this.faceDetectionSamplingInterval,this.config),this.sdkCredentials=e.sdkCredentials,this.conditionChecker=Er(this.vitalSignEngine,e.conditionCheckerConfig,this.customConditionRange),e.precisionMode!==void 0&&(this.precisionMode=e.precisionMode),this.cameraDevices=new Mr(this,h=>{this.onCameraDevicesUpdated&&this.onCameraDevicesUpdated({devices:h,selected:this.device})}),this.cameraDevices.start(),(async()=>{var h;try{a||(this.ageEstimator=await Tr(e.faceApiModelPath),this.ageEstimator.configure(e.ageEstimationConfig)),l&&(this.beautyAnalyzer=await Nr({apiKey:(h=e.config)==null?void 0:h.apiKey})),this._realtimeEstimationConfig&&(this.realtimeEstimator=await Br(this._realtimeEstimationConfig)),this.faceDetector=await this.createFaceDetector(e.faceDetectionModelLocation),this.onInitialized&&this.onInitialized();const o=(new Date().getTime()-n.getTime())/1e3;console.log(`[VitalSignCamera] initialized. Loading time ${o}s.`)}catch(o){console.error(o),console.log("[VitalSignCamera] initialization failed."),this.onError&&this.onError(o),this.camera&&this.cameraStartTime&&this.stopCamera()}})()}async createFaceDetector(e){try{console.log("[VitalSignCamera] Model loading location: ",e);let t=await li(this.faceDetectorType);return await t.loadModels(e),t}catch(t){if(this.faceDetectorType==ne.MPFaceMeshThreaded)return console.warn("[VitalSignCamera] Failed to initialize MediaPipe FaceMesh threaded detector. Falling back to non-threaded version."),this.faceDetectorType=ne.MPFaceMesh,await this.createFaceDetector(e);throw t}}bind(e){this.video=e,this.video.setAttribute("autoplay","true"),this.video.setAttribute("playsinline",""),this.config&&(this.vitalSignEngine.configure(this.config),this.vitalSignEngine.isReady()),this.faceDetectorType===ne.TFMediaPipe&&this.vitalSignEngine.configure({blinkDetectorType:Ne.default}),this.isActive=this.activateAfterBound}set device(e){const t=this.isActive;this._device&&this._device.length>0&&this._device!==e&&this.stopCamera(),this._device=e,e?t&&this.startCamera():this.stopCamera()}get device(){return this._device}set isActive(e){e?this.startCamera():this.stopCamera()}get isActive(){return this._isActive}set presetFormat(e){if(this._presetFormat===e)return;const t=this.isActive;this.stopCamera(),this._presetFormat=e,t&&this.startCamera()}get presetFormat(){return this._presetFormat}set config(e){this._config={...this._config},Object.keys(e).forEach(t=>{const n=t;e[n]!==void 0&&(this._config[n]=e[n])}),this.config&&(this.vitalSignEngine.configure(this.config),this.roiExtractor=fi(this.faceDetectionSamplingInterval,this.config))}get config(){let e={...this._config};const t=new URLSearchParams(location.search).get("PANOPTIC_API_KEY");return t&&(e.apiKey=t),e}set userInfo(e){this._userInfo={...this._userInfo},Object.keys(e).forEach(t=>{const n=t;e[n]!==void 0&&(this._userInfo[n]=e[n])})}get userInfo(){let e={...this._userInfo};const t=new URLSearchParams(location.search).get("PANOPTIC_USER_ID");return t&&(e.userId=t),e}get sdkCredentials(){if(!(!this.config.apiKey&&!this.userInfo.userId))return{apiKey:this.config.apiKey,userId:this.userInfo.userId}}set sdkCredentials(e){e!=null&&e.apiKey&&(this.config={apiKey:e?.apiKey}),e!=null&&e.userId&&(this.userInfo={userId:e?.userId})}get precisionMode(){return this._precisionMode}set precisionMode(e){if(!e)return;this._precisionMode!==e&&(this.onPrecisionModeUpdated&&this.onPrecisionModeUpdated({previousMode:this._precisionMode,currentMode:e,reason:"manual"}),this.precisionModeChecker.reset()),this._precisionMode=e;const t=Ai(e);this.config=t.engineConfig,this.vitalSignEngine.configure(this.config),t.conditionCheckerConfig&&this.conditionChecker.configure(t.conditionCheckerConfig),t.presetFormat&&(this.presetFormat=t.presetFormat),t.maxFaceDetectionFps!==void 0&&(this.maxFaceDetectionFps=t.maxFaceDetectionFps,this.faceDetectionFunction&&this.startFaceDetection())}set faceDetectionResult(e){var t,n,a,l;this._faceDetectionResult=e,(t=this.faceDetectionResult)!=null&&t.videoFrame.width&&(n=this.faceDetectionResult)!=null&&n.videoFrame.height&&(this.videoFrameInfo={timestamp:performance.now(),width:(a=this.faceDetectionResult)==null?void 0:a.videoFrame.width,height:(l=this.faceDetectionResult)==null?void 0:l.videoFrame.height})}get faceDetectionResult(){return this._faceDetectionResult}get videoSettings(){return this._videoSettings}set videoSettings(e){if(this._videoSettings=e,e&&this.video){if(!this.onVideoSettingsUpdated)return;this.onVideoSettingsUpdated({video:this.video,settings:e})}}get visualizationOptions(){return this._visualizationOptions}set visualizationOptions(e){var t,n;if(this._visualizationOptions=e,!this.isActive)return;const a=e?.boundingBox&&e.boundingBox.enabled!==!1;a&&!this.boundingBox&&this.video&&(this.boundingBox=new di(this.video,(t=this._visualizationOptions)==null?void 0:t.boundingBox)),!a&&this.boundingBox&&(this.boundingBox.enabled=!1,this.boundingBox=void 0),this.boundingBox&&e!=null&&e.boundingBox&&this.boundingBox.updateOptions(e?.boundingBox);const l=e?.faceMesh&&e.faceMesh.enabled!==!1;l&&!this.faceMesh&&this.video&&(this.faceMesh=new ui(this.video,(n=this._visualizationOptions)==null?void 0:n.faceMesh)),!l&&this.faceMesh&&(this.faceMesh.destroy(),this.faceMesh=void 0),this.faceMesh&&e!=null&&e.faceMesh&&this.faceMesh.updateOptions(e?.faceMesh)}get faceMeshElement(){var e;return(e=this.faceMesh)==null?void 0:e.faceMesh}get boundingBoxElement(){var e;return(e=this.boundingBox)==null?void 0:e.boundingBox}get grabbedFrames(){var e;return(e=this.frameGrabber)==null?void 0:e.grabbedFrames}get realtimeEstimationConfig(){return this._realtimeEstimationConfig}set realtimeEstimationConfig(e){this._realtimeEstimationConfig=e,this.realtimeEstimator&&this.realtimeEstimator.configure(e)}get faceDetectionRegionAbs(){if(!this.faceDetectionRegion||!this.videoSettings)return;const{x:e,y:t,width:n,height:a}=this.faceDetectionRegion,l=this.videoSettings.width,h=this.videoSettings.height;return{x:typeof e=="string"?parseFloat(e)/100*l:e,y:typeof t=="string"?parseFloat(t)/100*h:t,width:typeof n=="string"?parseFloat(n)/100*l:n,height:typeof a=="string"?parseFloat(a)/100*h:a}}get processedFrame(){var e,t,n,a,l,h,o,f,p;if(this.videoFrameInfo===null||!this.videoFrame)return;const x=this.healthResult;return x!=null&&x.health&&(x.health.beautyAnalysis=(e=this.beautyAnalyzer)==null?void 0:e.result,x.health.vitalSigns={...x.health.vitalSigns,facialSkinAge:((n=(t=this.beautyAnalyzer)==null?void 0:t.result)==null?void 0:n.skinAge)||((l=(a=this.ageEstimator)==null?void 0:a.estimation)==null?void 0:l.age)}),{videoFrameInfo:this.videoFrameInfo,videoFrame:this.videoFrame,facebox:(h=this.faceDetectionResult)==null?void 0:h.faceBox,healthResult:x,scanConditions:this.conditionChecker.conditions,landmarks:(o=this.faceDetectionResult)==null?void 0:o.landmarks,realtimeEstimation:((f=this.realtimeEstimator)==null?void 0:f.estimation)||null,signalData:((p=this.realtimeEstimator)==null?void 0:p.signalData)||null}}updateVideoSettings(e){if(!e||!e.srcObject)return this.videoSettings=void 0,"not-ready";const t=e.srcObject.id,n=e.srcObject.getVideoTracks()[0].getSettings(),{width:a,height:l,frameRate:h}=n;return a===void 0||l===void 0?"undefined":(console.log(`[VitalSignCamera] Video Settings in ${te.browserName}: ${a}x${l} @ ${h} fps`),this.transform=pr(e),e.style.transform=this.transform,this.onTransformUpdated&&this.onTransformUpdated(this.transform),this.videoSettings={videoId:t,width:e.videoWidth||a,height:e.videoHeight||l,transformX:this.transform},"ok")}startCamera(){var e,t;this._isActive||(this._isActive=!0,this.processVideoFrame(),(e=this.visualizationOptions)!=null&&e.boundingBox&&this.visualizationOptions.boundingBox.enabled!==!1&&!this.boundingBox&&this.video&&(this.boundingBox=new di(this.video,this.visualizationOptions.boundingBox)),(t=this.visualizationOptions)!=null&&t.faceMesh&&this.visualizationOptions.faceMesh.enabled!==!1&&!this.faceMesh&&this.video&&(this.faceMesh=new ui(this.video,this.visualizationOptions.faceMesh)))}async stopCamera(){var e,t;this._isActive&&(this._isActive=!1,this.vitalSignEngine.stop(),(e=this.boundingBox)==null||e.update(void 0),(t=this.faceMesh)==null||t.update(void 0),this.faceDetectionResult=void 0,this.videoFrame=void 0,this.boundingBox&&(this.boundingBox.enabled=!1,this.boundingBox=void 0),this.faceMesh&&(this.faceMesh.destroy(),this.faceMesh=void 0),this.video&&this.stopVideo(),this.conditionChecker.reset(),this.camera&&(await this.camera.stop(),this.cameraStartTime=void 0))}async waitCameraToStop(e){return this.camera?await this.camera.waitUntilStopped(e):!0}async stopVideo(){const e=this.video;e.srcObject&&e.srcObject.getVideoTracks().forEach(t=>t.stop()),this.vitalSignEngine.stop(),clearInterval(this.faceDetectionTimer),this.faceDetectionTimer=void 0,this.faceDetectionFunction=void 0,console.log("[VitalSignCamera] stop Camera")}startScanning(){var e,t;console.log("[VitalSignCamera] start scanning..."),this.vsStatus="measuring",(e=this.frameGrabber)==null||e.reset(),(t=this.realtimeEstimator)==null||t.reset(),this.vitalSignEngine.start()}stopScanning(){console.log("[VitalSignCamera] stop scanning..."),this.vitalSignEngine.stop()}convertFaceBox(e){if(e===void 0)return;if(!this.videoSettings||!this.faceDetectionRegionAbs)return e;const t=(e.xCenter*this.faceDetectionRegionAbs.width+this.faceDetectionRegionAbs.x)/this.videoSettings.width,n=(e.yCenter*this.faceDetectionRegionAbs.height+this.faceDetectionRegionAbs.y)/this.videoSettings.height,a=e.width*this.faceDetectionRegionAbs.width/this.videoSettings.width,l=e.height*this.faceDetectionRegionAbs.height/this.videoSettings.height;return{xCenter:t,yCenter:n,width:a,height:l}}convertLandmarks(e){if(e===void 0)return;if(this.videoSettings===void 0||!this.faceDetectionRegionAbs)return e;const t=this.videoSettings,n=this.faceDetectionRegionAbs;return e.map(a=>{const l=(a.x*n.width+n.x)/t.width,h=(a.y*n.height+n.y)/t.height,o=a.z;return{x:l,y:h,z:o}})}startFaceDetection(){this.faceDetectionFunction!==void 0&&(this.faceDetectionTimer&&(clearInterval(this.faceDetectionTimer),this.faceDetectionTimer=void 0),this.faceDetectionTimer=setInterval(this.faceDetectionFunction,1e3/this.maxFaceDetectionFps))}async processVideoFrame(){const e=this.video,{width:t,height:n}=nr(this.presetFormat||Se.hd1920x1080);this.precisionModeChecker.reset();const a=new cr(e,{width:t,height:n,deviceId:this.device,preferredCamera:this.preferredCamera,callbackFrameRate:this.maxFps,handleIOS17Bug:te.isIOS&&We(te.browserVersion,"17")>=0,handleIOS17ObjectFitBug:te.isIOS&&We(te.browserVersion,"17.2")>=0,onFrame:p=>{var x,S,y,w,b,u,g,D,E,v,M,F,T,P,A,j;if(a.croppingRegion=this.faceDetectionRegionAbs,this.cameraStartTime===void 0)return;const U=new Date().getTime()-this.cameraStartTime.getTime();if((((x=this.videoSettings)==null?void 0:x.width)!=e.videoWidth||((S=this.videoSettings)==null?void 0:S.height)!=e.videoHeight)&&this.updateVideoSettings(e)!=="ok"&&U>5e3){console.error("[VitalSignCamera] Could not get camera settings."),a.stop(),this.onError&&this.onError(new Error("undefined camera dimension"));return}if(this.cameraFps.tick(),this.faceDetectionResult==null)return;this.conditionChecker.processFrame(this.faceDetectionResult.videoFrame,(y=this.faceDetectionResult)==null?void 0:y.faceBox,this.vsStatus==="idle"?this.checkBrightness:!1,this.cameraFps.average,this.vsStatus),this.precisionModeChecker.process(this.cameraFps.average,this.vsStatus);const{images:H}=this.roiExtractor.processFrame(p,this.faceDetectionResult,this.vsStatus);this.videoFrame=p;const G=this.faceDetectionResult.faceBox,X={faceBox:G,landmarks:this.faceDetectionResult.landmarks,videoFrameInfo:p,images:H,userInfo:this.userInfo},W=this.vitalSignEngine.getHealth(X);if(this.healthResult=W,this.vsStatus==="measuring"&&(W.stage===q.Idle&&(this.vsStatus="idle",this.vitalSignEngine.stop(),W.error&&this.onError&&this.onError(W.error)),(b=(w=W.health)==null?void 0:w.vitalSigns)!=null&&b.heartRate&&((D=this.realtimeEstimator)==null||D.updateWithServerResult(W.health.vitalSigns.heartRate,(u=W.health.scanParameters)==null?void 0:u.snr,(g=W.health.scanParameters)==null?void 0:g.signalQuality)),(E=this.ageEstimator)==null||E.processFrame(p,W.stage,W.remainingTime),(v=this.realtimeEstimator)==null||v.processFrame(p,W.stage,W.remainingTime,H),(T=this.beautyAnalyzer)==null||T.processFrame(p,G,(F=(M=this.ageEstimator)==null?void 0:M.estimation)==null?void 0:F.age,W.stage,W.remainingTime),(P=this.frameGrabber)==null||P.processFrame(p,W.stage,W.remainingTime)),this.boundingBox){const Z=this.convertFaceBox((A=this.faceDetectionResult)==null?void 0:A.faceBox);this.boundingBox.update(Z)}if(this.faceMesh){const Z=this.convertLandmarks((j=this.faceDetectionResult)==null?void 0:j.landmarks);this.faceMesh.update(Z)}this.processedFrame&&this.onVideoFrameProcessed&&this.onVideoFrameProcessed(this.processedFrame)}});try{a.croppingRegion=this.faceDetectionRegionAbs,await a.start(),this.updateVideoSettings(e),this._device=a.deviceId,this.cameraStartTime=new Date}catch(p){console.error("[VitalSignCamera] Could not start camera: ",p),this.onError&&this.onError(p);return}let l=!1;const h=3;let o=0;const f=document.createElement("canvas");this.faceDetectionFunction=async()=>{if(this.faceDetector===void 0||!this.faceDetectionTimer||this.cameraFps.frameCount==0||l||!e.srcObject||this.videoSettings===void 0)return;const p=this.videoSettings;l=!0;const x=this.faceDetectionRegionAbs||{x:0,y:0,width:p.width,height:p.height},S=x.width/x.height;if(f.width=S>1?320:320*S,f.height=f.width/S,this.faceDetectorType!==ne.Dummy){let y=f.getContext("2d",{willReadFrequently:!0});y?.drawImage(e,x.x,x.y,x.width,x.height,0,0,f.width,f.height)}try{this.faceDetector.detect({image:f}).then(y=>{this.faceDetectionFps.tick(),this.faceDetectionResult={...y,faceDetectionRegion:x}})}catch(y){o++,console.error(`Face detector crashed: ${y}`),console.log(`Face detector crash count: ${o}`),o>h&&(console.log(`Face detector crashed ${o} times, falling back to dummy detector.`),this.faceDetectorType=ne.Dummy,this.faceDetector=await li(this.faceDetectorType))}l=!1},this.startFaceDetection(),this.camera=a}}function sa(s){return new ia(s)}var Ae=(s=>(s.OK="ok",s.TooFar="tooFar",s.TooClose="tooClose",s))(Ae||{}),ve=(s=>(s.Centered="centered",s.TooHigh="tooHigh",s.TooLow="tooLow",s.TooLeft="tooLeft",s.TooRight="tooRight",s.Unknown="unknown",s))(ve||{}),Me=(s=>(s.relaxed="relaxed",s.strict="strict",s))(Me||{});function na(s){return typeof s=="boolean"?s?"Yes":"No":typeof s=="string"?s:typeof s=="number"?s.toFixed(1):s===void 0?"undefined":s===null?"null":"unknown type"}function ra(s){switch(s){case Ze.Poor:return"Poor";case Ze.Good:return"Good";case Ze.Excellent:return"Excellent";case void 0:return"undefined";case null:return"null";default:return"Unknown"}}function I(s,e){return e===null?`<!-- ${s} is null -->`:e===void 0?`<!-- ${s} is undefined -->`:`<!-- ${s}: ${typeof e} --><li>${s}: ${na(e)}</li>`}function aa(s,e){const t=e.healthResult?.health;if(t)if(t){const n=t.scanParameters?.conditions?.[0]!==void 0?t.scanParameters?.conditions?.[0]:t.scanParameters?.signalConditions?.hrSteadiness,a=t.scanParameters?.conditions?.[1]!==void 0?t.scanParameters?.conditions?.[1]:t.scanParameters?.signalConditions?.goodSnr,l=t.scanParameters?.conditions?.[2]!==void 0?t.scanParameters?.conditions?.[2]:t.scanParameters?.signalConditions?.noSpeedJitter,h=t.scanParameters?.conditions?.[3]!==void 0?t.scanParameters?.conditions?.[3]:t.scanParameters?.signalConditions?.goodAverageSpeed,o=t.scanParameters?.conditions?.[4]!==void 0?t.scanParameters?.conditions?.[4]:t.scanParameters?.signalConditions?.signalSteadiness;s.innerHTML=`
    <hr/>
    <fieldset>
      <legend>Vital Signs</legend>
      <ul>
      ${I("Heart Rate",t.vitalSigns?.heartRate)}
      ${I("SPO2",t.vitalSigns?.spo2)}
      ${I("Respiratory Rate",t.vitalSigns?.respiratoryRate)}
      ${I("HRV SDNN",t.vitalSigns?.hrvSdnn)}
      ${I("HRV RMSSD",t.vitalSigns?.hrvRmssd)}
      ${I("Temperature",t.vitalSigns?.temperature)}
      ${I("Blood Pressure",t.vitalSigns?.bloodPressure)}
      ${I("Blood Pressure Systolic",t.vitalSigns?.bloodPressureSystolic)}
      ${I("Blood Pressure Diastolic",t.vitalSigns?.bloodPressureDiastolic)}
      ${I("Blood Alcohol",t.vitalSigns?.bloodAlcohol)}
      ${I("Blood Sugar",t.vitalSigns?.bloodSugar)}
      ${I("Facial Skin Age",t.vitalSigns?.facialSkinAge)}
      </ul>
    </fieldset>
    <fieldset>
      <legend>Cardiovascular Risk</legend>
      <ul>
      ${I("General Risk",t.risks?.cardiovascularRisks?.generalRisk)}
      ${I("Coronary Heart Disease",t.risks?.cardiovascularRisks?.coronaryHeartDisease)}
      ${I("Congestive Heart Failure",t.risks?.cardiovascularRisks?.congestiveHeartFailure)}
      ${I("Intermittent Claudication",t.risks?.cardiovascularRisks?.intermittentClaudication)}
      ${I("Stroke",t.risks?.cardiovascularRisks?.stroke)}
      </ul>
    </fieldset>
    <fieldset>
      <legend>Holistic Health</legend>
      <ul>
      ${I("General Wellness",t.holisticHealth?.generalWellness)}
      ${I("BMI",t.holisticHealth?.bmi)}
      ${I("ABSI",t.holisticHealth?.absi)}
      ${I("ABSIZ",t.holisticHealth?.absiz)}
      ${I("Cardiac Workload",t.holisticHealth?.cardiacWorkload)}
      ${I("Pulse Respiratory Quotient",t.holisticHealth?.pulseRespiratoryQuotient)}
      ${I("Waist To Height Ratio",t.holisticHealth?.waistToHeightRatio)}
      ${I("Cardiovascular System Wellness",t.holisticHealth?.cardiovascularSystemWellness)}
      ${I("Mental Wellness",t.holisticHealth?.mentalWellness)}
      ${I("Physical Wellness",t.holisticHealth?.physicalWellness)}
      ${I("Respiratory System Wellness",t.holisticHealth?.respiratorySystemWellness)}
      </ul>
    </fieldset>

    <fieldset>
      <legend>Health Risks</legend>
      <ul>
      ${I("Covid Risk",t.risks?.covidRisk?.covidRisk)}
      ${I("Diabetes Risk",t.risks?.diabetesRisk)}
      ${I("Hypertension Risk",t.risks?.hypertensionRisk)}
      </ul>
    </fieldset>

    <fieldset>
      <legend>Scan Parameters</legend>
      <ul>
      ${I("Signal Quality",t.scanParameters?.signalQuality)}
      ${I("Warning",t.scanParameters?.warning)}
      ${I("HR Steadiness",n)}
      ${I("Good SNR",a)}
      ${I("No Speed Jitter",l)}
      ${I("Good Average Speed",h)}
      ${I("Signal Steadiness",o)}
      ${I("Fixed Head Position",t.scanParameters?.signalConditions?.fixedHeadPosition)}
      ${I("No Head turning",t.scanParameters?.signalConditions?.noHeadTurning)}
      ${I("Adequate Brightness",t.scanParameters?.signalConditions?.adequateBrightness)}
      ${I("Even Lighting On Face",t.scanParameters?.signalConditions?.evenLightingOnFace)}
      ${I("Good Signal Percentage",ra(t.scanParameters?.signalConditions?.goodSignalPercentage))}
      ${I("HR Signal Quality",t.scanParameters?.signalConditions?.hrSignalQuality)}
      ${I("RR Signal Quality",t.scanParameters?.signalConditions?.rrSignalQuality)}
      ${I("BP Signal Quality",t.scanParameters?.signalConditions?.bpSignalQuality)}
      ${I("Invalid Pixel Percentage",t.scanParameters?.invalidPixelPercentage)}
      ${I("Signal Duration",t.scanParameters?.signalDuration)}
      ${I("SNR",t.scanParameters?.snr)}
      </ul>
    </fieldset>
    `}else Ii(s)}function Ii(s){s.innerHTML=""}function oa(s){return s===!1?"Improve lighting":null}function la(s,e){if(s===!1)switch(e){case ve.TooLeft:return"Move right";case ve.TooRight:return"Move left";case ve.TooHigh:return"Move down";case ve.TooLow:return"Move up";case ve.Unknown:return"Center face";default:return"Center face"}return null}function ca(s){return s===!1?"Hold still":null}function ha(s,e){if(s===!1)switch(e){case Ae.TooFar:return"Move closer";case Ae.TooClose:return"Move back";default:return"Adjust distance"}return null}function da(s){return s===!1?"Low frame rate":null}function ua(s){return s===!1?"Server not ready":null}function ga(s){return!(s===void 0||!s.lighting||!s.centered||!s.movement||!s.distance||!s.frameRate||!s.serverReady)}function fa(s,e){const t=[],n=oa(e.scanConditions?.lighting);n&&t.push(n);const a=la(e.scanConditions?.centered,e.scanConditions?.facePositionCondition);a&&t.push(a);const l=ca(e.scanConditions?.movement);l&&t.push(l);const h=ha(e.scanConditions?.distance,e.scanConditions?.distanceCondition);h&&t.push(h);const o=da(e.scanConditions?.frameRate);o&&t.push(o);const f=ua(e.scanConditions?.serverReady);if(f&&t.push(f),t.length===0)s.innerHTML='<div style="color: var(--success); text-align: center;"><i class="fas fa-check-circle"></i> Ready to Scan</div>';else{const p=t.join(" & ");s.innerHTML=`
      <ul style="list-style: none; padding: 0; margin: 0; width: 100%; display: flex; justify-content: center;">
        <li style="color: var(--warning); margin-bottom: 4px; display: flex; align-items: center; gap: 8px; text-align: center;">
            <i class="fas fa-exclamation-triangle"></i> ${p}
        </li>
      </ul>
    `}}var pt;function Bi(s,e){pt=e,pt?(s.innerHTML=`${pt}`,s.style.display="inline-block"):(s.innerHTML="",s.style.display="none")}function ma(s){Bi(s,void 0)}function pa(s,e,t){s.innerHTML=e.map(n=>{const a=t.device===n.id?"selected":"";return`<option value="${n.id}" ${a}>${n.label}</option>`}).join(`
`)}async function va(s,e){const t=document.getElementById("cameraBtn"),n=document.getElementById("cameraDropdown");t?.addEventListener("click",a=>{a.stopPropagation();const l=n.style.display==="block";n.style.display=l?"none":"block"}),document.addEventListener("click",a=>{!t?.contains(a.target)&&!n?.contains(a.target)&&(n.style.display="none")}),e.onCameraDevicesUpdated=a=>{pa(s,a.devices,e),a.devices.length>1&&s.removeAttribute("disabled")},s.addEventListener("change",()=>{e.device=s.value,n.style.display="none"})}function wa(s,e){e.healthResult?.stage!==q.Idle?s.setAttribute("hidden",""):s.removeAttribute("hidden")}let Ie=!1,it=!1;function ya(s,e,t,n,a,l,h,o){s.addEventListener("click",()=>{if(Ie)e.stopScanning(),s.innerHTML='<i class="fas fa-play"></i> Start Scan',s.removeAttribute("disabled"),s.classList.remove("scanning"),document.body.classList.remove("scanning-active"),Ie=!1,it=!1,a("Scan cancelled");else{h(t),o(n),it=!1;const f=document.querySelector("#pulseValue"),p=document.querySelector("#qualityValue"),x=document.querySelector("#snrValue"),S=document.querySelector("#confidenceValue"),y=document.querySelector("#qualityScore");f.textContent="--",p.textContent="--",x.textContent="--",S.textContent="--",y.textContent="--",l(),s.innerHTML='<i class="fas fa-spinner fa-spin"></i> Scanning...',s.classList.add("scanning"),document.body.classList.add("scanning-active"),Ie=!0,e.startScanning()}})}function ba(s,e){if(!Ie)return;let t="";switch(e.healthResult?.stage){case q.CollectingData:t=`Scanning... ${(e.healthResult?.remainingTime||0).toFixed(0)}s`;break;case q.AnalyzingData:t=`Analyzing... ${(e.healthResult?.remainingTime||0).toFixed(0)}s`;break;default:return}t&&(s.innerHTML=`<i class="fas fa-spinner fa-spin"></i> ${t}`)}function xa(s,e){it||(it=!0,s.innerHTML='<i class="fas fa-play"></i> Start Scan',s.classList.remove("scanning"),document.body.classList.remove("scanning-active"),Ie=!1,e("Vital signs scan completed successfully!"))}function ka(s){const e="325168";let t="";const n=document.querySelector("#passwordScreen"),a=document.querySelectorAll(".num-btn"),l=document.querySelector("#resetBtn"),h=document.querySelector("#bellBtn");a.forEach(o=>{o.addEventListener("click",()=>{t+=o.getAttribute("data-num"),o.classList.add("pressed"),setTimeout(()=>o.classList.remove("pressed"),200)})}),l.addEventListener("click",()=>{t="",l.classList.add("pressed"),setTimeout(()=>l.classList.remove("pressed"),200)}),h.addEventListener("click",()=>{t===e?(n.style.display="none",s()):t="",h.classList.add("pressed"),setTimeout(()=>h.classList.remove("pressed"),200)}),document.addEventListener("keydown",o=>{if(n.style.display!=="none"){const f=o.key;let p=null;f>="0"&&f<="9"?(t+=f,p=document.querySelector(`.num-btn[data-num="${f}"]`),o.preventDefault()):f==="Backspace"?(t=t.slice(0,-1),p=document.querySelector("#resetBtn"),o.preventDefault()):f==="Enter"?(t===e?(n.style.display="none",s()):t="",p=document.querySelector("#bellBtn"),o.preventDefault()):f==="Escape"&&(t="",p=document.querySelector("#resetBtn"),o.preventDefault()),p&&(p.classList.add("pressed"),setTimeout(()=>p.classList.remove("pressed"),200))}})}window.onload=()=>{ka(()=>{const s=document.querySelector("#mainContainer");s.style.display="block";const e={apiKey:"3AQMwZWvDf566xPwuMfvd5FLjPEw3j6G3Q3SPpAC",userId:"07a51b41-e1a4-4570-94a7-04ef371cc4f3"},t={age:30,gender:pi.Male,weight:60,height:170},n=document.querySelector("#startScanBtn"),a=document.querySelector("#scanConditions"),l=document.querySelector("#report"),h=document.querySelector("video"),o=document.querySelector("#error"),f=document.querySelector("#cameraPicker"),p=document.querySelector("#pulseValue"),x=document.querySelector("#qualityValue"),S=document.querySelector("#snrValue"),y=document.querySelector("#confidenceValue"),w=document.querySelector("#heartbeatContainer"),b=document.querySelector("#heartbeatIcon"),u=document.querySelector("#signalVisualizerContainer"),g=document.querySelector("#settingsBtn"),D=sa({precisionMode:Me.relaxed,isActive:!0,sdkCredentials:e,userInfo:t,visualizationOptions:{boundingBox:{enabled:!0}},realtimeEstimationConfig:{earlyEstimation:!0,minDuration:5,minConfidence:.3}});D.onError=P=>Bi(o,P),D.bind(h),va(f,D);let E=null,v="PPG";function M(P,A=!0){if(P&&P>0&&A){w.classList.add("active");const j=60/P;b.style.animationDuration=`${j}s`}else w.classList.remove("active")}function F(P=v){v=P,E&&(E.destroy(),E=null),E=new Pr(u,{width:300,height:100,maxPoints:200,lineColor:"#00ff00",backgroundColor:"transparent",visualizationType:P})}D.onVideoFrameProcessed=P=>{fa(a,P),wa(f,P),aa(l,P),ba(n,P);const A=document.querySelector(".history-section"),j=document.querySelector(".scanner-actions");if(Ie?(j.style.display="block",A.style.display="none"):ga(P.scanConditions)?(n.removeAttribute("disabled"),j.style.display="block",A.style.display="none"):(n.setAttribute("disabled","true"),j.style.display="none",A.style.display="block"),P.realtimeEstimation){const U=P.realtimeEstimation;if(U.heartRate?(p.textContent=Math.round(U.heartRate).toString(),M(U.heartRate,Ie)):M(0,Ie),U.signalQuality!==void 0&&U.signalQuality!==null){const H=Math.round(U.signalQuality/100*5),G="★".repeat(H),X="☆".repeat(5-H);x.textContent=G+X;const W=document.querySelector("#qualityScore");W.textContent=`${Math.round(U.signalQuality)}%`}U.snr!==void 0&&U.snr!==null&&(S.textContent=U.snr.toFixed(1)),y.textContent=Math.round(U.confidence*100).toString()}if(E&&P.signalData){const U={...P.signalData,values:P.signalData.values.slice(-200),timestamps:P.signalData.timestamps.slice(-200)};E.updateSignal(U,P.realtimeEstimation||null,P.healthResult?.stage)}P.healthResult&&P.healthResult.health&&xa(n,T)},ya(n,D,l,o,T,F,Ii,ma),g.addEventListener("click",()=>{v=v==="PPG"?"ECG":"PPG",F(v),T(`Visualization type changed to ${v}`)});function T(P){const A=document.createElement("div");A.className="toast",A.textContent=P,document.body.appendChild(A),setTimeout(()=>{A.classList.add("show")},10),setTimeout(()=>{A.classList.remove("show"),setTimeout(()=>{document.body.removeChild(A)},300)},3e3)}})};export{at as a,Sa as b,Ra as c,dr as f,gr as g,q as j,Ca as m,sr as n,Da as o,rn as r,oi as s,Ea as u};

import{e as r,r as c,b as d,i}from"./index-DvXIqUHB.js";import{p as m}from"./DNiMR7Uc-BCxaXHv6.js";var l=Object.defineProperty,f=(s,e,a)=>e in s?l(s,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[e]=a,n=(s,e,a)=>f(s,typeof e!="symbol"?e+"":e,a);const{FaceLandmarker:k,FilesetResolver:h}=m;class p{constructor(){n(this,"faceLandmarker"),n(this,"runningMode","IMAGE"),n(this,"modelLocation",r.CDN)}getModelAssetPath(e){switch(e){case r.CDN:return"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task";case r.SelfHosted:const{protocol:a,host:t}=window.location;return`${a}//${t}/models/mpvision/face_landmarker/face_landmarker/float16/1/face_landmarker.task`}}getWasmPath(e){switch(e){case r.CDN:return"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm";case r.SelfHosted:const{protocol:a,host:t}=window.location;return`${a}//${t}/models/mpvision/tasks-vision@latest/wasm`}}async createFaceLandmarker(e){const a=this.getWasmPath(e||r.SelfHosted),t=await h.forVisionTasks(a),o=this.getModelAssetPath(e||r.SelfHosted);this.faceLandmarker=await k.createFromOptions(t,{baseOptions:{modelAssetPath:o,delegate:"GPU"},outputFaceBlendshapes:!0,runningMode:this.runningMode,numFaces:1})}async loadModels(e){var a;await this.createFaceLandmarker(e||this.modelLocation),(a=this.faceLandmarker)==null||a.detect(await c())}async detect(e){const a=d(e);if(this.faceLandmarker===void 0)return{faceBox:void 0,landmarks:[],videoFrame:a};const t=this.faceLandmarker.detect(a);if(t.faceLandmarks.length===0)return{faceBox:void 0,landmarks:[],videoFrame:a};const o=t.faceLandmarks[0];return{faceBox:i(o),landmarks:o,videoFrame:a}}async detectInWorker(e){if(this.faceLandmarker===void 0)return{faceBox:void 0,landmarks:[],videoFrame:e};const a=this.faceLandmarker.detect(e);if(a.faceLandmarks.length===0)return{faceBox:void 0,landmarks:[],videoFrame:e};const t=a.faceLandmarks[0];return{faceBox:i(t),landmarks:t,videoFrame:e}}}export{p as MPVisionFaceMeshDetector};
